<!DOCTYPE html><html lang="en"><head><style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style><style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Updated at 2021-10-20 10:25:35 UTC">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>devonfw guide</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" integrity="sha256-M/Awbb/BYh+Rh0aGjpQid26p1b2OBsrk2k9yAvQxPV0=" crossorigin="anonymous"></script>
<!-- JQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/styles/googlecode.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/lang/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>

<!-- ************** Google analytics ************ -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>

<!-- ******************************************** -->

</head>
<body id="master.asciidoc" class="book toc2 toc-left">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="/website/pages/explore/explore.html">EXPLORE</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html" class="active">DOCS</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input id="search-field" type="search" class="form-control mr-sm-2" placeholder="Search by keyword(s)..." aria-label="Search" style="height: auto;">
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width="auto" height="auto" alt>
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="header">
<h1>devonfw guide</h1>
<div class="details">
<span id="author" class="author">Updated at 2021-10-20 10:27:16 UTC</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="master.html">devonfw guide</a></span></p><ul class="sectlevel0">
<li><a href="getting-started.asciidoc.html">Getting Started</a>
</li>
<li><a href="devonfw-ide.asciidoc.html">devonfw-ide</a>
</li>
<li><a href="devon4j.asciidoc.html">Java</a>
<ul class="sectlevel1">
<li><a href="devon4j.asciidoc_general.html">General</a>
</li>
<li><a href="spring.asciidoc.html">Spring</a>
<ul class="sectlevel2">
<li><a href="spring.asciidoc_pros.html">Pros</a>
</li>
<li><a href="spring.asciidoc_cons.html">Cons</a>
</li>
<li><a href="spring.asciidoc_spring-boot.html">Spring-Boot</a>
</li>
<li><a href="spring.asciidoc_spring-native.html">Spring-Native</a>
</li>
<li><a href="guide-component.asciidoc.html">Components</a>
</li>
<li><a href="guide-structure-classic.asciidoc.html">Classic project structure</a>
</li>
<li><a href="devon4j.asciidoc_layers.html">Layers</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html"><span class="toc-current">Guides</span></a>
<ul class="sectlevel3">
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-spring-configuration.asciidoc">Configuration</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-auditing.asciidoc">Auditing</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-access-control.asciidoc">Access-Control</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-access-control-schema.asciidoc">Access Control Schema</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-jwt.asciidoc">JWT</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-csrf.asciidoc">Cross-site request forgery (CSRF)</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-aop.asciidoc">Aspect Oriented Programming (AOP)</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-exceptions.asciidoc">Exception Handling</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-i18n.asciidoc">Internationalization</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-service-client.asciidoc">Service Client</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#devon4j.wiki_guide-testing.asciidoc">Testing</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-transferobject.asciidoc">Transfer-Objects</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-beanmapping.asciidoc">Bean-Mapping</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-datatype.asciidoc">Datatypes</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#devon4j.wiki_guide-cors-support.asciidoc">CORS support</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-microservice.asciidoc">Microservices in devonfw</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-caching.asciidoc">Caching</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-feature-toggle.asciidoc">Feature-Toggles</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#devon4j.wiki_guide-accessibility.asciidoc">Accessibility</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-kafka.asciidoc">Messaging Services</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-jms.asciidoc">Messaging</a>
</li>
<li><a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-text-search.asciidoc">Full Text Search</a>
</li>
</ul>
</li>
<li><a href="devon4j.asciidoc_tutorials.html">Tutorials</a>
</li>
</ul>
</li>
<li><a href="quarkus.asciidoc.html">Quarkus</a>
</li>
</ul>
</li>
<li><a href="master-devon4ng.asciidoc.html">Angular</a>
</li>
<li><a href="master-devon4net.asciidoc.html">.net</a>
</li>
<li><a href="master-devon4node.asciidoc.html">NodeJS</a>
</li>
<li><a href="master-database.asciidoc.html">Choosing your Database</a>
</li>
<li><a href="devonfw-guide_master.asciidoc_2.html">Tools</a>
</li>
<li><a href="master-production-line.asciidoc.html">Production Line Templates</a>
</li>
<li><a href="master-my-thai-star.asciidoc.html">MyThaiStar</a>
</li>
<li><a href="hangar.asciidoc.html">Hangar</a>
</li>
<li><a href="master-contributing.asciidoc.html">Contributing</a>
</li>
<li><a href="master-release-notes.asciidoc.html">Release Notes</a>
</li>
</ul>
</div>
</div><div id="content">
<div class="sect2">
<h3 id="devon4j.wiki_devon4j.asciidoc_guides">Guides</h3>
<!-- toc disabled -->
<div class="sect3">
<h4 id="guide-spring-configuration.asciidoc">Configuration</h4>
<div class="sect4">
<h5 id="guide-spring-configuration.asciidoc_external-application-configuration">External Application Configuration</h5>
<div class="sect5">
<h6 id="guide-spring-configuration.asciidoc_database-configuration">Database Configuration</h6>
<div class="paragraph">
<p>The configuration for spring and Hibernate is already provided by devonfw in our sample application and the application template. So you only need to worry about a few things to customize.</p>
</div>
<div class="sect6">
<h7 id="guide-spring-configuration.asciidoc_database-system-and-access">Database System and Access</h7>
<div class="paragraph">
<p>Obviously you need to configure which type of database you want to use as well as the location and credentials to access it. The defaults are configured in <code>application.properties</code> that is bundled and deployed with the release of the software. The files should therefore contain the properties as in the given example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">  database.url=jdbc:postgresql://database.enterprise.com/app
  database.user.login=appuser01
  database.user.password=************
  database.hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect
  database.hibernate.hbm2ddl.auto=validate</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further details about <code>database.hibernate.hbm2ddl.auto</code> please see <a href="http://docs.jboss.org/hibernate/orm/5.0/manual/en-US/html/ch03.html#configuration-misc-properties">here</a>. For production and acceptance environments we use the value <code>validate</code> that should be set as default. In case you want to use Oracle RDBMS you can find additional hints <a href="guide-oracle.html#driver">here</a>.</p>
</div>
<div class="paragraph">
<p>If your application supports multiples database types, set <code>spring.profiles.active=XXX</code> in <code>src/main/resources/config/application.properties</code> choose database of your choice. Also, one has to set all the active spring profiles in this <code>application.properties</code> and not in any of the other <code>application.properties</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="guide-spring-configuration.asciidoc_database-logging">Database Logging</h7>
<div class="paragraph">
<p>Add the following properties to <code>application.properties</code> to enable logging of database queries for debugging purposes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">spring.jpa.properties.hibernate.show_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
spring.jpa.properties.hibernate.format_sql=true</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-configuration-mapping.asciidoc">Mapping configuration to your code</h5>
<div class="paragraph">
<p>If you are using <code>spring-boot</code> as suggested by <code>devon4j</code> your application can be configured by <code>application.properties</code> file as described in <a href="guide-configuration.asciidoc.html">configuration</a>.
To get a single configuration option into your code for flexibility, you can use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Value(&quot;${my.property.name}&quot;)
private String myConfigurableField;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, in your <code>application.properties</code> you can add the property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>my.property.name=my-property-value</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may even use <code>@Value(&quot;${my.property.name:my-default-value}&quot;)</code> to make the property optional.</p>
</div>
<div class="sect5">
<h6 id="guide-configuration-mapping.asciidoc_naming-conventions-for-configuration-properties">Naming conventions for configuration properties</h6>
<div class="paragraph">
<p>As a best practice your configruation properties should follow these naming conventions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>build the property-name as a path of segments separated by the dot character (<code>.</code>)</p>
</li>
<li>
<p>segments should get more specific from left to right</p>
</li>
<li>
<p>a property-name should either be a leaf value or a tree node (prefix of other property-names) but never both! So never have something like <code>foo.bar=value</code> and <code>foo.bar.child=value2</code>.</p>
</li>
<li>
<p>start with a segment namespace unique to your context or application</p>
</li>
<li>
<p>a good example would be <code>&#xAB;myapp&#xBB;.billing.service.email.sender</code> for the sender address of billing service emails send by <code>&#xAB;myapp&#xBB;</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="guide-configuration-mapping.asciidoc_mapping-advanced-configuration">Mapping advanced configuration</h6>
<div class="paragraph">
<p>However, in many scenarios you will have features that require more than just one property.
Injecting those via <code>@Value</code> is not leading to good code quality.
Instead we create a class with the suffix <code>ConfigProperties</code> containing all configuration properties for our aspect that is annotated with <code>@ConfigurationProperties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ConfigurationProperties(prefix = &quot;myapp.billing.service&quot;)
public class BillingServiceConfigProperties {

  private final Email email = new Email();
  private final Smtp smtp = new Smtp();

  public Email getEmail() { return this.email; }
  public Email getSmtp() { return this.smtp; }

  public static class Email {

    private String sender;
    private String subject;

    public String getSender() { return this.sender; }
    public void setSender(String sender) { this.sender = sender; }
    public String getSubject() { return this.subject; }
    public void setSubject(String subject) { this.subject = subject; }
  }

  public static class Smtp {

    private String host;
    private int port = 25;

    public String getHost() { return this.host; }
    public void setHost(String host) { this.host = host; }
    public int getPort() { return this.port; }
    public void setPort(int port) { this.port = port; }
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course this is just an example to demonstrate this feature of <code>spring-boot</code>.
In order to send emails you would typically use the existing <a href="https://www.baeldung.com/spring-email">spring-email</a> feature.
But as you can see this allows us to define and access our configuration in a very structured and comfortable way.
The annotation <code>@ConfigurationProperties(prefix = &quot;myapp.billing.service&quot;)</code> will automatically map spring configuration properties starting with <code>myapp.billing.service</code> via the according getters and setters into our <code>BillingServiceConfigProperties</code>.
We can easily define defaults (e.g. <code>25</code> as default value for <code>myapp.billing.service.smtp.port</code>).
Also <code>Email</code> or <code>Smtp</code> could be top-level classes to be reused in multiple configurations.
Of course you would also add helpful <code>JavaDoc</code> comments to the <code>getters</code> and classes to document your configuration options.
Further to access this configuration, we can use standard <a href="guide-dependency-injection.asciidoc.html">dependency-injection</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
private BillingServiceConfigProperties config;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For very generic cases you may also use <code>Map&lt;String, String&gt;</code> to map any kind of property in an untyped way.
An example for generic configuration from <code>devon4j</code> can be found in
<a href="https://github.com/devonfw/devon4j/blob/9b8f9461997bb5d8048a9fec42bec3625652eec3/modules/service/src/main/java/com/devonfw/module/service/common/base/config/ServiceConfigProperties.java">ServiceConfigProperties</a>.</p>
</div>
<div class="paragraph">
<p>For further details about this feature also consult <a href="https://www.baeldung.com/configuration-properties-in-spring-boot">Guide to @ConfigurationProperties in Spring Boot</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-configuration-mapping.asciidoc_generate-configuration-metadata">Generate configuration metadata</h6>
<div class="paragraph">
<p>You should further add this <code>dependency</code> to your module containing the <code>*ConfigProperties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
      &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate configuration metadata so projects using your code can benefit from autocompletion and getting your JavaDoc as tooltip when editing <code>application.properites</code> what makes this approach very powerful.
For further details about this please read <a href="https://www.baeldung.com/spring-boot-configuration-metadata">A Guide to Spring Boot Configuration Metadata</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-auditing.asciidoc">Auditing</h4>
<div class="paragraph">
<p>For database auditing we use <a href="http://envers.jboss.org/">hibernate envers</a>. If you want to use auditing ensure you have the following dependency in your pom.xml:</p>
</div>
<div class="listingblock">
<div class="title">Listing 20. <strong>spring</strong></div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.modules&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-jpa-envers&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 21. <strong>quarkus</strong></div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-hibernate-envers&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The following part applies only to spring applications. At this point, the Quarkus extension does not provide any additional configurations. For Quarkus applications, simply use the <code>@Audited</code> annotation to enable auditing for an entity class, as described a few lines below or seen <a href="https://hibernate.org/orm/envers/">here</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Make sure that entity manager also scans the package from the devon4j-jpa[-envers] module in order to work properly. And make sure that correct Repository Factory Bean Class is chosen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EntityScan(basePackages = { &quot;&#xAB;my.base.package&#xBB;&quot; }, basePackageClasses = { AdvancedRevisionEntity.class })
...
@EnableJpaRepositories(repositoryFactoryBeanClass = GenericRevisionedRepositoryFactoryBean.class)
...
public class SpringBootApp {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let your [Entity]Repository extend from DefaultRevisionedRepository instead of DefaultRepository.</p>
</div>
<div class="paragraph">
<p>The repository now has a method getRevisionHistoryMetadata(id) and getRevisionHistoryMetadata(id, boolean lazy) available to get a list of revisions for a given entity and a method find(id, revision) to load a specific revision of an entity with the given ID or getLastRevisionHistoryMetadata(id) to load last revision.
To enable auditing for a entity simply place the @Audited annotation to your entity and all entity classes it extends from.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Entity(name = &quot;Drink&quot;)
@Audited
public class DrinkEntity extends ProductEntity implements Drink {
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When auditing is enabled for an entity an additional database table is used to store all changes to the entity table and a corresponding revision number. This table is called &lt;ENTITY_NAME&gt;_AUD per default. Another table called REVINFO is used to store all revisions. Make sure that these tables are available. They can be generated by hibernate with the following property (only for development environments).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">  database.hibernate.hbm2ddl.auto=create</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another possibility is to put them in your <a href="guide-database-migration.asciidoc.html">database migration</a> scripts like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">CREATE CACHED TABLE PUBLIC.REVINFO(
  id BIGINT NOT NULL generated by default as identity (start with 1),
  timestamp BIGINT NOT NULL,
  user VARCHAR(255)
);
...
CREATE CACHED TABLE PUBLIC.&lt;TABLE_NAME&gt;_AUD(
    &lt;ALL_TABLE_ATTRIBUTES&gt;,
    revtype TINYINT,
    rev BIGINT NOT NULL
);</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="guide-access-control.asciidoc">Access-Control</h4>
<div class="paragraph">
<p>Access-Control is a central and important aspect of <a href="guide-security.asciidoc.html">Security</a>. It consists of two major aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guide-access-control.asciidoc_guide-access-control.asciidoc_Authentication">Authentication</a> (Who tries to access?)</p>
</li>
<li>
<p><a href="#guide-access-control.asciidoc_guide-access-control.asciidoc_Authorization">Authorization</a> (Is the one accessing allowed to do what he wants to do?)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_authentication">Authentication</h5>
<div class="paragraph">
<p>Definition:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Authentication is the verification that somebody interacting with the system is the actual subject for whom he claims to be.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The one authenticated is properly called <em>subject</em> or <a href="http://docs.oracle.com/javase/7/docs/api/java/security/Principal.html"><em>principal</em></a>. However, for simplicity we use the common term <em>user</em> even though it may not be a human (e.g. in case of a service call from an external system).</p>
</div>
<div class="paragraph">
<p>To prove his authenticity the user provides some secret called <em>credentials</em>. The most simple form of credentials is a password.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Please never implement your own authentication mechanism or credential store. You have to be aware of implicit demands such as salting and hashing credentials, password life-cycle with recovery, expiry, and renewal including email notification confirmation tokens, central password policies, etc. This is the domain of access managers and identity management systems. In a business context you will typically already find a system for this purpose that you have to integrate (e.g. via LDAP). Otherwise you should consider establishing such a system e.g. using <a href="http://keycloak.org">keycloak</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>We use <a href="https://projects.spring.io/spring-security/">spring-security</a> as a framework for authentication purposes.</p>
</div>
<div class="paragraph">
<p>Therefore you need to provide an implementation of <a href="https://docs.spring.io/spring-security/site/docs/4.2.x/apidocs/org/springframework/security/config/annotation/web/WebSecurityConfigurer.html">WebSecurityConfigurerAdapter</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@EnableWebSecurity
public class MyWebSecurityConfig extends WebSecurityConfigurerAdapter {

  @Inject
  private UserDetailsService userDetailsService;
  ...
  public void configure(HttpSecurity http) throws Exception {
    http.userDetailsService(this.userDetailsService)
        .authorizeRequests().antMatchers(&quot;/public/**&quot;).permitAll()
        .anyRequest().authenticated().and()
        ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see spring-security offers a fluent API for easy configuration. You can simply add invocations like <code>formLogin().loginPage(&quot;/public/login&quot;)</code> or <code>httpBasic().realmName(&quot;MyApp&quot;)</code>. Also <a href="guide-security.asciidoc.html">CSRF</a> protection can be configured by invoking <code>csrf()</code>.
For further details see <a href="https://docs.spring.io/spring-security/site/docs/current/reference/html/jc.html#jc-httpsecurity">spring Java-config for HTTP security</a>.</p>
</div>
<div class="paragraph">
<p>Further, you need to provide an implementation of the <a href="https://docs.spring.io/spring-security/site/docs/4.2.x/apidocs/org/springframework/security/core/userdetails/UserDetailsService.html">UserDetailsService</a> interface.
A good starting point comes with our application template.</p>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_preserve-original-request-anchors-after-form-login-redirect">Preserve original request anchors after form login redirect</h6>
<div class="paragraph">
<p>Spring Security will automatically redirect any unauthorized access to the defined login-page. After successful login, the user will be redirected to the original requested URL. The only pitfall is, that anchors in the request URL will not be transmitted to server and thus cannot be restored after successful login. Therefore the <code>devon4j-security</code> module provides the <code>RetainAnchorFilter</code>, which is able to inject javascript code to the source page and to the target page of any redirection. Using javascript this filter is able to retrieve the requested anchors and store them into a cookie. Heading the target URL this cookie will be used to restore the original anchors again.</p>
</div>
<div class="paragraph">
<p>To enable this mechanism you have to integrate the <code>RetainAnchorFilter</code> as follows:
First, declare the filter with</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>storeUrlPattern</code>: an regular expression matching the URL, where anchors should be stored</p>
</li>
<li>
<p><code>restoreUrlPattern</code>: an regular expression matching the URL, where anchors should be restored</p>
</li>
<li>
<p><code>cookieName</code>: the name of the cookie to save the anchors in the intermediate time</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can easily configure this as code in your <code>WebSecurityConfig</code> as following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">RetainAnchorFilter filter = new RetainAnchorFilter();
filter.setStoreUrlPattern(&quot;http://[^/]+/[^/]+/login.*&quot;);
filter.setRestoreUrlPattern(&quot;http://[^/]+/[^/]+/.*&quot;);
filter.setCookieName(&quot;TARGETANCHOR&quot;);
http.addFilterBefore(filter, UsernamePasswordAuthenticationFilter.class);</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_users-vs.-systems">Users vs. Systems</h6>
<div class="paragraph">
<p>If we are talking about authentication we have to distinguish two forms of principals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>human users</p>
</li>
<li>
<p>autonomous systems</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While e.g. a Kerberos/SPNEGO Single-Sign-On makes sense for human users it is pointless for authenticating autonomous systems. So always keep this in mind when you design your authentication mechanisms and separate access for human users from access for systems.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_using-jwt">Using JWT</h6>
<div class="paragraph">
<p>For authentication via JSON Web Token (JWT) see <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-jwt.asciidoc">JWT guide</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_mixed-authentication">Mixed Authentication</h6>
<div class="paragraph">
<p>In rare cases you might need to mix multiple authentication mechanisms (form based, basic-auth, SAMLv2, OAuth, etc.) within the same app (for different URLs). For KISS this should be avoided where possible. However, when needed, you can find a solution
<a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#multiple-httpsecurity">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_authorization">Authorization</h5>
<div class="paragraph">
<p><strong>Definition:</strong></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Authorization is the verification that an authenticated user is allowed to perform the operation he intends to invoke.</p>
</div>
</blockquote>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_clarification-of-terms">Clarification of terms</h6>
<div class="paragraph">
<p>For clarification we also want to give a common understanding of related terms that have no unique definition and consistent usage in the wild.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. Security terms related to authorization</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Term</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning and comment</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A permission is an object that allows a principal to perform an operation in the system. This permission can be <em>granted</em> (give) or <em>revoked</em> (taken away). Sometimes people also use the term <em>right</em> what is actually wrong as a right (such as the right to be free) can not be revoked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We use the term group in this context for an object that contains permissions. A group may also contain other groups. Then the group represents the set of all recursively contained permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We consider a role as a specific form of group that also contains permissions. A role identifies a specific function of a principal. A user can act in a role.</p>
<p class="tableblock">For simple scenarios a principal has a single role associated. In more complex situations a principal can have multiple roles but has only one active role at a time that he can choose out of his assigned roles. For KISS it is sometimes sufficient to avoid this by creating multiple accounts for the few users with multiple roles. Otherwise at least avoid switching roles at run-time in clients as this may cause problems with related states. Simply restart the client with the new role as parameter in case the user wants to switch his role.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any permission, group, role, etc., which declares a control for access management.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_suggestions-on-the-access-model">Suggestions on the access model</h6>
<div class="paragraph">
<p>For the access model we give the following suggestions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each Access Control (permission, group, role, &#x2026;&#x200B;) is uniquely identified by a human readable string.</p>
</li>
<li>
<p>We create a unique permission for each use-case.</p>
</li>
<li>
<p>We define groups that combine permissions to typical and useful sets for the users.</p>
</li>
<li>
<p>We define roles as specific groups as required by our business demands.</p>
</li>
<li>
<p>We allow to associate users with a list of Access Controls.</p>
</li>
<li>
<p>For authorization of an implemented use case we determine the required permission. Furthermore, we determine the current user and verify that the required permission is contained in the tree spanned by all his associated Access Controls. If the user does not have the permission we throw a security exception and thus abort the operation and transaction.</p>
</li>
<li>
<p>We avoid negative permissions, that is a user has no permission by default and only those granted to him explicitly give him additional permission for specific things. Permissions granted can not be reduced by other permissions.</p>
</li>
<li>
<p>Technically we consider permissions as a secret of the application. Administrators shall not fiddle with individual permissions but grant them via groups. So the access management provides a list of strings identifying the Access Controls of a user. The individual application itself contains these Access Controls in a structured way, whereas each group forms a permission tree.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_naming-conventions">Naming conventions</h6>
<div class="paragraph">
<p>As stated above each Access Control is uniquely identified by a human readable string. This string should follow the naming convention:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&#xAB;app-id&#xBB;.&#xAB;local-name&#xBB;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Access Control Permissions the <code>&#xAB;local-name&#xBB;</code> again follows the convention:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&#xAB;verb&#xBB;&#xAB;object&#xBB;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The segments are defined by the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Segments of Access Control Permission ID</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Segment</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#xAB;app-id&#xBB;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is a unique technical but human readable string of the application (or microservice). It shall not contain special characters and especially no dot or whitespace. We recommend to use <code>lower-train-case-ascii-syntax</code>. The identity and access management should be organized on enterprise level rather than application level. Therefore permissions of different apps might easily clash (e.g. two apps might both define a group <code>ReadMasterData</code> but some user shall get this group for only one of these two apps). Using the <code>&#xAB;app-id&#xBB;.</code> prefix is a simple but powerful namespacing concept that allows you to scale and grow. You may also reserve specific &#xAB;app-id&#xBB;s for cross-cutting concerns that do not actually reflect a single app e.g to grant access to a geographic region.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shop</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#xAB;verb&#xBB;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The action that is to be performed on &#xAB;object&#xBB;. We use <code>Find</code> for searching and reading data. <code>Save</code> shall be used both for create and update. Only if you really have demands to separate these two you may use <code>Create</code> in addition to <code>Save</code>. Finally, <code>Delete</code> is used for deletions. For non CRUD actions you are free to use additional verbs such as <code>Approve</code> or <code>Reject</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Find</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#xAB;object&#xBB;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The affected object or entity. Shall be named according to your data-model</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Product</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>So as an example <code>shop.FindProduct</code> will reflect the permission to search and retrieve a <code>Product</code> in the <code>shop</code> application. The group <code>shop.ReadMasterData</code> may combine all permissions to read master-data from the <code>shop</code>. However, also a group <code>shop.Admin</code> may exist for the <code>Admin</code> role of the <code>shop</code> application. Here the <code>&#xAB;local-name&#xBB;</code> is <code>Admin</code> that does not follow the <code>&#xAB;verb&#xBB;&#xAB;object&#xBB;</code> schema.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_devon4j-security">devon4j-security</h6>
<div class="paragraph">
<p>The module <code>devon4j-security</code> provides ready-to-use code based on <a href="http://projects.spring.io/spring-security/">spring-security</a> that makes your life a lot easier.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/Security-AccessControl.png"><img src="images/Security-AccessControl.png" alt="access-control"></a>
</div>
<div class="title">Figure 7. devon4j Security Model</div>
</div>
<div class="paragraph">
<p>The diagram shows the model of <code>devon4j-security</code> that separates two different aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>Identity- and Access-Management</em> is provided by according products and typically already available in the enterprise landscape (e.g. an active directory). It provides a hierarchy of <em>primary access control objects</em> (roles and groups) of a user. An administrator can grant and revoke permissions (indirectly) via this way.</p>
</li>
<li>
<p>The application security defines a hierarchy of <em>secondary access control objects</em> (groups and permissions). This is done by configuration owned by the application (see following section). The &quot;API&quot; is defined by the IDs of the primary access control objects that will be referenced from the <em>Identity- and Access-Management</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_access-control-config">Access Control Config</h6>
<div class="paragraph">
<p>In your application simply extend <code>AccessControlConfig</code> to configure your access control objects as code and reference it from your use-cases. An example config may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
public class ApplicationAccessControlConfig extends AccessControlConfig {

  public static final String APP_ID = &quot;MyApp&quot;;

  private static final String PREFIX = APP_ID + &quot;.&quot;;

  public static final String PERMISSION_FIND_OFFER = PREFIX + &quot;FindOffer&quot;;

  public static final String PERMISSION_SAVE_OFFER = PREFIX + &quot;SaveOffer&quot;;

  public static final String PERMISSION_DELETE_OFFER = PREFIX + &quot;DeleteOffer&quot;;

  public static final String PERMISSION_FIND_PRODUCT = PREFIX + &quot;FindProduct&quot;;

  public static final String PERMISSION_SAVE_PRODUCT = PREFIX + &quot;SaveProduct&quot;;

  public static final String PERMISSION_DELETE_PRODUCT = PREFIX + &quot;DeleteProduct&quot;;

  public static final String GROUP_READ_MASTER_DATA = PREFIX + &quot;ReadMasterData&quot;;

  public static final String GROUP_MANAGER = PREFIX + &quot;Manager&quot;;

  public static final String GROUP_ADMIN = PREFIX + &quot;Admin&quot;;

  public ApplicationAccessControlConfig() {

    super();
    AccessControlGroup readMasterData = group(GROUP_READ_MASTER_DATA, PERMISSION_FIND_OFFER, PERMISSION_FIND_PRODUCT);
    AccessControlGroup manager = group(GROUP_MANAGER, readMasterData, PERMISSION_SAVE_OFFER, PERMISSION_SAVE_PRODUCT);
    AccessControlGroup admin = group(GROUP_ADMIN, manager, PERMISSION_DELETE_OFFER, PERMISSION_DELETE_PRODUCT);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_configuration-on-java-method-level">Configuration on Java Method level</h6>
<div class="paragraph">
<p>In your use-case you can now reference a permission like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
public class UcSafeOfferImpl extends ApplicationUc implements UcSafeOffer {

  @Override
  @RolesAllowed(ApplicationAccessControlConfig.PERMISSION_SAVE_OFFER)
  public OfferEto save(OfferEto offer) { ... }
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_check-data-permissions">Check Data-Permissions</h6>
<div class="paragraph">
<p>See <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-data-permission.asciidoc">data permissions</a></p>
</div>
</div>
<div class="sect5">
<h6 id="guide-access-control.asciidoc_access-control-schema-deprecated">Access Control Schema (deprecated)</h6>
<div class="paragraph">
<p>The <code>access-control-schema.xml</code> approach is deprecated. The documentation can still be found in <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-access-control-schema.asciidoc">access control schema</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-access-control-schema.asciidoc">Access Control Schema</h4>
<div class="paragraph">
<p>With release <code>3.0.0</code> the <code>access-control-schema.xml</code> has been deprecated. You may still use it and find the documentation in this section. However, for new devonfw applications always start with the new approach described in <a href="guide-access-control.html#access-control-config.asciidoc">access control config</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-access-control-schema.asciidoc_legacy-access-control-schema-documentation">Legacy Access Control Schema Documentation</h5>
<div class="paragraph">
<p>The file <code>access-control-schema.xml</code> is used to define the mapping from groups to permissions (see <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/resources/config/app/security/access-control-schema.xml">example from sample app</a>). The general terms discussed above can be mapped to the implementation as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. General security terms related to devon4j access control schema</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Term</strong></th>
<th class="tableblock halign-left valign-top"><strong>devon4j-security implementation</strong></th>
<th class="tableblock halign-left valign-top"><strong>Comment</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccessControlPermission</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccessControlGroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When considering different levels of groups of different meanings, declare <code>type</code> attribute, e.g. as &quot;group&quot;.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccessControlGroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With <code>type=&quot;role&quot;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccessControl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Super type that represents a tree of <code>AccessControlGroups</code> and <code>AccessControlPermissions</code>. If a principal &quot;has&quot; a <code>AccessControl</code> he also &quot;has&quot; all <code>AccessControls</code> with according permissions in the spanned sub-tree.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Listing 22. Example access-control-schema.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;access-control-schema&gt;
  &lt;group id=&quot;ReadMasterData&quot; type=&quot;group&quot;&gt;
    &lt;permissions&gt;
      &lt;permission id=&quot;OfferManagement_GetOffer&quot;/&gt;
      &lt;permission id=&quot;OfferManagement_GetProduct&quot;/&gt;
      &lt;permission id=&quot;TableManagement_GetTable&quot;/&gt;
      &lt;permission id=&quot;StaffManagement_GetStaffMember&quot;/&gt;
    &lt;/permissions&gt;
  &lt;/group&gt;

  &lt;group id=&quot;Waiter&quot; type=&quot;role&quot;&gt;
    &lt;inherits&gt;
      &lt;group-ref&gt;Barkeeper&lt;/group-ref&gt;
    &lt;/inherits&gt;
    &lt;permissions&gt;
      &lt;permission id=&quot;TableManagement_ChangeTable&quot;/&gt;
    &lt;/permissions&gt;
  &lt;/group&gt;
  ...
&lt;/access-control-schema&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example <code>access-control-schema.xml</code> declares</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a group named <code>ReadMasterData</code>, which grants four different permissions, e.g., <code>OfferManagement_GetOffer</code></p>
</li>
<li>
<p>a group named <code>Waiter</code>, which</p>
<div class="ulist">
<ul>
<li>
<p>also grants all permissions from the group <code>Barkeeper</code></p>
</li>
<li>
<p>in addition grants the permission <code>TableManagement_ChangeTable</code></p>
</li>
<li>
<p>is marked to be a <code>role</code> for further application needs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The devon4j-security module automatically validates the schema configuration and will throw an exception if invalid.</p>
</div>
<div class="paragraph">
<p>Unfortunately, Spring Security does not provide differentiated interfaces for authentication and authorization. Thus we have to provide an <code>AuthenticationProvider</code>, which is provided from Spring Security as an interface for authentication and authorization simultaneously.
To integrate the devon4j-security provided access control schema, you can simply inherit your own implementation from the devon4j-security provided abstract class <code>AbstractAccessControlBasedAuthenticationProvider</code> and register your <code>ApplicationAuthenticationProvider</code> as an <code>AuthenticationManager</code>. Doing so, you also have to declare the two Beans <code>AccessControlProvider</code> and <code>AccessControlSchemaProvider</code>, which are precondition for the <code>AbstractAccessControlBasedAuthenticationProvider</code>.</p>
</div>
<div class="paragraph">
<p>As state of the art devon4j will focus on role-based authorization to cope with authorization for executing use case of an application.
We will use the JSR250 annotations, mainly <code>@RolesAllowed</code>, for authorizing method calls against the permissions defined in the annotation body. This has to be done for each use-case method in logic layer. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class OrdermanagementImpl extends AbstractComponentFacade implements Ordermanagement {

  @RolesAllowed(Roles.WAITER)
  public PaginatedListTo&lt;OrderCto&gt; findOrdersByPost(OrderSearchCriteriaTo criteria) {

    return findOrderCtos(criteria);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now this method can only be called if a user is logged-in that has the permission <code>FIND_TABLE</code>.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
<div class="sect4">
<h5 id="guide-data-permission.asciidoc">Data-permissions</h5>
<div class="paragraph">
<p>In some projects there are demands for permissions and authorization that is dependent on the processed data. E.g. a user may only be allowed to read or write data for a specific region. This is adding some additional complexity to your authorization. If you can avoid this it is always best to keep things simple. However, in various cases this is a requirement. Therefore the following sections give you guidance and patterns how to solve this properly.</p>
</div>
<div class="sect5">
<h6 id="guide-data-permission.asciidoc_structuring-your-data">Structuring your data</h6>
<div class="paragraph">
<p>For all your business objects (entities) that have to be secured regarding to data permissions we recommend that you create a separate interface that provides access to the relevant data required to decide about the permission. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface SecurityDataPermissionCountry {

  /**
   * @return the 2-letter ISO code of the country this object is associated with. Users need
   *         a data-permission for this country in order to read and write this object.
   */
  String getCountry();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now related business objects (entities) can implement this interface. Often such data-permissions have to be applied to an entire object-hierarchy. For security reasons we recommend that also all child-objects implement this interface. For performance reasons we recommend that the child-objects redundantly store the data-permission properties (such as <code>country</code> in the example above) and this gets simply propagated from the parent, when a child object is created.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-data-permission.asciidoc_permissions-for-processing-data">Permissions for processing data</h6>
<div class="paragraph">
<p>When saving or processing objects with a data-permission, we recommend to provide dedicated methods to verify the permission in an abstract base-class such as <code>AbstractUc</code> and simply call this explicitly from your business code. This makes it easy to understand and debug the code. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected void verifyPermission(SecurityDataPermissionCountry entity) throws AccessDeniedException;</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="guide-data-permission.asciidoc_beware-of-aop">Beware of AOP</h7>
<div class="paragraph">
<p>For simple but cross-cutting data-permissions you may also use <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-aop.asciidoc">AOP</a>. This leads to programming aspects that reflectively scan method arguments and magically decide what to do. Be aware that this quickly gets tricky:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What if multiple of your method arguments have data-permissions (e.g. implement <code>SecurityDataPermission*</code>)?</p>
</li>
<li>
<p>What if the object to authorize is only provided as reference (e.g. <code>Long</code> or <code>IdRef</code>) and only loaded and processed inside the implementation where the AOP aspect does not apply?</p>
</li>
<li>
<p>How to express advanced data-permissions in annotations?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What we have learned is that annotations like <code>@PreAuthorize</code> from <code>spring-security</code> easily lead to the &quot;programming in string literals&quot; anti-pattern. We strongly discourage to use this anti-pattern. In such case writing your own <code>verifyPermission</code> methods that you manually call in the right places of your business-logic is much better to understand, debug and maintain.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-data-permission.asciidoc_permissions-for-reading-data">Permissions for reading data</h6>
<div class="paragraph">
<p>When it comes to restrictions on the data to read it becomes even more tricky. In the context of a user only entities shall be loaded from the database he is permitted to read. This is simple for loading a single entity (e.g. by its ID) as you can load it and then if not permitted throw an exception to secure your code. But what if the user is performing a search query to find many entities? For performance reasons we should only find data the user is permitted to read and filter all the rest already via the database query. But what if this is not a requirement for a single query but needs to be applied cross-cutting to tons of queries? Therefore we have the following pattern that solves your problem:</p>
</div>
<div class="paragraph">
<p>For each data-permission attribute (or set of such) we create an abstract base entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@MappedSuperclass
@EntityListeners(PermissionCheckListener.class)
@FilterDef(name = &quot;country&quot;, parameters = {@ParamDef(name = &quot;countries&quot;, type = &quot;string&quot;)})
@Filter(name = &quot;country&quot;, condition = &quot;country in (:countries)&quot;)
public abstract class SecurityDataPermissionCountryEntity extends ApplicationPersistenceEntity
    implements SecurityDataPermissionCountry {

  private String country;

  @Override
  public String getCountry() {
    return this.country;
  }

  public void setCountry(String country) {
    this.country = country;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are some special hibernate annotations <code>@EntityListeners</code>, <code>@FilterDef</code>, and <code>@Filter</code> used here allowing to apply a filter on the <code>country</code> for any (non-native) query performed by hibernate. The entity listener may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class PermissionCheckListener {

  @PostLoad
  public void read(SecurityDataPermissionCountryEntity entity) {
    PermissionChecker.getInstance().requireReadPermission(entity);
  }

  @PrePersist
  @PreUpdate
  public void write(SecurityDataPermissionCountryEntity entity) {
    PermissionChecker.getInstance().requireWritePermission(entity);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will ensure that hibernate implicitly will call these checks for every such entity when it is read from or written to the database. Further to avoid reading entities from the database the user is not permitted to (and ending up with exceptions), we create an AOP aspect that automatically activates the above declared hibernate filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
public class PermissionCheckerAdvice implements MethodBeforeAdvice {

  @Inject
  private PermissionChecker permissionChecker;

  @PersistenceContext
  private EntityManager entityManager;

  @Override
  public void before(Method method, Object[] args, Object target) {

    Collection&lt;String&gt; permittedCountries = this.permissionChecker.getPermittedCountriesForReading();
    if (permittedCountries != null) { // null is returned for admins that may access all countries
      if (permittedCountries.isEmpty()) {
        throw new AccessDeniedException(&quot;Not permitted for any country!&quot;);
      }
      Session session = this.entityManager.unwrap(Session.class);
      session.enableFilter(&quot;country&quot;).setParameterList(&quot;countries&quot;, permittedCountries.toArray());
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally to apply this aspect to all Repositories (can easily be changed to DAOs) implement the following advisor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
public class PermissionCheckerAdvisor implements PointcutAdvisor, Pointcut, ClassFilter, MethodMatcher {

  @Inject
  private PermissionCheckerAdvice advice;

  @Override
  public Advice getAdvice() {
    return this.advice;
  }

  @Override
  public boolean isPerInstance() {
    return false;
  }

  @Override
  public Pointcut getPointcut() {
    return this;
  }

  @Override
  public ClassFilter getClassFilter() {
    return this;
  }

  @Override
  public MethodMatcher getMethodMatcher() {
    return this;
  }

  @Override
  public boolean matches(Method method, Class&lt;?&gt; targetClass) {
    return true; // apply to all methods
  }

  @Override
  public boolean isRuntime() {
    return false;
  }

  @Override
  public boolean matches(Method method, Class&lt;?&gt; targetClass, Object... args) {
    throw new IllegalStateException(&quot;isRuntime()==false&quot;);
  }

  @Override
  public boolean matches(Class&lt;?&gt; clazz) {
    // when using DAOs simply change to some class like ApplicationDao
    return DefaultRepository.class.isAssignableFrom(clazz);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-data-permission.asciidoc_managing-and-granting-the-data-permissions">Managing and granting the data-permissions</h6>
<div class="paragraph">
<p>Following our <a href="guide-access-control.html#authorization">authorization guide</a> we can simply create a permission for each country. We might simply reserve a prefix (as virtual <code>&#xAB;app-id&#xBB;</code>) for each data-permission to allow granting data-permissions to end-users across all applications of the IT landscape. In our example we could create access controls <code>country.DE</code>, <code>country.US</code>, <code>country.ES</code>, etc. and assign those to the users. The method <code>permissionChecker.getPermittedCountriesForReading()</code> would then scan for these access controls and only return the 2-letter country code from it.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Before you make your decisions how to design your access controls please clarify the following questions:
</td>
</tr>
</tbody></table>
</div>
<div class="ulist">
<ul>
<li>
<p>Do you need to separate data-permissions independent of the functional permissions? E.g. may it be required to express that a user can read data from the countries <code>ES</code> and <code>PL</code> but is only permitted to modify data from <code>PL</code>? In such case a single assignment of &quot;country-permissions&quot; to users is insufficient.</p>
</li>
<li>
<p>Do you want to grant data-permissions individually for each application (higher flexibility and complexity) or for the entire application landscape (simplicity, better maintenance for administrators)? In case of the first approach you would rather have access controls like <code>app1.country.GB</code> and <code>app2.country.GB</code>.</p>
</li>
<li>
<p>Do your data-permissions depend on objects that can be created dynamically inside your application?</p>
</li>
<li>
<p>If you want to grant data-permissions on other business objects (entities), how do you want to reference them (primary keys, business keys, etc.)? What reference is most stable? Which is most readable?</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-jwt.asciidoc">JWT</h4>
<div class="paragraph">
<p><a href="https://jwt.io">JWT</a> (JSON Web Token) is an open standard (see <a href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>) for creating <a href="guide-json.asciidoc.html">JSON</a> based access tokens that assert some number of claims.
With an IT landscape divided into multiple smaller apps you want to avoid coupling all those apps or services tightly with your IAM (Identity &amp; Access Management).
Instead your apps simply expects a JWT as <a href="https://oauth.net/2/bearer-tokens/">bearer-token</a> in the <code>Authorization</code> HTTP header field.
All it needs to do for authentication is validating this JWT.
The actual authentication is done centrally by an access system (IAM) that authors those JWTs.
Therefore we recommend to use strong asymmetric cryptography to sign the JWT when it is authored.
Create a keypair per environment and keep the private key as a secret only known to the access system authorizing the JWTs.
Your apps only need to know the public key in order to validate the JWT.
Any request without a JWT or with an invalid JWT will be rejected (with status code <code>401</code>).</p>
</div>
<div class="paragraph">
<p>When using <a href="spring.asciidoc.html">spring</a> check the <a href="#spring/guide-jwt-spring.asciidoc">JWT Spring-Starter</a>.
For <a href="quarkus.asciidoc.html">quarkus</a> follow <a href="https://quarkus.io/guides/security-jwt">Using JWT RBAC</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="guide-csrf.asciidoc">Cross-site request forgery (CSRF)</h4>
<div class="paragraph">
<p>CSRF is a type of malicious exploit of a web application that allows an attacker to induce users to perform actions that they do not intend to perform.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jwt_flow.png"><img src="images/csrf.png" alt="csrf" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>More details about csrf can be found at <a href="https://owasp.org/www-community/attacks/csrf" class="bare">https://owasp.org/www-community/attacks/csrf</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-csrf.asciidoc_secure-devon4j-server-against-csrf">Secure devon4j server against CSRF</h5>
<div class="paragraph">
<p>In case your devon4j server application is not accessed by browsers or the web-client is using <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-jwt.asciidoc">JWT based authentication</a>, you are already safe according to CSRF.
However, if your application is accessed from a browser and you are using <em>form based authentication</em> (with session coockie) or <em>basic authentication</em>, you need to enable CSRF protection.
This guide will tell you how to do this.</p>
</div>
<div class="sect5">
<h6 id="guide-csrf.asciidoc_dependency">Dependency</h6>
<div class="paragraph">
<p>To secure your devon4j application against CSRF attacks, you only need to add the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.starters&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-starter-security-csrf&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Starting with devon4j version <code>2020.12.001</code> application template, this is all you need to do.
However, if you have started from an older version or you want to understand more, please read on.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-csrf.asciidoc_pluggable-web-security">Pluggable web-security</h6>
<div class="paragraph">
<p>To enable pluggable security via devon4j security starters you need to apply <code>WebSecurityConfigurer</code> to your <code>BaseWebSecurityConfig</code> (your class extending spring-boot&#x2019;s <code>WebSecurityConfigurerAdapter</code>) as following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  @Inject
  private WebSecurityConfigurer webSecurityConfigurer;

  public void configure(HttpSecurity http) throws Exception {
    // disable CSRF protection by default, use csrf starter to override.
	  http = http.csrf().disable();
	  // apply pluggable web-security from devon4j security starters
    http = this.webSecurityConfigurer.configure(http);
    .....
  }</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-csrf.asciidoc_custom-csrfrequestmatcher">Custom CsrfRequestMatcher</h6>
<div class="paragraph">
<p>If you want to customize which HTTP requests will require a CSRF token, you can implement your own <code>CsrfRequestMatcher</code> and provide it to the devon4j CSRF protection via qualified injection as following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named(&quot;CsrfRequestMatcher&quot;)
public class CsrfRequestMatcher implements RequestMatcher {
  @Override
  public boolean matches(HttpServletRequest request) {
    .....
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that the exact name (<code>@Named(&quot;CsrfRequestMatcher&quot;)</code>) is required here to ensure your custom implementation will be injected properly.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-csrf.asciidoc_csrfrestservice">CsrfRestService</h6>
<div class="paragraph">
<p>With the <code>devon4j-starter-security-csrf</code> the <code>CsrfRestService</code> gets integrated into your app.
It provides an operation to get the CSRF token via an HTTP <code>GET</code> request.
The URL path to retrieve this CSRF token is <code>services/rest/csrf/v1/token</code>.
As a result you will get a JSON like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
  &quot;token&quot;:&quot;3a8a5f66-c9eb-4494-81e1-7cc58bc3a519&quot;,
  &quot;parameterName&quot;:&quot;_csrf&quot;,
  &quot;headerName&quot;:&quot;X-CSRF-TOKEN&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>token</code> value is a strong random value that will differ for each user session.
It has to be send with subsequent HTTP requests (when method is other than <code>GET</code>) in the specified header (<code>X-CSRF-TOKEN</code>).</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-csrf.asciidoc_how-it-works">How it works</h6>
<div class="paragraph">
<p>Putting it all together, a browser client should call the <code>CsrfRestService</code> after successfull login to receive the current CSRF token.
With every subsequent HTTP request (other than <code>GET</code>) the client has to send this token in the according HTTP header.
Otherwise the server will reject the request to prevent CSRF attacks.
Therefore, an attacker might make your browser perform HTTP requests towards your devon4j application backend via <code>&lt;image&gt;</code> elements, <code>&lt;iframes&gt;</code>, etc.
Your browser will then still include your session coockie if you are already logged in (e.g. from another tab).
However, in case he wants to trigger <code>DELETE</code> or <code>POST</code> requests trying your browser to make changes in the application (delete or update data, etc.) this will fail without CSRF token.
The attacker may make your browser retrieve the CSRF token but he will not be able to retrieve the result and put it into the header of other requests due to the same-origin-policy.
This way your application will be secured against CSRF attacks.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-csrf.asciidoc_configure-devon4ng-client-for-csrf">Configure devon4ng client for CSRF</h5>
<div class="paragraph">
<p>Devon4ng client configuration for CSRF is described <a href="https://github.com/devonfw/devon4ng/blob/develop/documentation/guide-consuming-rest-services">here</a></p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-aop.asciidoc">Aspect Oriented Programming (AOP)</h4>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> is a powerful feature for cross-cutting concerns. However, if used extensive and for the wrong things an application can get unmaintainable. Therefore we give you the best practices where and how to use AOP properly.</p>
</div>
<div class="sect4">
<h5 id="guide-aop.asciidoc_aop-key-principles">AOP Key Principles</h5>
<div class="paragraph">
<p>We follow these principles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We use <a href="http://docs.spring.io/spring/docs/2.5.4/reference/aop.html">spring AOP</a> based on dynamic proxies (and fallback to cglib).</p>
</li>
<li>
<p>We avoid AspectJ and other mighty and complex AOP frameworks whenever possible</p>
</li>
<li>
<p>We only use AOP where we consider it as necessary (see below).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-aop.asciidoc_aop-usage">AOP Usage</h5>
<div class="paragraph">
<p>We recommend to use AOP with care but we consider it established for the following cross cutting concerns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="guide-jpa.asciidoc.html#guide-transactions.asciidoc">Transaction-Handling</a></p>
</li>
<li>
<p><a href="guide-security.html#method-authorization">Authorization</a></p>
</li>
<li>
<p><a href="guide-validation.asciidoc.html">Validation</a></p>
</li>
<li>
<p><a href="guide-logging.html#tracing">Trace-Logging</a> (for testing and debugging)</p>
</li>
<li>
<p>Exception facades for <a href="devon4j.asciidoc_layers.html#guide-service-layer.asciidoc">services</a> but only if no other solution is possible (use alternatives such as <a href="guide-service-layer.html#rest-exception-handling">JAX-RS provider</a> instead).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-aop.asciidoc_aop-debugging">AOP Debugging</h5>
<div class="paragraph">
<p>When using AOP with dynamic proxies the debugging of your code can get nasty. As you can see by the red boxes in the call stack in the debugger there is a lot of magic happening while you often just want to step directly into the implementation skipping all the AOP clutter. When using Eclipse this can easily be archived by enabling <em>step filters</em>. Therefore you have to enable the feature in the Eclipse tool bar (highlighted in read).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/eclipse-debug-aop.png"><img src="images/eclipse-debug-aop.png" alt="AOP debugging"></a>
</div>
</div>
<div class="paragraph">
<p>In order to properly make this work you need to ensure that the step filters are properly configured:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="images/eclipse-debug-step-filters.png"><img src="images/eclipse-debug-step-filters.png" alt="Step Filter Configuration"></a>
</div>
</div>
<div class="paragraph">
<p>Ensure you have at least the following step-filters configured and active:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ch.qos.logback.*
com.devonfw.module.security.*
java.lang.reflect.*
java.security.*
javax.persistence.*
org.apache.commons.logging.*
org.apache.cxf.jaxrs.client.*
org.apache.tomcat.*
org.h2.*
org.springframework.*</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-exceptions.asciidoc">Exception Handling</h4>
<div class="sect4">
<h5 id="guide-exceptions.asciidoc_exception-principles">Exception Principles</h5>
<div class="paragraph">
<p>For exceptions we follow these principles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We only use exceptions for <em>exceptional</em> situations and not for programming control flows, etc. Creating an exception in Java is expensive and hence you should not do it just for testing if something is present, valid or permitted. In the latter case design your API to return this as a regular result.</p>
</li>
<li>
<p>We use unchecked exceptions (RuntimeException) <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>We distinguish <em>internal exceptions</em> and <em>user exceptions</em>:</p>
<div class="ulist">
<ul>
<li>
<p>Internal exceptions have technical reasons. For unexpected and exotic situations it is sufficient to throw existing exceptions such as IllegalStateException. For common scenarios a own exception class is reasonable.</p>
</li>
<li>
<p>User exceptions contain a message explaining the problem for end users. Therefore we always define our own exception classes with a clear, brief but detailed message.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Our own exceptions derive from an exception base class supporting</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/NlsRuntimeException.html#getUuid%28%29">unique ID per instance</a></p>
</li>
<li>
<p><a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/NlsRuntimeException.html#getCode%28%29">Error code per class</a></p>
</li>
<li>
<p><a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/NlsThrowable.html#getNlsMessage%28%29">message templating</a> (see <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-i18n.asciidoc">I18N</a>)</p>
</li>
<li>
<p><a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/NlsRuntimeException.html#isForUser%28%29">distinguish between <em>user exceptions</em> and <em>internal exceptions</em></a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All this is offered by <a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/package-summary.html#documentation">mmm-util-core</a> that we propose as solution.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-exceptions.asciidoc_exception-example">Exception Example</h5>
<div class="paragraph">
<p>Here is an exception class from our sample application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class IllegalEntityStateException extends ApplicationBusinessException {

  private static final long serialVersionUID = 1L;

  public IllegalEntityStateException(Object entity, Object state) {

    this((Throwable) null, entity, state);
  }


  public IllegalEntityStateException(Object entity, Object currentState, Object newState) {

    this(null, entity, currentState, newState);
  }

  public IllegalEntityStateException(Throwable cause, Object entity, Object state) {

    super(cause, createBundle(NlsBundleApplicationRoot.class).errorIllegalEntityState(entity, state));
  }

  public IllegalEntityStateException(Throwable cause, Object entity, Object currentState, Object newState) {

    super(cause, createBundle(NlsBundleApplicationRoot.class).errorIllegalEntityStateChange(entity, currentState,
        newState));
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message templates are defined in the interface NlsBundleRestaurantRoot as following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface NlsBundleApplicationRoot extends NlsBundle {


  @NlsBundleMessage(&quot;The entity {entity} is in state {state}!&quot;)
  NlsMessage errorIllegalEntityState(@Named(&quot;entity&quot;) Object entity, @Named(&quot;state&quot;) Object state);


  @NlsBundleMessage(&quot;The entity {entity} in state {currentState} can not be changed to state {newState}!&quot;)
  NlsMessage errorIllegalEntityStateChange(@Named(&quot;entity&quot;) Object entity, @Named(&quot;currentState&quot;) Object currentState,
      @Named(&quot;newState&quot;) Object newState);


  @NlsBundleMessage(&quot;The property {property} of object {object} can not be changed!&quot;)
  NlsMessage errorIllegalPropertyChange(@Named(&quot;object&quot;) Object object, @Named(&quot;property&quot;) Object property);

  @NlsBundleMessage(&quot;There is currently no user logged in&quot;)
  NlsMessage errorNoActiveUser();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-exceptions.asciidoc_handling-exceptions">Handling Exceptions</h5>
<div class="paragraph">
<p>For catching and handling exceptions we follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We do not catch exceptions just to wrap or to re-throw them.</p>
</li>
<li>
<p>If we catch an exception and throw a new one, we always <strong>have</strong> to provide the original exception as <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html#getCause%28%29">cause</a> to the constructor of the new exception.</p>
</li>
<li>
<p>At the entry points of the application (e.g. a service operation) we have to catch and handle all throwables. This is done via the <em>exception-facade-pattern</em> via an explicit facade or aspect. The <code>devon4j-rest</code> module already provides ready-to-use implementations for this such as <a href="https://github.com/devonfw/devon4j/blob/develop/modules/rest/src/main/java/com/devonfw/module/rest/service/impl/RestServiceExceptionFacade.java">RestServiceExceptionFacade</a>. The exception facade has to &#x2026;&#x200B;</p>
<div class="ulist">
<ul>
<li>
<p>log all errors (user errors on info and technical errors on error level)</p>
</li>
<li>
<p>ensure the entire exception is passed to the logger (not only the message) so that the logger can capture the entire stacktrace and the root cause is not lost.</p>
</li>
<li>
<p>convert the error to a result appropriable for the client and secure for <a href="https://www.owasp.org/index.php/Top_10_2013-A6-Sensitive_Data_Exposure">Sensitive Data Exposure</a>. Especially for security exceptions only a generic security error code or message may be revealed but the details shall only be logged but <strong>not</strong> be exposed to the client. All <em>internal exceptions</em> are converted to a generic error with a message like:</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>An unexpected technical error has occurred. We apologize any inconvenience. Please try again later.</p>
</div>
</blockquote>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-exceptions.asciidoc_common-errors">Common Errors</h5>
<div class="paragraph">
<p>The following errors may occur in any devon application:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 43. Common Exceptions</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Code</strong></th>
<th class="tableblock halign-left valign-top"><strong>Message</strong></th>
<th class="tableblock halign-left valign-top"><strong>Link</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TechnicalError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An unexpected error has occurred! We apologize any inconvenience. Please try again later.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/m-m-m/util/blob/master/exception/src/main/java/net/sf/mmm/util/exception/api/TechnicalErrorUserException.java">TechnicalErrorUserException.java</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServiceInvoke</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#xAB;original message of the cause&#xBB;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/m-m-m/util/blob/master/exception/src/main/java/net/sf/mmm/util/exception/api/ServiceInvocationFailedException.java">ServiceInvocationFailedException.java</a></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-i18n.asciidoc">Internationalization</h4>
<div class="paragraph">
<p>Internationalization (I18N) is about writing code independent from locale-specific information.
For I18N of text messages we are suggesting
<a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/nls/api/package-summary.html#documentation">mmm native-language-support</a>.</p>
</div>
<div class="paragraph">
<p>In devonfw we have developed a solution to manage text internationalization. devonfw solution comes into two aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bind locale information to the user.</p>
</li>
<li>
<p>Get the messages in the current user locale.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="guide-i18n.asciidoc_binding-locale-information-to-the-user">Binding locale information to the user</h5>
<div class="paragraph">
<p>We have defined two different points to bind locale information to user, depending on user is authenticated or not.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User not authenticated: devonfw intercepts unsecured request and extract locale from it. At first, we try to extract a <code>language</code> parameter from the request and if it is not possible, we extract locale from &#xC0;ccept-language` header.</p>
</li>
<li>
<p>User authenticated. During login process, applications developers are responsible to fill <code>language</code> parameter in the UserProfile class. This <code>language</code> parameter could be obtain from DB, LDAP, request, etc. In devonfw sample we get the locale information from database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This image shows the entire process:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/i18n.png" alt="Internationalization">
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-i18n.asciidoc_getting-internationalizated-messages">Getting internationalizated messages</h5>
<div class="paragraph">
<p>devonfw has a bean that manage i18n message resolution, the <code>ApplicationLocaleResolver.</code> This bean is responsible to get the current user and extract locale information from it and read the correct properties file to get the message.</p>
</div>
<div class="paragraph">
<p>The i18n properties file must be called <code>ApplicationMessages_la_CO.properties</code> where la=language and CO=country. This is an example of a i18n properties file for English language to translate devonfw sample user roles:</p>
</div>
<div class="paragraph">
<p>ApplicationMessages_en_US.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>admin=Admin</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should define an ApplicationMessages_la_CO.properties file for every language that your application needs.</p>
</div>
<div class="paragraph">
<p><code>ApplicationLocaleResolver</code> bean is injected in <code>AbstractComponentFacade</code> class so you have available this bean in logic layer so you only need to put this code to get an internationalized message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String msg = getApplicationLocaleResolver().getMessage(&quot;mymessage&quot;);</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-service-client.asciidoc">Service Client</h4>
<div class="paragraph">
<p>This guide is about consuming (calling) services from other applications (micro-services). For providing services see the <a href="devon4j.asciidoc_layers.html#guide-service-layer.asciidoc">Service-Layer Guide</a>. Services can be consumed in the <a href="devon4j.asciidoc_layers.html#guide-client-layer.asciidoc">client</a> or the server. As the client is typically not written in Java you should consult the according guide for your client technology. In case you want to call a service within your Java code this guide is the right place to get help.</p>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_motivation">Motivation</h5>
<div class="paragraph">
<p>Various solutions already exist for calling services such as <code>RestTemplate</code> from spring or the JAX-RS client API. Further each and every service framework offers its own API as well. These solutions might be suitable for very small and simple projects (with one or two such invocations). However, with the trend of microservices the invocation of a service becomes a very common use-case that occurs all over the place. You typically need a solution that is very easy to use but supports flexible configuration, adding headers for authentication, mapping of errors from server, logging success/errors with duration for performance analysis, support for synchronous and asynchronous invocations, etc. This is exactly what this <code>devon4j</code> service-client solution brings for you.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_dependency">Dependency</h5>
<div class="paragraph">
<p>You need to add (at least one of) these dependencies to your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;!-- Starter for asynchronous consuming REST services via Jaca HTTP Client (Java11+) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.starters&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-starter-http-client-rest-async&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!-- Starter for synchronous consuming REST services via Jaca HTTP Client (Java11+) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.starters&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-starter-http-client-rest-sync&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!-- Starter for synchronous consuming REST services via Apache CXF (Java8+)
  NOTE: This is an alternative to devon4j-starter-http-client-rest-sync
  --&gt;
&lt;!--
&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.starters&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-starter-cxf-client-rest&lt;/artifactId&gt;
&lt;/dependency&gt;
--&gt;
&lt;!-- Starter for synchronous consuming SOAP services via Apache CXF (Java8+) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.starters&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-starter-cxf-client-ws&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_features">Features</h5>
<div class="paragraph">
<p>When invoking a service you need to consider many cross-cutting aspects. You might not think about them in the very first place and you do not want to implement them multiple times redundantly. Therefore you should consider using this approach. The following sub-sections list the covered features and aspects:</p>
</div>
<div class="sect5">
<h6 id="guide-service-client.asciidoc_simple-usage">Simple usage</h6>
<div class="paragraph">
<p>Assuming you already have a Java interface <code>MyService</code> of the service you want to invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.company.department.foo.mycomponent.service.api.rest;
...

@Path(&quot;/myservice&quot;)
public interface MyService extends RestService {

  @POST
  @Path(&quot;/getresult&quot;)
  MyResult getResult(MyArgs myArgs);

  @DELETE
  @Path(&quot;/entity/{id}&quot;)
  void deleteEntity(@PathParam(&quot;id&quot;) long id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then all you need to do is this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
public class UcMyUseCaseImpl extends MyUseCaseBase implements UcMyUseCase {
  @Inject
  private ServiceClientFactory serviceClientFactory;

  ...
  private void callSynchronous(MyArgs myArgs) {
    MyService myService = this.serviceClientFactory.create(MyService.class);
    // call of service over the wire, synchronously blocking until result is received or error occurred
    MyResult myResult = myService.myMethod(myArgs);
    handleResult(myResult);
  }

  private void callAsynchronous(MyArgs myArgs) {
    AsyncServiceClient&lt;MyService&gt; client = this.serviceClientFactory.createAsync(MyService.class);
    // call of service over the wire, will return when request is send and invoke handleResult asynchronously
    client.call(client.get().myMethod(myArgs), this::handleResult);
  }

  private void handleResult(MyResult myResult) {
    ...
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see both synchronous and asynchronous invocation of a service is very simple and type-safe. Still it is very flexible and powerful (see following features). The actual call of <code>myMethod</code> will technically call the remote service over the wire (e.g. via HTTP) including marshaling the arguments (e.g. converting <code>myArgs</code> to JSON) and unmarshalling the result (e.g. converting the received JSON to <code>myResult</code>).</p>
</div>
<div class="sect6">
<h7 id="guide-service-client.asciidoc_asynchronous-invocation-of-void-methods">Asynchronous Invocation of void Methods</h7>
<div class="paragraph">
<p>If you want to call a service method with <code>void</code> as return type, the type-safe <code>call</code> method can not be used as <code>void</code> methods do not return a result. Therefore you can use the <code>callVoid</code> method as following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  private void callAsynchronousVoid(long id) {
    AsyncServiceClient&lt;MyService&gt; client = this.serviceClientFactory.createAsync(MyService.class);
    // call of service over the wire, will return when request is send and invoke resultHandler asynchronously
    Consumer&lt;Void&gt; resultHandler = r -&gt; { System.out.println(&quot;Response received&quot;)};
    client.callVoid(() -&gt; { client.get().deleteEntity(id);}, resultHandler);
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also provide <code>null</code> as <code>resultHandler</code> for &quot;fire and forget&quot;. However, this will lead to the result being ignored so even in case of an error you will not be notified.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-service-client.asciidoc_configuration">Configuration</h6>
<div class="paragraph">
<p>This solution allows a very flexible configuration on the following levels:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Global configuration (defaults)</p>
</li>
<li>
<p>Configuration per remote service application (microservice)</p>
</li>
<li>
<p>Configuration per invocation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A configuration on a deeper level (e.g. 3) overrides the configuration from a higher level (e.g. 1).</p>
</div>
<div class="paragraph">
<p>The configuration on Level 1 and 2 are configured via <code>application.properties</code>
(see <a href="guide-configuration.asciidoc.html">configuration guide</a>).
For Level 1 the prefix <code>service.client.default.</code> is used for properties.
Further, for level 2. the prefix <code>service.client.app.&#xAB;application&#xBB;.</code> is used where <code>&#xAB;application&#xBB;</code> is the
technical name of the application providing the service. This name will automatically be derived from
the java package of the service interface (e.g. <code>foo</code> in <code>MyService</code> interface before) following our
<a href="coding-conventions.html#packages">packaging conventions</a>.
In case these conventions are not met it will fallback to the fully qualified name of the service interface.</p>
</div>
<div class="paragraph">
<p>Configuration on Level 3 has to be provided as <code>Map</code> argument to the method
<code>ServiceClientFactory.create(Class&lt;S&gt; serviceInterface, Map&lt;String, String&gt; config)</code>.
The keys of this <code>Map</code> will not use prefixes (such as the ones above). For common configuration
parameters a type-safe builder is offered to create such map via <code>ServiceClientConfigBuilder</code>.
E.g. for testing you may want to do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">this.serviceClientFactory.create(MyService.class,
  new ServiceClientConfigBuilder().authBasic().userLogin(login).userPassword(password).buildMap());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of a configuration block for your <code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>service.client.default.url=https://api.company.com/services/${type}
service.client.default.timeout.connection=120
service.client.default.timeout.response=3600

service.client.app.bar.url=https://bar.company.com:8080/services/rest
service.client.app.bar.auth=basic
service.client.app.bar.user.login=user4711
service.client.app.bar.user.password=ENC(jd5ZREpBqxuN9ok0IhnXabgw7V3EoG2p)

service.client.app.foo.url=https://foo.company.com:8443/services/rest
# authForward: simply forward Authorization header (e.g. with JWT) to remote service
service.client.app.bar.auth=authForward</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-service-client.asciidoc_service-discovery">Service Discovery</h6>
<div class="paragraph">
<p>You do not want to hardwire service URLs in your code, right? Therefore different strategies might apply
to <em>discover</em> the URL of the invoked service. This is done internally by an implementation of the interface
<code>ServiceDiscoverer</code>. The default implementation simply reads the base URL from the configuration.
So you can simply add this to your <code>application.properties</code> as in the above configuration example.</p>
</div>
<div class="paragraph">
<p>Assuming your service interface would have the fully qualified name
<code>com.company.department.foo.mycomponent.service.api.rest.MyService</code> then the URL would be resolved to
<code><a href="https://foo.company.com:8443/services/rest" class="bare">https://foo.company.com:8443/services/rest</a></code> as the <code>&#xAB;application&#xBB;</code> is <code>foo</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, the URL might use the following variables that will automatically be resolved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${app}</code> to <code>&#xAB;application&#xBB;</code> (useful for default URL)</p>
</li>
<li>
<p><code>${type}</code> to the type of the service. E.g. <code>rest</code> in case of a <a href="guide-rest.asciidoc.html">REST</a> service and <code>ws</code> for a <a href="guide-soap.asciidoc.html">SOAP</a> service.</p>
</li>
<li>
<p><code>${local.server.port}</code> for the port of your current Java servlet container running the JVM. Should only used for testing with spring-boot random port mechanism (technically spring can not resolve this variable but we do it for you here).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Therefore, the default URL may also be configured as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>service.client.default.url=https://api.company.com/${app}/services/${type}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can use any implementation of <code>ServiceDiscoverer</code>, you can also easily use <a href="https://github.com/Netflix/eureka#eureka">eureka</a> (or anything else) instead to discover your services.
However, we recommend to use <a href="https://istio.io/">istio</a> instead as described below.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-service-client.asciidoc_headers">Headers</h6>
<div class="paragraph">
<p>A very common demand is to tweak (HTTP) headers in the request to invoke the service. May it be for security (authentication data) or for other cross-cutting concerns (such as the <a href="guide-logging.html#correlation-id">Correlation ID</a>). This is done internally by implementations of the interface  <code>ServiceHeaderCustomizer</code>.
We already provide several implementations such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ServiceHeaderCustomizerBasicAuth</code> for basic authentication (<code>auth=basic</code>).</p>
</li>
<li>
<p><code>ServiceHeaderCustomizerOAuth</code> for OAuth: passes a security token from security context such as a <a href="https://jwt.io/">JWT</a> via OAuth (<code>auth=oauth</code>).</p>
</li>
<li>
<p><code>ServiceHeaderCustomizerAuthForward</code> forwards the <code>Authorization</code> HTTP header from the running request to the request to the remote serivce as is (<code>auth=authForward</code>). Be careful to avoid security pitfals by misconfiguring this feature as it may also sensitive credentials (e.g. basic auth) to the remote service. Never use as default.</p>
</li>
<li>
<p><code>ServiceHeaderCustomizerCorrelationId</code> passed the <a href="guide-logging.html#correlation-id">Correlation ID</a> to the service request.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, you can add further custom implementations of <code>ServiceHeaderCustomizer</code> for your individual requirements and additional headers.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-service-client.asciidoc_timeouts">Timeouts</h6>
<div class="paragraph">
<p>You can configure timeouts in a very flexible way. First of all you can configure timeouts to establish the connection (<code>timeout.connection</code>) and to wait for the response (<code>timeout.response</code>) separately. These timeouts can be configured on all three levels as described in the configuration section above.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-service-client.asciidoc_error-handling">Error Handling</h6>
<div class="paragraph">
<p>Whilst invoking a remote service an error may occur. This solution will automatically handle such errors and map them to a higher level <code>ServiceInvocationFailedException</code>. In general we separate two different types of errors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Network error</strong><br>
In such case (host not found, connection refused, time out, etc.) there is not even a response from the server. However, in advance to a low-level exception you will get a wrapped <code>ServiceInvocationFailedException</code> (with code <code>ServiceInvoke</code>) with a readable message containing the service that could not be invoked.</p>
</li>
<li>
<p><strong>Service error</strong><br>
In case the service failed on the server-side the <a href="guide-rest.html#error-results">error result</a> will be parsed and thrown as a <code>ServiceInvocationFailedException</code> with the received message and code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This allows to catch and handle errors when a service-invocation failed. You can even distinguish business errors from the server-side from technical errors and implement retry strategies or the like.
Further the created exception contains detailed contextual information about the serivce that failed (service interface class, method, URL) what makes it much easier to trace down errors. Here is an example from our tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>While invoking the service com.devonfw.test.app.myexample.service.api.rest.MyExampleRestService#businessError[http://localhost:50178/app/services/rest/my-example/v1/business-error] the following error occurred: Test of business error. Probably the service is temporary unavailable. Please try again later. If the problem persists contact your system administrator.
2f43b03e-685b-45c0-9aae-23ff4b220c85:BusinessErrorCode</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may even provide your own implementation of <code>ServiceClientErrorFactory</code> instead to provide an own exception class for this purpose.</p>
</div>
<div class="sect6">
<h7 id="guide-service-client.asciidoc_handling-erros">Handling Erros</h7>
<div class="paragraph">
<p>In case of a synchronous service invocation an error will be immediately thrown so you can sourround the call with a regular try-catch block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  private void callSynchronous(MyArgs myArgs) {
    MyService myService = this.serviceClientFactory.create(MyService.class);
    // call of service over the wire, synchronously blocking until result is received or error occurred
    try {
      MyResult myResult = myService.myMethod(myArgs);
      handleResult(myResult);
    } catch (ServiceInvocationFailedException e) {
      if (e.isTechnical()) {
        handleTechnicalError(e);
      } else {
        // error code you defined in the exception on the server side of the service
        String errorCode = e.getCode();
        handleBusinessError(e, errorCode;
      }
    } catch (Throwable e) { // you may not handle this explicitly here...
      handleTechnicalError(e);
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using asynchronous service invocation an error can occurr in a separate thread. Therefore you may and should define a custom error handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  private void callAsynchronous(MyArgs myArgs) {
    AsyncServiceClient&lt;MyService&gt; client = this.serviceClientFactory.createAsync(MyService.class);
    Consumer&lt;Throwalbe&gt; errorHandler = this::handleError;
    client.setErrorHandler(errorHandler);
    // call of service over the wire, will return when request is send and invoke handleResult asynchronously
    client.call(client.get().myMethod(myArgs), this::handleResult);
  }

  private void handleError(Throwalbe error) {
    ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The error handler consumes <code>Throwable</code> and not only <code>RuntimeException</code> so you can get notified even in case of an unexpected <code>OutOfMemoryError</code>, <code>NoClassDefFoundError</code>, or other technical problems. Please note that the error handler may also be called from the thread calling the service (e.g. if already creating the request fails). The default error handler used if no custom handler is set will only log the error and do nothing else.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-service-client.asciidoc_logging">Logging</h6>
<div class="paragraph">
<p>By default this solution will log all invocations including the URL of the invoked service, success or error status flag and the duration in seconds (with decimal nano precision as available). Therefore you can easily monitor the status and performance of the service invocations. Here is an example from our tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Invoking service com.devonfw.test.app.myexample.service.api.rest.MyExampleRestService#greet[http://localhost:50178/app/services/rest/my-example/v1/greet/John%20Doe%20%26%20%3F%23] took PT20.309756622S (20309756622ns) and succeded with status 200.</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-service-client.asciidoc_resilience">Resilience</h6>
<div class="paragraph">
<p>Resilience adds a lot of complexity and that typically means that addressing this here would most probably result in not being up-to-date and not meeting all requirements. Therefore we recommend something completely different: the <em>sidecar</em> approach (based on <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/sidecar">sidecar pattern</a>). This means that you use a generic proxy app that runs as a separate process on the same host, VM, or container of your actual application. Then in your app you are calling the service via the sidecar proxy on <code>localhost</code> (service discovery URL is e.g. <code><a href="http://localhost:8081/${app}/services/${type}" class="bare">http://localhost:8081/${app}/services/${type}</a></code>) that then acts as proxy to the actual remote service. Now aspects such as resilience with circuit breaking and the actual service discovery can be configured in the sidecar proxy app and independent of your actual application. Therefore, you can even share and reuse configuration and experience with such a sidecar proxy app even across different technologies (Java, .NET/C#, Node.JS, etc.). Further, you do not pollute the technology stack of your actual app with the infrastructure for resilience, throttling, etc. and can update the app and the side-card independently when security-fixes are available.</p>
</div>
<div class="paragraph">
<p>Various implementations of such sidecar proxy apps are available as free open source software.
Our recommendation in devonfw is to use <a href="https://istio.io/">istio</a>. This not only provides such a side-car but also an entire management solution for service-mesh making administration and maintenance much easier. Platforms like OpenShift support this out of the box.</p>
</div>
<div class="paragraph">
<p>However, if you are looking for details about side-car implementations for services you can have a look at the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Netflix Sidecar - see <a href="http://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#_polyglot_support_with_sidecar">Spring Cloud Netflix docs</a></p>
</li>
<li>
<p><a href="https://lyft.github.io/envoy/">Envoy</a> - see <a href="https://dzone.com/articles/microservices-patterns-with-envoy-sidecar-proxy-pa">Microservices Patterns With Envoy Sidecar Proxy</a></p>
</li>
<li>
<p><a href="https://github.com/netflix/Prana">Prana</a> - see <a href="https://medium.com/netflix-techblog/prana-a-sidecar-for-your-netflix-paas-based-applications-and-services-258a5790a015">Prana: A Sidecar for your Netflix PaaS based Applications and Services</a> &#x2190; <strong>Not updated as it&#x2019;s not used internally by Netflix</strong></p>
</li>
<li>
<p>Keycloak - see <a href="http://www.hawkular.org/blog/2017/07/jaeger-with-security-proxy.html">Protecting Jaeger UI with a sidecar security proxy</a></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="devon4j.wiki_guide-testing.asciidoc">Testing</h4>
<div class="sect4">
<h5 id="guide-testing.asciidoc_general-best-practices">General best practices</h5>
<div class="paragraph">
<p>For testing please follow our general best practices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tests should have a clear goal that should also be documented.</p>
</li>
<li>
<p>Tests have to be classified into different <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-testing.asciidoc_integration-levels">integration levels</a>.</p>
</li>
<li>
<p>Tests should follow a clear naming convention.</p>
</li>
<li>
<p>Automated tests need to properly assert the result of the tested operation(s) in a reliable way. E.g. avoid stuff like <code>assertThat(service.getAllEntities()).hasSize(42)</code> or even worse tests that have no assertion at all.</p>
</li>
<li>
<p>Tests need to be independent of each other. Never write test-cases or tests (in Java @Test methods) that depend on another test to be executed before.</p>
</li>
<li>
<p>Use <a href="http://joel-costigliola.github.io/assertj/">AssertJ</a> to write good readable and maintainable tests that also provide valuable feedback in case a test fails. Do not use legacy JUnit methods like <code>assertEquals</code> anymore!</p>
</li>
<li>
<p>For easy understanding divide your test in three commented sections:</p>
<div class="ulist">
<ul>
<li>
<p><code>//given</code></p>
</li>
<li>
<p><code>//when</code></p>
</li>
<li>
<p><code>//then</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Plan your tests and test data management properly before implementing.</p>
</li>
<li>
<p>Instead of having a too strong focus on test coverage better ensure you have covered your critical core functionality properly and review the code including tests.</p>
</li>
<li>
<p>Test code shall NOT be seen as second class code. You shall consider design, architecture and code-style also for your test code but do not over-engineer it.</p>
</li>
<li>
<p>Test automation is good but should be considered in relation to cost per use. Creating full coverage via <em>automated system tests</em> can cause a massive amount of test-code that can turn out as a huge maintenance hell. Always consider all aspects including product life-cycle, criticality of use-cases to test, and variability of the aspect to test (e.g. UI, test-data).</p>
</li>
<li>
<p>Use continuous integration and establish that the entire team wants to have clean builds and running tests.</p>
</li>
<li>
<p>Prefer delegation over inheritance for cross-cutting testing functionality. Good places to put this kind of code can be realized and reused via the JUnit @Rule mechanism.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_test-automation-technology-stack">Test Automation Technology Stack</h5>
<div class="paragraph">
<p>For test automation we use <a href="http://junit.org/">JUnit</a>. However, we are strictly doing all assertions with <a href="http://joel-costigliola.github.io/assertj/">AssertJ</a>. For <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-testing.asciidoc_test-doubles">mocking</a> we use <a href="http://mockito.org/">mockito</a>.
In order to mock remote connections we use <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-testing.asciidoc_wiremock">wiremock</a>.
For testing entire components or sub-systems we recommend to use <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html">spring-boot-starter-test</a> as lightweight and fast testing infrastructure that is already shipped with <code>devon4j-test</code>.</p>
</div>
<div class="paragraph">
<p>In case you have to use a full blown JEE application server, we recommend to use <a href="http://arquillian.org/">arquillian</a>. To get started with arquillian, look <a href="http://arquillian.org/guides/getting_started/index.html#add_the_arquillian_apis">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_test-doubles">Test Doubles</h5>
<div class="paragraph">
<p>We use <a href="http://xunitpatterns.com/Using%20Test%20Doubles.html">test doubles</a> as generic term for mocks, stubs, fakes, dummies, or spys to avoid confusion. Here is a short summary from <a href="http://martinfowler.com/articles/mocksArentStubs.html">stubs VS mocks</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Dummy</strong> objects specifying no logic at all. May declare data in a POJO style to be used as boiler plate code to parameter lists or even influence the control flow towards the test&#x2019;s needs.</p>
</li>
<li>
<p><strong>Fake</strong> objects actually have working implementations, but usually take some shortcut which makes them not suitable for production (an in memory database is a good example).</p>
</li>
<li>
<p><strong>Stubs</strong> provide canned answers to calls made during the test, usually not responding at all to anything outside what&#x2019;s programmed in for the test. Stubs may also record information about calls, such as an email gateway stub that remembers the messages it &apos;sent&apos;, or maybe only how many messages it &apos;sent&apos;.</p>
</li>
<li>
<p><strong>Mocks</strong> are objects pre-programmed with expectations, which form a specification of the calls they are expected to receive.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We try to give some examples, which should make it somehow clearer:</p>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_stubs">Stubs</h6>
<div class="paragraph">
<p>Best Practices for applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A good way to replace small to medium large boundary systems, whose impact (e.g. latency) should be ignored during load and performance tests of the application under development.</p>
</li>
<li>
<p>As stub implementation will rely on state-based verification, there is the threat, that test developers will partially reimplement the state transitions based on the replaced code. This will immediately lead to a black maintenance whole, so better use mocks to assure the certain behavior on interface level.</p>
</li>
<li>
<p>Do NOT use stubs as basis of a large amount of test cases as due to state-based verification of stubs, test developers will enrich the stub implementation to become a large monster with its own hunger after maintenance efforts.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_mocks">Mocks</h6>
<div class="paragraph">
<p>Best Practices for applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace not-needed dependencies of your system-under-test (SUT) to minimize the application context to start of your component framework.</p>
</li>
<li>
<p>Replace dependencies of your SUT to impact the control flow under test without establishing all the context parameters needed to match the control flow.</p>
</li>
<li>
<p>Remember: Not everything has to be mocked! Especially on lower levels of tests like isolated module tests you can be betrayed into a mocking delusion, where you end up in a hundred lines of code mocking the whole context and five lines executing the test and verifying the mocks behavior. Always keep in mind the benefit-cost ratio, when implementing tests using mocks.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_wiremock">Wiremock</h6>
<div class="paragraph">
<p>If you need to mock remote connections such as HTTP-Servers, wiremock offers easy to use functionality. For a full description see the <a href="http://wiremock.org/">homepage</a> or the <a href="https://github.com/tomakehurst/wiremock">github repository</a>. Wiremock can be used either as a JUnit Rule, in Java outside of JUnit or as a standalone process. The mocked server can be configured to respond to specific requests in a given way via a fluent Java API, JSON files and JSON over HTTP. An example as an integration to JUnit can look as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.wireMockConfig;
import com.github.tomakehurst.wiremock.junit.WireMockRule;

public class WireMockOfferImport{

  @Rule
  public WireMockRule mockServer = new WireMockRule(wireMockConfig().dynamicPort());

  @Test
  public void requestDataTest() throws Exception {
  int port = this.mockServer.port();
  ...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a server on a randomly chosen free port on the running machine. You can also specify the port to be used if wanted. Other than that there are several options to further configure the server. This includes HTTPs, proxy settings, file locations, logging and extensions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  @Test
  public void requestDataTest() throws Exception {
      this.mockServer.stubFor(get(urlEqualTo(&quot;/new/offers&quot;)).withHeader(&quot;Accept&quot;, equalTo(&quot;application/json&quot;))
      .withHeader(&quot;Authorization&quot;, containing(&quot;Basic&quot;)).willReturn(aResponse().withStatus(200).withFixedDelay(1000)
      .withHeader(&quot;Content-Type&quot;, &quot;application/json&quot;).withBodyFile(&quot;/wireMockTest/jsonBodyFile.json&quot;)));
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will stub the URL <code>localhost:port/new/offers</code> to respond with a status 200 message containing a header (<code>Content-Type: application/json</code>) and a body with content given in <code>jsonBodyFile.json</code> if the request matches several conditions.
It has to be a GET request to <code>../new/offers</code> with the two given header properties.</p>
</div>
<div class="paragraph">
<p>Note that by default files are located in <code>src/test/resources/__files/</code>. When using only one WireMock server one can omit the <code>this.mockServer</code> in before the <code>stubFor</code> call (static method).
You can also add a fixed delay to the response or processing delay with <code>WireMock.addRequestProcessingDelay(time)</code> in order to test for timeouts.</p>
</div>
<div class="paragraph">
<p>WireMock can also respond with different corrupted messages to simulate faulty behaviour.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Test(expected = ResourceAccessException.class)
public void faultTest() {

    this.mockServer.stubFor(get(urlEqualTo(&quot;/fault&quot;)).willReturn(aResponse()
    .withFault(Fault.MALFORMED_RESPONSE_CHUNK)));
...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A GET request to <code>../fault</code> returns an OK status header, then garbage, and then closes the connection.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_integration-levels">Integration Levels</h5>
<div class="paragraph">
<p>There are many discussions about the right level of integration for test automation. Sometimes it is better to focus on small, isolated modules of the system - whatever a &quot;module&quot; may be. In other cases it makes more sense to test integrated groups of modules. Because there is no universal answer to this question, devonfw only defines a common terminology for what could be tested. Each project must make its own decision where to put the focus of test automation. There is no worldwide accepted terminology for the integration levels of testing. In general we consider <a href="http://istqbexamcertification.com/what-are-software-testing-levels/">ISTQB</a>. However, with a technical focus on test automation we want to get more precise.</p>
</div>
<div class="paragraph">
<p>The following picture shows a simplified view of an application based on the <a href="architecture.html#technical-architecture">devonfw reference architecture</a>. We define four integration levels that are explained in detail below.
The boxes in the picture contain parenthesized numbers. These numbers depict the lowest integration level, a box belongs to. Higher integration levels also contain all boxes of lower integration levels. When writing tests for a given integration level, related boxes with a lower integration level must be replaced by test <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-testing.asciidoc_test-doubles">doubles</a> or drivers.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/integration-levels.png" alt="Integration Levels">
</div>
</div>
<div class="paragraph">
<p>The main difference between the integration levels is the amount of infrastructure needed to test them. The more infrastructure you need, the more bugs you will find, but the more instable and the slower your tests will be. So each project has to make a trade-off between pros and contras of including much infrastructure in tests and has to select the integration levels that fit best to the project.</p>
</div>
<div class="paragraph">
<p>Consider, that more infrastructure does not automatically lead to a better bug-detection. There may be bugs in your software that are masked by bugs in the infrastructure. The best way to find those bugs is to test with very few infrastructure.</p>
</div>
<div class="paragraph">
<p>External systems do not belong to any of the integration levels defined here. devonfw does not recommend involving real external systems in test automation. This means, they have to be replaced by test <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-testing.asciidoc_test-doubles">doubles</a> in automated tests. An exception may be external systems that are fully under control of the own development team.</p>
</div>
<div class="paragraph">
<p>The following chapters describe the four integration levels.</p>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_level-1-module-test">Level 1 Module Test</h6>
<div class="paragraph">
<p>The goal of a <em>isolated module test</em> is to provide fast feedback to the developer. Consequently, isolated module tests must not have any interaction with the client, the database, the file system, the network, etc.</p>
</div>
<div class="paragraph">
<p>An isolated module test is testing a single classes or at least a small set of classes in isolation. If such classes depend on other components or external resources, etc. these shall be replaced with a <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-testing.asciidoc_test-doubles">test double</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyClassTest extends ModuleTest {

  @Test
  public void testMyClass() {

    // given
    MyClass myClass = new MyClass();
    // when
    String value = myClass.doSomething();
    // then
    assertThat(value).isEqualTo(&quot;expected value&quot;);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For an advanced example see <a href="https://github.com/devonfw/devon4j/blob/develop/modules/rest/src/test/java/com/devonfw/module/rest/service/impl/RestServiceExceptionFacadeTest.java">here</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_level-2-component-test">Level 2 Component Test</h6>
<div class="paragraph">
<p>A <a href="http://istqbexamcertification.com/what-is-component-testing/"><em>component test</em></a> aims to test components or component parts as a unit.
These tests typically run with a (light-weight) infrastructure such as spring-boot-starter-test and can access resources such as a database (e.g. for DAO tests).
Further, no remote communication is intended here. Access to external systems shall be replaced by a <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-testing.asciidoc_test-doubles">test double</a>.</p>
</div>
<div class="paragraph">
<p>With devon4j and spring you can write a component-test as easy as illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SpringBootTest(classes = { MySpringBootApp.class }, webEnvironment = WebEnvironment.NONE)
public class UcFindCountryTest extends ComponentTest {
  @Inject
  private UcFindCountry ucFindCountry;

  @Test
  public void testFindCountry() {

    // given
    String countryCode = &quot;de&quot;;

    // when
    TestUtil.login(&quot;user&quot;, MyAccessControlConfig.FIND_COUNTRY);
    CountryEto country = this.ucFindCountry.findCountry(countryCode);

    // then
    assertThat(country).isNotNull();
    assertThat(country.getCountryCode()).isEqualTo(countryCode);
    assertThat(country.getName()).isEqualTo(&quot;Germany&quot;);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This test will start the entire spring-context of your app (<code>MySpringBootApp</code>). Within the test spring will inject according spring-beans into all your fields annotated with <code>@Inject</code>. In the test methods you can use these spring-beans and perform your actual tests. This pattern can be used for testing DAOs/Repositories, Use-Cases, or any other spring-bean with its entire configuration including database and transactions.</p>
</div>
<div class="paragraph">
<p>When you are testing use-cases your <a href="guide-access-control.html#configuration-on-java-method-level">authorization</a> will also be in place. Therefore, you have to simulate a logon in advance what is done via the <code>login</code> method in the above example.  The test-infrastructure will automatically do a <code>logout</code> for you after each test method in <code>doTearDown</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_level-3-subsystem-test">Level 3 Subsystem Test</h6>
<div class="paragraph">
<p>A <em>subsystem test</em> runs against the external interfaces (e.g. HTTP service) of the integrated subsystem. Subsystem tests of the client subsystem are described in the <a href="https://github.com/devonfw/devon4ng/blob/master/documentation/guide-testing">devon4ng testing guide</a>. In devon4j the server (JEE application) is the subsystem under test. The tests act as a client (e.g. service consumer) and the server has to be integrated and started in a container.</p>
</div>
<div class="paragraph">
<p>With devon4j and spring you can write a subsystem-test as easy as illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SpringBootTest(classes = { MySpringBootApp.class }, webEnvironment = WebEnvironment.RANDOM_PORT)
public class CountryRestServiceTest extends SubsystemTest {

  @Inject
  private ServiceClientFactory serviceClientFactory;

  @Test
  public void testFindCountry() {

    // given
    String countryCode = &quot;de&quot;;

    // when
    CountryRestService service = this.serviceClientFactory.create(CountryRestService.class);
    CountryEto country = service.findCountry(countryCode);

    // then
    assertThat(country).isNotNull();
    assertThat(country.getCountryCode()).isEqualTo(countryCode);
    assertThat(country.getName()).isEqualTo(&quot;Germany&quot;);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though not obvious on the first look this test will start your entire application as a server on a free random port (so that it works in CI with parallel builds for different branches) and tests the invocation of a (REST) service including (un)marshalling of data (e.g. as JSON) and transport via HTTP (all in the invocation of the <code>findCountry</code> method).</p>
</div>
<div class="paragraph">
<p>Do not confuse a <em>subsystem test</em> with a <a href="http://istqbexamcertification.com/what-is-system-integration-testing/">system integration test</a>. A system integration test validates the interaction of several systems where we do not recommend test automation.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_level-4-system-test">Level 4 System Test</h6>
<div class="paragraph">
<p>A <a href="http://istqbexamcertification.com/what-is-system-testing/"><em>system test</em></a> has the goal to test the system as a whole against its official interfaces such as its UI or batches. The system itself runs as a separate process in a way close to a regular deployment. Only external systems are simulated by <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-testing.asciidoc_test-doubles">test doubles</a>.</p>
</div>
<div class="paragraph">
<p>The devonfw only gives advice for automated system test (TODO see allure testing framework). In nearly every project there must be manual system tests, too. This manual system tests are out of scope here.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_classifying-integration-levels">Classifying Integration-Levels</h6>
<div class="paragraph">
<p>devon4j defines <a href="https://github.com/devonfw/devon4j/tree/develop/modules/test/src/main/java/com/devonfw/module/test/common/api/category">Category-Interfaces</a> that shall be used as <a href="https://github.com/junit-team/junit/wiki/Categories">JUnit Categories</a>.
Also devon4j provides <a href="https://github.com/devonfw/devon4j/tree/develop/modules/test/src/main/java/com/devonfw/module/test/common/base">abstract base classes</a> that you may extend in your test-cases if you like.</p>
</div>
<div class="paragraph">
<p>devon4j further pre-configures the maven build to only run integration levels 1-2 by default (e.g. for fast feedback in continuous integration). It offers the profiles subsystemtest (1-3) and systemtest (1-4). In your nightly build you can simply add -Psystemtest to run all tests.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_implementation">Implementation</h5>
<div class="paragraph">
<p>This section introduces how to implement tests on the different levels with the given devonfw infrastructure and the proposed frameworks.</p>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_module-test">Module Test</h6>
<div class="paragraph">
<p>In devon4j you can extend the abstract class <a href="https://github.com/devonfw/devon4j/blob/develop/modules/test/src/main/java/com/devonfw/module/test/common/base/ModuleTest.java">ModuleTest</a> to basically get access to assertions. In order to test classes embedded in dependencies  and external services one needs to provide mocks for that. As the <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-testing.asciidoc_test-automation-technology-stack">technology stack</a> recommends we use the Mockito framework to offer this functionality. The following example shows how to implement Mockito into a JUnit test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import static org.mockito.Mockito.when;
import static org.mockito.Mockito.mock;
...

public class StaffmanagementImplTest extends ModuleTest {
  @Rule
  public MockitoRule rule = MockitoJUnit.rule();

  @Test
  public void testFindStaffMember() {
  ...}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the test class does not use the <code>@SpringApplicationConfiguration</code> annotation. In a module test one does not use the whole application.
The JUnit rule is the best solution to use in order to get all needed functionality of Mockito. Static imports are a convenient option to enhance readability within Mockito tests.
You can define mocks with the <code>@Mock</code> annotation or the <code>mock(*.class)</code> call. To inject the mocked objects into your class under test you can use the <code>@InjectMocks</code> annotation. This automatically uses the setters of <code>StaffmanagementImpl</code> to inject the defined mocks into the <em>class under test (CUT)</em> when there is a setter available. In this case the <code>beanMapper</code> and the <code>staffMemberDao</code> are injected. Of course it is possible to do this manually if you need more control.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  @Mock
  private BeanMapper beanMapper;
  @Mock
  private StaffMemberEntity staffMemberEntity;
  @Mock
  private StaffMemberEto staffMemberEto;
  @Mock
  private StaffMemberDao staffMemberDao;
  @InjectMocks
  StaffmanagementImpl staffmanagementImpl = new StaffmanagementImpl();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mocked objects do not provide any functionality at the time being. To define what happens on a method call on a mocked dependency in the CUT one can use <code>when(<em>condition</em>).thenReturn(<em>result</em>)</code>. In this case we want to test <code>findStaffMember(Long id)</code> in the <a href="https://github.com/oasp/oasp4j/blob/master/samples/core/src/main/java/io/oasp/gastronomy/restaurant/staffmanagement/logic/impl/StaffmanagementImpl.java">StaffmanagementImpl</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public StaffMemberEto findStaffMember(Long id) {
  return getBeanMapper().map(getStaffMemberDao().find(id), StaffMemberEto.class);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this simple example one has to stub two calls on the CUT as you can see below. For example the method call of the CUT <code>staffMemberDao.find(id)</code> is stubbed for returning a mock object <code>staffMemberEntity</code> that is also defined as mock.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_subsystem-test">Subsystem Test</h6>
<div class="paragraph">
<p>devon4j provides a simple test infrastructure to aid with the implementation of subsystem tests. It becomes available by simply subclassing <a href="https://github.com/oasp/oasp4j/blob/master/samples/core/src/test/java/io/oasp/gastronomy/restaurant/general/common/base/AbstractRestServiceTest.java">AbstractRestServiceTest.java</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">//given
long id = 1L;
Class&lt;StaffMemberEto&gt; targetClass = StaffMemberEto.class;
when(this.staffMemberDao.find(id)).thenReturn(this.staffMemberEntity);
when(this.beanMapper.map(this.staffMemberEntity, targetClass)).thenReturn(this.staffMemberEto);

//when
StaffMemberEto resultEto = this.staffmanagementImpl.findStaffMember(id);

//then
assertThat(resultEto).isNotNull();
assertThat(resultEto).isEqualTo(this.staffMemberEto);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the test method call one can verify the expected results. Mockito can check whether a mocked method call was indeed called. This can be done using Mockito <code>verify</code>. Note that it does not generate any value if you check for method calls that are needed to reach the asserted result anyway. Call verification can be useful e.g. when you want to assure that statistics are written out without actually testing them.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_regression-testing">Regression testing</h5>
<div class="paragraph">
<p>When it comes to complex output (even binary) that you want to regression test by comparing with an expected result, you sould consider <a href="https://approvaltests.com/">Approval Tests</a> using <a href="https://github.com/approvals/approvaltests.java">ApprovalTests.Java</a>.
If applied for the right problems, it can be very helpful.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_deployment-pipeline">Deployment Pipeline</h5>
<div class="paragraph">
<p>A deployment pipeline is a semi-automated process that gets software-changes from version control into production. It contains several validation steps, e.g. automated tests of all integration levels.
Because devon4j should fit to different project types - from agile to waterfall - it does not define a standard deployment pipeline. But we recommend to define such a deployment pipeline explicitly for each project and to find the right place in it for each type of test.</p>
</div>
<div class="paragraph">
<p>For that purpose, it is advisable to have fast running test suite that gives as much confidence as possible without needing too much time and too much infrastructure. This test suite should run in an early stage of your deployment pipeline. Maybe the developer should run it even before he/she checked in the code. Usually lower integration levels are more suitable for this test suite than higher integration levels.</p>
</div>
<div class="paragraph">
<p>Note, that the deployment pipeline always should contain manual validation steps, at least manual acceptance testing. There also may be manual validation steps that have to be executed for special changes only, e.g. usability testing. Management and execution processes of those manual validation steps are currently not in the scope of devonfw.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_test-coverage">Test Coverage</h5>
<div class="paragraph">
<p>We are using tools (SonarQube/Jacoco) to measure the coverage of the tests. Please always keep in mind that the only reliable message of a code coverage of X% is that (100-X)% of the code is entirely untested. It does not say anything about the quality of the tests or the software though it often relates to it.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_test-configuration">Test Configuration</h5>
<div class="paragraph">
<p>This section covers test configuration in general without focusing on integration levels as in the first chapter.</p>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_configure-test-specific-beans">Configure Test Specific Beans</h6>
<div class="paragraph">
<p>Sometimes it can become handy to provide other or differently configured bean implementations via CDI than those available in production. For example, when creating beans using <code>@Bean</code>-annotated methods they are usually configured within those methods. <a href="https://github.com/oasp/oasp4j/blob/master/samples/core/src/main/java/io/oasp/gastronomy/restaurant/general/service/impl/config/WebSecurityBeansConfig.java">WebSecurityBeansConfig</a> shows an example of such methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
public class WebSecurityBeansConfig {
  //...
  @Bean
  public AccessControlSchemaProvider accessControlSchemaProvider() {
    // actually no additional configuration is shown here
    return new AccessControlSchemaProviderImpl();
  }
  //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AccessControlSchemaProvider</code> allows to programmatically access data defined in some XML file, e.g. <code>access-control-schema.xml</code>. Now, one can imagine that it would be helpful if <code>AccessControlSchemaProvider</code> would point to some other file than the default within a test class. That file could provide content that differs from the default.
The question is: how can I change resource path of <code>AccessControlSchemaProviderImpl</code> within a test?</p>
</div>
<div class="paragraph">
<p>One very helpful solution is to use <strong>static inner classes</strong>.
Static inner classes can contain <code>@Bean</code> -annotated methods, and by placing them in the <code>classes</code> parameter in <code>@SpringBootTest(classes = { /* place class here*/ })</code> annotation the beans returned by these methods are placed in the application context during test execution. Combining this feature with inheritance allows to override methods defined in other configuration classes as shown in the following listing where <code>TempWebSecurityConfig</code> extends <code>WebSecurityBeansConfig</code>. This relationship allows to override <code>public AccessControlSchemaProvider accessControlSchemaProvider()</code>. Here we are able to configure the instance of type <code>AccessControlSchemaProviderImpl</code> before returning it (and, of course, we could also have used a completely different implementation of the <code>AccessControlSchemaProvider</code> interface). By overriding the method the implementation of the super class is ignored, hence, only the new implementation is called at runtime. Other methods defined in <code>WebSecurityBeansConfig</code> which are not overridden by the subclass are still dispatched to <code>WebSecurityBeansConfig</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">//... Other testing related annotations
@SpringBootTest(classes = { TempWebSecurityConfig.class })
public class SomeTestClass {

  public static class TempWebSecurityConfig extends WebSecurityBeansConfig {

    @Override
    @Bean
    public AccessControlSchemaProvider accessControlSchemaProvider() {

      ClassPathResource resource = new ClassPathResource(locationPrefix + &quot;access-control-schema3.xml&quot;);
      AccessControlSchemaProviderImpl accessControlSchemaProvider = new AccessControlSchemaProviderImpl();
      accessControlSchemaProvider.setAccessControlSchema(resource);
      return accessControlSchemaProvider;
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-javaconfig">chapter of the Spring framework documentation</a> explains issue, but uses a slightly different way to obtain the configuration.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_test-data">Test Data</h6>
<div class="paragraph">
<p>It is possible to obtain test data in two different ways depending on your test&#x2019;s integration level.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_debugging-tests">Debugging Tests</h5>
<div class="paragraph">
<p>The following two sections describe two debugging approaches for tests. Tests are either run from within the IDE or from the command line using Maven.</p>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_debugging-with-the-ide">Debugging with the IDE</h6>
<div class="paragraph">
<p>Debugging with the IDE is as easy as always. Even if you want to execute a <code>SubsystemTest</code> which needs a Spring context and a server infrastructure to run properly, you just set your breakpoints and click on Debug As &#x2192; JUnit Test. The test infrastructure will take care of initializing the necessary infrastructure - if everything is configured properly.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-testing.asciidoc_debugging-with-maven">Debugging with Maven</h6>
<div class="paragraph">
<p>Please refer to the following two links to find a guide for debugging tests when running them from Maven.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://maven.apache.org/surefire/maven-surefire-plugin/examples/debugging.html" class="bare">http://maven.apache.org/surefire/maven-surefire-plugin/examples/debugging.html</a></p>
</li>
<li>
<p><a href="https://www.eclipse.org/jetty/documentation/9.3.x/debugging-with-eclipse.html" class="bare">https://www.eclipse.org/jetty/documentation/9.3.x/debugging-with-eclipse.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In essence, you first have to start execute a test using the command line. Maven will halt just before the test execution and wait for your IDE to connect to the process. When receiving a connection the test will start and then pause at any breakpoint set in advance.
The first link states that tests are started through the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn -Dmaven.surefire.debug test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although this is correct, it will run <em>every</em> test class in your project and - which is time consuming and mostly unnecessary - halt before each of these tests.
To counter this problem you can simply execute a single test class through the following command (here we execute the <code>TablemanagementRestServiceTest</code> from the restaurant sample application):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn test -Dmaven.surefire.debug test -Dtest=TablemanagementRestServiceTest</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to notice that you first have to execute the Maven command in the according submodule, e.g. to execute the <code>TablemanagementRestServiceTest</code> you have first to navigate to the core module&#x2019;s directory.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-transferobject.asciidoc">Transfer-Objects</h4>
<div class="paragraph">
<p>The technical data model is defined in form of <a href="guide-jpa.html#entity">persistent entities</a>.
However, passing persistent entities via <em>call-by-reference</em> across the entire application will soon cause problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to a persistent entity are directly written back to the persistent store when the transaction is committed. When the entity is send across the application also changes tend to take place in multiple places endangering data sovereignty and leading to inconsistency.</p>
</li>
<li>
<p>You want to send and receive data via services across the network and have to define what section of your data is actually transferred. If you have relations in your technical model you quickly end up loading and transferring way too much data.</p>
</li>
<li>
<p>Modifications to your technical data model shall not automatically have impact on your external services causing incompatibilities.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To prevent such problems transfer-objects are used leading to a <em>call-by-value</em> model and decoupling changes to persistent entities.</p>
</div>
<div class="paragraph">
<p>In the following sections the different types of transfer-objects are explained.
You will find all according naming-conventions in the <a href="guide-structure-classic.html#architecture-mapping">architecture-mapping</a></p>
</div>
<div class="paragraph">
<p>To structure your transfer objects, we recommend the following approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guide-eto-cto.asciidoc">ETO and CTO</a></p>
</li>
<li>
<p><a href="#guide-dto.asciidoc">DTO</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also considering the following transfer objects in specific cases:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SearchCriteriaTo</dt>
<dd>
<p>For searching we create or generate a <code>&#xAB;BusinessObject&#xBB;SearchCriteriaTo</code> representing a query to find instances of <code>&#xAB;BusinessObject&#xBB;</code>.</p>
</dd>
<dt class="hdlist1">TO</dt>
<dd>
<p>There are typically transfer-objects for data that is never persistent.
For very generic cases these just carry the suffix <code>To</code>.</p>
</dd>
<dt class="hdlist1">STO</dt>
<dd>
<p>We can potentially create separate <em>service transfer objects</em> (STO) (if possible named <code>&#xAB;BusinessObject&#xBB;Sto</code>) to keep the <a href="devon4j.asciidoc_layers.html#guide-service-layer.asciidoc">service</a> API stable and independent of the actual data-model.
However, we usually do not need this and want to keep our architecture simple.
Only create STOs if you need <a href="guide-service-layer.html#versioning">service versioning</a> and support previous APIs or to provide legacy service technologies that require their own isolated data-model.
In such case you also need <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-beanmapping.asciidoc">beanmapping</a> between STOs and ETOs/DTOs what means extra effort and complexity that should be avoided.</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="guide-beanmapping.asciidoc">Bean-Mapping</h4>
<div class="paragraph">
<p>For decoupling you sometimes need to create separate objects (beans) for a different view. E.g. for an external service you will use a <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-transferobject.asciidoc">transfer-object</a> instead of the <a href="guide-jpa.html#entity">persistence entity</a> so internal changes to the entity do not implicitly change or break the service.</p>
</div>
<div class="paragraph">
<p>Therefore you have the need to map similar objects what creates a copy. This also has the benefit that modifications to the copy have no side-effect on the original source object. However, to implement such mapping code by hand is very tedious and error-prone (if new properties are added to beans but not to mapping code):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public UserEto mapUser(UserEntity source) {
  UserEto target = new UserEto();
  target.setUsername(source.getUsername());
  target.setEmail(source.getEmail());
  ...
  return target;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore we are using a <code>BeanMapper</code> for this purpose that makes our lives a lot easier.</p>
</div>
<div class="sect4">
<h5 id="guide-beanmapping.asciidoc_bean-mapper-dependency">Bean-Mapper Dependency</h5>
<div class="paragraph">
<p>To get access to the <code>BeanMapper</code> we have to use either of below dependency in our POM:</p>
</div>
<div class="paragraph">
<p>We started with dozer.sourceforge.net/[dozer] in devon4j and still support it. However, we now recommend <a href="https://orika-mapper.github.io/orika-docs/">orika</a> (for new projects) as it is much faster (see <a href="https://www.baeldung.com/java-performance-mapping-frameworks#2-orika">Performance of Java Mapping Frameworks</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;com.devonfw.java&lt;/groupId&gt;
      &lt;artifactId&gt;devon4j-beanmapping-orika&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;com.devonfw.java&lt;/groupId&gt;
      &lt;artifactId&gt;devon4j-beanmapping-dozer&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-beanmapping.asciidoc_bean-mapper-configuration-using-dozer">Bean-Mapper Configuration using Dozer</h5>
<div class="paragraph">
<p>The <code>BeanMapper</code> implementation is based on an existing open-source bean mapping framework.
In case of Dozer the mapping is configured <code>src/main/resources/config/app/common/dozer-mapping.xml</code>.</p>
</div>
<div class="paragraph">
<p>See the my-thai-star <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/resources/config/app/common/dozer-mapping.xml">dozer-mapping.xml</a> as an example.
Important is that you configure all your custom datatypes as <code>&lt;copy-by-reference&gt;</code> tags and have the mapping from <code>PersistenceEntity</code> (<code>ApplicationPersistenceEntity</code>) to <code>AbstractEto</code> configured properly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;mapping type=&quot;one-way&quot;&gt;
    &lt;class-a&gt;com.devonfw.module.basic.common.api.entity.PersistenceEntity&lt;/class-a&gt;
    &lt;class-b&gt;com.devonfw.module.basic.common.api.to.AbstractEto&lt;/class-b&gt;
    &lt;field custom-converter=&quot;com.devonfw.module.beanmapping.common.impl.dozer.IdentityConverter&quot;&gt;
      &lt;a&gt;this&lt;/a&gt;
      &lt;b is-accessible=&quot;true&quot;&gt;persistentEntity&lt;/b&gt;
    &lt;/field&gt;
&lt;/mapping&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-beanmapping.asciidoc_bean-mapper-usage">Bean-Mapper Usage</h5>
<div class="paragraph">
<p>Then we can get the <code>BeanMapper</code> via <a href="guide-dependency-injection.asciidoc.html">dependency-injection</a> what we typically already provide by an abstract base class (e.g. <code>AbstractUc</code>). Now we can solve our problem very easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">...
UserEntity resultEntity = ...;
...
return getBeanMapper().map(resultEntity, UserEto.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also additional support for mapping entire collections.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-datatype.asciidoc">Datatypes</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A datatype is an object representing a value of a specific type with the following aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It has a technical or business specific semantic.</p>
</li>
<li>
<p>Its JavaDoc explains the meaning and semantic of the value.</p>
</li>
<li>
<p>It is immutable and therefore stateless (its value assigned at construction time and can not be modified).</p>
</li>
<li>
<p>It is serializable.</p>
</li>
<li>
<p>It properly implements #equals(Object) and #hashCode() (two different instances with the same value are equal and have the same hash).</p>
</li>
<li>
<p>It shall ensure syntactical validation so it is NOT possible to create an instance with an invalid value.</p>
</li>
<li>
<p>It is responsible for formatting its value to a string representation suitable for sinks such as UI, loggers, etc. Also consider cases like a Datatype representing a password where toString() should return something like &quot;<strong><strong></strong></strong>**&quot; instead of the actual password to prevent security accidents.</p>
</li>
<li>
<p>It is responsible for parsing the value from other representations such as a string (as needed).</p>
</li>
<li>
<p>It shall provide required logical operations on the value to prevent redundancies. Due to the immutable attribute all manipulative operations have to return a new Datatype instance (see e.g. BigDecimal.add(java.math.BigDecimal)).</p>
</li>
<li>
<p>It should implement Comparable if a natural order is defined.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Based on the Datatype a presentation layer can decide how to view and how to edit the value. Therefore a structured data model should make use of custom datatypes in order to be expressive.
Common generic datatypes are String, Boolean, Number and its subclasses, Currency, etc.
Please note that both Date and Calendar are mutable and have very confusing APIs. Therefore, use JSR-310 or jodatime instead.
Even if a datatype is technically nothing but a String or a Number but logically something special it is worth to define it as a dedicated datatype class already for the purpose of having a central javadoc to explain it. On the other side avoid to introduce technical datatypes like String32 for a String with a maximum length of 32 characters as this is not adding value in the sense of a real Datatype.
It is suitable and in most cases also recommended to use the class implementing the datatype as API omitting a dedicated interface.</p>
</div>
</blockquote>
<div class="attribution">
&#x2014; mmm project<br>
<cite>datatype javadoc</cite>
</div>
</div>
<div class="paragraph">
<p>See <a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/lang/api/Datatype.html">mmm datatype javadoc</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-datatype.asciidoc_datatype-packaging">Datatype Packaging</h5>
<div class="paragraph">
<p>For the devonfw we use a common <a href="coding-conventions.html#packages">packaging schema</a>.
The specifics for datatypes are as following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Segment</strong></th>
<th class="tableblock halign-left valign-top"><strong>Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Explanation</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;component&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Here we use the (business) component defining the datatype or general for generic datatypes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;layer&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">common</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datatypes are used across all layers and are not assigned to a dedicated layer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;scope&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datatypes are always used directly as API even tough they may contain (simple) implementation logic. Most datatypes are simple wrappers for generic Java types (e.g. String) but make these explicit and might add some validation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="guide-datatype.asciidoc_technical-concerns">Technical Concerns</h5>
<div class="paragraph">
<p>Many technologies like Dozer and QueryDSL&#x2019;s (alias API) are heavily based on reflection. For them to work properly with custom datatypes, the frameworks must be able to instantiate custom datatypes with no-argument constructors. It is therefore recommended to implement a no-argument constructor for each datatype of at least protected visibility.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-datatype.asciidoc_datatypes-in-entities">Datatypes in Entities</h5>
<div class="paragraph">
<p>The usage of custom datatypes in entities is explained in the <a href="guide-jpa.html#entities-and-datatypes">persistence layer guide</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-datatype.asciidoc_datatypes-in-transfer-objects">Datatypes in Transfer-Objects</h5>
<div class="sect5">
<h6 id="guide-datatype.asciidoc_xml">XML</h6>
<div class="paragraph">
<p>For mapping datatypes with JAXB see <a href="guide-xml.asciidoc.html">XML guide</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-datatype.asciidoc_json">JSON</h6>
<div class="paragraph">
<p>For mapping datatypes from and to JSON see <a href="guide-json.html#json-custom-mapping">JSON custom mapping</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="devon4j.wiki_guide-cors-support.asciidoc">CORS support</h4>
<div class="paragraph">
<p>When you are developing Javascript client and server application separately, you have to deal with cross domain issues. We have to request from a origin domain distinct to target domain and browser does not allow this.</p>
</div>
<div class="paragraph">
<p>So , we need to prepare server side to accept request from other domains. We need to cover the following points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Accept request from other domains.</p>
</li>
<li>
<p>Accept devonfw used headers like <code>X-CSRF-TOKEN</code> or <code>correlationId.</code></p>
</li>
<li>
<p>Be prepared to receive secured request (cookies).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is important to note that if you are using security in your request (sending cookies) you have to set  <code>withCredentials</code> flag to <code>true</code> in your client side request and deal with special IE8 characteristics.</p>
</div>
<div class="sect4">
<h5 id="devon4j.wiki_guide-cors-support.asciidoc_configuring-cors-support">Configuring CORS support</h5>
<div class="sect5">
<h6 id="guide-cors-support.asciidoc_dependency">Dependency</h6>
<div class="paragraph">
<p>To enable the CORS support from the server side add the below dependency.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.starters&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-starter-security-cors&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-cors-support.asciidoc_configuration">Configuration</h6>
<div class="paragraph">
<p>Add the below properties in your application.properties file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>#CORS support
security.cors.spring.allowCredentials=true
security.cors.spring.allowedOriginPatterns=*
security.cors.spring.allowedHeaders=*
security.cors.spring.allowedMethods=OPTIONS,HEAD,GET,PUT,POST,DELETE,PATCH
security.cors.pathPattern=/**</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">HTTP Header</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowCredentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decides the browser should include any cookies associated with the request (<code>true</code> if cookies should be included).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access-Control-Allow-Credentials</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedOrigins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of allowed origins (use <code>*</code> to allow all orgins).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access-Control-Allow-Origin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedMethods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of allowed HTTP request methods (<code>OPTIONS</code>, <code>HEAD</code>, <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>, <code>PATCH</code>, etc.).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of allowed headers that can be used during the request (use <code>*</code> to allow all headers requested by the client)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access-Control-Allow-Headers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pathPattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ant-style pattern for the URL paths where to apply CORS. Use &quot;/**&quot; to match all URL paths.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>More information about the CORS headers can be found <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers#cors">here</a></p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-microservice.asciidoc">Microservices in devonfw</h4>
<div class="paragraph">
<p>The Microservices architecture is an approach for application development based on a series of <em>small</em> services grouped under a business domain. Each individual service runs autonomously and communicating with each other through their APIs. That independence between the different services allows to manage (upgrade, fix, deploy, etc.) each one without affecting the rest of the system&#x2019;s services. In addition to that the microservices architecture allows to scale specific services when facing an increment of the requests, so the applications based on microservices are more flexible and stable, and can be adapted quickly to demand changes.</p>
</div>
<div class="paragraph">
<p>However, this new approach, developing apps based on microservices, presents some downsides.</p>
</div>
<div class="paragraph">
<p>Let&#x2019;s see the main challenges when working with microservices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Having the applications divided in different services we will need a component (router) to redirect each request to the related microservice. These redirection rules must implement filters to guarantee a proper functionality.</p>
</li>
<li>
<p>In order to manage correctly the routing process, the application will also need a catalog with all the microservices and its details: IPs and ports of each of the deployed instances of each microservice, the state of each instance and some other related information. This catalog is called <em>Service Discovery</em>.</p>
</li>
<li>
<p>With all the information of the <em>Service Discovery</em> the application will need to calculate and select between all the available instances of a microservice which is the suitable one. This will be figured out by the library <em>Client Side Load Balancer</em>.</p>
</li>
<li>
<p>The different microservices will be likely interconnected with each other, that means that in case of failure of one of the microservices involved in a process, the application must implement a mechanism to avoid the error propagation through the rest of the services and provide an alternative as a process result. To solve this, the pattern <em>Circuit Breaker</em> can be implemented in the calls between microservices.</p>
</li>
<li>
<p>As we have mentioned, the microservices will exchange calls and information with each other so our applications will need to provide a secured context to avoid not allowed operations or intrusions. In addition, since microservices must be able to operate in an isolated way, it is not recommended to maintain a session. To meet this need without using Spring sessions, a token-based authentication is used that exchanges information using the <a href="https://jwt.io/">json web token (JWT)</a> protocol.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to all of this we will find other issues related to this particular architecture that we will address fitting the requirements of each project.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distributed data bases: each instance of a microservice should have only one data base.</p>
</li>
<li>
<p>Centralized logs: each instance of a microservice creates a log and a trace that should be centralized to allow an easier way to read all that information.</p>
</li>
<li>
<p>Centralized configuration: each microservice has its own configuration, so our applications should group all those configurations in only one place to ease the configuration management.</p>
</li>
<li>
<p>Automatized deployments: as we are managing several components (microservices, catalogs, balancers, etc.) the deployment should be automatized to avoid errors and ease this process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To address the above, devonfw microservices has an alternative approach <a href="#alternative-microservice-netflix.asciidoc">Microservices based on Netflix-Tools</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="guide-caching.asciidoc">Caching</h4>
<div class="paragraph">
<p>Caching is a technical approach to improve performance. While it may appear easy on the first sight it is an advanced topic. In general, try to use caching only when required for performance reasons. If you come to the point that you need caching first think about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What to cache?<br>
Be sure about what you want to cache. Is it static data? How often will it change? What will happen if the data changes but due to caching you might receive &quot;old&quot; values? Can this be tolerated? For how long? This is not a technical question but a business requirement.</p>
</li>
<li>
<p>Where to cache?<br>
Will you cache data on client or server? Where exactly?</p>
</li>
<li>
<p>How to cache?<br>
Is a local cache sufficient or do you need a shared cache?</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="guide-caching.asciidoc_local-cache">Local Cache</h5>

</div>
<div class="sect4">
<h5 id="guide-caching.asciidoc_shared-cache">Shared Cache</h5>
<div class="sect5">
<h6 id="guide-caching.asciidoc_distributed-cache">Distributed Cache</h6>

</div>
</div>
<div class="sect4">
<h5 id="guide-caching.asciidoc_products">Products</h5>
<div class="ulist">
<ul>
<li>
<p><a href="http://ehcache.org/" class="bare">http://ehcache.org/</a></p>
</li>
<li>
<p><a href="http://hazelcast.org/" class="bare">http://hazelcast.org/</a></p>
</li>
<li>
<p><a href="http://terracotta.org/" class="bare">http://terracotta.org/</a></p>
</li>
<li>
<p><a href="http://memcached.org/" class="bare">http://memcached.org/</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-caching.asciidoc_caching-of-web-resources">Caching of Web-Resources</h5>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.mobify.com/blog/beginners-guide-to-http-cache-headers/" class="bare">http://www.mobify.com/blog/beginners-guide-to-http-cache-headers/</a></p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/Web_cache#Cache_control" class="bare">http://en.wikipedia.org/wiki/Web_cache#Cache_control</a></p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Avoiding_caching" class="bare">http://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Avoiding_caching</a></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-feature-toggle.asciidoc">Feature-Toggles</h4>
<div class="paragraph">
<p>The most software developing teams use Feature-Branching to be able to work in parallel and maintain a stable main branch in the VCS. However Feature-Branching might not be the ideal tool in every case because of big merges and isolation between development groups. In many cases, Feature-Toggles can avoid some of these problems, so these should definitely be considered to be used in the collaborative software development.</p>
</div>
<div class="sect4">
<h5 id="guide-feature-toggle.asciidoc_implementation-with-the-devonfw">Implementation with the devonfw</h5>
<div class="paragraph">
<p>To use Feature-Toggles with the devonfw, use the Framework <a href="http://www.togglz.org/">Togglz</a> because it has all the features generally needed and provides a great documentation.</p>
</div>
<div class="paragraph">
<p>For a pretty minimal working example, also see <a href="https://github.com/florianluediger/oasp4j">this fork</a>.</p>
</div>
<div class="sect5">
<h6 id="guide-feature-toggle.asciidoc_preparation">Preparation</h6>
<div class="paragraph">
<p>The following example takes place in the <code>oasp-sample-core</code> project, so the necessary dependencies have to be added to the according <code>pom.xml</code> file. Required are the main Togglz project including Spring support, the Togglz console to graphically change the feature state and the Spring security package to handle authentication for the Togglz console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;!-- Feature-Toggle-Framework togglz --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.togglz&lt;/groupId&gt;
  &lt;artifactId&gt;togglz-spring-boot-starter&lt;/artifactId&gt;
  &lt;version&gt;2.3.0.RC2&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.togglz&lt;/groupId&gt;
  &lt;artifactId&gt;togglz-console&lt;/artifactId&gt;
  &lt;version&gt;2.3.0.RC2&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.togglz&lt;/groupId&gt;
  &lt;artifactId&gt;togglz-spring-security&lt;/artifactId&gt;
  &lt;version&gt;2.3.0.RC2&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to that, the following lines have to be included in the spring configuration file <code>application.properties</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># configuration for the togglz Feature-Toggle-Framework
togglz.enabled=true
togglz.console.secured=false</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-feature-toggle.asciidoc_small-features">Small features</h6>
<div class="paragraph">
<p>For small features, a simple query of the toggle state is often enough to achieve the desired functionality. To illustrate this, a simple example follows, which implements a toggle to limit the page size returned by the staffmanagement. See <a href="https://github.com/florianluediger/oasp4j/commit/e55c3c7cfcb42efe4f279dc673cced730abd580a">here</a> for further details.</p>
</div>
<div class="paragraph">
<p>This is the current implementation to <em>toggle</em> the feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Uncomment next line in order to limit the maximum page size for the staff member search
// criteria.limitMaximumPageSize(MAXIMUM_HIT_LIMIT);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To realise this more elegantly with Togglz, first an enum is required to configure the feature-toggle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public enum StaffmanagementFeatures implements Feature {
  @Label(&quot;Limit the maximum page size for the staff members&quot;)
  LIMIT_STAFF_PAGE_SIZE;

  public boolean isActive() {
    return FeatureContext.getFeatureManager().isActive(this);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To familiarize the Spring framework with the enum, add the following entry to the <code>application.properties</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>togglz.feature-enums=io.oasp.gastronomy.restaurant.staffmanagement.featuremanager.StaffmanagementFeatures</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, the toggle can be used easily by calling the <code>isActive()</code> method of the enum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">if (StaffmanagementFeatures.LIMIT_STAFF_PAGE_SIZE.isActive()) {
  criteria.limitMaximumPageSize(MAXIMUM_HIT_LIMIT);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This way, you can easily switch the feature on or off by using the administration console at <a href="http://localhost:8081/devon4j-sample-server/togglz-console" class="bare">http://localhost:8081/devon4j-sample-server/togglz-console</a>. If you are getting redirected to the login page, just sign in with any valid user (eg. admin).</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-feature-toggle.asciidoc_extensive-features">Extensive features</h6>
<div class="paragraph">
<p>When implementing extensive features, you might want to consider using the strategy design pattern to maintain the overview of your software. The following example is an implementation of a feature which adds a 25% discount to all products managed by the offermanagement.</p>
</div>
<div class="olist arabic">
<div class="title">Therefore there are two strategies needed:</div>
<ol class="arabic">
<li>
<p>Return the offers with the normal price</p>
</li>
<li>
<p>Return the offers with a 25% discount</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The implementation is pretty straight forward so use this as a reference. Compare <a href="https://github.com/florianluediger/oasp4j/commit/8f43f788d3a4a61b6b003c22a8b6c0d3f2254d14">this</a> for further details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Override
@RolesAllowed(PermissionConstants.FIND_OFFER)
public PaginatedListTo&lt;OfferEto&gt; findOfferEtos(OfferSearchCriteriaTo criteria) {
  criteria.limitMaximumPageSize(MAXIMUM_HIT_LIMIT);
  PaginatedListTo&lt;OfferEntity&gt; offers = getOfferDao().findOffers(criteria);


  if (OffermanagementFeatures.DISCOUNT.isActive()) {
    return getOfferEtosDiscount(offers);
  } else {
    return getOfferEtosNormalPrice(offers);
  }

}


// Strategy 1: Return the OfferEtos with the normal price
private PaginatedListTo&lt;OfferEto&gt; getOfferEtosNormalPrice(PaginatedListTo&lt;OfferEntity&gt; offers) {
  return mapPaginatedEntityList(offers, OfferEto.class);
}

// Strategy 2: Return the OfferEtos with the new, discounted price
private PaginatedListTo&lt;OfferEto&gt; getOfferEtosDiscount(PaginatedListTo&lt;OfferEntity&gt; offers) {
  offers = addDiscountToOffers(offers);
  return mapPaginatedEntityList(offers, OfferEto.class);
}

private PaginatedListTo&lt;OfferEntity&gt; addDiscountToOffers(PaginatedListTo&lt;OfferEntity&gt; offers) {
  for (OfferEntity oe : offers.getResult()) {
    Double oldPrice = oe.getPrice().getValue().doubleValue();

    // calculate the new price and round it to two decimal places
    BigDecimal newPrice = new BigDecimal(oldPrice * 0.75);
    newPrice = newPrice.setScale(2, RoundingMode.HALF_UP);

    oe.setPrice(new Money(newPrice));
  }

  return offers;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-feature-toggle.asciidoc_guidelines-for-a-successful-use-of-feature-toggles">Guidelines for a successful use of feature-toggles</h5>
<div class="paragraph">
<p>The use of feature-toggles requires a specified set of guidelines to maintain the overview on the software. The following is a collection of considerations and examples for conventions that are reasonable to use.</p>
</div>
<div class="sect5">
<h6 id="guide-feature-toggle.asciidoc_minimize-the-number-of-toggles">Minimize the number of toggles</h6>
<div class="paragraph">
<p>When using too many toggles at the same time, it is hard to maintain a good overview of the system and things like finding bugs are getting much harder. Additionally, the management of toggles in the configuration interface gets more difficult due to the amount of toggles.</p>
</div>
<div class="paragraph">
<p>To prevent toggles from piling up during development, a toggle and the associated obsolete source code should be removed after the completion of the corresponding feature. In addition to that, the existing toggles should be revisited periodically to verify that these are still needed and therefore remove legacy toggles.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-feature-toggle.asciidoc_consistent-naming-scheme">Consistent naming scheme</h6>
<div class="paragraph">
<p>A consistent naming scheme is the key to a structured and easily maintainable set of features. This should include the naming of toggles in the source code and the appropriate naming of commit messages in the VCS. The following section contains an example for a useful naming scheme including a small example.</p>
</div>
<div class="paragraph">
<p>Every Feature-Toggle in the system has to get its own unique name without repeating any names of features, which were removed from the system. The chosen names should be descriptive names to simplify the association between toggles and their purpose. If the feature should be split into multiple sub-features, you might want to name the feature like the parent feature with a describing addition. If for example you want to split the <code>DISCOUNT</code> feature into the logic and the UI part, you might want to name the sub-features <code>DISCOUNT_LOGIC</code> and <code>DISCOUNT_UI</code>.</p>
</div>
<div class="paragraph">
<p>The entry in the togglz configuration enum should be named identically to the aforementioned feature name. The explicitness of feature names prevents a confusion between toggles due to using multiple enums.</p>
</div>
<div class="paragraph">
<p>Commit messages are very important for the use of feature-toggles and also should follow a predefined naming scheme. You might want to state the feature name at the beginning of the message, followed by the actual message, describing what the commit changes to the feature. An example commit message could look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>DISCOUNT: Add the feature-toggle to the offermanagement implementation.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mentioning the feature name in the commit message has the advantage, that you can search your git log for the feature name and get every commit belonging to the feature. An example for this using the tool <em>grep</em> could look like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ git log | grep -C 4 DISCOUNT

commit 034669a48208cb946cc6ba8a258bdab586929dd9
Author: Florian Luediger &lt;florian.luediger@somemail.com&gt;
Date:   Thu Jul 7 13:04:37 2016 +0100

DISCOUNT: Add the feature-toggle to the offermanagement implementation.</code></pre>
</div>
</div>
<div class="paragraph">
<p>To keep track of all the features in your software system, a platform like GitHub offers issues. When creating an issue for every feature, you can retrace, who created the feature and who is assigned to completing its development. When referencing the issue from commits, you also have links to all the relevant commits from the issue view.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-feature-toggle.asciidoc_placement-of-toggle-points">Placement of toggle points</h6>
<div class="paragraph">
<p>To maintain a clean codebase, you definitely want to avoid using the same toggle in different places in the software. There should be one single query of the toggle which should be able to toggle the whole functionality of the feature. If one single toggle point is not enough to switch the whole feature on or off, you might want to think about splitting the feature into multiple ones.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-feature-toggle.asciidoc_use-of-fine-grained-features">Use of fine-grained features</h6>
<div class="paragraph">
<p>Bigger features in general should be split into multiple sub-features to maintain the overview on the codebase. These sub-features get their own feature-toggle and get implemented independently.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="devon4j.wiki_guide-accessibility.asciidoc">Accessibility</h4>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="paragraph">
<p><a href="http://www.w3.org/TR/WCAG20/" class="bare">http://www.w3.org/TR/WCAG20/</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.w3.org/WAI/intro/aria" class="bare">http://www.w3.org/WAI/intro/aria</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.einfach-fuer-alle.de/artikel/bitv/" class="bare">http://www.einfach-fuer-alle.de/artikel/bitv/</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.banu.bund.de" class="bare">http://www.banu.bund.de</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.de.capgemini.com/public-sector/igov" class="bare">http://www.de.capgemini.com/public-sector/igov</a></p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="guide-kafka.asciidoc">Messaging Services</h4>
<div class="paragraph">
<p>Messaging Services provide an asynchronous communication mechanism between applications. Technically this is implemented using <a href="http://kafka.apache.org/documentation.html/">Apache Kafka</a> .</p>
</div>
<div class="paragraph">
<p>For <a href="spring.asciidoc.html">spring</a>, devonfw uses <a href="https://spring.io/projects/spring-kafka">Spring-Kafka</a> as kafka framework.
For more details, check the <a href="#spring/guide-kafka-spring.asciidoc">devon4j-kafka</a>.</p>
</div>
<div class="paragraph">
<p>For <a href="quarkus.asciidoc.html">quarkus</a>, follow <a href="https://quarkus.io/guides/kafka">Quarkus - Kafka Reference Guide</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="guide-jms.asciidoc">Messaging</h4>
<div class="paragraph">
<p>Messaging in Java is done using the <a href="https://en.wikipedia.org/wiki/Java_Message_Service">JMS</a> standard from JEE.</p>
</div>
<div class="sect4">
<h5 id="guide-jms.asciidoc_products">Products</h5>
<div class="paragraph">
<p>For messaging you need to choose a JMS provider such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.rabbitmq.com/">RabbitMQ</a></p>
</li>
<li>
<p><a href="https://activemq.apache.org/jms">ActiveMQ</a></p>
</li>
<li>
<p><a href="guide-oracle.html#messaging">Oracle Advanced Queuing</a> (esp. if you already use <a href="#guide-oracle.asciidoc">Oracle RDBMS</a>)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-jms.asciidoc_receiver">Receiver</h5>
<div class="paragraph">
<p>As a receiver of messages is receiving data from other systems it is located in the <a href="devon4j.asciidoc_layers.html#guide-service-layer.asciidoc">service-layer</a>.</p>
</div>
<div class="sect5">
<h6 id="guide-jms.asciidoc_jms-listener">JMS Listener</h6>
<div class="paragraph">
<p>A <code>JmsListener</code> is a class listening and consuming JMS messages. It should carry the suffix <code>JmsListener</code> and implement the <code>MessageListener</code> interface or have its listener method annotated with <code>@JmsListener</code>. This is illustrated by the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
@Transactional
public class BookingJmsListener /* implements MessageListener */ {

  @Inject
  private Bookingmanagement bookingmanagement;

  @Inject
  private MessageConverter messageConverter;

  @JmsListener(destination = &quot;BOOKING_QUEUE&quot;, containerFactory = &quot;jmsListenerContainerFactory&quot;)
  public void onMessage(Message message) {
    try {
      BookingTo bookingTo = (BookingTo) this.messageConverter.fromMessage(message);
      this.bookingmanagement.importBooking(bookingTo);
    } catch (MessageConversionException | JMSException e) {
      throw new InvalidMessageException(message);
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-jms.asciidoc_sender">Sender</h5>
<div class="paragraph">
<p>The sending of JMS messages is considered as any other sending of data like <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-kafka.asciidoc">kafka</a> messages or RPC calls via <a href="guide-rest.asciidoc.html">REST</a> using <a href="devon4j.wiki_devon4j.asciidoc_guides.html#guide-service-client.asciidoc">service-client</a>, gRPC, etc.
This will typically happen directly from a <a href="devon4j.asciidoc_layers.html#guide-usecase.asciidoc">use-case</a> in the <a href="devon4j.asciidoc_layers.html#guide-logic-layer.asciidoc">logic-layer</a>.
However, the technical complexity of the communication and protocols itself shall be hidden from the use-case and not be part of the logic layer.
With spring we can simply use <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/jms/core/JmsTemplate.html">JmsTemplate</a> to do that.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-text-search.asciidoc">Full Text Search</h4>
<div class="paragraph">
<p>If you want to all your users fast and simple searches with just a single search field (like in google), you need full text indexing and search support.</p>
</div>
<div class="sect4">
<h5 id="guide-text-search.asciidoc_solutions">Solutions</h5>
<div class="ulist">
<ul>
<li>
<p><a href="http://lucene.apache.org/">Lucene</a></p>
</li>
<li>
<p><a href="https://lucene.apache.org/core/4_4_0/analyzers-common/org/apache/lucene/analysis/ngram/NGramTokenizer.html">NGram</a></p>
</li>
<li>
<p><a href="http://lucene.apache.org/solr/">Solr</a></p>
</li>
<li>
<p><a href="https://www.elastic.co/products/elasticsearch">elastic-search</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Maybe you also want to use native features of your database</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://blogs.sap.com/2012/10/10/the-not-so-fuzzy-fuzzy-search/">SAP Hana Fuzzy Search</a></p>
</li>
<li>
<p><a href="https://www.oracle.com/technetwork/database/enterprise-edition/index-098492.html">Oracle Text</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-text-search.asciidoc_best-practices">Best Practices</h5>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>&#x2190;&#xA0;Previous:&#xA0;<a href="devon4j.asciidoc_layers.html">Layers</a>&#xA0;| &#x2191;&#xA0;Up:&#xA0;<a href="spring.asciidoc.html">Spring</a>&#xA0;| &#x2302;&#xA0;Home:&#xA0;<a href="master.html">devonfw guide</a>&#xA0;| Next:&#xA0;<a href="devon4j.asciidoc_tutorials.html">Tutorials</a>&#xA0;&#x2192;</p>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html#introduction-why-should-i-use-devonfw.asciidoc">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_further-information.html">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devon4j.asciidoc_architecture.html">Architecture</a></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">Resources</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-ide-support.asciidoc.html#LICENSE.asciidoc">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script type="module">
      import { UtilsModule } from '/website/shared/utils.js';
      import { HeaderModule } from '/website/components/header/header.js';

      let searchData = { index: null, documents: null };
      UtilsModule.loadIndex(searchData);

      $(window).on('load', function() {
        const queryFun = () => {
          HeaderModule.queryFunction(searchData);
        };

        HeaderModule.searchOnClick(queryFun);
      });
    </script>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<div class="footnote"><sub>

Last updated 2021-10-20 10:23:13 UTC
</sub></div>


<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>

</body></html>