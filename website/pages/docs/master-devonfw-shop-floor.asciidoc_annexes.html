<!DOCTYPE html><html lang="en"><head><style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style><style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Updated at 2021-07-16 19:40:49 UTC">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>devonfw guide</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" integrity="sha256-M/Awbb/BYh+Rh0aGjpQid26p1b2OBsrk2k9yAvQxPV0=" crossorigin="anonymous"></script>
<!-- JQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/styles/googlecode.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/lang/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>

<!-- ************** Google analytics ************ -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>

<!-- ******************************************** -->

</head>
<body id="master.asciidoc" class="book toc2 toc-left">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="/website/pages/explore/explore.html">EXPLORE</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html" class="active">DOCS</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input id="search-field" type="search" class="form-control mr-sm-2" placeholder="Search by keyword(s)..." aria-label="Search" style="height: auto;">
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width="auto" height="auto" alt>
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="header">
<h1>devonfw guide</h1>
<div class="details">
<span id="author" class="author">Updated at 2021-07-16 19:41:21 UTC</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="master.html">devonfw guide</a></span></p><ul class="sectlevel0">
<li><a href="getting-started.asciidoc.html">I. Getting Started</a>
</li>
<li><a href="devonfw-ide.asciidoc.html">II. devonfw-ide</a>
</li>
<li><a href="java.asciidoc.html">III. Java</a>
</li>
<li><a href="master-devon4ng.asciidoc.html">IV. Angular</a>
</li>
<li><a href="master-devon4net.asciidoc.html">V. .net</a>
</li>
<li><a href="master-devon4node.asciidoc.html">VI. NodeJS</a>
</li>
<li><a href="master-database.asciidoc.html">VII. Choosing your Database</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc.html">VIII. devonfw shop floor</a>
<ul class="sectlevel1">
<li><a href="h0ec2830b289a5d728774589aca18d6e7.asciidoc.html">50. What is devonfw shop floor?</a>
</li>
<li><a href="dsf-how-to-use.asciidoc.html">51. How to use it</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_provisioning-environments.html">52. Provisioning environments</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_configuration-and-services-integration.html">53. Configuration and services integration</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_create-project.html">54. Create project</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_deployment-environments.html">55. Deployment environments</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_monitoring.html">56. Monitoring</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_annexes.html"><span class="toc-current">57. Annexes</span></a>
<ul class="sectlevel2">
<li><a href="master-devonfw-shop-floor.asciidoc_annexes.html#master-devonfw-shop-floor.asciidoc_bitbucket">57.1. BitBucket</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_annexes.html#master-devonfw-shop-floor.asciidoc_selenium-basic-grid">57.2. Selenium Basic Grid</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_annexes.html#master-devonfw-shop-floor.asciidoc_mirabaud-experience">57.3. Mirabaud Experience</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_annexes.html#master-devonfw-shop-floor.asciidoc_azure-devops">57.4. Azure DevOps</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_annexes.html#master-devonfw-shop-floor.asciidoc_okd-openshift-origin">57.5. OKD (OpenShift Origin)</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd.asciidoc">57.6. OKD &lt;em&gt;(OpenShift Origin)&lt;/em&gt;</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc_annexes.html#master-devonfw-shop-floor.asciidoc_istio-guide">57.7. ISTIO Guide</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="master-cicdgen.asciidoc.html">IX. cicdgen</a>
</li>
<li><a href="master-production-line.asciidoc.html">X. Production Line Templates</a>
</li>
<li><a href="master-cobigen.asciidoc.html">XI. CobiGen&#x2009;&#x2014;&#x2009;Code-based incremental Generator</a>
</li>
<li><a href="master-mrchecker.asciidoc.html">XII. MrChecker - devonfw testing tool</a>
</li>
<li><a href="master-my-thai-star.asciidoc.html">XIII. MyThaiStar</a>
</li>
<li><a href="master-dashboard.asciidoc.html">XIV. devonfw dashboard</a>
</li>
<li><a href="master-solicitor.asciidoc.html">XV. Solicitor User Guide</a>
</li>
<li><a href="master-contributing.asciidoc.html">XVI. Contributing</a>
</li>
<li><a href="master-release-notes.asciidoc.html">XVII. Release Notes</a>
</li>
</ul>
</div>
</div><div id="content">
<div class="sect1">
<h2 id="master-devonfw-shop-floor.asciidoc_annexes">57. Annexes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_bitbucket">57.1. BitBucket</h3>
<div class="paragraph">
<p><em>[Under construction]</em></p>
</div>
<hr>
<div class="paragraph">
<p>The purpose of the present document is to provide the basic steps carried out to setup a BitBucket server in OpenShift.</p>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>BitBucket is the Atlassian tool that extends the Git functionality, by adding integration with JIRA, Confluence, or Trello, as well as incorporates extra features for security or management of user accounts (See <a href="https://www.atlassian.com/software/bitbucket/features">BitBucket</a>).</p>
</div>
<div class="paragraph">
<p>BitBucket server is the Atlassian tool that runs the BitBucket services (See <a href="https://www.atlassian.com/software/bitbucket/server">BitBucket server</a>).</p>
</div>
<div class="paragraph">
<p>The followed approach has been not using command line, but OpenShift Web Console, by deploying the Docker image <strong>atlassian/bitbucket-server</strong> (available in <a href="https://hub.docker.com/r/atlassian/bitbucket-server/">Docker Hub</a>) in the existing project <strong>Deployment</strong>.</p>
</div>
<div class="paragraph">
<p>The procedure below exposed consists basically in three main steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the BitBucket server image (from OpenShift web console)</p>
</li>
<li>
<p>Add a route for the external traffic (from OpenShift web console)</p>
</li>
<li>
<p>Configure the BitBucket server (from BitBucket server web console)</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_prerequisites">Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>OpenShift up &amp; running</p>
</li>
<li>
<p>Atlassian account (with personal account key). Not required for OpenShift, but for the initial BitBucket server configuration.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_procedure">Procedure</h5>
<div class="paragraph">
<p><a id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-0-log-into-our-linkhttps10.68.26.1638443consolelogoutopenshift-web-console"></a>]
=== Step 0: Log into our <a href="https://10.68.26.163:8443/console/logout">OpenShift Web console</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step0.png" alt="step0">
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-1-get-into-development-project">Step 1: Get into Development project</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step1.png" alt="]">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.1-deploy-a-new-image-to-the-project">Step 2.1: Deploy a new image to the project</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step2.1.png" alt="step2.1">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.2-introduce-the-image-name-available-in-linkhttpshub.docker.comratlassianbitbucket-serverdocker-hub-and-search">Step 2.2: Introduce the image name (available in <a href="https://hub.docker.com/r/atlassian/bitbucket-server/">Docker Hub</a>) and search</h6>
<div class="paragraph">
<p>Image name: <strong>atlassian/bitbucket-server</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step2.2.png" alt="step2.2">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.3-leave-by-the-moment-the-default-config.-since-it-is-enough-for-the-basic-setup.-press-create">Step 2.3: Leave by the moment the default config. since it is enough for the basic setup. Press Create</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step2.3.png" alt="step2.3">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.4-copy-the-oc-commands-in-case-it-is-required-to-work-via-command-line">Step 2.4: Copy the oc commands in case it is required to work via command line, and Go to overview</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step2.4.png" alt="step2.4">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.5-wait-until-openshift-deploys-and-starts-up-the-image.-all-the-info-will-be-available.">Step 2.5: Wait until OpenShift deploys and starts up the image. All the info will be available.</h6>
<div class="paragraph">
<p>Please notice that there are no pre-configured routes, hence the application is not accessible from outside the cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step2.5.png" alt="step2.5">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-3-create-a-route-in-order-for-the-application-to-be-accessible-from-outside-the-cluster-external-traffic.-press-create">Step 3: Create a route in order for the application to be accessible from outside the cluster (external traffic). Press Create</h6>
<div class="paragraph">
<p>Please notice that there are different fields that can be specified (hostname, port). If required, the value of those fields can be modified later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step3a.png" alt="step3a">
</div>
</div>
<div class="paragraph">
<p>Leave by the moment the default config. as it is enough for the basic setup.</p>
</div>
<div class="paragraph">
<p>The route for external traffic is now available.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step3b.png" alt="step3b">
</div>
</div>
<hr>
<div class="paragraph">
<p>Now the BitBucker server container is up &amp; running in our cluster.</p>
</div>
<div class="paragraph">
<p>The below steps correspond to the basic configuration of our BitBucket server.</p>
</div>
<hr>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.1-click-on-the-link-of-the-external-traffic-route.-this-will-open-our-bitbucket-server-setup-wizard">Step 4.1: Click on the link of the external traffic route. This will open our BitBucket server setup wizard</h6>

</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.2-leave-by-the-moment-the-internal-database-since-it-is-enough-for-the-basic-setup-and-it-can-be-modified-later">Step 4.2: Leave by the moment the Internal database since it is enough for the basic setup (and it can be modified later), and click Next</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step4.2.png" alt="step4.2">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.3-select-the-evaluation-license">Step 4.3: Select the evaluation license, and click I have an account</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step4.3.png" alt="step4.3">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.4-select-the-option-bitbucker-server">Step 4.4: Select the option Bitbucker (Server)</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step4.4.png" alt="step4.4">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.5-introduce-your-organization-capgemini">Step 4.5: Introduce your organization (Capgemini), and click Generate License</h6>

</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.6-confirm-that-you-want-to-install-the-license-on-the-bitbucket-server">Step 4.6: Confirm that you want to install the license on the BitBucket server</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step4.6.png" alt="step4.6">
</div>
</div>
<div class="paragraph">
<p>The license key will be automatically generated. Click <strong>Next</strong></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.7-introduce-the-details-of-the-administration-account.">Step 4.7: Introduce the details of the Administration account.</h6>
<div class="paragraph">
<p>Since our BitBucket server is not going to be integrated with JIRA, click on Go to Bitbucket. The integration with JIRA can be configured later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/step4.7.png" alt="step4.7">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.8-log-in-with-the-admin-account-that-has-been-just-created">Step 4.8: Log in with the admin account that has been just created</h6>

</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_done-">DONE !!</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/done.png" alt="done">
</div>
</div>
<div class="paragraph">
<p><em>[Under construction]</em></p>
</div>
<hr>
<div class="paragraph">
<p>The purpose of the present document is to provide the basic steps carried out to improve the configuration of BitBucket server in OpenShift.</p>
</div>
<div class="paragraph">
<p>The improved configuration consists on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistent Volume Claims</p>
</li>
<li>
<p>Health Checks <em>(pending to be completed)</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_persistent-volume-claims.">Persistent Volume Claims.</h5>
<div class="paragraph">
<p>Please notice that the BitBucket server container does not use persistent volume claims by default, which means that the data (e.g.: BitBucket server config.) will be lost from one deployment to another.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/xtraconfig/pvc0.png" alt="pvc0">
</div>
</div>
<div class="paragraph">
<p><strong>It is very important to create a persistent volume claim in order to prevent the mentioned loss of data.</strong></p>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_step-1-add-storage">Step 1: Add storage</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/xtraconfig/pvc1.png" alt="pvc1">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_step-2-select-the-appropriate-storage">Step 2: Select the appropriate storage, or create it from scratch if necessary</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/xtraconfig/pvc2.png" alt="pvc2">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_step-3-introduce-the-required-information">Step 3: Introduce the required information</h6>
<div class="ulist">
<ul>
<li>
<p><strong>Path</strong> as it is specified in the <a href="https://hub.docker.com/r/atlassian/bitbucket-server/">BitBucket server Docker image</a> (/var/atlassian/application-data/bitbucket)</p>
</li>
<li>
<p><strong>Volume name</strong> with a unique name to clearly identify the volume</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/xtraconfig/pvc3.png" alt="pvc3">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_the-change-will-be-inmediately-applied">The change will be inmediately applied</h6>
<div class="imageblock">
<div class="content">
<img src="./images/others/bitbucket/xtraconfig/done.png" alt="done">
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_selenium-basic-grid">57.2. Selenium Basic Grid</h3>
<div class="sect3">
<h4 id="dsf-openshift-services-selenium-basic-grid.asciidoc">57.2.1. Basic Selenium Grid setup in OpenShift</h4>
<div class="paragraph">
<p><em>[Under construction]</em></p>
</div>
<hr>
<div class="paragraph">
<p>The purpose of the present document is to provide the basic steps carried out to setup a Selenium Grid (Hub + Nodes) in OpenShift.</p>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-selenium-basic-grid.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>Selenium is a tool to automate web browser across many platforms. It allows the automation of the testing in many different browsers, operating systems, programing laguages, or testing frameworks. (for further information pelase see <a href="http://www.seleniumhq.org/">Selenium</a>)</p>
</div>
<div class="paragraph">
<p>Selenium Grid is the platform provided by Selenium in order to perform the execution of tests in parallel and in a distributed way.</p>
</div>
<div class="paragraph">
<p>It basically consists on a Selenium Server (also known as hub or simply server) which redirects the requests it receives to the appropriate node (Firefox node, Chrome node, &#x2026;&#x200B;) depending on how the Selenium WebDriver is configured or implemented (See <a href="http://www.seleniumhq.org/docs/">Selenium Doc.</a>)</p>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_additional-documentacion">Additional documentacion:</h6>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.tutorialspoint.com/selenium/selenium_grids.htm" class="bare">https://www.tutorialspoint.com/selenium/selenium_grids.htm</a></p>
</li>
<li>
<p><a href="http://www.softwaretestinghelp.com/selenium-ide-download-and-installation-selenium-tutorial-2" class="bare">http://www.softwaretestinghelp.com/selenium-ide-download-and-installation-selenium-tutorial-2</a></p>
</li>
<li>
<p><a href="https://examples.javacodegeeks.com/enterprise-java/selenium/selenium-standalone-server-example" class="bare">https://examples.javacodegeeks.com/enterprise-java/selenium/selenium-standalone-server-example</a></p>
</li>
<li>
<p><a href="https://tripleqa.com/2016/09/26/hello-world-selenium" class="bare">https://tripleqa.com/2016/09/26/hello-world-selenium</a></p>
</li>
<li>
<p><a href="http://queirozf.com/entries/selenium-hello-world-style-tutorial" class="bare">http://queirozf.com/entries/selenium-hello-world-style-tutorial</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-selenium-basic-grid.asciidoc_prerequisites">Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>OpenShift up &amp; running</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-selenium-basic-grid.asciidoc_procedure">Procedure</h5>
<div class="paragraph">
<p>The present procedure is divided into two different main parts:
* First part: Selenium Hub (server) installation
* Second part: Selenium node installation (Firefox &amp; Chrome)
* Create persistent volumes for the hub and the node(s)</p>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_selenium-hub-installation">Selenium Hub installation</h6>
<div class="paragraph">
<p>The followed approach consists on deploying new image from the OpenShift WenConsole.</p>
</div>
<div class="paragraph">
<p>The image as well as its documentation and details can be found at <a href="https://hub.docker.com/r/selenium/hub/">Selenium Hub Docker Image</a></p>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-1-deploy-image">Step 1: Deploy Image</h7>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/hub/step1.png" alt="step1">
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-2-image-name">Step 2: Image Name</h7>
<div class="paragraph">
<p>As it is specified in the <a href="https://hub.docker.com/r/selenium/hub/">documentation</a> <em>(selenium/hub)</em></p>
</div>
<div class="paragraph">
<p><em>(Please notice that, as it is described in the additional documentation of the above links, the server will run by default on <strong>4444</strong> port)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/hub/step2.png" alt="step2">
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-3-introduce-the-appropriate-resource-name">Step 3: Introduce the appropriate resource name</h7>
<div class="paragraph">
<p><em>(selenium-hub in this case)</em></p>
</div>
<div class="paragraph">
<p><em>(No additional config. is required by the moment)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/hub/step3a.png" alt="step3a">
</div>
</div>
<div class="paragraph">
<p>Once the image is deployed, you will be able to check &amp; review the config. of the container. Please notice by, by default, <strong>no route is created for external traffic</strong>, hence the application (the selenium server or hub) is not reachable from outside the cluster</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/hub/step3b.png" alt="step3b">
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-4-create-a-route-for-external-traffic">Step 4: Create a route for external traffic</h7>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/hub/step4.png" alt="step4">
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-5-change-the-default-config.-if-necessary">Step 5: Change the default config. if necessary</h7>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/hub/step5.png" alt="step5">
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_done-">DONE !!</h7>
<div class="paragraph">
<p>The Selenium Server is now accesible from outside the cluster. Click on the link of the route and you will be able to see the server home page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/hub/done1.png" alt="done1">
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_consoleview-config-to-see-the-default-server-config.">console/view config to see the default server config.</h7>
<div class="paragraph">
<p>Please notice that the server is not detecting any node up &amp; running, since we have not yet installed none of them.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/hub/done2.png" alt="done2">
</div>
</div>
<hr>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_selenium-node-firefox-installation">Selenium Node Firefox installation</h6>
<div class="paragraph">
<p><em>(Same steps apply for Selenium Node Chrome with the selenium/node-chrome Docker image)</em></p>
</div>
<div class="paragraph">
<p>The key point of the nodes installation is to specify the host name and port of the hub. If this step is not correctly done, the container will be setup but the application will not run.</p>
</div>
<div class="paragraph">
<p>The followed approach consists on deploying new image from the OpenShift WenConsole.</p>
</div>
<div class="paragraph">
<p>The image as well as its documentation and details can be found at <a href="https://hub.docker.com/r/selenium/node-firefox/">Selenium Hub Docker Image</a> <em>(firefox node in this case)</em></p>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-1-deploy-image">Step 1: Deploy Image</h7>
<div class="paragraph">
<p>Introduce the appropriate Docker Image name as it is specified in the <a href="https://hub.docker.com/r/selenium/node-firefox/">documentation</a> <em>(selenium/node-firefox)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/node/step1.png" alt="step1">
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-2-introduce-the-appropriate-resource-name">Step 2: Introduce the appropriate resource name</h7>
<div class="paragraph">
<p><em>(selenium-node-firefox in this case)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/node/step2.png" alt="step2">
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-3-introduce">Step 3: Introduce, as environment variables, the host name and port of the selenium hub previously created</h7>
<div class="paragraph">
<p><strong>Env. var. for selenium hub host name</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: HUB_PORT_4444_TCP_ADDR</p>
</li>
<li>
<p>Value: The Selenium hub host name. It&#x2019;s recommended to use the service name of the internal OpenShift service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Env. var. for host selenium hub host port</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: HUB_PORT_4444_TCP_PORT</p>
</li>
<li>
<p>Value: 4444 <em>(by default)</em>, or the appropriate one if it was changed during the installation.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/node/step3.png" alt="step3">
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-openshift-services-selenium-basic-grid.asciidoc_done-">DONE !!</h7>
<div class="paragraph">
<p>If the creation of the container was correct, we will be able to see our new selenium-node-firefox application up &amp; running, as well as we will be able to see that the firefox node has correctly detected the selenium hub <em>(in the log of the POD)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/node/done1.png" alt="done1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/node/done2.png" alt="done2">
</div>
</div>
<div class="paragraph">
<p>If we go back to the configuration of the SeleniumHub through the WebConsole, we also will be able to see the our new firefox node</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/selenium/node/done3.png" alt="done3">
</div>
</div>
<hr>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_persistent-volumes">Persistent Volumes</h6>
<div class="paragraph">
<p>Last part of the installation of the Selenium Grid consists on creating persistent volumes for both, the hub container and the node container.</p>
</div>
<div class="paragraph">
<p>Persistent Volumes can be easely created folling the the <a href="#dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc">BitBucket Extra server configuration</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_mirabaud-experience">57.3. Mirabaud Experience</h3>
<div class="sect3">
<h4 id="dsf-mirabaud-cicd-environment-setup.asciidoc">57.3.1. Mirabaud CICD Environment Setup</h4>
<div class="paragraph">
<p>Initial requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OS</strong>: RHEL 6.5</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remote setup in CI machine (located in the Netherlands)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    - Jenkins
    - Nexus
    - GitLab
    - Mattermost
    - Atlassian Crucible
    - SonarQube</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_1.-install-docker-and-docker-compose-in-rhel-6.5">1. Install Docker and Docker Compose in RHEL 6.5</h5>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_docker">Docker</h6>
<div class="paragraph">
<p>Due to that OS version, the only way to have Docker running in the CI machine is by installing it from the <strong>EPEL</strong> repository (Extra Packages for Enterprise Linux).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Add EPEL</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># rpm -iUvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Install <code>docker.io</code> from that repository</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># yum -y install docker-io</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Start Docker daemon</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># service docker start</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Check the installation</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># docker -v
Docker version 1.7.1, build 786b29d/1.7.1</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_docker-compose">Docker Compose</h6>
<div class="paragraph">
<p>Download and install it via <strong>curl</strong>. It will use <a href="https://github.com/docker/compose/releases?after=1.7.0-rc2">this site</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># curl -L https://github.com/docker/compose/releases/download/1.5.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose

# chmod +x /usr/local/bin/docker-compose</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add it to your <code>sudo</code> path:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Find out where it is:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre># echo $PATH</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Copy the <code>docker-compose</code> file from <code>/usr/local/bin/</code> to your <code>sudo</code> PATH.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># docker-compose -v
docker-compose version 1.5.2, build 7240ff3</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_2.-directories-structure">2. Directories structure</h5>
<div class="paragraph">
<p>Several directories had been added to organize some files related to docker (like <code>docker-compose.yml</code>) and docker volumes for each service. Here&#x2019;s how it looks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">/home
    /[username]
        /jenkins
            /volumes
                /jenkins_home
        /sonarqube
            /volumes
                /conf
                /data
                /extensions
                /lib
                    /bundled-plugins
        /nexus
            /volumes
                /nexus-data
        /crucible
            /volumes
                /
        /gitlab
            docker-compose.yml
            /volumes
                /etc
                    /gitlab
                /var
                    /log
                    /opt
        /mattermost
            docker-compose.yml
            /volumes
                /db
                    /var
                        /lib
                            /postgresql
                                /data
                /app
                    /mattermost
                        /config
                        /data
                        /logs
                /web
                    /cert</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_3.-cicd-services-with-docker">3. CICD Services with Docker</h5>
<div class="paragraph">
<p>Some naming conventions had been followed as naming containers as <code>mirabaud_[service]</code>.</p>
</div>
<div class="paragraph">
<p>Several folders have been created to store each service&#x2019;s volumes, <code>docker-compose.yml</code>(s), extra configuration settings and so on:</p>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_jenkins">Jenkins</h6>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command">Command</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># docker run -d -p 8080:8080 -p 50000:50000 --name=mirabaud_jenkins \
    -v /home/[username]/jenkins/volumes/jenkins_home:/var/jenkins_home \
    jenkins</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_generate-keystore">Generate keystore</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>keytool -importkeystore -srckeystore server.p12 -srcstoretype pkcs12 -srcalias 1 -destkeystore newserver.jks -deststoretype jks -destalias server</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_start-jekins-with-ssl-todo-make-a-docker-compose.yml-for-this">Start jekins with SSL (TODO: make a docker-compose.yml for this):</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sudo docker run -d --name mirabaud_jenkins -v /jenkins:/var/jenkins_home -p 8080:8443 jenkins --httpPort=-1 --httpsPort=8443 --httpsKeyStore=/var/jenkins_home/certs/keystore.jks --httpsKeyStorePassword=Mirabaud2017</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>volumes/jenkins_home:/var/jenkins_home</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_sonarqube">SonarQube</h6>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command">Command</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># docker run -d -p 9000:9000 -p 9092:9092 --name=mirabaud_sonarqube \
    -v /home/[username]/sonarqube/volumes/conf:/opt/sonarqube/conf \
    -v /home/[username]/sonarqube/volumes/data:/opt/sonarqube/data \
    -v /home/[username]/sonarqube/volumes/extensions:/opt/sonarqube/extensions \
    -v /home/[username]/sonarqube/volumes/lib/bundled-plugins:/opt/sonarqube//lib/bundled-plugins \
    sonarqube</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>volumes/conf:/opt/sonarqube/conf
volumes/data:/opt/sonarqube/data
volumes/extensions:/opt/sonarqube/extensions
volumes/lib/bundled-plugins:/opt/sonarqube/lib/bundled-plugins</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_nexus">Nexus</h6>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command">Command</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># docker run -d -p 8081:8081 --name=mirabaud_nexus\
    -v /home/[username]/nexus/nexus-data:/sonatype-work
    sonatype/nexus</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>volumes/nexus-data/:/sonatype-work</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_atlassian-crucible">Atlassian Crucible</h6>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command">Command</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># docker run -d -p 8084:8080 --name=mirabaud_crucible \
    -v /home/[username]/crucible/volumes/data:/atlassian/data/crucible
    mswinarski/atlassian-crucible:latest</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>volumes/data:/atlassian/data/crucible</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_4.-cicd-services-with-docker-compose">4. CICD Services with Docker Compose</h5>
<div class="paragraph">
<p>Both Services had been deploying by using the <code># docker-compose up -d</code> command from their root directories (<code>/gitlab</code> and <code>/mattermost</code>). The syntax of the two <code>docker-compose.yml</code> files is the one corresponding with the 1st version (due to the <code>docker-compose v1.5</code>).</p>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_gitlab">GitLab</h6>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_docker-compose.yml"><code>docker-compose.yml</code></h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">mirabaud:
    image: &apos;gitlab/gitlab-ce:latest&apos;
    restart: always
    ports:
            - &apos;8888:80&apos;
    volumes:
            - &apos;/home/[username]/gitlab/volumes/etc/gilab:/etc/gitlab&apos;
            - &apos;/home/[username]/gitlab/volumes/var/log:/var/log/gitlab&apos;
            - &apos;/home/[username]/gitlab/volumes/var/opt:/var/opt/gitlab&apos;</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command-docker">Command (docker)</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker run -d -p 8888:80 --name=mirabaud_gitlab \
    -v /home/[username]/gitlab/volumes/etc/gitlab/:/etc/gitlab \
    -v /home/[username]/gitlab/volumes/var/log:/var/log/gitlab \
    -v /home/[username]/gitlab/volumes/var/opt:/var/opt/gitlab \
    gitlab/gitlab-ce</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>volumes/etc/gitlab:/etc/gitlab
volumes/var/opt:/var/log/gitlab
volumes/var/log:/var/log/gitlab</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_mattermost">Mattermost</h6>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_docker-compose.yml"><code>docker-compose.yml</code>:</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">db:
  image: mattermost/mattermost-prod-db
  restart: unless-stopped
  volumes:
    - ./volumes/db/var/lib/postgresql/data:/var/lib/postgresql/data
    - /etc/localtime:/etc/localtime:ro
  environment:
    - POSTGRES_USER=mmuser
    - POSTGRES_PASSWORD=mmuser_password
    - POSTGRES_DB=mattermost

app:
  image: mattermost/mattermost-prod-app
  links:
    - db:db
  restart: unless-stopped
  volumes:
    - ./volumes/app/mattermost/config:/mattermost/config:rw
    - ./volumes/app/mattermost/data:/mattermost/data:rw
    - ./volumes/app/mattermost/logs:/mattermost/logs:rw
    - /etc/localtime:/etc/localtime:ro
  environment:
    - MM_USERNAME=mmuser
    - MM_PASSWORD=mmuser_password
    - MM_DBNAME=mattermost

web:
  image: mattermost/mattermost-prod-web
  ports:
    - &quot;8088:80&quot;
    - &quot;8089:443&quot;
  links:
    - app:app
  restart: unless-stopped
  volumes:
    - ./volumes/web/cert:/cert:ro
    - /etc/localtime:/etc/localtime:ro</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_ssl-certificate">SSL Certificate</h7>
<div class="paragraph">
<p>How to generate the certificates:</p>
</div>
<div class="paragraph">
<p>Get the <strong>crt</strong> and <strong>key</strong> from CA or <strong>generate a new one self-signed</strong>. Then:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// 1. create the p12 keystore
# openssl pkcs12 -export -in cert.crt -inkey mycert.key -out certkeystore.p12

// 2. export the pem certificate with password
# openssl pkcs12 -in certkeystore.p12 -out cert.pem

// 3. export the pem certificate without password
# openssl rsa -in cert.pem -out key-no-password.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>SSL:</p>
</div>
<div class="paragraph">
<p>Copy the cert and the key without password at:</p>
</div>
<div class="paragraph">
<p><code>./volumes/web/cert/cert.pem</code></p>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="paragraph">
<p><code>./volumes/web/cert/key-no-password.pem</code></p>
</div>
<div class="paragraph">
<p>Restart the server and the SSL should be enabled at port <strong>8089</strong> using <strong>HTTPS</strong>.</p>
</div>
</div>
<div class="sect6">
<h7 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>-- db --
volumes/db/var/lib/postgresql/data:/var/lib/postgresql/data
/etc/localtime:/etc/localtime:ro                                # absolute path

-- app --
volumes/app/mattermost/config:/mattermost/config:rw
volumes/app/mattermost/data:/mattermost/data:rw
volumes/app/mattermost/logs:/mattermost/logs:rw
/etc/localtime:/etc/localtime:ro                                # absolute path

-- web --
volumes/web/cert:/cert:ro
/etc/localtime:/etc/localtime:ro                                # absolute path</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_5.-service-integration">5. Service Integration</h5>
<div class="paragraph">
<p>All integrations had been done following <strong>CICD Services Integration</strong> guides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-mirabaud-jenkins-nexus-integration.asciidoc">Jenkins - Nexus integration</a></p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-mirabaud-jenkins-gitLab-integration.asciidoc">Jenkins - GitLab integration</a></p>
</li>
<li>
<p><a href="#dsf-mirabaud-jenkins-sonarQube-integration.asciidoc">Jenkins - SonarQube integration</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
These guides may be obsolete. You can find here the <a href="dsf-how-to-use.html#Step-1---Configuration-and-service-integration">official configuration guides</a>,
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-jenkins-gitLab-integration.asciidoc">57.3.2. Jenkins - GitLab integration</h4>
<div class="paragraph">
<p>The first step to have a Continuous Integration system for your development is to make sure that all your changes to your team&#x2019;s remote repository are evaluated by the time they are pushed. That usually implies the usage of so-called <em>webhooks</em>. You&#x2019;ll find a fancy explanation about what Webhooks are in <a href="http://culttt.com/2014/01/22/webhooks/">here</a>.</p>
</div>
<div class="paragraph">
<p>To resume what we&#x2019;re doing here, we are going to prepare our Jenkins and our GitLab so when a developer pushes some changes to the GitLab repository, a pipeline in Jenkins gets triggered. Just like that, in an automatic way.</p>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_1.-jenkins-gitlab-plugin">1. Jenkins GitLab plugin</h5>
<div class="paragraph">
<p>As it usually happens, some Jenkins plug-in(s) must be installed. In this case, let&#x2019;s install those related with GitLab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/jenkins-gitlab-plugins.png" alt="jenkins gitlab plugins">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_2.-gitlab-api-token">2. GitLab API Token</h5>
<div class="paragraph">
<p>To communicate with GitLab from Jenkins, we will need to create an authentication token from your GitLab user settings. A good practice for this would be to create it from a <em>machine user</em>. Something like (i.e.) <code>devonfw-ci/******</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/gitlab-access-token.png" alt="gitlab access token">
</div>
</div>
<div class="paragraph">
<p>Simply by adding a name to it and a date for it expire is enough:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/gitlab-access-token-generation.png" alt="gitlab access token generation">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/gitlab-access-token-generated.png" alt="gitlab access token generated">
</div>
</div>
<div class="paragraph">
<p>As GitLab said, you should make sure you don&#x2019;t lose your token. Otherwise you would need to create a new one.</p>
</div>
<div class="paragraph">
<p>This will allow Jenkins to connect with right permissions to our GitLab server.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_3.-create-gitlab-api-token-credentials">3. Create &quot;GitLab API&quot; Token credentials</h5>
<div class="paragraph">
<p>Those credentials will use that token already generated in GitLab to connect once we declare the GitLab server in the Global Jenkins configuration. Obviously, those credentials must be <strong>GitLab API token</strong>-like.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/jenkins-gitlab-api-token-credentials-kind.png" alt="jenkins gitlab api token credentials kind">
</div>
</div>
<div class="paragraph">
<p>Then, we add the generated token in the <code>API token</code> field:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/jenkins-gitlab-api-token-credentials-complete.png" alt="jenkins gitlab api token credentials complete">
</div>
</div>
<div class="paragraph">
<p>Look in your Global credentials if they had been correctly created:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/jenkins-gitlab-api-token-credentials.png" alt="jenkins gitlab api token credentials">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_4.-create-gitlab-connection-in-jenkins">4. Create GitLab connection in Jenkins</h5>
<div class="paragraph">
<p>Specify a GitLab connection in your Jenkins&#x2019;s <code>Manage Jenkins &gt; Configure System</code> configuration. This will tell Jenkins where is our GitLab server, a user to access it from and so on.</p>
</div>
<div class="paragraph">
<p>You&#x2019;ll need to give it a name, for example, related with what this GitLab is dedicated for (specific clients, internal projects&#x2026;&#x200B;). Then, the <code>Gitlab host URL</code> is just where your GitLab server is. If you have it locally, that field should look similar to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connection name: <code>my-local-gitlab</code></p>
</li>
<li>
<p>Gitlab host URL: <code>http://localhost:${PORT_NUMBER}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, we select our recently GitLab API token as credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/jenkins-gitlab-connection.png" alt="jenkins gitlab connection">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_5.-jenkins-pipeline-changes">5. Jenkins Pipeline changes</h5>
<div class="sect5">
<h6 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_5.1-choose-gitlab-connection-in-pipelines-general-configuration">5.1 Choose GitLab connection in Pipeline&#x2019;s General configuration</h6>
<div class="paragraph">
<p>First, our pipeline should allow us to add a GitLab connection to connect to (the already created one).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/jenkins-pipeline-gitlab-connection.png" alt="jenkins pipeline gitlab connection">
</div>
</div>
<div class="paragraph">
<p>In the case of the local example, could be like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GitLab connection: <code>my-local-gitlab</code></p>
</li>
<li>
<p>GitLab Repository Name: <code>myusername/webhook-test</code> (for example)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_5.2-create-a-build-trigger">5.2 Create a Build Trigger</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You should already see your GitLab project&#x2019;s URL (as you stated in the General settings of the Pipeline).</p>
</li>
<li>
<p>Write <code>.*build.*</code> in the comment for triggering a build</p>
</li>
<li>
<p>Specify or filter the branch of your repo you want use as target. That means, whenever a git action is done to that branch (for example, <code>master</code>), this Pipeline is going to be built.</p>
</li>
<li>
<p>Generate a Secret token (to be added in the yet-to-be-created GitLab webhook).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/jenkins-pipeline-build-trigger.png" alt="jenkins pipeline build trigger">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_6.-gitlab-webhook">6. GitLab Webhook</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to you GitLab project&#x2019;s <code>Settings &gt; Integration</code> section.</p>
</li>
<li>
<p>Add the path to your Jenkins Pipeline. Make sure you add <strong>project</strong> instead of <strong>job</strong> in the path.</p>
</li>
<li>
<p>Paste the generated Secret token of your Jenkins pipeline</p>
</li>
<li>
<p>Select your git action that will trigger the build.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/gitlab-webhook.png" alt="gitlab webhook">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_7.-results">7. Results</h5>
<div class="paragraph">
<p>After all those steps you should have a result similar to this in your Pipeline:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-gitlab/jenkins-pipeline-result.png" alt="jenkins pipeline result">
</div>
</div>
<div class="paragraph">
<p>Enjoy the Continuous Integration! :)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-jenkins-nexus-integration.asciidoc">57.3.3. Jenkins - Nexus integration</h4>
<div class="paragraph">
<p>Nexus is used to both host dependencies for devonfw projects to download (common Maven ones, custom ones such as <code>ojdb</code> and even devonfw so-far-IP modules). Moreover, it will host our projects&apos; build artifacts (<code>.jar</code>, <code>.war</code>, &#x2026;&#x200B;) and expose them for us to download, wget and so on. A team should have a bidirectional relation with its Nexus repository.</p>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-nexus-integration.asciidoc_1.-jenkins-credentials-to-access-nexus">1. Jenkins credentials to access Nexus</h5>
<div class="paragraph">
<p>By default, when Nexus is installed, it contains 3 user credentials for different purposes. The admin ones look like this: <code>admin/admin123</code>. There are also other 2: <code>deployment/deployment123</code> and <code>TODO</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// ADD USER TABLE IMAGE FROM NEXUS</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, let&#x2019;s use the ones with the greater permissions: <code>admin/admin123</code>.</p>
</div>
<div class="paragraph">
<p>Go to <code>Credentials &gt; System</code> (left sidebar of Jenkins) then to <code>Global credentials (unrestricted)</code> on the page table and on the left sidebar again click on <code>Add Credentials</code>.</p>
</div>
<div class="paragraph">
<p>This should be shown in your Jenkins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-nexus/jenkins-new-nexus-credentials.png" alt="jenkins new nexus credentials">
</div>
</div>
<div class="paragraph">
<p>Fill the form like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-nexus/jenkins-new-nexus-credentials-filled.png" alt="jenkins new nexus credentials filled">
</div>
</div>
<div class="paragraph">
<p>And click in OK to create them. Check if the whole thing went as expected:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-nexus/jenkins-new-nexus-credentials-completed.png" alt="jenkins new nexus credentials completed">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-nexus-integration.asciidoc_2.-jenkins-maven-settings">2. Jenkins Maven Settings</h5>
<div class="paragraph">
<p>Those settings are also configured (or maybe not-yet-configured) in our <strong>devonfw distributions</strong> in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>/${devonfw-dist-path}
    /software
        /maven
            /conf
                settings.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go to <code>Manage Jenkins &gt; Managed files</code> and select <code>Add a new Config</code> in the left sidebar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-nexus/jenkins-new-maven-settings.png" alt="jenkins new maven settings">
</div>
</div>
<div class="paragraph">
<p>The ID field will get automatically filled with a unique value if you don&#x2019;t set it up. No problems about that. Click on <code>Submit</code> and let&#x2019;s create some Servers Credentials:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-nexus/jenkins-new-maven-settings-servers.png" alt="jenkins new maven settings servers">
</div>
</div>
<div class="paragraph">
<p>Those <strong>Server Credentials</strong> will allow Jenkins to access to the different repositories/servers that are going to be declared afterwards.</p>
</div>
<div class="paragraph">
<p>Let&#x2019;s create 4 server credentials.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>my.nexus</code>: Will serve as general profile for <strong>Maven</strong>.</p>
</li>
<li>
<p><code>mynexus.releases</code>: When a <code>mvn deploy</code> process is executed, this will tell <strong>Maven</strong> where to push <strong>releases</strong> to.</p>
</li>
<li>
<p><code>mynexus.snapshots</code>: The same as before, but with <strong>snapshots</strong> instead.</p>
</li>
<li>
<p><code>mynexus.central</code>: Just in case we want to install an specific dependency that is not by default in the Maven Central repository (such as <code>ojdbc</code>), Maven will point to it instead.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-nexus/jenkins-new-maven-settings-servers-credentials.png" alt="jenkins new maven settings servers credentials">
</div>
</div>
<div class="paragraph">
<p>A more or less complete Jenkins Maven settings would look look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;
          xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
          xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt;

    &lt;mirrors&gt;
        &lt;mirror&gt;
            &lt;id&gt;mynexus.central&lt;/id&gt;
            &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
            &lt;name&gt;central&lt;/name&gt;
            &lt;url&gt;http://${URL-TO-YOUR-NEXUS-REPOS}/central&lt;/url&gt;
        &lt;/mirror&gt;
    &lt;/mirrors&gt;

    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;my.nexus&lt;/id&gt;
            &lt;!-- 3 REPOS ARE DECLARED --&gt;
            &lt;repositories&gt;
                &lt;repository&gt;
                    &lt;id&gt;mynexus.releases&lt;/id&gt;
                    &lt;name&gt;mynexus Releases&lt;/name&gt;
                    &lt;url&gt;http://${URL-TO-YOUR-NEXUS-REPOS}/releases&lt;/url&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;false&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/snapshots&gt;
                &lt;/repository&gt;
                &lt;repository&gt;
                    &lt;id&gt;mynexus.snapshots&lt;/id&gt;
                    &lt;name&gt;mynexus Snapshots&lt;/name&gt;
                    &lt;url&gt;http://${URL-TO-YOUR-NEXUS-REPOS}/snapshots&lt;/url&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;false&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/snapshots&gt;
                &lt;/repository&gt;
            &lt;/repositories&gt;
            &lt;pluginRepositories&gt;
                &lt;pluginRepository&gt;
                    &lt;id&gt;public&lt;/id&gt;
                    &lt;name&gt;Public Repositories&lt;/name&gt;
                    &lt;url&gt;http://${URL-TO-YOUR-NEXUS}/nexus/content/groups/public/&lt;/url&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/snapshots&gt;
                &lt;/pluginRepository&gt;
            &lt;/pluginRepositories&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
    &lt;!-- HERE IS WHERE WE TELL MAVEN TO CHOOSE THE my.nexus PROFILE --&gt;
    &lt;activeProfiles&gt;
        &lt;activeProfile&gt;my.nexus&lt;/activeProfile&gt;
    &lt;/activeProfiles&gt;
&lt;/settings&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-nexus-integration.asciidoc_3.-use-it-in-jenkins-pipelines">3. Use it in Jenkins Pipelines</h5>

</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc">57.3.4. Jenkins - SonarQube integration</h4>
<div class="paragraph">
<p>First thing is installing both tools by, for example, Docker or Docker Compose. Then, we have to think about how they should collaborate to create a more efficient Continuous Integration process.</p>
</div>
<div class="paragraph">
<p>Once our project&#x2019;s pipeline is triggered (it could also be triggered in a fancy way, such as when a merge to the <code>develop</code> branch is done).</p>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_1.-jenkins-sonarqube-plugin">1. Jenkins SonarQube plugin</h5>
<div class="paragraph">
<p>Typically in those integration cases, Jenkins plug-in installations become a <strong>must</strong>. Let&#x2019;s look for some available SonarQube plug-in(s) for Jenkins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-sonarqube/jenkins-sonarqube-plugin.png" alt="jenkins sonarqube plugin">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_2.-sonarqube-token">2. SonarQube token</h5>
<div class="paragraph">
<p>Once installed let&#x2019;s create a <strong>token</strong> in SonarQube so that Jenkins can communicate with it to trigger their Jobs. Once we install SonarQube in our CI/CD machine (ideally a remote machine) let&#x2019;s login with <code>admin/admin</code> credentials:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-sonarqube/sonarqube-login.png" alt="sonarqube login">
</div>
</div>
<div class="paragraph">
<p>Afterwards, SonarQube itself asks you to create this token we talked about (the name is up to you):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-sonarqube/sonarqube-token-name.png" alt="sonarqube token name">
</div>
</div>
<div class="paragraph">
<p>Then a token is generated:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-sonarqube/sonarqube-token-generation.png" alt="sonarqube token generation">
</div>
</div>
<div class="paragraph">
<p>You click in &quot;continue&quot; and the token&#x2019;s generation is completed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-sonarqube/sonarqube-token-done.png" alt="sonarqube token done">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_3.-jenkins-sonarqube-server-setup">3. Jenkins SonarQube Server setup</h5>
<div class="paragraph">
<p>Now we need to tell Jenkins where is SonarQube and how to communicate with it. In <code>Manage Jenkins &gt; Configure Settings</code>. We add a name for the server (up to you), where it is located (URL), version and the Server authentication token created in point 2.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-sonarqube/jenkins-sonarqube-server-setup.png" alt="jenkins sonarqube server setup">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_4.-jenkins-sonarqube-scanner">4. Jenkins SonarQube Scanner</h5>
<div class="paragraph">
<p>Install a SonarQube Scanner as a Global tool in Jenkins to be used in the project&#x2019;s pipeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-sonarqube/jenkins-sonarqube-scanner.png" alt="jenkins sonarqube scanner">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_5.-pipeline-code">5. Pipeline code</h5>
<div class="paragraph">
<p>Last step is to add the SonarQube process in our project&#x2019;s Jenkins pipeline. The following code will trigger a SonarQube process that will evaluate our code&#x2019;s quality looking for bugs, duplications, and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    stage &apos;SonarQube Analysis&apos;
        def scannerHome = tool &apos;SonarQube scanner&apos;;
        sh &quot;${scannerHome}/bin/sonar-scanner \
             -Dsonar.host.url=http://url-to-your-sq-server:9000/ \
             -Dsonar.login=[SONAR_USER] -Dsonar.password=[SONAR_PASS] \
             -Dsonar.projectKey=[PROJECT_KEY] \
             -Dsonar.projectName=[PROJECT_NAME] -Dsonar.projectVersion=[PROJECT_VERSION] \
             -Dsonar.sources=. -Dsonar.java.binaries=. \
             -Dsonar.java.source=1.8 -Dsonar.language=java&quot;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_6.-results">6. Results</h5>
<div class="paragraph">
<p>After all this, you should end up having something like this in Jenkins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-sonarqube/jenkins-sonarqube-feedback.png" alt="jenkins sonarqube feedback">
</div>
</div>
<div class="paragraph">
<p>And in SonarQube:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/jenkins-sonarqube/sonarqube-project-result.png" alt="sonarqube project result">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_7.-changes-in-a-devonfw-project-to-execute-sonarqube-tests-with-coverage">7. Changes in a devonfw project to execute SonarQube tests with Coverage</h5>
<div class="paragraph">
<p>The plugin used to have Coverage reports in the SonarQube for devonfw projects is <strong>Jacoco</strong>. There are some changes in the project&#x2019;s parent <code>pom.xml</code> that are mandatory to use it.</p>
</div>
<div class="paragraph">
<p>Inside of the <code>&lt;properties&gt;</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;properties&gt;

    (...)

    &lt;sonar.jacoco.version&gt;3.8&lt;/sonar.jacoco.version&gt;
    &lt;sonar.java.coveragePlugin&gt;jacoco&lt;/sonar.java.coveragePlugin&gt;
    &lt;sonar.core.codeCoveragePlugin&gt;jacoco&lt;/sonar.core.codeCoveragePlugin&gt;
    &lt;sonar.dynamicAnalysis&gt;reuseReports&lt;/sonar.dynamicAnalysis&gt;
    &lt;sonar.language&gt;java&lt;/sonar.language&gt;
    &lt;sonar.java.source&gt;1.7&lt;/sonar.java.source&gt;
    &lt;sonar.junit.reportPaths&gt;target/surefire-reports&lt;/sonar.junit.reportPaths&gt;
    &lt;sonar.jacoco.reportPaths&gt;target/jacoco.exec&lt;/sonar.jacoco.reportPaths&gt;
    &lt;sonar.sourceEncoding&gt;UTF-8&lt;/sonar.sourceEncoding&gt;
    &lt;sonar.exclusions&gt;
        **/generated-sources/**/*,
        **io/oasp/mirabaud/general/**/*,
        **/*Dao.java,
        **/*Entity.java,
        **/*Cto.java,
        **/*Eto.java,
        **/*SearchCriteriaTo.java,
        **/*management.java,
        **/*SpringBootApp.java,
        **/*SpringBootBatchApp.java,
        **/*.xml,
        **/*.jsp
    &lt;/sonar.exclusions&gt;
    &lt;sonar.coverage.exclusions&gt;
        **io/oasp/mirabaud/general/**/*,
        **/*Dao.java,
        **/*Entity.java,
        **/*Cto.java,
        **/*Eto.java,
        **/*SearchCriteriaTo.java,
        **/*management.java,
        **/*SpringBootApp.java,
        **/*SpringBootBatchApp.java,
        **/*.xml,
        **/*.jsp
    &lt;/sonar.coverage.exclusions&gt;
    &lt;sonar.host.url&gt;http://${YOUR_SONAR_SERVER_URL}/&lt;/sonar.host.url&gt;
    &lt;jacoco.version&gt;0.7.9&lt;/jacoco.version&gt;

    &lt;war.plugin.version&gt;3.2.0&lt;/war.plugin.version&gt;
    &lt;assembly.plugin.version&gt;3.1.0&lt;/assembly.plugin.version&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, those <code>sonar</code> amd <code>sonar.coverage</code> can/must be changed to fit with other projects.</p>
</div>
<div class="paragraph">
<p>Now add the <strong>Jacoco Listener</strong> as a dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.sonarsource.java&lt;/groupId&gt;
        &lt;artifactId&gt;sonar-jacoco-listeners&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Plugin Management declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;pluginManagement&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.sonarsource.scanner.maven&lt;/groupId&gt;
            &lt;artifactId&gt;sonar-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.2&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
            &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;${jacoco.version}&lt;/version&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;pluginManagement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Plugins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugins&gt;

    (...)

    &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.20.1&lt;/version&gt;
        &lt;configuration&gt;
            &lt;argLine&gt;-XX:-UseSplitVerifier -Xmx2048m ${surefireArgLine}&lt;/argLine&gt;
            &lt;testFailureIgnore&gt;false&lt;/testFailureIgnore&gt;
            &lt;useFile&gt;false&lt;/useFile&gt;
            &lt;reportsDirectory&gt;${project.basedir}/${sonar.junit.reportPaths}&lt;/reportsDirectory&gt;
            &lt;argLine&gt;${jacoco.agent.argLine}&lt;/argLine&gt;
            &lt;excludedGroups&gt;${oasp.test.excluded.groups}&lt;/excludedGroups&gt;
            &lt;alwaysGenerateSurefireReport&gt;true&lt;/alwaysGenerateSurefireReport&gt;
            &lt;aggregate&gt;true&lt;/aggregate&gt;
            &lt;properties&gt;
                &lt;property&gt;
                    &lt;name&gt;listener&lt;/name&gt;
                    &lt;value&gt;org.sonar.java.jacoco.JUnitListener&lt;/value&gt;
                &lt;/property&gt;
            &lt;/properties&gt;
        &lt;/configuration&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
        &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
        &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
            &lt;argLine&gt;-Xmx128m&lt;/argLine&gt;
            &lt;append&gt;true&lt;/append&gt;
            &lt;propertyName&gt;jacoco.agent.argLine&lt;/propertyName&gt;
            &lt;destFile&gt;${sonar.jacoco.reportPath}&lt;/destFile&gt;
            &lt;excludes&gt;
                &lt;exclude&gt;**/generated-sources/**/*,&lt;/exclude&gt;
                &lt;exclude&gt;**io/oasp/${PROJECT_NAME}/general/**/*&lt;/exclude&gt;
                &lt;exclude&gt;**/*Dao.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*Entity.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*Cto.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*Eto.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*SearchCriteriaTo.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*management.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*SpringBootApp.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*SpringBootBatchApp.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*.class&lt;/exclude&gt;
            &lt;/excludes&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
            &lt;execution&gt;
                &lt;id&gt;prepare-agent&lt;/id&gt;
                &lt;phase&gt;initialize&lt;/phase&gt;
                &lt;goals&gt;
                    &lt;goal&gt;prepare-agent&lt;/goal&gt;
                &lt;/goals&gt;
                &lt;configuration&gt;
                    &lt;destFile&gt;${sonar.jacoco.reportPath}&lt;/destFile&gt;
                    &lt;append&gt;true&lt;/append&gt;
                &lt;/configuration&gt;
            &lt;/execution&gt;
            &lt;execution&gt;
                &lt;id&gt;report-aggregate&lt;/id&gt;
                &lt;phase&gt;verify&lt;/phase&gt;
                &lt;goals&gt;
                    &lt;goal&gt;report-aggregate&lt;/goal&gt;
                &lt;/goals&gt;
            &lt;/execution&gt;
            &lt;execution&gt;
                &lt;id&gt;jacoco-site&lt;/id&gt;
                &lt;phase&gt;verify&lt;/phase&gt;
                &lt;goals&gt;
                    &lt;goal&gt;report&lt;/goal&gt;
                &lt;/goals&gt;
            &lt;/execution&gt;
        &lt;/executions&gt;
    &lt;/plugin&gt;
&lt;/plugins&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_jenkins-sonarqube-execution">Jenkins SonarQube execution</h5>
<div class="paragraph">
<p>If the previous configuration is already setup, once Jenkins execute the sonar maven plugin, it will automatically execute coverage as well.</p>
</div>
<div class="paragraph">
<p>This is an example of a block of code from a devonfw project&#x2019;s <code>Jenkinsfile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    withMaven(globalMavenSettingsConfig: &apos;YOUR_GLOBAL_MAVEN_SETTINGS&apos;, jdk: &apos;OpenJDK 1.8&apos;, maven: &apos;Maven_3.3.9&apos;) {
        sh &quot;mvn sonar:sonar -Dsonar.login=[USERNAME] -Dsonar.password=[PASSWORD]&quot;
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_azure-devops">57.4. Azure DevOps</h3>
<div class="sect3">
<h4 id="dsf-azure-install-sonar-with-docker-in-a-virtual-machine.asciidoc_connect-to-a-virtual-machinevm-in-azure">57.4.1. Connect to a Virtual Machine(VM) in Azure</h4>
<div class="sect5">
<h6 id="dsf-azure-install-sonar-with-docker-in-a-virtual-machine.asciidoc_pre-requisites">Pre-requisites</h6>
<div class="paragraph">
<p>Have a VM created and a private key in order to connect to it</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-azure-install-sonar-with-docker-in-a-virtual-machine.asciidoc_establish-a-connection">Establish a connection</h6>
<div class="paragraph">
<p>1- Open the client of your choice(putty,cmder,bash)</p>
</div>
<div class="paragraph">
<p>2- Ensure you have read-only access to the private key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>chmod 400 azureuser.pem</pre>
</div>
</div>
<div class="paragraph">
<p>3- Run this command to connect to your VM</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh -i &lt;private key path&gt; azureuser@51.103.78.61</pre>
</div>
</div>
<div class="paragraph">
<p><em>note: To get the IP go to your azure portal, click on your VM, click on <strong>Networking</strong> and you will find the IP needed to establish the connection</em></p>
</div>
<div class="paragraph">
<p>You are connected:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/vm-connection.png" alt="vm connection">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-azure-install-sonar-with-docker-in-a-virtual-machine.asciidoc_install-sonar-using-docker-and-docker-compose">57.4.2. Install Sonar using Docker and Docker-compose</h4>
<div class="paragraph">
<p>As an example we will use the practical case of Bad Weather, a project where we were asked to install Sonar inside a VM in Azure portal</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/install-sonar.png" alt="install sonar">
</div>
</div>
<div class="paragraph">
<p>We had 2 possible scenarios, we went for the <strong>case A</strong> since no other service will be installed in this VM</p>
</div>
<div class="sect5">
<h6 id="dsf-azure-install-sonar-with-docker-in-a-virtual-machine.asciidoc_steps">Steps</h6>
<div class="paragraph">
<p>1- Install docker and docker compose in the VM</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo
sudo dnf list docker-ce
sudo dnf install docker-ce --nobest -y
sudo systemctl start docker
sudo systemctl enable docker
docker --version
sudo dnf install curl -y
sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.25.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
docker-compose --version</pre>
</div>
</div>
<div class="paragraph">
<p>2- Deploy SonarQube and Postgress</p>
</div>
<div class="paragraph">
<p>2.1- Set necesary parameters for sonarqube</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo sysctl -w vm.max_map_count=262144
sudo sysctl -w fs.file-max=65536
sudo ulimit -n 65536
sudo ulimit -u 4096</pre>
</div>
</div>
<div class="paragraph">
<p>2.2- Use docker-compose with the next definition to deploy it:</p>
</div>
<div class="paragraph">
<p>vim /home/sonar/docker-compose.yaml</p>
</div>
<div class="listingblock">
<div class="content">
<pre>version: &quot;3&quot;

services:
  sonarqube:
    image: &quot;sonarqube:7.9-community&quot;
    networks:
      - sonar
    environment:
      - sonar.jdbc.username=user
      - sonar.jdbc.password=pass
      - sonar.jdbc.url=jdbc:postgresql://sonarqube-db:5432/sonar
    ports:
      - &quot;80:9000&quot;
	depends_on:
      - &quot;sonarqube-db&quot;
    volumes:
      - &quot;$PWD/volumes/sonarqube/conf:/opt/sonarqube/conf&quot;
      - &quot;$PWD/volumes/sonarqube/data:/opt/sonarqube/data&quot;
      - &quot;$PWD/volumes/sonarqube/extensions:/opt/sonarqube/extensions&quot;
      - &quot;$PWD/volumes/sonarqube/logs:/opt/sonarqube/logs&quot;
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
  sonarqube-db:
    image: &quot;postgres:12-alpine&quot;
    networks:
      - sonar
    volumes:
      - &quot;$PWD/volumes/sonarqube-db/data:/var/lib/postgresql/data&quot;
    environment:
      - POSTGRES_USER=youruser
      - POSTGRES_PASSWORD=yourpass
      - POSTGRES_DB=sonar
      - PGDATA=/var/lib/postgresql/data

networks:
  sonar:
    driver: bridge</pre>
</div>
</div>
<div class="paragraph">
<p>3- Update the start configuration to set automatically the correct values and run the docker-compose</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vim /usr/local/sbin/start.sh

sysctl -w vm.max_map_count=262144
sysctl -w fs.file-max=65536
ulimit -n 65536
ulimit -u 4096

cd /home/sonar &amp;&amp; docker-compose up -d</pre>
</div>
</div>
<div class="paragraph">
<p>4- Add this to execute the docker-compose file every time the machine turns on</p>
</div>
<div class="listingblock">
<div class="content">
<pre>crontab -e
@reboot /usr/local/sbin/start.sh

vim /etc/sysctl.conf
vm.max_map_count=262144
fs.file-max=65536</pre>
</div>
</div>
<div class="paragraph">
<p>Your Sonar is Up and running in your VM</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-azure-pipeline-from-scratch">57.4.3. Create an Azure pipeline from scratch</h4>
<div class="paragraph">
<p>The following steps will allow you to create a basic pipeline in Azure Devops from scratch</p>
</div>
<div class="paragraph">
<p>In order to deploy in Azure, we&#x2019;ve created an automatic pipeline in Azure Devops that will be executed automaticaly when  developers make a push to the Azure repositories, the pipeline will compile the code, build the application and ensure with automatic tests that the build is not going to break the application, to ensure a good quality code the code will be analyzed by sonar as well as your code coverage and last but not least, your application will be deployed using Azure App Services.</p>
</div>
</div>
<div class="sect3">
<h4 id="dsf-azure-pipelines.asciidoc_steps">57.4.4. Steps</h4>
<div class="paragraph">
<p>1- Sign in to your Azure DevOps organization and navigate to your project.</p>
</div>
<div class="paragraph">
<p>2- Go to Pipelines, and then select New Pipeline.</p>
</div>
<div class="paragraph">
<p>3- Choose the location of your source code(Github, Bitbucket,Azure repos..etc), in this case we have our code in Azure Repos Git.</p>
</div>
<div class="paragraph">
<p>A list of your repositories will be shown here:</p>
</div>
<div class="paragraph">
<p>4- When the list of repositories appears, select your repository.</p>
</div>
<div class="paragraph">
<p>Depending on your project type(Java, .NET, Python or JavaScript) the following configuration will change, in this case our project is a .NET, for more type of projects please follow the <a href="https://docs.microsoft.com/es-es/azure/devops/pipelines/create-first-pipeline?view=azure-devops&amp;tabs=net%2Ctfs-2018-2%2Cbrowser">official documentation</a>.</p>
</div>
<div class="paragraph">
<p>5- When the Configure tab appears, select ASP.NET Core(or the one according to your project)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-pipelines/configuration.png" alt="configuration">
</div>
</div>
<div class="paragraph">
<p>6- A .yaml file in your ./ location will be generated with all the required steps to run your pipeline.
The name of this .yaml file is &apos;azure-pipelines.yaml&apos; wich is the default name that will be used in your pipeline settings.</p>
</div>
<div class="paragraph">
<p><em>Note:If you change the name or the location, you will need to specify in the pipeline settings the new name or location:</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-pipelines/pipeline-settings.png" alt="pipeline settings">
</div>
</div>
<div class="paragraph">
<p>The pipeline is created with the minimum required steps to run it which are the following:</p>
</div>
<div class="sect4">
<h5 id="dsf-azure-pipelines.asciidoc_triggers">TRIGGERS</h5>
<div class="paragraph">
<p>Triggers that will activate the pipeline execution</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">trigger:
- master
- develop</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-azure-pipelines.asciidoc_variables">VARIABLES</h5>
<div class="paragraph">
<p>Variables that will be used in the next steps</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">variables:
  solution: &apos;**/*.sln&apos;
  buildPlatform: &apos;Any CPU&apos;
  buildConfiguration: &apos;Release&apos;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-azure-pipelines.asciidoc_tools-and-libraries">TOOLS AND LIBRARIES</h5>
<div class="paragraph">
<p>For .NET:</p>
</div>
<div class="paragraph">
<p><strong>-NuGet Tool Installer task</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- task: NuGetToolInstaller@1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use this task to find, download, and cache a specified version of NuGet and add it to the PATH.</p>
</div>
<div class="paragraph">
<p><strong>-The NuGet command to run</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- task: NuGetCommand@2
  inputs:
    restoreSolution: &apos;$(solution)&apos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The NuGet command to run.</p>
</div>
<div class="paragraph">
<p>For more info use the official <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/tool/nuget?view=azure-devops">documentation</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-azure-pipelines.asciidoc_build">BUILD</h5>
<div class="paragraph">
<p><strong>-Visual Studio Build task</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- task: VSBuild@1
  inputs:
    solution: &apos;$(solution)&apos;
    msbuildArgs: &apos;/p:DeployOnBuild=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:DesktopBuildPackageLocation=&quot;$(build.artifactStagingDirectory)\WebApp.zip&quot; /p:DeployIisAppPath=&quot;Default Web Site&quot;&apos;
    platform: &apos;$(buildPlatform)&apos;
    configuration: &apos;$(buildConfiguration)&apos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use this task to build with MSBuild and set the Visual Studio version property.</p>
</div>
<div class="paragraph">
<p>For more info use the official <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/build/visual-studio-build?view=azure-devops">documentation</a></p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-azure-pipelines.asciidoc_test">TEST</h5>
<div class="paragraph">
<p><strong>-Visual Studio Test task</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- task: DotNetCoreCLI@2
  inputs:
    command: &apos;test&apos;
    arguments: &apos;/p:CollectCoverage=true /p:CoverletOutputFormat=opencover /p:CoverletOutput=$(Agent.TempDirectory)/&apos;
    projects: &apos;$(solution)&apos;
    publishTestResults: true
  continueOnError: false
  displayName: &apos;Dot Net Core CLI Test&apos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use this task to run unit and functional tests (Selenium, Appium, Coded UI test, and more) using the Visual Studio Test Runner.</p>
</div>
<div class="paragraph">
<p>For more info use the official <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/test/vstest?view=azure-devops">documentation</a></p>
</div>
<div class="paragraph">
<p>This steps are the ones generated when your pipeline is created, we can create the ones we need using the Azure Devops wizard in an easy way.</p>
</div>
<div class="paragraph">
<p>In our case, apart from build and test, we also need to deploy</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-azure-pipelines.asciidoc_deploy">DEPLOY</h5>

</div>
<div class="sect4">
<h5 id="dsf-azure-pipelines.asciidoc_app-services">App Services</h5>
<div class="paragraph">
<p>While deploying with App Services, 2 steps are required:</p>
</div>
<div class="sect5">
<h6 id="dsf-azure-pipelines.asciidoc_step-1-publish">Step 1: Publish</h6>
<div class="paragraph">
<p>Use this task in a pipeline to publish artifacts for the Azure Pipeline</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- task: PublishPipelineArtifact@0
  inputs:
    artifactName: &apos;Bad_Weather_Backend&apos;
    targetPath: &apos;$(Build.ArtifactStagingDirectory)&apos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To know more about the use of predefined variables in azure take a look at the <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/build/variables?view=azure-devops&amp;tabs=yaml">documentation</a></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-azure-pipelines.asciidoc_step-2-deployment">Step 2: Deployment</h6>
<div class="paragraph">
<p>Use this task to deploy to a range of App Services on Azure</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- task: AzureRmWebAppDeployment@4
  inputs:
    ConnectionType: &apos;AzureRM&apos;
    azureSubscription: &apos;bad-weather-poc-rs-bw-dev&apos;
    appType: &apos;webApp&apos;
    WebAppName: &apos;bwbackendbe&apos;
    packageForLinux: &apos;$(build.artifactStagingDirectory)\WebApp.zip&apos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This task has 2 prerequisites:</p>
</div>
<div class="paragraph">
<p>1-App Service instance:</p>
</div>
<div class="paragraph">
<p>The task is used to deploy a Web App project or Azure Function project to an existing Azure App Service instance, which must exist before the task runs.</p>
</div>
<div class="paragraph">
<p>2-Azure Subscription:</p>
</div>
<div class="paragraph">
<p>In order to deploy to Azure, an Azure subscription must be <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/library/connect-to-azure?view=azure-devops">linked to the pipeline</a>.</p>
</div>
<div class="paragraph">
<p>To know more about the input arguments for this task, make use of the offcial <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/deploy/azure-rm-web-app-deployment?view=azure-devops">documentation</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-azure-connection-strings.asciidoc_connection-strings">57.4.5. CONNECTION STRINGS</h4>
<div class="paragraph">
<p>Once your database is created, you will need to connect that DB to your backend application, this can be made using <a href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/connection-strings"><strong>connection strings</strong></a>.</p>
</div>
<div class="sect5">
<h6 id="dsf-azure-connection-strings.asciidoc_create-the-connection-string">CREATE THE CONNECTION STRING</h6>
<div class="paragraph">
<p>Go to the Azure portal,select the App Service that you want to connect with the DB, to be able to establish this connection, both your DB and your App Service must be under the same resource group.</p>
</div>
<div class="paragraph">
<p>P.E</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-connection-strings/resource-group.png" alt="resource group">
</div>
</div>
<div class="paragraph">
<p>As we can see here, both the app service and the DB exist under the same resource group &apos;BW-dev&apos;</p>
</div>
<div class="paragraph">
<p>Select your app service and go to &apos;settings &gt; Configuration&apos;, scroll down looking for &apos;Connection strings&apos; and click on &quot;New connection string&quot;</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-connection-strings/appservice.png" alt="appservice">
</div>
</div>
<div class="paragraph">
<p>Put the name you want(we&#x2019;ve put the name &apos;Context&apos;, this name will be used later in your appSettings.json) and select the DB type, and for fill the value box go to &apos;Home&gt;SQL databases&apos;, click on the target DB and click on &apos;Show database connection strings&apos;, copy the value that appears there and paste it in the value box.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-connection-strings/db.png" alt="db">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-connection-strings/connection-string.png" alt="connection string">
</div>
</div>
<div class="paragraph">
<p>Paste the connection string in the &apos;value&apos; box and click OK</p>
</div>
<div class="paragraph">
<p>Your connection string has been created.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-azure-connection-strings.asciidoc_use-the-connection-string">USE THE CONNECTION STRING</h6>
<div class="paragraph">
<p>Go to your project, open the file AppSettings.json and add the connection string</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">  &quot;ConnectionStrings&quot;: {
    &quot;Context&quot;: &quot;Source=(localdb)\\MSSQLLocalDB;Initial Catalog=my-db;Integrated Security=True;&quot;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Context is the name that we choose for the connection string that we&#x2019;ve created before and that value is only for local purposes.</p>
</div>
<div class="paragraph">
<p><strong>When the application is deployed,the value for context will be replaced for the value of the connection string that we&#x2019;ve created in the earlier steps</strong>, using this we avoid to put the user and the password into the code and we use them as secrets that will be replaced in the deployment.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-azure-sonarqube-integration.asciidoc_integrate-the-sonarqube-plugin-in-an-azure-devops-pipeline">57.4.6. Integrate the SonarQube plugin in an Azure DevOps pipeline</h4>
<div class="paragraph">
<p>The purpose of this readme is that you can configure your Azure Devops pipeline in order to be able to run a code analysis, analyse the code coverage and publish the results through the Sonar plugin.</p>
</div>
</div>
<div class="sect3">
<h4 id="dsf-azure-sonarqube-integration.asciidoc_how-to-do-it">57.4.7. How to do it</h4>
<div class="sect5">
<h6 id="dsf-azure-sonarqube-integration.asciidoc_step-1-create-a-service-connection">Step 1: Create a service connection</h6>
<div class="paragraph">
<p>The first thing to do is to declare your SonarQube server as a service endpoint in your Azure DevOps project settings.</p>
</div>
<div class="paragraph">
<p>Go to project settings &#x2192; pipelines &#x2192; service connections and <strong>create</strong> and choose &apos;SonarQube&apos;.</p>
</div>
<div class="paragraph">
<p><strong>Create service connection</strong></p>
</div>
<div class="paragraph">
<p>Specify the server url and the connection name of your SonarQube server and the token Auth
Go to your SonarQube server and log in as admin,
once inside, go to administration &#x2192; Security &#x2192; Users &#x2192; Administrator &#x2192; Tokens&#x2192; And <strong>generate</strong> the token.
Copy the generated token(once created it will never appear again so don&#x2019;t lose it) and paste it and click on <strong>save</strong> .</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/ServiceConnection.png" alt="ServiceConnection">
</div>
</div>
<div class="paragraph">
<p>The service connection has been created.
Once this step is done your service creation will appear now in the <em>service connections</em> side bar.</p>
</div>
<div class="paragraph">
<p>For more info regarding the Authentication part please read the <a href="https://docs.sonarqube.org/latest/user-guide/user-token/">official documentation</a></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-azure-sonarqube-integration.asciidoc_step-2-add-the-required-tasks-in-the-azure-pipeline">Step 2: Add the required tasks in the azure pipeline</h6>
<div class="paragraph">
<p>In order to integrate the SonarQube in the pipeline, 3 steps or <strong>tasks</strong> are required(Depending on the different solutions like .NET, Java, C..etc some of this tasks can be optional), this tasks are:</p>
</div>
<div class="paragraph">
<p>Prepare Analysis configuration
Run Code Analysis
Publish Quality Gate result</p>
</div>
<div class="paragraph">
<p>We can use the wizard to create this in an easy way, search &quot;SonarQube&quot; and let&#x2019;s configure the tasks one by one.</p>
</div>
<div class="paragraph">
<p><strong>Prepare Analysis configuration:</strong></p>
</div>
<div class="paragraph">
<p>Fill the required fields and click on <strong>add</strong></p>
</div>
<div class="paragraph">
<p>The <strong>prepare</strong> task will be now shown in the pipeline code:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/sonarprepare.png" alt="sonarprepare">
</div>
</div>
<div class="paragraph">
<p>Follow the <a href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner-for-azure-devops/">official documentation</a> if you have doubts while filling the fields:</p>
</div>
<div class="paragraph">
<p>Once the <strong>prepare</strong> is done, continue with the code analysis.</p>
</div>
<div class="paragraph">
<p><strong>Run Code Analysis</strong></p>
</div>
<div class="paragraph">
<p>Select this from the task assistant and just like happened with the first task, the code will appear in your pipeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/runAnalysis.png" alt="runAnalysis">
</div>
</div>
<div class="paragraph">
<p>Now, let&#x2019;s publish the result of the analysis.</p>
</div>
<div class="paragraph">
<p><strong>Publish quality gate result</strong></p>
</div>
<div class="paragraph">
<p>Same as we did before, select in the display the publish extension and add it</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/publish.png" alt="publish">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-azure-sonarqube-integration.asciidoc_step-3-run-the-pipeline">Step 3: Run the pipeline</h6>
<div class="paragraph">
<p>With this, all the required steps to integrate SonarQube in your Azure DevOps pipeline are done, the last thing you need to do is <strong>run</strong> your pipeline and your code will be analyzed and the results published.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="install-and-use-custom-sonar-plugin-in-azure-devops">57.4.8. Install and use custom sonar plugin in Azure Devops</h4>
<div class="paragraph">
<p>By default, the sonar plugin is not capable to be used in every branch you want to, to do this you need to purchase a license or customize the current plugin in order to satisfy our needs.</p>
</div>
<div class="paragraph">
<p>How to costumize the plugin is not the purpose of this documentation, this documentation is for the intallment and use of it.</p>
</div>
<div class="paragraph">
<p>If you want to install a custom plugin, sign into your Azure Devops organization and once you are in, click on the marketplace icon:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/custom-plugin/marketplace.png" alt="marketplace">
</div>
</div>
<div class="paragraph">
<p>Select *browse marketplace&gt;publish extension</p>
</div>
<div class="paragraph">
<p>Choose the extension you want to install and clik on the options</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/custom-plugin/extension.png" alt="extension">
</div>
</div>
<div class="paragraph">
<p><strong>Important</strong>:</p>
</div>
<div class="paragraph">
<p>You need to choose the organization for which you are going to use the extension and <strong>share it</strong>, if not, you won&#x2019;t be able to install it.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/custom-plugin/share-unshare.png" alt="share unshare">
</div>
</div>
<div class="paragraph">
<p>Once you&#x2019;ve done this click on View extension and &apos;Get it free&apos;, the extension will be downloaded and you will be able to use it in the next screen</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/custom-plugin/install.png" alt="install">
</div>
</div>
<div class="paragraph">
<p>If there are no organizations you can seee the possible causes <a href="https://docs.microsoft.com/en-us/azure/devops/marketplace/faq-extensions?view=azure-devops#no-organizations">here</a>.</p>
</div>
<div class="paragraph">
<p>Another cause might be that you forgot to share the extension.</p>
</div>
<div class="paragraph">
<p>Note: If the install button does not appear, it&#x2019;s possible that you don&#x2019;t have permissions to install it so you will need to talk with the owner of the org.
Another posibility is that you can <em>request</em> an installation.</p>
</div>
<div class="paragraph">
<p>Once installed, in the pipeline wizard it will appear and you will be able to select it.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/others/azure-sonarqube/custom-plugin/wizard.png" alt="wizard">
</div>
</div>
<div class="paragraph">
<p>We can see in the image the default plugin and the customized one.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_okd-openshift-origin">57.5. OKD (OpenShift Origin)</h3>

</div>
<div class="sect2">
<h3 id="dsf-okd.asciidoc">57.6. OKD <em>(OpenShift Origin)</em></h3>
<div class="sect3">
<h4 id="dsf-okd.asciidoc_what-is-okd">57.6.1. What is OKD</h4>
<div class="paragraph">
<p>OKD is a distribution of Kubernetes optimized for continuous application development and multi-tenant deployment. OKD is the upstream Kubernetes distribution embedded in Red Hat OpenShift.</p>
</div>
<div class="paragraph">
<p>OKD embeds Kubernetes and extends it with security and other integrated concepts. OKD is also referred to as Origin in github and in the documentation.</p>
</div>
<div class="paragraph">
<p>OKD provides a complete open source container application platform. If you are looking for enterprise-level support, or information on partner certification, Red Hat also offers <a href="https://www.openshift.com/">Red Hat OpenShift Container Platform</a>.</p>
</div>
<hr>
<h4 id="dsf-okd.asciidoc_continue-reading..." class="discrete">Continue reading&#x2026;&#x200B;</h4>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-how-to-install.asciidoc">How to install Openshift Origin</a></p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-initial-setup.asciidoc">Initial setup</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-s2i.asciidoc">s2i</a></p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-templates.asciidoc">templates</a></p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize.asciidoc">Customize Openshift</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize-icons.asciidoc">Customize icons</a></p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize-catalog.asciidoc">Customize catalog</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd.asciidoc">57.6.2. OKD <em>(OpenShift Origin)</em></h4>
<div class="sect4">
<h5 id="dsf-okd.asciidoc_what-is-okd">What is OKD</h5>
<div class="paragraph">
<p>OKD is a distribution of Kubernetes optimized for continuous application development and multi-tenant deployment. OKD is the upstream Kubernetes distribution embedded in Red Hat OpenShift.</p>
</div>
<div class="paragraph">
<p>OKD embeds Kubernetes and extends it with security and other integrated concepts. OKD is also referred to as Origin in github and in the documentation.</p>
</div>
<div class="paragraph">
<p>OKD provides a complete open source container application platform. If you are looking for enterprise-level support, or information on partner certification, Red Hat also offers <a href="https://www.openshift.com/">Red Hat OpenShift Container Platform</a>.</p>
</div>
<hr>
<h5 id="dsf-okd.asciidoc_continue-reading..." class="discrete">Continue reading&#x2026;&#x200B;</h5>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-how-to-install.asciidoc">How to install Openshift Origin</a></p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-initial-setup.asciidoc">Initial setup</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-s2i.asciidoc">s2i</a></p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-templates.asciidoc">templates</a></p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize.asciidoc">Customize Openshift</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize-icons.asciidoc">Customize icons</a></p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize-catalog.asciidoc">Customize catalog</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-how-to-install.asciidoc">57.6.3. Install OKD <em>(Openshift Origin)</em></h4>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_pre-requisites">Pre-requisites</h5>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_install-docker">Install docker</h6>
<div class="paragraph">
<p><a href="https://docs.docker.com/engine/installation/linux/docker-ce/debian/#set-up-the-repository" class="bare">https://docs.docker.com/engine/installation/linux/docker-ce/debian/#set-up-the-repository</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ sudo groupadd docker
$ sudo usermod -aG docker $USER</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_download-openshift-origin-client">Download Openshift Origin Client</h6>
<div class="paragraph">
<p>Download Openshift Origin Client from <a href="https://www.openshift.org/download.html#oc-platforms">here</a></p>
</div>
<div class="paragraph">
<p>When the download it&#x2019;s complete, only extract it on the directory that you want, for example <code>/home/administrador/oc</code></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_add-oc-to-path">Add oc to path</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ export PATH=$PATH:/home/administrador/oc</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_install-openshift-cluster">Install Openshift Cluster</h5>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_add-the-insecure-registry">Add the insecure registry</h6>
<div class="paragraph">
<p>Create file <code><code>/etc/docker/daemon.json</code></code> with the next content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    &quot;insecure-registries&quot; : [ &quot;172.30.0.0/16&quot; ]
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_download-docker-images-for-openshift">Download docker images for openshift</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ oc cluster up</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_install-oc-cluster-wrapper">Install Oc Cluster Wrapper</h5>
<div class="paragraph">
<p>To manage easier the cluster persistent, we are going to use oc cluster wrapper.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">cd /home/administrador/oc
wget https://raw.githubusercontent.com/openshift-evangelists/oc-cluster-wrapper/master/oc-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>oc-cluster up devonfw-shop-floor --public-hostname X.X.X.X</p>
</div>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_configure-iptables">Configure iptables</h6>
<div class="paragraph">
<p>We must create iptables rules to allow traffic from other machines.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-diff" data-lang="diff">- The next commands it&apos;s to let all traffic, don&apos;t do it on a real server.

- $ iptables -F
- $ iptables -X
- $ iptables -t nat -F
- $ iptables -t nat -X
- $ iptables -t mangle -F
- $ iptables -t mangle -X
- $ iptables -P INPUT ACCEPT
- $ iptables -P OUTPUT ACCEPT
- $ iptables -P FORWARD ACCEPT</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-how-to-install.asciidoc">57.6.4. How to use Oc Cluster Wrapper</h4>
<div class="paragraph">
<p>With oc cluster wrapper we could have different clusters with different context.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_cluster-up">Cluster up</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ oc-cluster up devonfw-shop-floor --public-hostname X.X.X.X</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_cluster-down">Cluster down</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ oc-cluster down</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_use-non-persistent-cluster">Use non-persistent cluster</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">oc cluster up --image openshift/origin --public-hostname X.X.X.X --routing-suffix apps.X.X.X.X.nip.io</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-initial-setup.asciidoc">57.6.5. devonfw Openshift Origin Initial Setup</h4>
<div class="paragraph">
<p>These are scripts to customize an Openshift cluster to be a devonfw Openshift.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-initial-setup.asciidoc_how-to-use">How to use</h5>
<div class="sect5">
<h6 id="dsf-okd-initial-setup.asciidoc_prerequisite-customize-openshift">Prerequisite: Customize Openshift</h6>
<div class="paragraph">
<p>devonfw Openshift Origin use custom icons, and we need to add it to openshift. More information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize.asciidoc">Customize Openshift</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-initial-setup.asciidoc_script-initial-setup">Script initial-setup</h6>
<div class="paragraph">
<p>Download <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/initial-setup.sh">this</a> script and execute it.</p>
</div>
<div class="paragraph">
<p>More information about what this script does <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup#script-initial-setup">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-initial-setup.asciidoc_known-issues">Known issues</h5>
<div class="sect5">
<h6 id="dsf-okd-initial-setup.asciidoc_failed-to-push-image">Failed to push image</h6>
<div class="paragraph">
<p>If you receive an error like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>error: build error: Failed to push image: After retrying 6 times, Push image still failed due to error: Get http://172.30.1.1:5000/v2/:  dial tcp 172.30.1.1:5000: getsockopt: connection refused</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#x2019;s because the registry isn&#x2019;t working, go to openshift console and enter into the <strong>default</strong> project <code><code><a href="https://x.x.x.x:8443/console/project/default/overview" class="bare">https://x.x.x.x:8443/console/project/default/overview</a></code></code> and you must see two resources, <strong>docker-registry</strong> and <strong>router</strong> they must be running. If they don&#x2019;t work, try to deploy them and look at the logs what is happen.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-s2i.asciidoc">57.6.6. s2i devonfw</h4>
<div class="paragraph">
<p>This are the s2i source and templates to build an s2i images. It provides OpenShift builder images for components of the devonfw (at this moment only for angular and java).</p>
</div>
<div class="paragraph">
<p>This work is totally based on the implementation of  <a href="https://github.com/Mickuehl">Michael Kuehl</a> from RedHat for Oasp s2i.</p>
</div>
<div class="paragraph">
<p>All this information is used as a part of the <a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-initial-setup.asciidoc">initial setup</a> for openshift.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-s2i.asciidoc_previous-setup">Previous setup</h5>
<div class="paragraph">
<p>In order to build all of this, it will be necessary, first, to have a running OpenShift cluster. How to install it <a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-how-to-install.asciidoc">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-s2i.asciidoc_usage">Usage</h5>
<div class="paragraph">
<p>Before using the builder images, add them to the OpenShift cluster.</p>
</div>
<div class="sect5">
<h6 id="dsf-okd-s2i.asciidoc_deploy-the-source-2-image-builder-images">Deploy the Source-2-Image builder images</h6>
<div class="paragraph">
<p>First, create a dedicated <code>devonfw</code> project as admin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ oc new-project devonfw --display-name=&apos;devonfw&apos; --description=&apos;devonfw Application Standard Platform&apos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now add the builder image configuration and start their build.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/s2i/java/s2i-devonfw-java-imagestream.json --namespace=devonfw
oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/s2i/angular/s2i-devonfw-angular-imagestream.json --namespace=devonfw
oc start-build s2i-devonfw-java --namespace=devonfw
oc start-build s2i-devonfw-angular --namespace=devonfw</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure other projects can access the builder images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">oc policy add-role-to-group system:image-puller system:authenticated --namespace=devonfw</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#x2019;s all!</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-s2i.asciidoc_deploy-devonfw-templates">Deploy devonfw templates</h6>
<div class="paragraph">
<p>Now, it&#x2019;s time to create devonfw templates to use this s2i and add it to the browse catalog. More information <a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-templates.asciidoc">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-s2i.asciidoc_build-all">Build All</h5>
<div class="paragraph">
<p>Use <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/initial-setup.sh">this</a> script to automatically install and build all image streams. The script also creates templates devonfw-angular and devonfw-java inside the project &apos;openshift&apos; to be used by everyone.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a bash shell as Administrator</p>
</li>
<li>
<p>Execute shell file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ /PATH/TO/BUILD/FILE/initial-setup.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about what this script does <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup#script-initial-setup">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-s2i.asciidoc_links--references">Links &amp; References</h5>
<div class="paragraph">
<p>This is a list of useful articles, etc, that I found while creating the templates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/openshift/openshift-docs/issues/1329">Template Icons</a></p>
</li>
<li>
<p><a href="https://github.com/jbossdemocentral/coolstore-microservice">Red Hat Cool Store Microservice Demo</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/install_config/web_console_customization.html">Openshift Web Console Customization</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-templates.asciidoc">57.6.7. devonfw templates</h4>
<div class="paragraph">
<p>This are the devonfw templates to build devonfw apps for Openshift using the s2i images. They are based on the work of Mickuehl in Oasp templates/mythaistar for deploy My Thai Star.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inside the <code>example-mythaistar</code> we have an example to deploy My Thai Star application using devonfw templates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All this information is used as a part of the <a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-initial-setup.asciidoc">initial setup</a> for openshift.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-templates.asciidoc_how-to-use">How to use</h5>
<div class="sect5">
<h6 id="dsf-okd-templates.asciidoc_previous-requirements">Previous requirements</h6>
<div class="sect6">
<h7 id="dsf-okd-templates.asciidoc_deploy-the-source-2-image-builder-images">Deploy the Source-2-Image builder images</h7>
<div class="paragraph">
<p>Remember that this templates need a build image from s2i-devonfw-angular and s2i-devonfw-java. More information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-s2i.html#deploy-the-source-2-image-builder-images">Deploy the Source-2-Image builder images</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-templates.asciidoc_customize-openshift">Customize Openshift</h7>
<div class="paragraph">
<p>Remember that this templates also have custom icons, and to use it, we must modify the master-config.yml inside openshift. More information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize.asciidoc">Customize Openshift</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-templates.asciidoc_deploy-devonfw-templates">Deploy devonfw templates</h6>
<div class="paragraph">
<p>Now, it&#x2019;s time to create devonfw templates to use this s2i and add it to the browse catalog.</p>
</div>
<div class="paragraph">
<p>To let all user to use these templates in all openshift projects, we should create it in an openshift namespace. To do that, we must log in as an admin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/templates/devonfw-java-template.json --namespace=openshift
oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/templates/devonfw-angular-template.json --namespace=openshift</code></pre>
</div>
</div>
<div class="paragraph">
<p>When it finishes, remember to logout as an admin and enter with our normal user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ oc login</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-templates.asciidoc_how-to-use-devonfw-templates-in-openshift">How to use devonfw templates in openshift</h6>
<div class="paragraph">
<p>To use these templates with openshift, we can override any parameter values defined in the file by adding the --param-file=paramfile option.</p>
</div>
<div class="paragraph">
<p>This file must be a list of &lt;name&gt;=&lt;value&gt; pairs. A parameter reference may appear in any text field inside the template items.</p>
</div>
<div class="paragraph">
<p><strong>The parameters that we must override are the following</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ cat paramfile
  APPLICATION_NAME=app-Name
  APPLICATION_GROUP_NAME=group-Name
  GIT_URI=Git uri
  GIT_REF=master
  CONTEXT_DIR=/context</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The following parameters are optional</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ cat paramfile
  APPLICATION_HOSTNAME=Custom hostname for service routes. Leave blank for default hostname, e.g.: &lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;,
  # Only for angular
  REST_ENDPOINT_URL=The URL of the backend&apos;s REST API endpoint. This can be declared after,
  REST_ENDPOINT_PATTERN=The pattern URL of the backend&apos;s REST API endpoint that must be modify by the REST_ENDPOINT_URL variable,</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For example, to deploy My Thai Star Java</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ cat paramfile
  APPLICATION_NAME=&quot;mythaistar-java&quot;
  APPLICATION_GROUP_NAME=&quot;My-Thai-Star&quot;
  GIT_URI=&quot;https://github.com/oasp/my-thai-star.git&quot;
  GIT_REF=&quot;develop&quot;
  CONTEXT_DIR=&quot;/java/mtsj&quot;

$ oc new-app --template=devonfw-java --namespace=mythaistar --param-file=paramfile</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-customize.asciidoc">57.6.8. Customize Openshift Origin for devonfw</h4>
<div class="paragraph">
<p>This is a guide to customize Openshift cluster.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize.asciidoc_images-styles">Images Styles</h5>
<div class="paragraph">
<p>The icons for templates must measure the same as below or the images don&#x2019;t show right:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Openshift logo</code>: 230px x 40px.</p>
</li>
<li>
<p><code>Template logo</code>: 50px x 50px.</p>
</li>
<li>
<p><code>Category logo</code>: 110px x 36px.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize.asciidoc_how-to-use">How to use</h5>
<div class="paragraph">
<p>To use it, we need to enter in openshift as an admin and use the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ oc login

$ oc edit configmap/webconsole-config -n openshift-web-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, we can see in our shell the webconsole-config.yaml, we only need to navigate until <strong>extensions</strong> and add the url for our own <code>css</code> in the <strong>stylesheetURLs</strong> and <code>javascript</code> in the <strong>scriptURLs</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT: Scripts and stylesheets must be served with the correct content type or they will not be run by the browser. Scripts must be served with Content-Type: application/javascript and stylesheets with Content-Type: text/css.</strong></p>
</div>
<div class="paragraph">
<p>In git repositories, the content type of raw is text/plain. You can use <a href="https://rawgit.com/">rawgit</a> to convert a raw from a git repository to the correct content type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-YAML" data-lang="YAML">webconsole-config.yaml: |
  [...]
    extensions:
      scriptURLs:
        - https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/scripts/catalog-categories.js
      stylesheetURLs:
        - https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/stylesheet/icons.css
  [...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize.asciidoc_more-information">More information</h5>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize-icons.asciidoc">Customize icons</a> for Openshift.</p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize-catalog.asciidoc">Customize catalog</a> for Openshift.</p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/install_config/web_console_customization.html#loading-custom-scripts-and-stylesheets">Openshift docs</a> about customization.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize.asciidoc_old-versions">Old versions</h5>
<div class="ulist">
<ul>
<li>
<p>Customize Openshift for <a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize-v3-7.asciidoc">version 3.7</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize-icons.asciidoc">How to add Custom Icons inside openshift</h5>
<div class="paragraph">
<p>This is a guide to add custom icons into an Openshift cluster.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/stylesheet">Here</a> we can find an icons.css example to use the devonfw icons.</p>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-icons.asciidoc_images-styles">Images Styles</h6>
<div class="paragraph">
<p>The icons for templates must measure the same as below or the images don&#x2019;t show right:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Openshift logo</code>: 230px x 40px.</p>
</li>
<li>
<p><code>Template logo</code>: 50px x 50px.</p>
</li>
<li>
<p><code>Category logo</code>: 110px x 36px.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-icons.asciidoc_create-a-css">Create a css</h6>
<div class="sect6">
<h7 id="dsf-okd-customize-icons.asciidoc_custom-logo-for-openshift-cluster">Custom logo for openshift cluster</h7>
<div class="paragraph">
<p>For this example, we are going to call the css icons.css but you can call as you wish.
Openshift cluster draw their icon by the id header-logo, then we only need to add to our icons.css the next Style Attribute ID</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-CSS" data-lang="CSS">#header-logo {
  background-image: url(&quot;https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/images/devonfw-openshift.png);
  width: 230px;
  height: 40px;
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-icons.asciidoc_custom-icons-for-templates">Custom icons for templates</h7>
<div class="paragraph">
<p>To use a custom icon to a template openshift use a class name. Then, we need to insert inside our icons.css the next Style Class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-CSS" data-lang="CSS">.devonfw-logo {
  background-image: url(&quot;https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/images/devonfw.png&quot;);
  width: 50px;
  height: 50px;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To show that custom icon on a template, we only need to write the name of our class in the tag &quot;iconClass&quot; of our template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">{
    ...
    &quot;items&quot;: [
        {
            ...
            &quot;metadata&quot;: {
                ...
                &quot;annotations&quot;: {
                    ...
                    &quot;iconClass&quot;: &quot;devonfw-logo&quot;,
                    ...
                }
            },
            ...
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-icons.asciidoc_use-our-own-css-inside-openshift">Use our own css inside openshift</h6>
<div class="paragraph">
<p>To do that, we need to enter in openshift as an admin and use the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ oc login
$ oc edit configmap/webconsole-config -n openshift-web-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, we can see in our shell the webconsole-config.yaml, we only need to navigate until <strong>extensions</strong> and add the url for our own <code>css</code> in the <strong>stylesheetURLs</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT: Scripts and stylesheets must be served with the correct content type or they will not be run by the browser. stylesheets must be served with Content-Type: text/css.</strong></p>
</div>
<div class="paragraph">
<p>In git repositories, the content type of raw is text/plain. You can use <a href="https://rawgit.com/">rawgit</a> to convert a raw from a git repository to the correct content type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-YAML" data-lang="YAML">webconsole-config.yaml: |
	[...]
    extensions:
      stylesheetURLs:
		- https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/stylesheet/icons.css
    [...]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize-catalog.asciidoc">How to add custom catalog categories inside openshift</h5>
<div class="paragraph">
<p>This is a guide to add custom <code>Catalog Categories</code> into an Openshift cluster.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/scripts">Here</a> we can find a catalog-categories.js example to use the devonfw catalog categories.</p>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-catalog.asciidoc_create-a-scrip-to-add-custom-langauges-and-custom-catalog-categories">Create a scrip to add custom langauges and custom catalog categories</h6>
<div class="sect6">
<h7 id="dsf-okd-customize-catalog.asciidoc_custom-language">Custom language</h7>
<div class="paragraph">
<p>For this example, we are going add a new language into the languages category. To do that we must create a script and we named as catalog-categories.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Javascript" data-lang="Javascript">// Find the Languages category.
var category = _.find(window.OPENSHIFT_CONSTANTS.SERVICE_CATALOG_CATEGORIES,
                      { id: &apos;languages&apos; });
// Add Go as a new subcategory under Languages.
category.subCategories.splice(2,0,{ // Insert at the third spot.
  // Required. Must be unique.
  id: &quot;devonfw-languages&quot;,
  // Required.
  label: &quot;devonfw&quot;,
  // Optional. If specified, defines a unique icon for this item.
  icon: &quot;devonfw-logo-language&quot;,
  // Required. Items matching any tag will appear in this subcategory.
  tags: [
    &quot;devonfw&quot;,
    &quot;devonfw-angular&quot;,
    &quot;devonfw-java&quot;
  ]
});</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-catalog.asciidoc_custom-category">Custom category</h7>
<div class="paragraph">
<p>For this example, we are going add a new category into the category tab. To do that we must create a script and we named as catalog-categories.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Javascript" data-lang="Javascript">// Add a Featured category as the first category tab.
window.OPENSHIFT_CONSTANTS.SERVICE_CATALOG_CATEGORIES.unshift({
  // Required. Must be unique.
  id: &quot;devonfw-featured&quot;,
  // Required
  label: &quot;devonfw&quot;,
  subCategories: [
    {
      // Required. Must be unique.
      id: &quot;devonfw-languages&quot;,
      // Required.
      label: &quot;devonfw&quot;,
      // Optional. If specified, defines a unique icon for this item.
      icon: &quot;devonfw-logo-language&quot;,
      // Required. Items matching any tag will appear in this subcategory.
      tags: [
        &quot;devonfw&quot;,
        &quot;devonfw-angular&quot;,
        &quot;devonfw-java&quot;
      ]
    }
  ]
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-catalog.asciidoc_use-our-own-javascript-inside-openshift">Use our own javascript inside openshift</h6>
<div class="paragraph">
<p>To do that, we need to enter in openshift as an admin and use the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ oc login
$ oc edit configmap/webconsole-config -n openshift-web-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, we can see in our shell the webconsole-config.yaml, we only need to navigate until <strong>extensions</strong> and add the url for our own <code>javascript</code> in the <strong>scriptURLs</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT: Scripts and stylesheets must be served with the correct content type or they will not be run by the browser. Scripts must be served with Content-Type: application/javascript.</strong></p>
</div>
<div class="paragraph">
<p>In git repositories, the content type of raw is text/plain. You can use <a href="https://rawgit.com/">rawgit</a> to convert a raw from a git repository to the correct content type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-YAML" data-lang="YAML">webconsole-config.yaml: |
  [...]
    extensions:
      scriptURLs:
        - https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/scripts/catalog-categories.js
  [...]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-v3-7.asciidoc">Customize Openshift Origin v3.7 for devonfw</h6>
<div class="paragraph">
<p>This is a guide to customize Openshift cluster. For more information read the next:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/3.7/install_config/web_console_customization.html#loading-custom-scripts-and-stylesheets">Openshift docs customization</a> for the version 3.7.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-v3-7.asciidoc_images-styles">Images Styles</h7>
<div class="paragraph">
<p>The icons for templates must measure the same as below or the images don&#x2019;t show right:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Openshift logo</code>: 230px x 40px.</p>
</li>
<li>
<p><code>Template logo</code>: 50px x 50px.</p>
</li>
<li>
<p><code>Category logo</code>: 110px x 36px.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-v3-7.asciidoc_quick-use">Quick Use</h7>
<div class="paragraph">
<p>This is a quick example to add custom icons and categories inside openshift.</p>
</div>
<div class="paragraph">
<p>To modify the icons inside openshift, we must to modify our master-config.yaml of our openshift cluster. This file is inside the openshift container and to obtain a copy of it, we must to know what&#x2019;s our openshift container name.</p>
</div>
<div class="sect7">
<h8 id="dsf-okd-customize-v3-7.asciidoc_obtain-the-master-config.yaml-of-our-openshift-cluster">Obtain the master-config.yaml of our openshift cluster</h8>
<div class="sect8">
<h9 id="dsf-okd-customize-v3-7.asciidoc_obtain-the-name-of-our-openshift-container">Obtain the name of our openshift container</h9>
<div class="paragraph">
<p>To obtain it, we can know it executing the next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ docker container ls
CONTAINER ID        IMAGE                                           COMMAND                  CREATED             STATUS              PORTS                                     NAMES
83a4e3acda5b        openshift/origin:v3.7.0                         &quot;/usr/bin/openshift &#x2026;&quot;   6 days ago          Up 6 days                                                     origin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we can see that the name of the container is origin. Normaly the container it&#x2019;s called as origin.</p>
</div>
</div>
<div class="sect8">
<h9 id="dsf-okd-customize-v3-7.asciidoc_copy-the-master-config.yaml-of-our-openshift-container-to-our-directory">Copy the master-config.yaml of our openshift container to our directory</h9>
<div class="paragraph">
<p>This file is inside the openshift container in the next directory: /var/lib/origin/openshift.local.config/master/<code>master-config.yaml</code> and we can copy it with the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ docker cp origin:/var/lib/origin/openshift.local.config/master/master-config.yaml ./</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have a file with the configuration of our openshift cluster.</p>
</div>
</div>
</div>
<div class="sect7">
<h8 id="dsf-okd-customize-v3-7.asciidoc_copy-all-customize-files-inside-the-openshift-container">Copy all customize files inside the openshift container</h8>
<div class="paragraph">
<p>To use our customization of devonfw Openshift, we need to copy our files inside the openshift container.</p>
</div>
<div class="paragraph">
<p>To do this we need to copy the images, scripts and stylesheets from <a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift">here</a> inside openshift
container, for example, we could put it all inside a folder called openshift.local.devonfw. On the step one we obtain the name of this container, for this example we assume that it&#x2019;s called origin. Then our images are located inside openshift container and we can see an access it in <code>/var/lib/origin/openshift.local.devonfw/images</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ docker cp ./openshift.local.devonfw origin:/var/lib/origin/</code></pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="dsf-okd-customize-v3-7.asciidoc_edit-and-copy-the-master-config.yaml-to-use-our-customize-files">Edit and copy the master-config.yaml to use our customize files</h8>
<div class="paragraph">
<p>The master-config.yaml have a sections to charge our custom files. All these sections are inside the <code>assetConfig</code> and their names are the next:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The custom stylessheets are into <code>extensionStylesheets</code>.</p>
</li>
<li>
<p>The custom scripts are into <code>extensionScripts</code>.</p>
</li>
<li>
<p>The custom images are into <code>extensions</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use all our custom elements only need to add the directory routes of each element in their appropriate section of the master-config.yaml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">...
assetConfig:
  ...
  extensionScripts:
  - /var/lib/origin/openshift.local.devonfw/scripts/catalog-categories.js
  extensionStylesheets:
  - /var/lib/origin/openshift.local.devonfw/stylesheet/icons.css
  extensions:
  - name: images
    sourceDirectory: /var/lib/origin/openshift.local.devonfw/images
  ...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we only need to copy that master-config.yaml inside openshift, and restart it to load the new configuration. To do that execute the next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Shell" data-lang="Shell">$ docker cp ./master-config.yaml origin:/var/lib/origin/openshift.local.config/master/master-config.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>To re-start openshift do <code>oc cluster down</code> and start again your persistent openshift cluster.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-v3-7.asciidoc_more-information">More information</h7>
<div class="ulist">
<ul>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize-icons.asciidoc">Customize icons</a> for Openshift.</p>
</li>
<li>
<p><a href="master-devonfw-shop-floor.asciidoc_annexes.html#dsf-okd-customize-catalog.asciidoc">Customize catalog</a> for Openshift.</p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/install_config/web_console_customization.html#loading-custom-scripts-and-stylesheets">Openshift docs</a> about customization.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_istio-guide">57.7. ISTIO Guide</h3>
<div class="sect3">
<h4 id="dsf-istio-guide.asciidoc">57.7.1. ISTIO Service Mesh Implementation Guide</h4>
<div class="sect4">
<h5 id="dsf-istio-guide.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>A service mesh separating applications from network functions like resilience, fault tolerance, etc,.</p>
</div>
<div class="paragraph">
<p>A service mesh addresses the below functions without changing the application code.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Test the new versions of services without impacting the users.</p>
</li>
<li>
<p>Scale the services.</p>
</li>
<li>
<p>Find the services with the help of service registry.</p>
</li>
<li>
<p>Test against failures.</p>
</li>
<li>
<p>Secure service-to-service communication.</p>
</li>
<li>
<p>Route traffic to a specific way.</p>
</li>
<li>
<p>Circuit breaking and fault injection.</p>
</li>
<li>
<p>Monitor the services and collect matrices.</p>
</li>
<li>
<p>Tracing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ISTIO service mesh is an open environment for Connecting, Securing, Monitoring services across the environments.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-istio-guide.asciidoc_istio-architecture">ISTIO Architecture</h5>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image1.png" alt="image" width="373" height="277"></span></p>
</div>
<div class="paragraph">
<p>ISTIO is split into data plane and control plane. Refer <a href="https://istio.io/latest/docs/ops/deployment/architecture">ISTIO Architecture</a></p>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_data-plane">Data Plane</h6>
<div class="paragraph">
<p>The data plane is a set of intelligent proxies (Envoy) deployed as sidecars that mediate and control all network communication among microservices.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image2.png" alt="image" width="199" height="185"></span></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_control-plane">Control Plane</h6>
<div class="paragraph">
<p>The control plane is managing and configuring proxies to route traffic and enforcing policies.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pilot manages all the proxies and responsible for routing</p>
</li>
<li>
<p>Mixer collects telemetry and policy check</p>
</li>
<li>
<p>Citadel does Certificate management (TLS certs to Envoys)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-istio-guide.asciidoc_istio-installation">ISTIO installation</h5>
<div class="paragraph">
<p>Download ISTIO from <a href="https://github.com/istio/istio/releases/">releases</a></p>
</div>
<div class="paragraph">
<p><code>istioctl install --set profile=demo</code></p>
</div>
<div class="paragraph">
<p>Here used demo profile, there are other profiles for production.</p>
</div>
<div class="paragraph">
<p>Verify installation:</p>
</div>
<div class="paragraph">
<p><code>kubectl get all -n istio-system</code></p>
</div>
<div class="paragraph">
<p>Inject sidecar container automatically by issuing the below command.</p>
</div>
<div class="paragraph">
<p><code>kubectl label namespace default istio-injection=enabled</code></p>
</div>
<div class="paragraph">
<p>Verify:</p>
</div>
<div class="paragraph">
<p><code>kubectl get namespace -L istio-injection</code></p>
</div>
<div class="paragraph">
<p>For more installation guides, refer <a href="https://istio.io/latest/docs/setup/install/">ISTIO Installation</a></p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-istio-guide.asciidoc_traffic-management">Traffic Management</h5>
<div class="paragraph">
<p>ISITO&#x2019;s traffic management model relies on the Envoy proxies which deployed as sidecars to services.</p>
</div>
<div class="paragraph">
<p>Below are the traffic management API resources</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Virtual Services</p>
</li>
<li>
<p>Destination Rules</p>
</li>
<li>
<p>Gateways</p>
</li>
<li>
<p>Service Entries</p>
</li>
<li>
<p>Sidecars</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A virtual service, higher level abstraction of Kubernetes Service, lets you configure how requests are routed to a service within an Istio service mesh. Your mesh may have multiple virtual services or none. Virtual service consists of routing rules that are evaluated in order.</p>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_dark-launch">Dark Launch</h6>
<div class="paragraph">
<p>The following virtual service routes requests to different versions of a service depending on whether the request comes from a testuser. If the testuser calls then version v1 will be used, and for others version v2.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image3.png" alt="image" width="601" height="124"></span></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_bluegreen-deployment">Blue/Green deployment</h6>
<div class="paragraph">
<p>In blue/green deployment two versions of the application running. Both versions are live on different domain names, in this example it is mtsj.com and test.mtsj.com.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define 2 virtual services for mtsj v1 and v2 versions.</p>
</li>
<li>
<p>Define DestinationRule and configure the subsets for v1 and v2.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image4.png" alt="image" width="601" height="139"></span></p>
</div>
<div class="paragraph">
<p>When end user browses <em>mtsj.com</em>, the gateway call goes to subset v1 of the virtual service and redirects to destination version v1, and for <em>test.mtsj.com</em> to version v2.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_canary-deployment-traffic-splitting">Canary Deployment (Traffic Splitting)</h6>
<div class="paragraph">
<p>In canary deployment old and new versions of the application alive. ISTIO can be configured, how much percentage of traffic can go to each version.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image5.png" alt="image" width="601" height="123"></span></p>
</div>
<div class="paragraph">
<p>Here, the traffic is divided 75% to the version V1, and 25% to the version V2, as we gain confidence the percentage can be increased the latest version and gradually the traffic to the old version can be reduced and removed.</p>
</div>
<div class="paragraph">
<p>You may refer <a href="https://istio.io/latest/docs/concepts/traffic-management">ISTIO Traffic Management</a> for more details.</p>
</div>
<div class="sect6">
<h7 id="dsf-istio-guide.asciidoc_mythaistar-implementation">MyThaiStar Implementation</h7>
<div class="paragraph">
<p>In this example dish will have two versions and the traffic will be routed alternately using the ISTIO configuration.</p>
</div>
<div class="paragraph">
<p>Find all configuration files in istio/trafficmanagement/canary directory under mythaistarmicroservices example.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>MyThaiStar defines below</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Service</p>
</li>
<li>
<p>Service Account</p>
</li>
<li>
<p>Deployment</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The above configurations are defined in a single yaml file for all the different services like angular, dish, image etc.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>dish-v2: Dish Version 2 can be kept separately in different yaml file.</p>
</li>
<li>
<p>mts-gateway defines the ingress gateway which routes the outbound request to each service.</p>
</li>
<li>
<p>destination-rule-all defines the subsets here for later traffic routing</p>
</li>
<li>
<p>dish-50-50: traffic routing for different versions of dishmanagement.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_network-resilience">Network Resilience</h6>
<div class="sect6">
<h7 id="dsf-istio-guide.asciidoc_timeout">Timeout</h7>
<div class="paragraph">
<p>Istio lets you adjust the timeouts using virtual services. The default timeout is 15 seconds.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image6.png" alt="image" width="185" height="155"></span></p>
</div>
</div>
<div class="sect6">
<h7 id="dsf-istio-guide.asciidoc_retry">Retry</h7>
<div class="paragraph">
<p>A retry setting specifies the maximum number of times an Envoy proxy attempts to connect to a service if the initial call fails.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image7.png" alt="image" width="211" height="152"></span></p>
</div>
<div class="paragraph">
<p>Retries can also be configured on Gateway Error, Connection failure, Connection Refused or any 5xx error from the application.</p>
</div>
<div class="paragraph">
<p>retryOn: gateway-error,connect-failure,refused-stream,5xx</p>
</div>
</div>
<div class="sect6">
<h7 id="dsf-istio-guide.asciidoc_circuit-breakers">Circuit Breakers</h7>
<div class="paragraph">
<p>By defining the destination rule, set limits for calls to individual hosts within a service, such as the number of concurrent connections or how many times calls to this host have failed once the limit reached.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Outlier Detection is an ISTIO Resiliency strategy to detect unusual host behaviour and evict the unhealthy hosts from the set of load balanced healthy hosts inside a cluster.</p>
</li>
<li>
<p>If a request is sent to a service instance and it fails (returns a 50X error code), then ISTIO ejects the instance from the load balanced pool for a specified duration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image8.png" alt="image" width="182" height="150"></span></p>
</div>
</div>
<div class="sect6">
<h7 id="dsf-istio-guide.asciidoc_fault-injection">Fault Injection</h7>
<div class="paragraph">
<p>Two types of faults can be generated using ISTIO. This is useful for the testing.</p>
</div>
<div class="paragraph">
<p>Delays: timing failures.</p>
</div>
<div class="paragraph">
<p>Aborts: crash failures.</p>
</div>
<div class="paragraph">
<p>Below example is a crash failure Virtual Service. The below example configured to receive http status 500 error for the testuser. The application works fine for all other users.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image9.png" alt="image" width="229" height="377"></span></p>
</div>
<div class="paragraph">
<p>The below virtual service configured to wait 10s for all requests.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image10.png" alt="image" width="254" height="217"></span></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-istio-guide.asciidoc_security">Security</h5>
<div class="paragraph">
<p>ISTIO provides security solution has the below functions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Traffic encryption</p>
</li>
<li>
<p>Mutual TLS and fine-grained access policies.</p>
</li>
<li>
<p>Auditing tools</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_authentication">Authentication</h6>
<div class="paragraph">
<p>ISTIO provides two types of authentication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Peer authentication, secures service to service authentication</p>
</li>
<li>
<p>Request authentication is end user authentication to verify credential attached to the request.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_mutual-tls-authentication">Mutual TLS Authentication</h6>
<div class="paragraph">
<p>By default, the TLS protocol only proves the identity of the server to the client. Mutual TLS authentication ensures that traffic has been traffic is secure and trusted in both the directions between the client and server.</p>
</div>
<div class="paragraph">
<p>All traffic between services with proxies uses mutual TLS by default.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_peer-authentication">Peer Authentication</h6>
<div class="paragraph">
<p>Peer authentication has Permissive, Strict and Disabled mode. With permissive mode, a service accepts both plain text and mutual TLS traffic. Permissive mode is good at the time of onboarding and should switch to Strict later.</p>
</div>
<div class="paragraph">
<p>The authentication policy can be applied to mesh-wide, namespace wide or workload specific using the selector field.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image11.png" alt="image" width="275" height="148"></span></p>
</div>
<div class="paragraph">
<p>Here the policy applied to the workload bookings.</p>
</div>
<div class="paragraph">
<p>Check the default mesh policy:</p>
</div>
<div class="paragraph">
<p><code>kubectl describe meshpolicy default</code></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_request-authentication">Request authentication</h6>
<div class="paragraph">
<p>Request authentication policies specify the values needed to validate JWT tokens.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Authentication</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Applies to</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Uses</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Identity</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service to service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mTLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">source.principal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">End User authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request.auth.principal</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_authorization">Authorization</h6>
<div class="paragraph">
<p>Apply an authorization policy to the workload/namespace/mesh to enforce the access control. Supports ALLOW and DENY actions.</p>
</div>
<div class="sect6">
<h7 id="dsf-istio-guide.asciidoc_deny-all">Deny All</h7>
<div class="paragraph">
<p>Below example authorization policy without any rules denies access to all workloads in admin namespace.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image12.png" alt="image" width="221" height="97"></span></p>
</div>
<div class="paragraph">
<p>Example below allowing the GET methods from order service.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image13.png" alt="image" width="247" height="174"></span></p>
</div>
<div class="paragraph">
<p>Example below denies the request to the /registered path for requests without request principals.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/others/istio/media/image14.png" alt="image" width="236" height="166"></span></p>
</div>
<div class="paragraph">
<p>You may refer <a href="https://istio.io/latest/docs/concepts/security">ISTIO Security</a> for more details.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-istio-guide.asciidoc_observability">Observability</h5>
<div class="paragraph">
<p>ISTIO generates</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Metrics - for monitor latency, traffic, errors and saturation.</p>
</li>
<li>
<p>Distributed Traces to identify call flows and service dependencies</p>
</li>
<li>
<p>Access Logs enables audit service behaviour to the individual service level.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_grafana-dashboard">Grafana dashboard</h6>
<div class="paragraph">
<p>Grafana and Prometheus are preconfigured addons on ISTIO. To enable, choose the configuration profile which has Prometheus and Grafana enabled. Eg: Demo profile</p>
</div>
<div class="paragraph">
<p>Verify Prometheus and Grafana running in the cluster.</p>
</div>
<div class="paragraph">
<p><code>kubectl get pods -n istio-system</code></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-istio-guide.asciidoc_kiali-dashboard">Kiali dashboard</h6>
<div class="paragraph">
<p>The Kiali dashboard helps you understand the structure of your service mesh by displaying the topology. The demo profile enables Kiali dashboard also.</p>
</div>
<div class="paragraph">
<p>Access the Kiali dashboard. The default user name is admin and default password is admin.</p>
</div>
<div class="paragraph">
<p><code>istioctl dashboard kiali</code></p>
</div>
<div class="paragraph">
<p>You may refer <a href="https://istio.io/latest/docs/concepts/observability">ISTIO Observability</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-istio-guide.asciidoc_minikube-troubleshooting-tips">Minikube Troubleshooting Tips</h5>
<div class="paragraph">
<p>This documentation provides the troubleshooting tips while working with minikube in a local machine.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Always start minikube with a minimum of 4GB of memory or more if available. Using command <code>minikube start --memory=4096</code></p>
</li>
<li>
<p>If minikube is not starting or throwing any error even after multiple attempts. Try the below tips:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Delete the minikube in your local machine using <code>minikube delete</code> and do a fresh minikube start.</p>
</li>
<li>
<p>In any case, if minikube is not starting even after the above step, go to .minikube folder under the users directory and delete it manually. Now try starting minikube.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Set docker environment in minikube using <code>minikube docker-env</code>. Now all the docker commands that are run will be on the docker inside minikube. So building your application after executing the above command will have the application docker images available to minikube.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To exit minikube docker environment use <code>minikube docker-env -u</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>In any case, if you face any error related to docker image such as <code>Failed to pull image</code>, or <code>image not found</code> errors we will have to manually push the application docker image to minikube docker cache using the below commands.</p>
</li>
<li>
<p>For better results - stop minikube using <code>minikube stop</code> command.</p>
</li>
<li>
<p>Execute the command <code>minikube cache add imageName/tagName</code>.</p>
</li>
<li>
<p>Now start the minikube. To verify if the docker image has been added to minikube docker execute <code>minikube ssh docker images</code>.</p>
</li>
<li>
<p>To remove any docker image from minikube docker stop any containers running that docker image and then execute <code>minikube cache delete imageName/tagName</code>.</p>
</li>
<li>
<p>To reload any docker image to minikube docker environment, execute <code>minikube cache reload</code>.</p>
</li>
<li>
<p>In any case, if the docker images are not getting removed from minikube docker environment then navigate to .minikube/cache/images and then delete the particular image.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Execute the below command to make the Grafana available.</p>
</div>
<div class="paragraph">
<p><code>kubectl -n istio-system port-forward $(kubectl -n istio-system get pod -l app=grafana -o jsonpath=&apos;\{.items[0].metadata.name}&apos;) 3000:3000 &amp;</code></p>
</div>
<div class="paragraph">
<p>Use the below URLs to view the dashboard in local machine.</p>
</div>
<div class="paragraph">
<p><a href="http://localhost:3000/dashboard/db/istio-mesh-dashboard" class="bare">http://localhost:3000/dashboard/db/istio-mesh-dashboard</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>&#x2190;&#xA0;Previous:&#xA0;<a href="master-devonfw-shop-floor.asciidoc_monitoring.html">Monitoring</a>&#xA0;| &#x2191;&#xA0;Up:&#xA0;<a href="master-devonfw-shop-floor.asciidoc.html">devonfw shop floor</a>&#xA0;| &#x2302;&#xA0;Home:&#xA0;<a href="master.html">devonfw guide</a>&#xA0;| Next:&#xA0;<a href="master-cicdgen.asciidoc.html">cicdgen</a>&#xA0;&#x2192;</p>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html#introduction-why-should-i-use-devonfw.asciidoc">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_further-information.html">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devon4j.asciidoc_architecture.html">Architecture</a></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">Resources</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-ide-support.asciidoc.html#LICENSE.asciidoc">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script type="module">
      import { UtilsModule } from '/website/shared/utils.js';
      import { HeaderModule } from '/website/components/header/header.js';

      let searchData = { index: null, documents: null };
      UtilsModule.loadIndex(searchData);

      $(window).on('load', function() {
        const queryFun = () => {
          HeaderModule.queryFunction(searchData);
        };

        HeaderModule.searchOnClick(queryFun);
      });
    </script>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<div class="footnote"><sub>

Last updated 2021-07-16 19:37:38 UTC
</sub></div>


<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>

</body></html>