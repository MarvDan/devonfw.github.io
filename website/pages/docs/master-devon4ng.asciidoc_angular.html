<!DOCTYPE html><html lang="en"><head><style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style><style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Updated at 2021-05-26 13:05:24 UTC">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>devonfw guide</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" integrity="sha256-M/Awbb/BYh+Rh0aGjpQid26p1b2OBsrk2k9yAvQxPV0=" crossorigin="anonymous"></script>
<!-- JQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/styles/googlecode.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/lang/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>

<!-- ************** Google analytics ************ -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>

<!-- ******************************************** -->

</head>
<body id="master.asciidoc" class="book toc2 toc-left">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">RESOURCES</a></p>
</li>
<li>
<p><a href="/website/pages/explore/explore.html">EXPLORE</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html" class="active">DOCS</a></p>
</li>
<li>
<p><a href="/website/pages/community/community.html">COMMUNITY</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input id="search-field" type="search" class="form-control mr-sm-2" placeholder="Search by keyword(s)..." aria-label="Search" style="height: auto;">
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width="auto" height="auto" alt>
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="header">
<h1>devonfw guide</h1>
<div class="details">
<span id="author" class="author">Updated at 2021-05-26 13:05:39 UTC</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="master.html">devonfw guide</a></span></p><ul class="sectlevel0">
<li><a href="getting-started.asciidoc.html">I. Getting Started</a>
</li>
<li><a href="devonfw-ide.asciidoc.html">II. devonfw-ide</a>
</li>
<li><a href="devon4j.asciidoc.html">III. devonfw for Java (devon4j)</a>
</li>
<li><a href="master-devon4ng.asciidoc.html">IV. devon4ng</a>
<ul class="sectlevel1">
<li><a href="master-devon4ng.asciidoc_introduction.html">14. Introduction</a>
</li>
<li><a href="master-devon4ng.asciidoc_architecture.html">15. Architecture</a>
</li>
<li><a href="master-devon4ng.asciidoc_layers.html">16. Layers</a>
</li>
<li><a href="master-devon4ng.asciidoc_guides.html">17. Guides</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html"><span class="toc-current">18. Angular</span></a>
<ul class="sectlevel2">
<li><a href="master-devon4ng.asciidoc_angular.html#guide-accessibility.asciidoc">18.1. Accessibility</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-angular-elements.asciidoc">18.2. Angular Elements</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-angular-lazy-loading.asciidoc">18.3. Angular Lazy loading</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-angular-library.asciidoc">18.4. Angular Library</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-angular-theming.asciidoc">18.5. Angular Material Theming</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-angular-pwa.asciidoc">18.6. Angular Progressive Web App</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-app-initializer.asciidoc">18.7. APP_INITIALIZER</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-component-decomposition.asciidoc">18.8. Component Decomposition</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-consuming-rest-services.asciidoc">18.9. Consuming REST services</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-error-handler.asciidoc">18.10. Error Handler in angular</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-file-structure.asciidoc">18.11. File Structure</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-internationalization.asciidoc">18.12. Internationalization</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-routing.asciidoc">18.13. Routing</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-testing.asciidoc">18.14. Testing</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-update-angular-cli.asciidoc">18.15. Update Angular CLI</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-upgrade-devon4ng.asciidoc">18.16. Upgrade devon4ng Angular and Ionic/Angular applications</a>
</li>
<li><a href="master-devon4ng.asciidoc_angular.html#guide-working-with-angular-cli.asciidoc">18.17. Working with Angular CLI</a>
</li>
</ul>
</li>
<li><a href="master-devon4ng.asciidoc_ionic.html">19. Ionic</a>
</li>
<li><a href="master-devon4ng.asciidoc_layouts.html">20. Layouts</a>
</li>
<li><a href="master-devon4ng.asciidoc_ngrx.html">21. NgRx</a>
</li>
<li><a href="master-devon4ng.asciidoc_cookbook.html">22. Cookbook</a>
</li>
</ul>
</li>
<li><a href="master-devon4net.asciidoc.html">V. devon4net</a>
</li>
<li><a href="master-devon4node.asciidoc.html">VI. devon4node</a>
</li>
<li><a href="master-database.asciidoc.html">VII. Choosing your Database</a>
</li>
<li><a href="master-devonfw-shop-floor.asciidoc.html">VIII. devonfw shop floor</a>
</li>
<li><a href="master-cicdgen.asciidoc.html">IX. cicdgen</a>
</li>
<li><a href="master-production-line.asciidoc.html">X. Production Line Templates</a>
</li>
<li><a href="master-cobigen.asciidoc.html">XI. CobiGen&#x2009;&#x2014;&#x2009;Code-based incremental Generator</a>
</li>
<li><a href="master-mrchecker.asciidoc.html">XII. MrChecker - devonfw testing tool</a>
</li>
<li><a href="master-my-thai-star.asciidoc.html">XIII. MyThaiStar</a>
</li>
<li><a href="master-dashboard.asciidoc.html">XIV. devonfw dashboard</a>
</li>
<li><a href="master-solicitor.asciidoc.html">XV. Solicitor User Guide</a>
</li>
<li><a href="master-contributing.asciidoc.html">XVI. Contributing</a>
</li>
<li><a href="master-release-notes.asciidoc.html">XVII. Release Notes</a>
</li>
</ul>
</div>
</div><div id="content">
<div class="sect1">
<h2 id="master-devon4ng.asciidoc_angular">18. Angular</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="guide-accessibility.asciidoc">18.1. Accessibility</h3>
<div class="paragraph">
<p>Multiple studies suggest that around 15-20% of the population are living with a disability of some kind. In comparison, that number is higher than any single browser demographic currently, other than Chrome2. Not considering those users when developing an application means excluding a large number of people from being able to use it comfortable or at all.</p>
</div>
<div class="paragraph">
<p>Some people are unable to use the mouse, view a screen, see low contrast text, Hear dialogue or music and some people having difficulty to understanding the complex language.This kind of people needed the support like Keyboard support, screen reader support, high contrast text, captions and transcripts and Plain language support. This disability may change the from permanent to the situation.</p>
</div>
<div class="sect3">
<h4 id="guide-accessibility.asciidoc_key-concerns-of-accessible-web-applications">18.1.1. Key Concerns of Accessible Web Applications</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Semantic Markup</strong> - Allows the application to be understood on a more general level rather than just details of whats being rendered</p>
</li>
<li>
<p><strong>Keyboard Accessibility</strong> - Applications must still be usable when using only a keyboard</p>
</li>
<li>
<p><strong>Visual Assistance</strong> - color contrast, focus of elements and text representations of audio and events</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_semantic-markup">Semantic Markup</h5>
<div class="paragraph">
<p>If you&#x2019;re creating custom element directives, Web Components or HTML in general, use native elements wherever possible to utilize built-in events and properties. Alternatively, use ARIA to communicate semantic meaning.</p>
</div>
<div class="paragraph">
<p>HTML tags have attributes that providers extra context on what&#x2019;s being displayed on the browser. For example, the  img  tag&#x2019;s  alt  attribute lets the reader know what is being shown using a short description.However, native tags don&#x2019;t cover all cases. This is where ARIA fits in. ARIA attributes can provide context on what roles specific elements have in the application or on how elements within the document relate to each other.</p>
</div>
<div class="paragraph">
<p>A modal component can be given the  role  of dialog or alertdialog to let the browser know that that component is acting as a modal. The modal component template can use the ARIA attributes  aria-labelledby  and  aria-described  to describe to readers what the title and purpose of the modal is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">@Component({
    selector: &apos;ngc2-app&apos;,
    template: `
      &lt;ngc2-notification-button
        message=&quot;Hello!&quot;
        label=&quot;Greeting&quot;
        role=&quot;button&quot;&gt;
      &lt;/ngc2-notification-button&gt;
      &lt;ngc2-modal
        [title]=&quot;modal.title&quot;
        [description]=&quot;modal.description&quot;
        [visible]=&quot;modal.visible&quot;
        (close)=&quot;modal.close()&quot;&gt;
      &lt;/ngc2-modal&gt;
    `
})
export class AppComponent {
  constructor(private modal: ModalService) { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>notification-button.component.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">@Component({
  selector: &apos;ngc2-modal&apos;,
  template: `
    &lt;div
      role=&quot;dialog&quot;
      aria-labelledby=&quot;modal-title&quot;
      aria-describedby=&quot;modal-description&quot;&gt;
      &lt;div id=&quot;modal-title&quot;&gt;{{title}}&lt;/div&gt;
      &lt;p id=&quot;modal-description&quot;&gt;{{description}}&lt;/p&gt;
      &lt;button (click)=&quot;close.emit()&quot;&gt;OK&lt;/button&gt;
    &lt;/div&gt;
  `
})
export class ModalComponent {
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_keyboard-accessibility">Keyboard Accessibility</h5>
<div class="paragraph">
<p>Keyboard accessibility is the ability of your application to be interacted with using just a keyboard. The more streamlined the site can be used this way, the more keyboard accessible it is. Keyboard accessibility is one of the largest aspects of web accessibility since it targets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>those with motor disabilities who can&#x2019;t use a mouse</p>
</li>
<li>
<p>users who rely on screen readers and other assistive technology, which require keyboard navigation</p>
</li>
<li>
<p>those who prefer not to use a mouse</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="guide-accessibility.asciidoc_focus">Focus</h6>
<div class="paragraph">
<p>Keyboard interaction is driven by something called focus. In web applications, only one element on a document has focus at a time, and keypresses will activate whatever function is bound to that element.
Focus element border can be styled with CSS using the  outline  property, but it should not be removed. Elements can also be styled using the  :focus  psuedo-selector.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-accessibility.asciidoc_tabbing">Tabbing</h6>
<div class="paragraph">
<p>The most common way of moving focus along the page is through the  tab  key. Elements will be traversed in the order they appear in the document outline - so that order must be carefully considered during development.
There is way change the default behaviour or tab order. This can be done through the  tabindex  attribute. The  tabindex  can be given the values:
* less than zero - to let readers know that an element should be focusable but not keyboard accessible
* 0 - to let readers know that that element should be accessible by keyboard
* greater than zero - to let readers know the order in which the focusable element should be reached using the keyboard. Order is calculated from lowest to highest.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-accessibility.asciidoc_transitions">Transitions</h6>
<div class="paragraph">
<p>The majority of transitions that happen in an Angular application will not involve a page reload. This means that developers will need to carefully manage what happens to focus in these cases.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">@Component({
  selector: &apos;ngc2-modal&apos;,
  template: `
    &lt;div
      role=&quot;dialog&quot;
      aria-labelledby=&quot;modal-title&quot;
      aria-describedby=&quot;modal-description&quot;&gt;
      &lt;div id=&quot;modal-title&quot;&gt;{{title}}&lt;/div&gt;
      &lt;p id=&quot;modal-description&quot;&gt;{{description}}&lt;/p&gt;
      &lt;button (click)=&quot;close.emit()&quot;&gt;OK&lt;/button&gt;
    &lt;/div&gt;
  `,
})
export class ModalComponent {
  constructor(private modal: ModalService, private element: ElementRef) { }

  ngOnInit() {
    this.modal.visible$.subscribe(visible =&gt; {
      if(visible) {
        setTimeout(() =&gt; {
          this.element.nativeElement.querySelector(&apos;button&apos;).focus();
        }, 0);
      }
    })
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-accessibility.asciidoc_visual-assistance">18.1.2. Visual Assistance</h4>
<div class="paragraph">
<p>One large category of disability is visual impairment. This includes not just the blind, but those who are color blind or partially sighted, and require some additional consideration.</p>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_color-contrast">Color Contrast</h5>
<div class="paragraph">
<p>When choosing colors for text or elements on a website, the contrast between them needs to be considered. For WCAG 2.0 AA, this means that the contrast ratio for text or visual representations of text needs to be at least 4.5:1. There are tools online to measure the contrast ratio such as this color contrast checker from WebAIM or be checked with using automation tests.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_visual-information">Visual Information</h5>
<div class="paragraph">
<p>Color can help a user&#x2019;s understanding of information, but it should never be the only way to convey information to a user. For example, a user with red/green color-blindness may have trouble discerning at a glance if an alert is informing them of success or failure.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_audiovisual-media">Audiovisual Media</h5>
<div class="paragraph">
<p>Audiovisual elements in the application such as video, sound effects or audio (ie. podcasts) need related textual representations such as transcripts, captions or descriptions. They also should never auto-play and playback controls should be provided to the user.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-accessibility.asciidoc_accessibility-with-angular-material">18.1.3. Accessibility with Angular Material</h4>
<div class="paragraph">
<p>The <code>a11y</code> package provides a number of tools to improve accessibility. Import</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { A11yModule } from &apos;@angular/cdk/a11y&apos;;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_listkeymanager">ListKeyManager</h5>
<div class="paragraph">
<p><code>ListKeyManager</code> manages the active option in a list of items based on keyboard interaction. Intended to be used with components that correspond to a <code>role=&quot;menu&quot;</code> or <code>role=&quot;listbox&quot;</code> pattern . Any component that uses a ListKeyManager will generally do three things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a <code>@ViewChildren</code> query for the options being managed.</p>
</li>
<li>
<p>Initialize the <code>ListKeyManager</code>, passing in the options.</p>
</li>
<li>
<p>Forward keyboard events from the managed component to the <code>ListKeyManager</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each option should implement the <code>ListKeyManagerOption</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">interface ListKeyManagerOption {
  disabled?: boolean;
  getLabel?(): string;
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="guide-accessibility.asciidoc_types-of-listkeymanager">Types of ListKeyManager</h6>
<div class="paragraph">
<p>There are two varieties of <code>ListKeyManager</code>, <code>FocusKeyManager</code> and <code>ActiveDescendantKeyManager</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_focuskeymanager">FocusKeyManager</h5>
<div class="paragraph">
<p>Used when options will directly receive browser focus. Each item managed must implement the FocusableOption interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">interface FocusableOption extends ListKeyManagerOption {
  focus(): void;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_activedescendantkeymanager">ActiveDescendantKeyManager</h5>
<div class="paragraph">
<p>Used when options will be marked as active via aria-activedescendant. Each item managed must implement the Highlightable interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">interface Highlightable extends ListKeyManagerOption {
  setActiveStyles(): void;
  setInactiveStyles(): void;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each item must also have an ID bound to the listbox&#x2019;s or menu&#x2019;s aria-activedescendant.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_focustrap">FocusTrap</h5>
<div class="paragraph">
<p>The <code>cdkTrapFocus</code> directive traps Tab key focus within an element. This is intended to be used to create accessible experience for components like modal dialogs, where focus must be constrained. This directive is declared in <code>A11yModule</code>.</p>
</div>
<div class="paragraph">
<p>This directive will not prevent focus from moving out of the trapped region due to mouse interaction.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-HTML" data-lang="HTML">&lt;div class=&quot;my-inner-dialog-content&quot; cdkTrapFocus&gt;
  &lt;!-- Tab and Shift + Tab will not leave this element. --&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_regions">Regions</h5>
<div class="paragraph">
<p>Regions can be declared explicitly with an initial focus element by using the <code>cdkFocusRegionStart</code>, <code>cdkFocusRegionEnd</code> and <code>cdkFocusInitial</code> DOM attributes. When using the tab key, focus will move through this region and wrap around on either end.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-HTML" data-lang="HTML">&lt;a mat-list-item routerLink cdkFocusRegionStart&gt;Focus region start&lt;/a&gt;
&lt;a mat-list-item routerLink&gt;Link&lt;/a&gt;
&lt;a mat-list-item routerLink cdkFocusInitial&gt;Initially focused&lt;/a&gt;
&lt;a mat-list-item routerLink cdkFocusRegionEnd&gt;Focus region end&lt;/a&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_interactivitychecker">InteractivityChecker</h5>
<div class="paragraph">
<p><code>InteractivityChecker</code> is used to check the interactivity of an element, capturing disabled, visible, tabbable, and focusable states for accessibility purposes.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_liveannouncer">LiveAnnouncer</h5>
<div class="paragraph">
<p><code>LiveAnnouncer</code> is used to announce messages for screen-reader users using an aria-live region.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-HTML" data-lang="HTML">@Component({...})
export class MyComponent {

 constructor(liveAnnouncer: LiveAnnouncer) {
   liveAnnouncer.announce(&quot;Hey Google&quot;);
 }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_api-reference-for-angular-cdk-a11y">API reference for Angular CDK a11y</h5>
<div class="paragraph">
<p><a href="https://material.angular.io/cdk/a11y/api">API reference for Angular CDK a11y</a></p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-elements.asciidoc">18.2. Angular Elements</h3>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_what-are-angular-elements">18.2.1. What are Angular Elements?</h4>
<div class="paragraph">
<p><a href="https://angular.io/guide/elements">Angular elements</a> are Angular components packaged as custom elements, a web standard for defining new HTML elements in a framework-agnostic way.</p>
</div>
<div class="paragraph">
<p>Custom elements are a Web Platform feature currently supported by Chrome, Firefox, Opera, and Safari, and available in other browsers through <a href="https://angular.io/guide/elements#browser-support">Polyfills</a>. A custom element extends HTML by allowing you to define a tag whose content is created and controlled by JavaScript code. The browser maintains a CustomElementRegistry of defined custom elements (also called Web Components), which maps an instantiable JavaScript class to an HTML tag.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_why-use-angular-elements">18.2.2. Why use Angular Elements?</h4>
<div class="paragraph">
<p>Angular Elements allows Angular to work with different frameworks by using input and output elements. This allows Angular to work with many different frameworks if needed. This is an ideal situation if a slow transformation of an application to <code>Angular</code> is needed or some Angular needs to be added in other web applications(For example. <code>ASP.net</code>, <code>JSP</code> etc )</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_negative-points-about-elements">18.2.3. Negative points about Elements</h4>
<div class="paragraph">
<p>Angular Elements is really powerful but since, the transition between views between views is going to be handled by another framework or html/javascript, using Angular <code>Router</code> is not possible. the view transitions have to be handled manually. This fact also eliminates the possibility of just porting an application completely.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_how-to-use-angular-elements">18.2.4. How to use Angular Elements?</h4>
<div class="paragraph">
<p>In a generalized way, a simple <code>Angular component</code> could be transformed to an <code>Angular Element</code> with this steps:</p>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_installing-angular-elements">Installing Angular Elements</h5>
<div class="paragraph">
<p>The first step is going to be install the library using our prefered packet manager:</p>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_npm">NPM</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>npm install @angular/elements</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_yarn">YARN</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yarn add @angular/elements</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_preparing-the-components-in-the-modules">Preparing the components in the modules</h5>
<div class="paragraph">
<p>Inside the <code>app.module.ts</code>, in addition to the normal declaration of the components inside <code>declarations</code>, the modules inside <code>imports</code> and the services inside <code>providers</code>, the components need to added in <code>entryComponents</code>. If there are components that have their own module, the same logic is going to be applied for them, only adding in the <code>app.module.ts</code> the components that dont have their own module. Here is an example of this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">....
@NgModule({
  declarations: [
    DishFormComponent,
    DishViewComponent
  ],
  imports: [
    CoreModule,  // Module containing Angular Materials
    FormsModule
  ],
  entryComponents: [
    DishFormComponent,
    DishViewComponent
  ],
  providers: [DishShareService]
})
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that is done, the constructor of the module is going to be modified to use injector and boostrap the application defining the components. This is going to allow the <code>Angular Element</code> to get the injections and to define a component tag that will be used later:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">....
})
export class AppModule {
  constructor(private injector: Injector) {

  }

  ngDoBootstrap() {
    const el = createCustomElement(DishFormComponent, {injector: this.injector});
    customElements.define(&apos;dish-form&apos;, el);

    const elView = createCustomElement(DishViewComponent, {injector: this.injector});
    customElements.define(&apos;dish-view&apos;, elView);
  }
}
....</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_a-component-example">A component example</h5>
<div class="paragraph">
<p>In order to be able to use a component, <code>@Input()</code> and <code>@Output()</code> variables are used. These variables are going to be the ones that will allow the Angular Element to communicate with the framework/javascript:</p>
</div>
<div class="paragraph">
<p>Component html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;mat-card&gt;
    &lt;mat-grid-list cols=&quot;1&quot; rowHeight=&quot;100px&quot; rowWidth=&quot;50%&quot;&gt;
				&lt;mat-grid-tile colspan=&quot;1&quot; rowspan=&quot;1&quot;&gt;
					&lt;span&gt;{{ platename }}&lt;/span&gt;
				&lt;/mat-grid-tile&gt;
				&lt;form (ngSubmit)=&quot;onSubmit(dishForm)&quot; #dishForm=&quot;ngForm&quot;&gt;
					&lt;mat-grid-tile colspan=&quot;1&quot; rowspan=&quot;1&quot;&gt;
						&lt;mat-form-field&gt;
							&lt;input matInput placeholder=&quot;Name&quot; name=&quot;name&quot; [(ngModel)]=&quot;dish.name&quot;&gt;
						&lt;/mat-form-field&gt;
					&lt;/mat-grid-tile&gt;
					&lt;mat-grid-tile colspan=&quot;1&quot; rowspan=&quot;1&quot;&gt;
						&lt;mat-form-field&gt;
							&lt;textarea matInput placeholder=&quot;Description&quot; name=&quot;description&quot; [(ngModel)]=&quot;dish.description&quot;&gt;&lt;/textarea&gt;
						&lt;/mat-form-field&gt;
					&lt;/mat-grid-tile&gt;
					&lt;mat-grid-tile colspan=&quot;1&quot; rowspan=&quot;1&quot;&gt;
						&lt;button mat-raised-button color=&quot;primary&quot; type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
					&lt;/mat-grid-tile&gt;
				&lt;/form&gt;
		&lt;/mat-grid-list&gt;
&lt;/mat-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Component ts</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">@Component({
  templateUrl: &apos;./dish-form.component.html&apos;,
  styleUrls: [&apos;./dish-form.component.scss&apos;]
})
export class DishFormComponent implements OnInit {

  @Input() platename;

  @Input() platedescription;

  @Output()
  submitDishEvent = new EventEmitter();

  submitted = false;
  dish = {name: &apos;&apos;, description: &apos;&apos;};

  constructor(public dishShareService: DishShareService) { }

  ngOnInit() {
    this.dish.name = this.platename;
    this.dish.description = this.platedescription;
  }

  onSubmit(dishForm: NgForm): void {
    this.dishShareService.createDish(dishForm.value.name, dishForm.value.description);
    this.submitDishEvent.emit(&apos;dishSubmited&apos;);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this file there are definitions of multiple variables that will be used as input and output. Since the input variables are going to be used directly by html, only lowercase and underscore strategies can be used for them. On the <code>onSubmit(dishForm: NgForm)</code> a service is used to pass this variables to another component. Finally, as a last thing, the selector inside <code>@Component</code> has been removed since a tag that will be used dynamically was already defined in the last step.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_solving-the-error">Solving the error</h5>
<div class="paragraph">
<p>In order to be able to use this <code>Angular Element</code> a <code>Polyfills</code>/<code>Browser support</code> related error needs to solved. This error can be solved in two ways:</p>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_changing-the-target">Changing the target</h7>
<div class="paragraph">
<p>One solution is to change the target in <code>tsconfig.json</code> to <code>es2015</code>. This might not be doable for every application since maybe a specific target is required.</p>
</div>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_installing-polyfaces">Installing Polyfaces</h7>
<div class="paragraph">
<p>Another solution is to use AutoPollyfill. In order to do so, the library is going to be installed with a packet manager:</p>
</div>
<div class="paragraph">
<p>Yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yarn add @webcomponents/webcomponentsjs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>npm install @webcomponents/webcomponentsjs</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the packet manager has finished, inside the src folder a new file <code>polyfills.ts</code> is found. To solve the error, importing the corresponding adapter (<code>custom-elements-es5-adapter.js</code>) is necessary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">....
/***************************************************************************************************
 * APPLICATION IMPORTS
 */

import &apos;@webcomponents/webcomponentsjs/custom-elements-es5-adapter.js&apos;;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to learn more about polyfills in angular you can do it <a href="https://angular.io/guide/browser-support">here</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_building-the-angular-element">Building the Angular Element</h5>
<div class="paragraph">
<p>First, before building the <code>Angular Element</code>, every element inside that app component except the module need to be removed. After that, a bash script is created in the root folder,. This script will allow to put every necessary file into a js.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ng build &quot;projectName&quot; --prod --output-hashing=none &amp;&amp; cat dist/&quot;projectName&quot;/runtime.js dist/&quot;projectName&quot;/polyfills.js dist/&quot;projectName&quot;/scripts.js dist/&quot;projectName&quot;/main.js &gt; ./dist/&quot;projectName&quot;/&quot;nameWantedAngularElement&quot;.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>After executing the bash script, it will generate inside the path <code>dist/&quot;projectName&quot;</code> a js file named <code>&quot;nameWantedAngularElement&quot;.js</code> and a css file.</p>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_building-with-ngx-build-plus-recommended">Building with ngx-build-plus (Recommended)</h7>
<div class="paragraph">
<p>The library <a href="https://github.com/manfredsteyer/ngx-build-plus">ngx-build-plus</a> allows to add different options when building. In addition, it solves some errors that will occur when trying to use multiple angular elements in an application. In order to use it, yarn or npm can be used:</p>
</div>
<div class="paragraph">
<p>Yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yarn add ngx-build-plus</code></pre>
</div>
</div>
<div class="paragraph">
<p>Npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>npm install ngx-build-plus</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to add it to a specific sub project in your projects folder, use the --project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>.... ngx-build-plus --project &quot;project-name&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this library and the following command, an isolated <code>Angular Element</code> which won&#x2019;t have conflict with others can be generated. This <code>Angular Element</code> will not have a polyfill so, the project where we use them will need to include a <code>poliyfill</code> with the <code>Angular Element</code> requirements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ng build &quot;projectName&quot; --output-hashing none --single-bundle true --prod --bundle-styles false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate three things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The main js bundle</p>
</li>
<li>
<p>The script js</p>
</li>
<li>
<p>The css</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These files will be used later instead of the single js generated in the last step.</p>
</div>
<div class="sect7">
<h8 id="guide-angular-elements.asciidoc_extra-parameters">Extra parameters</h8>
<div class="paragraph">
<p>Here are some extra useful parameters that <code>ngx-build-plus</code> provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--keep-polyfills</code>: This paremeter is going to allow us to keep the polyfills. This needs to be used with caution, avoiding using multiple different polyfills that could cause an error is necessary.</p>
</li>
<li>
<p><code>--extraWebpackConfig webpack.extra.js</code>: This parameter allows us to create a javascript file inside our <code>Angular Elements</code> project with the name of different libraries. Using <code>webpack</code> these libraries will not be included in the <code>Angular Element</code>. This is useful to lower the size of our <code>Angular Element</code> by removing libraries shared. Example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const webpack = require(&apos;webpack&apos;);

module.exports = {
    &quot;externals&quot;: {
        &quot;rxjs&quot;: &quot;rxjs&quot;,
        &quot;@angular/core&quot;: &quot;ng.core&quot;,
        &quot;@angular/common&quot;: &quot;ng.common&quot;,
        &quot;@angular/common/http&quot;: &quot;ng.common.http&quot;,
        &quot;@angular/platform-browser&quot;: &quot;ng.platformBrowser&quot;,
        &quot;@angular/platform-browser-dynamic&quot;: &quot;ng.platformBrowserDynamic&quot;,
        &quot;@angular/compiler&quot;: &quot;ng.compiler&quot;,
        &quot;@angular/elements&quot;: &quot;ng.elements&quot;,
        &quot;@angular/router&quot;: &quot;ng.router&quot;,
        &quot;@angular/forms&quot;: &quot;ng.forms&quot;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="literalblock">
<div class="content">
<pre>If some libraries are excluded from the `Angular Element` you will need to add the bundled umd files of those libraries manually.</pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_using-the-angular-element">Using the Angular Element</h5>
<div class="paragraph">
<p>The <code>Angular Element</code> that got generated in the last step can be used in almost every framework. In this case, the <code>Angular Element</code> is going to be used in html:</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. Sample index.html version without ngx-build-plus</div>
<div class="content">
<pre class="highlight"><code class="language-HTML" data-lang="HTML">&lt;html&gt;
    &lt;head&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id=&quot;container&quot;&gt;

        &lt;/div&gt;
        &lt;!--Use of the element non dynamically--&gt;
        &lt;!--&lt;plate-form platename=&quot;test&quot; platedescription=&quot;test&quot;&gt;&lt;/plate-form&gt;--&gt;
        &lt;script src=&quot;./devon4ngAngularElements.js&quot;&gt; &lt;/script&gt;
        &lt;script&gt;
                var elContainer = document.getElementById(&apos;container&apos;);
                var el= document.createElement(&apos;dish-form&apos;);
                el.setAttribute(&apos;platename&apos;,&apos;test&apos;);
                el.setAttribute(&apos;platedescription&apos;,&apos;test&apos;);
                el.addEventListener(&apos;submitDishEvent&apos;,(ev)=&gt;{
                    var elView= document.createElement(&apos;dish-view&apos;);
                    elContainer.innerHTML = &apos;&apos;;
                    elContainer.appendChild(elView);
                });
                elContainer.appendChild(el);
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 18. Sample index.html version with ngx-build-plus</div>
<div class="content">
<pre class="highlight"><code class="language-HTML" data-lang="HTML">&lt;html&gt;
    &lt;head&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id=&quot;container&quot;&gt;

        &lt;/div&gt;
        &lt;!--Use of the element non dynamically--&gt;
        &lt;!--&lt;plate-form platename=&quot;test&quot; platedescription=&quot;test&quot;&gt;&lt;/plate-form&gt;--&gt;
         &lt;script src=&quot;./polyfills.js&quot;&gt; &lt;/script&gt; &lt;!-- Created using --keep-polyfills options --&gt;
        &lt;script src=&quot;./scripts.js&quot;&gt; &lt;/script&gt;
         &lt;script src=&quot;./main.js&quot;&gt; &lt;/script&gt;
        &lt;script&gt;
                var elContainer = document.getElementById(&apos;container&apos;);
                var el= document.createElement(&apos;dish-form&apos;);
                el.setAttribute(&apos;platename&apos;,&apos;test&apos;);
                el.setAttribute(&apos;platedescription&apos;,&apos;test&apos;);
                el.addEventListener(&apos;submitDishEvent&apos;,(ev)=&gt;{
                    var elView= document.createElement(&apos;dish-view&apos;);
                    elContainer.innerHTML = &apos;&apos;;
                    elContainer.appendChild(elView);
                });
                elContainer.appendChild(el);
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this html, the css generated in the last step is going to be imported inside the <code>&lt;head&gt;</code> and then, the javascript element is going to be imported at the end of the body. After that is done, There is two uses of <code>Angular Elements</code> in the html, one directly whith use of the <code>@input()</code> variables as parameters commented in the html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">....
        &lt;!--Use of the element non dynamically--&gt;
        &lt;!--&lt;plate-form platename=&quot;test&quot; platedescription=&quot;test&quot;&gt;&lt;/plate-form&gt;--&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>and one dynamically inside the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">....
        &lt;script&gt;
                var elContainer = document.getElementById(&apos;container&apos;);
                var el= document.createElement(&apos;dish-form&apos;);
                el.setAttribute(&apos;platename&apos;,&apos;test&apos;);
                el.setAttribute(&apos;platedescription&apos;,&apos;test&apos;);
                el.addEventListener(&apos;submitDishEvent&apos;,(ev)=&gt;{
                    var elView= document.createElement(&apos;dish-view&apos;);
                    elContainer.innerHTML = &apos;&apos;;
                    elContainer.appendChild(elView);
                });
                elContainer.appendChild(el);
        &lt;/script&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>This javascript is an example of how to create dynamically an <code>Angular Element</code> inserting attributed to fill our <code>@Input()</code> variables and listen to the <code>@Output()</code> that was defined earlier. This is done with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">                el.addEventListener(&apos;submitDishEvent&apos;,(ev)=&gt;{
                    var elView= document.createElement(&apos;dish-view&apos;);
                    elContainer.innerHTML = &apos;&apos;;
                    elContainer.appendChild(elView);
                });</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows javascript to hook with the <code>@Output()</code> event emitter that was defined. When this event gets called, another component that was defined gets inserted dynamically.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_angular-element-within-another-angular-project">18.2.5. Angular Element within another Angular project</h4>
<div class="paragraph">
<p>In order to use an <code>Angular Element</code> within another <code>Angular</code> project the following steps need to be followed:</p>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_copy-bundled-script-and-css-to-resources">Copy bundled script and css to resources</h5>
<div class="paragraph">
<p>First copy the generated <code>.js</code> and <code>.css</code> inside assets in the corresponding folder.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_add-bundled-script-to-angular.json">Add bundled script to angular.json</h5>
<div class="paragraph">
<p>Inside <code>angular.json</code> both of the files that were copied in the last step are going to be included. This will be done both, in <code>test</code> and in <code>build</code>. Including it on the test, will allow to perform unitary tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
....
  &quot;architect&quot;: {
    ....
    &quot;build&quot;: {
      ....
      &quot;styles&quot;: [
        ....
          &quot;src/assets/css/devon4ngAngularElements.css&quot;
        ....
      ]
      ....
      &quot;scripts&quot;: [
        &quot;src/assets/js/devon4ngAngularElements.js&quot;
      ]
      ....
    }
    ....
    &quot;test&quot;: {
      ....
      &quot;styles&quot;: [
        ....
          &quot;src/assets/css/devon4ngAngularElements.css&quot;
        ....
      ]
      ....
      &quot;scripts&quot;: [
        &quot;src/assets/js/devon4ngAngularElements.js&quot;
      ]
      ....
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By declaring the files in the <code>angular.json</code> angular will take care of including them in a proper way.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_using-angular-element">Using Angular Element</h5>
<div class="paragraph">
<p>There are two ways that <code>Angular Element</code> can be used:</p>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_create-component-dynamicly">Create component dynamicly</h7>
<div class="paragraph">
<p>In order to add the component in a dynamic way, first adding a container is necessary:</p>
</div>
<div class="paragraph">
<p><code>app.component.html</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">....
&lt;div id=&quot;container&quot;&gt;
&lt;/div&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this container created, inside the <code>app.component.ts</code> a method is going to be created. This method is going to find the container, create the dynamic element and append it into the container.</p>
</div>
<div class="paragraph">
<p><code>app.component.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">export class AppComponent implements OnInit {
  ....
  ngOnInit(): void {
    this.createComponent();
  }
  ....
  createComponent(): void {
    const container = document.getElementById(&apos;container&apos;);
    const component = document.createElement(&apos;dish-form&apos;);
    container.appendChild(component);
  }
  ....</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_using-it-directly">Using it directly</h7>
<div class="paragraph">
<p>In order to use it directly on the templates, in the <code>app.module.ts</code> the <code>CUSTOM_ELEMENTS_SCHEMA</code> needs to be added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">....
import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from &apos;@angular/core&apos;;
....
@NgModule({
  ....
  schemas: [ CUSTOM_ELEMENTS_SCHEMA ],</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is going to allow the use of the <code>Angular Element</code> in the templates directly:</p>
</div>
<div class="paragraph">
<p><code>app.component.html</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">....
&lt;div id=&quot;container&quot;&gt;
  &lt;dish-form&gt;&lt;/dish-form&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-lazy-loading.asciidoc">18.3. Angular Lazy loading</h3>
<div class="paragraph">
<p>When the development of an application starts, it just contains a small set of features so the app usually loads fast. However, as new features are added, the overall application size grows up  and its loading speed decreases, is in this context where Lazy loading finds its place.
Lazy loading is a dessign pattern that defers initialization of objects until it is needed so, for example, Users that just access to a website&#x2019;s home page do not need to have other areas loaded.
Angular handles lazy loading through the routing module which redirect to requested pages. Those pages can be loaded at start or on demand.</p>
</div>
<div class="sect3">
<h4 id="guide-angular-lazy-loading.asciidoc_an-example-with-angular">18.3.1. An example with Angular</h4>
<div class="paragraph">
<p>To explain how lazy loading is implemented using angular, a basic sample app is going to be developed. This app will consist in a window named &quot;level 1&quot; that contains two buttons that redirects to other windows in a &quot;second level&quot;. It is a simple example, but useful to understand the relation between angular modules and lazy loading.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/levels-app.png" alt="Levels app structure" width="500 link=" images angular angular-lazy levels-app.png"">
</div>
<div class="title">Figure 19. Levels app structure.</div>
</div>
<div class="paragraph">
<p>This graphic shows that modules acts as gates to access components &quot;inside&quot; them.</p>
</div>
<div class="paragraph">
<p>Because the objective of this guide is related mainly with logic, the html structure and scss styles are less relevant, but the complete code can be found as a sample <a href="https://github.com/devonfw/devon4ng/tree/master/samples/AngularLazyLoading">here</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-angular-lazy-loading.asciidoc_implementation">Implementation</h5>
<div class="paragraph">
<p>First write in a console <code>ng new level-app --routing</code>, to generate a new project called level-app including an app-routing.module.ts file (<strong>--routing</strong> flag).</p>
</div>
<div class="paragraph">
<p>In the file app.component.html delete all the content except the router-outlet tag.</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. File app.component.html</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;router-outlet&gt;&lt;/router-outlet&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next steps consists on creating features modules.</p>
</div>
<div class="paragraph">
<p>run <code>ng generate module first --routing</code>  to generate a module named <em>first</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>run <code>ng generate module first/second-left --routing</code> to generate a module named <em>second-left</em> under <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate module first/second-right --routing</code> to generate a module <em>second-right</em> under <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate component first/first</code> to generate a component named <em>first</em> inside the module <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate component first/second-left/content</code> to generate a component <em>content</em> inside the module <em>second-left</em>.</p>
</li>
<li>
<p>run <code>ng generate component first/second-right/content</code> to generate a component <em>content</em> inside the module <em>second-right</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To move between components we have to configure the routes used:</p>
</div>
<div class="paragraph">
<p>In <strong>app-routing.module.ts</strong> add a path <strong>&apos;first&apos;</strong> to FirstComponent and a redirection from <strong>&apos;&apos;</strong> to <strong>&apos;first&apos;</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 20. File app-routing.module.ts.</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">...
import { FirstComponent } from &apos;./first/first/first.component&apos;;

const routes: Routes = [
  {
    path: &apos;first&apos;,
    component: FirstComponent
  },
  {
    path: &apos;&apos;,
    redirectTo: &apos;first&apos;,
    pathMatch: &apos;full&apos;,
  },
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule],
})
export class AppRoutingModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <strong>app.module.ts</strong> import the module which includes FirstComponent.</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. File app.module.ts</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">....
import { FirstModule } from &apos;./first/first.module&apos;;

@NgModule({
  ...
  imports: [
    ....
    FirstModule
  ],
  ...
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <strong>first-routing.module.ts</strong> add routes that direct to the content of SecondRightModule and SecondLeftModule. The content of both modules have the same name so, in order to avoid conflicts the name of the components are going to be changed using <strong>as</strong> ( original-name as new-name).</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. File first-routing.module.ts</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">...
import { ContentComponent as ContentLeft} from &apos;./second-left/content/content.component&apos;;
import { ContentComponent as ContentRight} from &apos;./second-right/content/content.component&apos;;
import { FirstComponent } from &apos;./first/first.component&apos;;

const routes: Routes = [
  {
    path: &apos;&apos;,
    component: FirstComponent
  },
  {
    path: &apos;first/second-left&apos;,
    component: ContentLeft
  },
  {
    path: &apos;first/second-right&apos;,
    component: ContentRight
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class FirstRoutingModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In first.module.ts import SecondLeftModule and SecondRightModule.</p>
</div>
<div class="listingblock">
<div class="title">Listing 23. File first.module.ts</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">...
import { SecondLeftModule } from &apos;./second-left/second-left.module&apos;;
import { SecondRightModule } from &apos;./second-right/second-right.module&apos;;

@NgModule({
  ...
  imports: [
    ...
    SecondLeftModule,
    SecondRightModule,
  ]
})
export class FirstModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the current configuration, we have a project that loads all the modules in a eager way. Run <code>ng serve</code> to see what happens.</p>
</div>
<div class="paragraph">
<p>First, during the compilation we can see that just a main file is built.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/compile-eager.png" alt="Compile eager" width="800 link=" images angular angular-lazy compile-eager.png"">
</div>
<div class="title">Figure 20. Compile eager.</div>
</div>
<div class="paragraph">
<p>If we go to http//localhost:4200/first and open developer options (F12 on Chrome), it is found that a document named &quot;first&quot; is loaded.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/first-lvl-eager.png" alt="First level eager" width="800 link=" images angular angular-lazy first-lvl-eager.png"">
</div>
<div class="title">Figure 21. First level eager.</div>
</div>
<div class="paragraph">
<p>If we click on <strong>[Go to right module]</strong> a second level module opens, but there is no &apos;second-right&apos; document.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/second-lvl-right-eager.png" alt="Second level right eager" width="800 link=" images angular angular-lazy second-lvl-right-eager.png"">
</div>
<div class="title">Figure 22. Second level right eager.</div>
</div>
<div class="paragraph">
<p>But, typing the url directly will load &apos;second-right&apos; but no &apos;first&apos;, even if we click on <strong>[Go back]</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/second-lvl-right-eager-d.png" alt="Second level right eager" width="800 link=" images angular angular-lazy second-lvl-right-eager-d.png"">
</div>
<div class="title">Figure 23. Second level right eager direct url.</div>
</div>
<div class="paragraph">
<p>Modifying an angular application to load its modules lazily is easy, you have to change the routing configuration of the desired module (for example FirstModule).</p>
</div>
<div class="listingblock">
<div class="title">Listing 24. File app-routing.module.ts.</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">const routes: Routes = [
  {
    path: &apos;first&apos;,
    loadChildren: () =&gt; import(&apos;./first/first.module&apos;).then(m =&gt; m.FirstModule),
  },
  {
    path: &apos;&apos;,
    redirectTo: &apos;first&apos;,
    pathMatch: &apos;full&apos;,
  },
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule],
})
export class AppRoutingModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that instead of loading a component, you dynamically import it in a <em>loadChildren</em> attribute because modules acts as gates to access components &quot;inside&quot; them. Updating the app to load lazily has four consecuences:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>No component attribute.</p>
</li>
<li>
<p>No import of FirstComponent.</p>
</li>
<li>
<p>FirstModule import has to be removed from the imports array at app.module.ts.</p>
</li>
<li>
<p>Change of context.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If we check <strong>first-routing.module.ts</strong> again, the can see that the path for ContentLeft and ContentRight is set to &apos;first/second-left&apos; and &apos;first/second-right&apos; respectively, so writing &apos;http//localhost:4200/first/second-left&apos; will redirect us to ContentLeft. However, after loading a module with loadChildren setting the path to &apos;<em>second-left</em>&apos; and &apos;<em>second-right</em>&apos; is enough because it adquires the context set by AppRoutingModule.</p>
</div>
<div class="listingblock">
<div class="title">Listing 25. File first-routing.module.ts</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">const routes: Routes = [
  {
    path: &apos;&apos;,
    component: FirstComponent
  },
  {
    path: &apos;second-left&apos;,
    component: ContentLeft
  },
  {
    path: &apos;second-right&apos;,
    component: ContentRight
  }
];</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we go to &apos;<em>first</em>&apos; then FirstModule is situated in &apos;<em>/first</em>&apos; but also its children ContentLeft and ContentRight, so it is not necessary to write in their path &apos;<em>first/second-left</em>&apos; and &apos;<em>first/second-right</em>&apos;, because that will situate the components on &apos;<em>first/first/second-left</em>&apos; and  &apos;<em>first/first/second-right</em>&apos;.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/first-lvl-wrong-path.png" alt="First level wrong path" width="800 link=" images angular angular-lazy first-lvl-wrong-path.png"">
</div>
<div class="title">Figure 24. First level lazy wrong path.</div>
</div>
<div class="paragraph">
<p>When we compile an app with lazy loaded modules, files containing them will be generated</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/compile-first-lazy.png" alt="First level lazy compilation" width="800 link=" images angular angular-lazy compile-first-lazy.png"">
</div>
<div class="title">Figure 25. First level lazy compilation.</div>
</div>
<div class="paragraph">
<p>And if we go to <em>developer tools &#x2192; network</em>, we can find those modules loaded (if they are needed).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/first-lvl-lazy.png" alt="First level lazy" width="800 link=" images angular angular-lazy first-lvl-lazy.png"">
</div>
<div class="title">Figure 26. First level lazy.</div>
</div>
<div class="paragraph">
<p>To load the component ContentComponent of SecondLeftModule lazily, we have to load SecondLeftModule as a children of FirstModule:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change <strong>component</strong> to <strong>loadChildren</strong> and reference SecondLeftModule.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 26. File first-routing.module.ts.</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">const routes: Routes = [
  {
    path: &apos;&apos;,
    component: FirstComponent
  },
  {
    path: &apos;second-left&apos;,
    loadChildren: () =&gt; import(&apos;./second-left/second-left.module&apos;).then(m =&gt; m.SecondLeftModule),
  },
  {
    path: &apos;second-right&apos;,
    component: ContentRight
  }
];</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove SecondLeftModule at first.component.ts</p>
</li>
<li>
<p>Route the components inside SecondLeftModule. Without this step nothing would be displayed.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 27. File second-left-routing.module.ts.</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">...
import { ContentComponent } from &apos;./content/content.component&apos;;

const routes: Routes = [
  {
    path: &apos;&apos;,
    component: ContentComponent
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class SecondLeftRoutingModule { }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>run <code>ng serve</code> to generate files containing the lazy modules.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/second-lvl-lazy.png" alt="Second level lazy" width="800 link=" images angular angular-lazy second-lvl-lazy.png"">
</div>
<div class="title">Figure 27. Second level lazy loading compilation.</div>
</div>
<div class="paragraph">
<p>Clicking on <strong>[Go to left module]</strong> triggers the load of SecondLeftModule.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-lazy/second-lvl-left-lazy.png" alt="Second level lazy network" width="800 link=" images angular angular-lazy second-lvl-left-lazy.png"">
</div>
<div class="title">Figure 28. Second level lazy loading network.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-lazy-loading.asciidoc_conclusion">18.3.2. Conclusion</h4>
<div class="paragraph">
<p>Lazy loading is a pattern useful when new features are added, these features are usually identified as modules which can be loaded only if needed as shown in this document, reducing the time spent loading an application.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-library.asciidoc">18.4. Angular Library</h3>
<div class="paragraph">
<p><code>Angular CLI</code> provides us with methods that allow the creation of a library. After that, using either packet manager (<code>npm</code> or <code>yarn</code>) the library can be build and packed which will allow later to install/publish it.</p>
</div>
<div class="sect3">
<h4 id="guide-angular-library.asciidoc_whats-a-library">18.4.1. Whats a library?</h4>
<div class="paragraph">
<p>From <a href="https://en.wikipedia.org/wiki/Library_(computing)">wikipedia</a>: a library is a collection of non-volatile resources used by computer programs, often for software development. These may include configuration data, documentation, help data, message templates, pre-written code and subroutines, classes, values or type specifications.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-library.asciidoc_how-to-build-a-library">18.4.2. How to build a library</h4>
<div class="paragraph">
<p>In this section, a library is going to be build step by step.</p>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_creating-an-empty-application">Creating an empty application</h5>
<div class="paragraph">
<p>First, using <code>Angular CLI</code> we are going to generate a empty application which will be later filled with the generated library. In order to do so, <code>Angular CLI</code> allows us to add to <code>ng new &quot;application-name&quot;</code> an option (<code>--create-application</code>). This option is going to tell <code>Angular CLI</code> not to create the initial <code>app</code> project. This is convenient since a library is going to be generated in later steps. Using this command <code>ng new &quot;application-name&quot; --create-application=false</code> an empty project with the name wanted is created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ng new &quot;application-name&quot; --create-application=false</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_generating-a-library">Generating a library</h5>
<div class="paragraph">
<p>After generating an empty application, a library is going to be generated. Inside the folder of the project, the <code>Angular CLI</code> command <code>ng generate library &quot;library-name&quot;</code> is going to generate the library as a project (<code>projects/&quot;library-name&quot;</code>). As an addition, the option <code>--prefix=&quot;library-prefix-wanted&quot;</code> allows us to switch the default prefix that Angular generated with (<code>lib</code>). Using the option to change the prefix the command will look like this <code>ng generate library &quot;library-name&quot; --prefix=&quot;library-prefix-wanted&quot;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ng generate library &quot;library-name&quot; --prefix=&quot;library-prefix-wanted&quot;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_generatingmodifying-in-our-library">Generating/Modifying in our library</h5>
<div class="paragraph">
<p>In the last step we generated a library. This generates automaticly a <code>module</code>,<code>service</code> and <code>component</code> inside (<code>projects/&quot;library-name&quot;</code>) that we can modify adding new methods, components etc that we want to use in other projects. We can generate other elements, using the usual <code>Angular CLI</code> generate commands adding the option <code>--project=&quot;library-name&quot;</code> is going to allow to generate elements within our project . An example of this is: <code>ng generate service &quot;name&quot; --project=&quot;library-name&quot;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ng generate &quot;element&quot; &quot;name&quot; --project=&quot;library-name&quot;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_exporting-the-generated-things">Exporting the generated things</h5>
<div class="paragraph">
<p>Inside the library (<code>projects/&quot;library-name</code>) theres a <code>public_api.ts</code> which is the file that exports the elements inside the library. In case we generated other things, that file needs to be modified adding the extra exports with the generated elements. In addition, changing the library version is possible in the file <code>package.json</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_building-our-library">Building our library</h5>
<div class="paragraph">
<p>Once we added the necessary exports, in order to use the library in other applications, we need to build the library. The command <code>ng build &quot;library-name&quot;</code> is going to build the library, generating in <code>&quot;project-name&quot;/dist/&quot;library-name&quot;</code> the necessary files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ng build &quot;library-name&quot;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_packing-the-library">Packing the library</h5>
<div class="paragraph">
<p>In this step we are going to pack the build library. In order to do so, we need to go inside <code>dist/&quot;library-name&quot;</code> and then run either <code>npm pack</code> or <code>yarn pack</code> to generate a <code>&quot;library-name-version.tgz&quot;</code> file.</p>
</div>
<div class="listingblock">
<div class="title">Listing 28. Packing using npm</div>
<div class="content">
<pre class="highlight"><code>npm pack</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 29. Packing using yarn</div>
<div class="content">
<pre class="highlight"><code>yarn pack</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_publishing-to-npm-repository-optional">Publishing to npm repository (optional)</h5>
<div class="ulist">
<ul>
<li>
<p>Add a <em>README.md</em> and <em>LICENSE</em> file. The text inside <em>README.md</em> will be used in you npm package web page as documentation.</p>
</li>
<li>
<p>run <code>npm adduser</code> if you do not have a npm account to create it, otherwise run <code>npm login</code> and introduce your credentials.</p>
</li>
<li>
<p>run <code>npm publish</code> inside <code>dist/&quot;library-name&quot;</code> folder.</p>
</li>
<li>
<p>Check that the library is published: <a href="https://npmjs.com/package/library-name" class="bare">https://npmjs.com/package/library-name</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_installing-our-library-in-other-projects">Installing our library in other projects</h5>
<div class="paragraph">
<p>In this step we are going to install/add the library on other projects.</p>
</div>
<div class="sect5">
<h6 id="guide-angular-library.asciidoc_npm">npm</h6>
<div class="paragraph">
<p>In order to add the library in other applications, there are two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Option 1</strong>: From inside the application where the library is going to get used, using the command <code>npm install &quot;path-to-tgz&quot;/&quot;library-name-version.tgz&quot;</code> allows us to install the <code>.tgz</code> generated in <a href="#guide-angular-library.asciidoc_id-packing-library">Packing the library</a>.</p>
</li>
<li>
<p><strong>Option 2</strong>: run <code>npm install &quot;library-name&quot;</code> to install it from npm repository.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="guide-angular-library.asciidoc_yarn">yarn</h6>
<div class="paragraph">
<p>To add the package using yarn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Option 1</strong>: From inside the application where the library is going to get used, using the command <code>yarn add &quot;path-to-tgz&quot;/&quot;library-name-version.tgz&quot;</code> allows us to install the <code>.tgz</code>  generated in <a href="#guide-angular-library.asciidoc_id-packing-library">Packing the library</a>.</p>
</li>
<li>
<p><strong>Option 2</strong>: run <code>yarn add &quot;library-name&quot;</code> to install it from npm repository.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_using-the-library">Using the library</h5>
<div class="paragraph">
<p>Finally, once the library was installed with either packet manager, you can start using the elements from inside like they would be used in a normal element inside the application. Example <code>app.component.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { Component, OnInit } from &apos;@angular/core&apos;;
import { MyLibraryService } from &apos;my-library&apos;;

@Component({
  selector: &apos;app-root&apos;,
  templateUrl: &apos;./app.component.html&apos;,
  styleUrls: [&apos;./app.component.scss&apos;]
})
export class AppComponent implements OnInit {

  toUpper: string;

  constructor(private myLibraryService: MyLibraryService) {}
  title = &apos;devon4ng library test&apos;;
  ngOnInit(): void {
    this.toUpper = this.myLibraryService.firstLetterToUpper(&apos;test&apos;);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <code>app.component.html</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">&lt;!--The content below is only a placeholder and can be replaced.--&gt;
&lt;div style=&quot;text-align:center&quot;&gt;
  &lt;h1&gt;
    Welcome to {{ title }}!
  &lt;/h1&gt;
  &lt;img width=&quot;300&quot; alt=&quot;Angular Logo&quot; src=&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg==&quot;&gt;
&lt;/div&gt;
&lt;h2&gt;Here is my library service being used: {{toUpper}}&lt;/h2&gt;
&lt;lib-my-library&gt;&lt;/lib-my-library&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <code>app.module.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { BrowserModule } from &apos;@angular/platform-browser&apos;;
import { NgModule } from &apos;@angular/core&apos;;

import { AppRoutingModule } from &apos;./app-routing.module&apos;;
import { AppComponent } from &apos;./app.component&apos;;

import { MyLibraryModule } from &apos;my-library&apos;;
@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    AppRoutingModule,
    MyLibraryModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result from using the library:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/angular-library/result.png"><img src="images/angular-library/result.png" alt="result"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_devon4ng-libraries">devon4ng libraries</h5>
<div class="paragraph">
<p>In <a href="https://github.com/devonfw/devon4ng-library">devonfw/devon4ng-library</a> you can find some useful libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authorization module</strong>: This devon4ng Angular module adds rights-based authorization to your Angular app.</p>
</li>
<li>
<p><strong>Cache module</strong>: Use this devon4ng Angular module when you want to cache requests to server. You may configure it to store in cache only the requests you need and to set the duration you want.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-theming.asciidoc">18.5. Angular Material Theming</h3>
<div class="paragraph">
<p>Angular Material library offers UI components for developers, those components follows Google Material desing baselines but characteristics like colors can be modified in order to adapt them to the needs of the client: corporative colors, corporative identity, dark themes, &#x2026;&#x200B;</p>
</div>
<div class="sect3">
<h4 id="guide-angular-theming.asciidoc_theming-basics">18.5.1. Theming basics</h4>
<div class="paragraph">
<p>In Angular Material, a theme is created mixing multiple colors. Colors and its light and dark variants conform a <strong>palette</strong>. In general, a theme consists of the following palettes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>primary</strong>: Most used across screens and componets.</p>
</li>
<li>
<p><strong>accent</strong>: Floating action button and interactive elements.</p>
</li>
<li>
<p><strong>warn</strong>: Error state.</p>
</li>
<li>
<p><strong>foreground</strong>: Text and icons.</p>
</li>
<li>
<p><strong>background</strong>: Element backgrounds.</p>
</li>
</ul>
</div>
<div id="guide-angular-theming.asciidoc_id_palette_variants" class="imageblock">
<div class="content">
<img src="images/angular/angular-theming/palette.PNG" alt="Theme palette" width="600 link=" images angular angular-theming palette.png"">
</div>
<div class="title">Figure 29. Palettes and variants.</div>
</div>
<div class="paragraph">
<p>In angular material, a palette is represented as a scss map.</p>
</div>
<div id="guide-angular-theming.asciidoc_id_scss_map" class="imageblock">
<div class="content">
<img src="images/angular/angular-theming/scss-map.png" alt="Scss map" width="600 link=" images angular angular-theming scss-map.png"">
</div>
<div class="title">Figure 30. Scss map and palettes.</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Some components can be forced to use primary, accent or warn palettes using the attribute <strong>color</strong>, for example: &lt;mat-toolbar color=&quot;primary&quot;&gt;.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-theming.asciidoc_prebuilt-themes">18.5.2. Prebuilt themes</h4>
<div class="paragraph">
<p>Available prebuilt themes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deeppurple-amber.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-theming/deeppurple-amber.png" alt="deeppurple-amber theme" width="600 link=" images angular angular-theming deeppurple-amber.png"">
</div>
<div class="title">Figure 31. deeppurple-amber theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>indigo-pink.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-theming/indigo-pink.png" alt="indigo-pink theme" width="600 link=" images angular angular-theming indigo-pink.png"">
</div>
<div class="title">Figure 32. indigo-pink theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>pink-bluegrey.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-theming/pink-bluegrey.png" alt="pink-bluegrey theme" width="600 link=" images angular angular-theming pink-bluegrey.png"">
</div>
<div class="title">Figure 33. ink-bluegrey theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>purple-green.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-theming/purple-green.png" alt="purple-green theme" width="600 link=" images angular angular-theming purple-green.png"">
</div>
<div class="title">Figure 34. purple-green theme.</div>
</div>
<div class="paragraph">
<p>The prebuilt themes can be added using <strong>@import</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-css" data-lang="css">@import &apos;@angular/material/prebuilt-themes/deeppurple-amber.css&apos;;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-theming.asciidoc_custom-themes">18.5.3. Custom themes</h4>
<div class="paragraph">
<p>Somethimes prebuild themes do not meet the needs of a project, because color schemas are too specific or do not incorporate branding colors, in those situations custom themes can be built to offer a better solution to the client.</p>
</div>
<div class="paragraph">
<p>For this topic, we are going to use a basic layout project that can be found in <a href="https://github.com/devonfw/devon4ng/tree/master/samples/AngularMaterialBasicLayout">devon4ng repository</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-angular-theming.asciidoc_basics">Basics</h5>
<div class="paragraph">
<p>Before starting writing custom themes, there are some necessary things that have to be mentioned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a default theme: The project mentioned before has just one global scss stylesheet <strong>styles.scss</strong> that includes indigo-pink.scss which will be the default theme.</p>
</li>
<li>
<p>Add <em>@import &apos;~@angular/material/theming&apos;;</em> at the begining of the every stylesheet to be able to use angular material prebuilt color palettes and functions.</p>
</li>
<li>
<p>Add <em>@include mat-core();</em> <strong>once</strong> per project, so if you are writing multiple themes in multiple files you could import those files from a &apos;central&apos; one (for example styles.scss). This includes all common styles that are used by multiple components.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-theming/theme-files-structure.png" alt="Theme files structure" width="600 link=" images angular angular-theming theme-files-structure.png"">
</div>
<div class="title">Figure 35. Theme files structure.</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-theming.asciidoc_basic-custom-theme">Basic custom theme</h5>
<div class="paragraph">
<p>To create a new custom theme, the .scss file containing it has to have imported the angular _theming.scss file (angular/material/theming) file and mat-core included. _theming.scss includes multiple color palettes and some functions that we are going to see below. The file for this basic theme is going to be named <strong>styles-custom-dark.scss</strong>.</p>
</div>
<div class="paragraph">
<p>First, declare new variables for primary, accent and warn palettes. Those variables are going to store the result of the function <strong>mat-palette</strong>.</p>
</div>
<div class="paragraph">
<p><strong>mat-palette</strong> accepts four arguments: base color palette, main, lighter and darker variants (See <a href="#id_palette_variants">[id_palette_variants]</a>) and returns a new palette including some additional map values: default, lighter and darker (<a href="#id_scss_map">[id_scss_map]</a>). Only the first argument is mandatory.</p>
</div>
<div class="listingblock">
<div class="title">Listing 30. File styles-custom-dark.scss.</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">$custom-dark-theme-primary: mat-palette($mat-pink);
$custom-dark-theme-accent: mat-palette($mat-blue);
$custom-dark-theme-warn: mat-palette($mat-red);
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we are using colors available in _theming.scss: mat-pink, mat-blue, mat-red. If you want to use a custom color you need to define a new map, for instance:</p>
</div>
<div class="listingblock">
<div class="title">Listing 31. File styles-custom-dark.scss custom pink.</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">$my-pink: (
    50 : #fcf3f3,
    100 : #f9e0e0,
    200 : #f5cccc,
    300 : #f0b8b8,
    500 : #ea9999,
    900 : #db6b6b,
    A100 : #ffffff,
    A200 : #ffffff,
    A400 : #ffeaea,
    A700 : #ffd0d0,
    contrast: (
        50 : #000000,
        100 : #000000,
        200 : #000000,
        300 : #000000,
        900 : #000000,
        A100 : #000000,
        A200 : #000000,
        A400 : #000000,
        A700 : #000000,
    )
);

$custom-dark-theme-primary: mat-palette($my-pink);
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Some pages allows to create these palettes easily, for instance: <a href="http://mcg.mbitson.com" class="bare">http://mcg.mbitson.com</a>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Until now, we just have defined primary, accent and warn palettes but what about foreground and background? Angular material has two functions to change both:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>mat-light-theme</strong>: Receives as arguments primary, accent and warn palettes and return a theme whose foreground is basically black (texts, icons, &#x2026;&#x200B;), the background is white and the other palettes are the received ones.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-theming/custom-light.png" alt="deeppurple-amber theme" width="600 link=" images angular angular-theming custom-light.png"">
</div>
<div class="title">Figure 36. Custom light theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>mat-dark-theme</strong>: Similar to mat-light-theme but returns a theme whose foreground is basically white and background black.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-theming/custom-dark.png" alt="deeppurple-amber theme" width="600 link=" images angular angular-theming custom-dark.png"">
</div>
<div class="title">Figure 37. Custom dark theme.</div>
</div>
<div class="paragraph">
<p>For this example we are going to use mat-dark-theme and save its result in $custom-dark-theme.</p>
</div>
<div class="listingblock">
<div class="title">Listing 32. File styles-custom-dark.scss updated with mat-dark-theme.</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">...

$custom-dark-theme: mat-dark-theme(
  $custom-dark-theme-primary,
  $custom-dark-theme-accent,
  $custom-dark-theme-warn
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To apply the saved theme, we have to go to <strong>styles.scss</strong> and import our <strong>styles-custom-dark.scss</strong> and include a function called <strong>angular-material-theme</strong> using the theme variable as argument.</p>
</div>
<div class="listingblock">
<div class="title">Listing 33. File styles.scss.</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">...
@import &apos;styles-custom-dark.scss&apos;;
@include angular-material-theme($custom-dark-theme);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we have multiple themes it is necessary to add the include statement inside a css class and use it in <strong>src/index.html &#x2192; app-root component</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 34. File styles.scss updated with custom-dark-theme class.</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">...
@import &apos;styles-custom-dark.scss&apos;;

.custom-dark-theme {
  @include angular-material-theme($custom-dark-theme);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 35. File src/index.html.</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">...
&lt;app-root class=&quot;custom-dark-theme&quot;&gt;&lt;/app-root&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will apply <strong>$custom-dark-theme</strong> theme for the entire application.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-theming.asciidoc_full-custom-theme">Full custom theme</h5>
<div class="paragraph">
<p>Sometimes it is needed to custom different elementsw from background and foreground, in those situations we have to create a new function similar to <em>mat-light-theme</em> and <em>mat-dark-theme</em>. Let&#x2019;s focus con mat-light-theme:</p>
</div>
<div id="guide-angular-theming.asciidoc_source-mat-light" class="listingblock">
<div class="title">Listing 36. Source code of mat-light-theme</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">@function mat-light-theme($primary, $accent, $warn: mat-palette($mat-red)) {
  @return (
    primary: $primary,
    accent: $accent,
    warn: $warn,
    is-dark: false,
    foreground: $mat-light-theme-foreground,
    background: $mat-light-theme-background,
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can se, <em>mat-light-theme</em> takes three arguments and returs a map including them as primary, accent and warn color; but there are three more keys in that map: is-dark, foreground and background.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>is-dark</strong>: Boolean true if it is a dark theme, false otherwise.</p>
</li>
<li>
<p><strong>background</strong>: Map that stores the color for multiple background elements.</p>
</li>
<li>
<p><strong>foreground</strong>: Map that stores the color for multiple foreground elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To show which elements can be colored lets create a new theme in a file <strong>styles-custom-cap.scss</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 37. File styles-custom-cap.scss: Background and foreground variables.</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">@import &apos;~@angular/material/theming&apos;;

// custom background and foreground palettes
$my-cap-theme-background: (
  status-bar: #0070ad,
  app-bar: map_get($mat-blue, 900),
  background: #12abdb,
  hover: rgba(white, 0.04),
  card: map_get($mat-red, 800),
  dialog: map_get($mat-grey, 800),
  disabled-button: $white-12-opacity,
  raised-button: map-get($mat-grey, 800),
  focused-button: $white-6-opacity,
  selected-button: map_get($mat-grey, 900),
  selected-disabled-button: map_get($mat-grey, 800),
  disabled-button-toggle: black,
  unselected-chip: map_get($mat-grey, 700),
  disabled-list-option: black,
);

$my-cap-theme-foreground: (
  base: yellow,
  divider: $white-12-opacity,
  dividers: $white-12-opacity,
  disabled: rgba(white, 0.3),
  disabled-button: rgba(white, 0.3),
  disabled-text: rgba(white, 0.3),
  hint-text: rgba(white, 0.3),
  secondary-text: rgba(white, 0.7),
  icon: white,
  icons: white,
  text: white,
  slider-min: white,
  slider-off: rgba(white, 0.3),
  slider-off-active: rgba(white, 0.3),
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Function which uses the variables defined before to create a new theme:</p>
</div>
<div class="listingblock">
<div class="title">Listing 38. File styles-custom-cap.scss: Creating a new theme function.</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">// instead of creating a theme with mat-light-theme or mat-dark-theme,
// we will create our own theme-creating function that lets us apply our own foreground and background palettes.
@function create-my-cap-theme($primary, $accent, $warn: mat-palette($mat-red)) {
  @return (
    primary: $primary,
    accent: $accent,
    warn: $warn,
    is-dark: false,
    foreground: $my-cap-theme-foreground,
    background: $my-cap-theme-background
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling the new function and storing its value in <strong>$custom-cap-theme</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 39. File styles-custom-cap.scss: Storing the new theme.</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">// We use create-my-cap-theme instead of mat-light-theme or mat-dark-theme
$custom-cap-theme-primary: mat-palette($mat-green);
$custom-cap-theme-accent: mat-palette($mat-blue);
$custom-cap-theme-warn: mat-palette($mat-red);

$custom-cap-theme: create-my-cap-theme(
  $custom-cap-theme-primary,
  $custom-cap-theme-accent,
  $custom-cap-theme-warn
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After defining our new theme, we can import it from styles.scss.</p>
</div>
<div class="listingblock">
<div class="title">Listing 40. File styles.scss updated with custom-cap-theme class.</div>
<div class="content">
<pre class="highlight"><code class="language-scss" data-lang="scss">...
@import &apos;styles-custom-cap.scss&apos;;
.custom-cap-theme {
  @include angular-material-theme($custom-cap-theme);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-theming.asciidoc_multiple-themes-and-overlay-based-components">Multiple themes and overlay-based components</h5>
<div class="paragraph">
<p>Certain components (e.g. menu, select, dialog, etc.) that are inside of a global overlay container,require an additional step to be affected by the theme&#x2019;s css class selector.</p>
</div>
<div class="listingblock">
<div class="title">Listing 41. File app.module.ts</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">import {OverlayContainer} from &apos;@angular/cdk/overlay&apos;;

@NgModule({
  // ...
})
export class AppModule {
  constructor(overlayContainer: OverlayContainer) {
    overlayContainer.getContainerElement().classList.add(&apos;custom-cap-theme&apos;);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-theming.asciidoc_useful-resources">18.5.4. Useful resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://material.angular.io/guide/theming">Angular Material&#x2019;s oficial theming guide</a></p>
</li>
<li>
<p><a href="https://material.io/design/color/#color-theme-creation">Material Desing: Color theme creation</a></p>
</li>
<li>
<p><a href="http://mcg.mbitson.com">Palette generator</a></p>
</li>
<li>
<p><a href="https://sass-lang.com/guide">SCSS tutorial</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-pwa.asciidoc">18.6. Angular Progressive Web App</h3>
<div class="paragraph">
<p>Progresive web applications (PWAs) are web application that offer better user experience than the traditional ones. In general, they solve problems related with reliability and speed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Reliability</em>:  PWAs are stable. In this context stability means than even with slow connections or even with no network at all, the application still works. To achieve this, some basic resources like styles, fonts, requests, &#x2026;&#x200B; are stored; due to this caching, it is not possible to assure that the content is always up-to-date.</p>
</li>
<li>
<p><em>Speed</em>: When an users opens an application, he or she will expect it to load almost inmediately (almost 53% of users abandon sites that take longer that 3 seconds, source: <a href="https://developers.google.com/web/progressive-web-apps/#fast" class="bare">https://developers.google.com/web/progressive-web-apps/#fast</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PWAs uses a script called <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">service worker</a>, which runs in background and essentially act as proxy between web app and network, intercepting requests and acting depending on the network conditions.</p>
</div>
<div class="sect3">
<h4 id="guide-angular-pwa.asciidoc_assumptions">18.6.1. Assumptions</h4>
<div class="paragraph">
<p>This guide assumes that you already have installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node.js</p>
</li>
<li>
<p>npm package manager</p>
</li>
<li>
<p>Angular CLI</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-pwa.asciidoc_sample-application">18.6.2. Sample Application</h4>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-pwa/mts-pwa-rec.png" alt="My thai star recommendation" width="800 link=" images angular angular-pwa mts-pwa-rec.png"">
</div>
<div class="title">Figure 38. Basic angular PWA.</div>
</div>
<div class="paragraph">
<p>To explain how to build PWAs using angular, a basic application is going to be built. This app will be able to ask for resources and save in the cache in order to work even offline.</p>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-1-create-a-new-project-and-install-angular-pwa-package">Step 1: Create a new project and install Angular PWA package</h5>
<div class="paragraph">
<p>This step can be completed with one simple command: <code>ng new &lt;name&gt;</code>, where &lt;names&gt; is the name for the app. In this case, the app is going to be named <strong>basic-ng-pwa</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-2-create-a-service">Step 2: Create a service</h5>
<div class="paragraph">
<p>Web applications usually uses external resources, making necessary the addition of services which can get those resources. This application gets a dish from My Thai Star&#x2019;s back-end and shows it. To do so, a new service is going to be created.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>go to project folder: <code>cd basic-ng-pwa</code></p>
</li>
<li>
<p>run <code>ng generate service data</code></p>
</li>
<li>
<p>Modify <strong>data.service.ts</strong>, <strong>environment.ts</strong>, <strong>environment.prod.ts</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To retrieve data with this service, you have to import the module HttpClient and add it to the service&#x2019;s contructor. Once added, use it to create a function <strong>getDishes()</strong> that sends http request to My Thai Start&#x2019;s back-end. The URL of the back-end can be stored as an environment variable <strong>MY_THAI_STAR_DISH</strong>.</p>
</div>
<div class="paragraph">
<p><strong>data.service.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">  ...
  import { HttpClient } from &apos;@angular/common/http&apos;;
  import { MY_THAI_STAR_DISH } from &apos;../environments/environment&apos;;
  ...

  export class DataService {
    constructor(private http: HttpClient) {}

    /* Get data from Back-end */
    getDishes() {
      return this.http.get(MY_THAI_STAR_DISH);
    }
    ...
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>environments.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">  ...
  export const MY_THAI_STAR_DISH =
  &apos;http://de-mucdevondepl01:8090/api/services/rest/dishmanagement/v1/dish/1&apos;;
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>environments.prod.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">  ...
  export const MY_THAI_STAR_DISH =
  &apos;http://de-mucdevondepl01:8090/api/services/rest/dishmanagement/v1/dish/1&apos;;
  ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-3-use-the-service">Step 3: Use the service</h5>
<div class="paragraph">
<p>The component AppComponent implements the interface OnInit and inside its method ngOnInit() the suscription to the services is done. When a dish arrives, it is saved and shown (app.component.html).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">  ...
  import { DataService } from &apos;./data.service&apos;;
  export class AppComponent implements OnInit {
  dish: { name: string; description: string } = { name: &apos;&apos;, description: &apos;&apos;};

  ...
  ngOnInit() {
    this.data
      .getDishes()
      .subscribe(
        (dishToday: { dish: { name: string; description: string } }) =&gt; {
          this.dish = {
            name: dishToday.dish.name,
            description: dishToday.dish.description,
          };
        },
      );
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-4-structures">Step 4: Structures, styles and updates</h5>
<div class="paragraph">
<p>This step shows code interesting inside the sample app. The complete content can be found in <a href="https://github.com/devonfw/devon4ng/tree/master/samples/AngularBasicPWA">devon4ng samples</a>.</p>
</div>
<div class="paragraph">
<p><strong>index.html</strong></p>
</div>
<div class="paragraph">
<p>To use the Montserrat font add the following link inside the tag header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">  &lt;link href=&quot;https://fonts.googleapis.com/css?family=Montserrat&quot; rel=&quot;stylesheet&quot;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>styles.scss</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-css" data-lang="css">  body {
    ...
    font-family: &apos;Montserrat&apos;, sans-serif;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>app.component.ts</strong></p>
</div>
<div class="paragraph">
<p>This file is also used to reload the app if there are any changes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>SwUpdate</em>: This object comes inside the @angular/pwa package and it is used to detect changes and reload the page if needed.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">  ...
  import { SwUpdate } from &apos;@angular/service-worker&apos;;

  export class AppComponent implements OnInit {

  ...
    constructor(updates: SwUpdate, private data: DataService) {
      updates.available.subscribe((event) =&gt; {
        updates.activateUpdate().then(() =&gt; document.location.reload());
      });
    }
    ...
  }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-5-make-it-progressive.">Step 5: Make it Progressive.</h5>
<div class="paragraph">
<p>Install Angular PWA package with <code>ng add @angular/pwa --project &lt;name&gt;</code>. As before substitute <code>name</code> with <strong>basic-ng-pwa</strong>.</p>
</div>
<div class="paragraph">
<p>The above command completes the following actions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adds the @angular/service-worker package to your project.</p>
</li>
<li>
<p>Enables service worker build support in the CLI.</p>
</li>
<li>
<p>Imports and registers the service worker in the app module.</p>
</li>
<li>
<p>Updates the <code>index.html</code> file:</p>
<div class="ulist">
<ul>
<li>
<p>Includes a link to add the <code>manifest.json</code> file.</p>
</li>
<li>
<p>Adds meta tags for theme-color.</p>
</li>
<li>
<p>Installs icon files to support the installed Progressive Web App (PWA).</p>
</li>
<li>
<p>Creates the service worker configuration file called <code>ngsw-config.json</code>, which specifies the caching behaviors and other settings.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="guide-angular-pwa.asciidoc_manifest.json">manifest.json</h6>
<div class="paragraph">
<p>manifest.json is a file that allows to control how the app is displayed in places where native apps are displayed.</p>
</div>
<div class="paragraph">
<p><strong>Fields</strong></p>
</div>
<div class="paragraph">
<p><em>name</em>: Name of the web application.</p>
</div>
<div class="paragraph">
<p><em>short_name</em>: Short version of name.</p>
</div>
<div class="paragraph">
<p><em>theme_color</em>: Default theme color for an application context.</p>
</div>
<div class="paragraph">
<p><em>background_color</em>: Expected background color of the web application.</p>
</div>
<div class="paragraph">
<p><em>display</em>: Preferred display mode.</p>
</div>
<div class="paragraph">
<p><em>scope</em>: Navigation scope of tghis web application&#x2019;s application context.</p>
</div>
<div class="paragraph">
<p><em>start_url</em>: URL loaded when the user launches the web application.</p>
</div>
<div class="paragraph">
<p><em>icons</em>: Array of icons that serve as representations of the web app.</p>
</div>
<div class="paragraph">
<p>Additional information can be found <a href="https://developers.google.com/web/fundamentals/web-app-manifest/">here</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-angular-pwa.asciidoc_ngsw-config.json">ngsw-config.json</h6>
<div class="paragraph">
<p>nsgw-config.json specifies which files and data URLs have to be cached and updated by the Angular service worker.</p>
</div>
<div class="paragraph">
<p><strong>Fields</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>index</em>: File that serves as index page to satisfy navigation requests.</p>
</li>
<li>
<p><em>assetGroups</em>: Resources that are part of the app version that update along with the app.</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: Identifies the group.</p>
</li>
<li>
<p><em>installMode</em>: How the resources are cached (prefetch or lazy).</p>
</li>
<li>
<p><em>updateMode</em>: Caching behaviour when a new version of the app is found (prefetch or lazy).</p>
</li>
<li>
<p><em>resources</em>: Resources to cache. There are three groups.</p>
<div class="ulist">
<ul>
<li>
<p><em>files</em>: Lists patterns that match files in the distribution directory.</p>
</li>
<li>
<p><em>urls</em>:  URL patterns matched at runtime.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><em>dataGroups</em>: UsefulIdentifies the group. for API requests.</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: Identifies the group.</p>
</li>
<li>
<p><em>urls</em>: URL patterns matched at runtime.</p>
</li>
<li>
<p><em>version</em>:  Indicates that the resources being cached have been updated in a backwards-incompatible way.</p>
</li>
<li>
<p><em>cacheConfig</em>: Policy by which matching requests will be cached</p>
<div class="ulist">
<ul>
<li>
<p><em>maxSize</em>: The maximum number of entries, or responses, in the cache.</p>
</li>
<li>
<p><em>maxAge</em>: How long responses are allowed to remain in the cache.</p>
<div class="ulist">
<ul>
<li>
<p>d: days. (5d = 5 days).</p>
</li>
<li>
<p>h: hours</p>
</li>
<li>
<p>m: minutes</p>
</li>
<li>
<p>s: seconds. (5m20s = 5 minutes and 20 seconds).</p>
</li>
<li>
<p>u: milliseconds</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>timeout</em>: How long the Angular service worker will wait for the network to respond before using a cached response. Same dataformat as maxAge.</p>
</li>
<li>
<p><em>strategy</em>: Caching strategies (performance or freshness).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><em>navigationUrls</em>: List of URLs that will be redirected to the index file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional information can be found <a href="https://angular.io/guide/service-worker-config">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-6-configure-the-app">Step 6: Configure the app</h5>
<div class="paragraph">
<p><strong>manifest.json</strong></p>
</div>
<div class="paragraph">
<p>Default configuration.</p>
</div>
<div class="paragraph">
<p>&#xA0;<br>
&#xA0;<br>
<strong>ngsw-config.json</strong></p>
</div>
<div class="paragraph">
<p>At <em>assetGroups &#x2192; resources &#x2192; urls</em>: In this field the google fonts api is added in order to use Montserrat font even without network.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  &quot;urls&quot;: [
          &quot;https://fonts.googleapis.com/**&quot;
        ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the root of the json: A data group to cache API calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  {
    ...
    &quot;dataGroups&quot;: [{
      &quot;name&quot;: &quot;mythaistar-dishes&quot;,
      &quot;urls&quot;: [
        &quot;http://de-mucdevondepl01:8090/api/services/rest/dishmanagement/v1/dish/1&quot;
      ],
      &quot;cacheConfig&quot;: {
        &quot;maxSize&quot;: 100,
        &quot;maxAge&quot;: &quot;1h&quot;,
        &quot;timeout&quot;: &quot;10s&quot;,
        &quot;strategy&quot;: &quot;freshness&quot;
      }
    }]
  }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-7-check-that-your-app-is-a-pwa">Step 7: Check that your app is a PWA</h5>
<div class="paragraph">
<p>To check if an app is a PWA lets compare its normal behaviour against itself but built for production. Run in the project&#x2019;s root folder the commands below:</p>
</div>
<div class="paragraph">
<p><code>ng build --prod</code> to build the app using production settings.</p>
</div>
<div class="paragraph">
<p><code>npm install http-server</code> to install an npm module that can serve your built application. Documentation <a href="https://www.npmjs.com/package/http-server">here</a>.</p>
</div>
<div class="paragraph">
<p>Go to the dist/basic-ng-pwa/ folder running <code>cd dist/basic-ng-pwa</code>.</p>
</div>
<div class="paragraph">
<p><code>http-server -o</code> to serve your built app.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-pwa/http-serve.png" alt="Http server running" width="600 link=" images angular angular-pwa http-serve.png"">
</div>
<div class="title">Figure 39. Http server running on localhost:8081.</div>
</div>
<div class="paragraph">
<p>&#xA0;</p>
</div>
<div class="paragraph">
<p>In another console instance run <code>ng serve</code> to open the common app (not built).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-pwa/ng-serve.png" alt=".Angular server running" width="600 link=" images angular angular-pwa ng-serve.png"">
</div>
<div class="title">Figure 40. Angular server running on localhost:4200.</div>
</div>
<div class="paragraph">
<p>&#xA0;</p>
</div>
<div class="paragraph">
<p>The first difference can be found on <em>Developer tools &#x2192; application</em>, here it is seen that the PWA application (left) has a service worker and the common (right) one does not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-pwa/pwa-nopwa-app-ng.png" alt="Application comparison" width="800 link=" images angular angular-pwa pwa-nopwa-app-ng.png"">
</div>
<div class="title">Figure 41. Application service worker comparison.</div>
</div>
<div class="paragraph">
<p>&#xA0;</p>
</div>
<div class="paragraph">
<p>If the &quot;offline&quot; box is checked, it will force a disconnection from network. In situations where users do not have connectivity or have a slow, one the PWA can still be accesed and used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-pwa/online-offline-ng.png" alt="Online offline apps" width="800 link=" images angular angular-pwa online-offline-ng.png"">
</div>
<div class="title">Figure 42. Offline application.</div>
</div>
<div class="paragraph">
<p>&#xA0;</p>
</div>
<div class="paragraph">
<p>Finally, browser extensions like <a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk">Lighthouse</a> can be used to test whether an application is progressive or not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/angular/angular-pwa/lighthouse-ng.png" alt="Lighthouse report" width="800 link=" images angular angular-pwa lighthouse-ng.png"">
</div>
<div class="title">Figure 43. Lighthouse report.</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-app-initializer.asciidoc">18.7. APP_INITIALIZER</h3>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_what-is-the-app_initializer-pattern">18.7.1. What is the APP_INITIALIZER pattern</h4>
<div class="paragraph">
<p>The APP_INITIALIZER pattern allows an aplication to choose which configuration is going to be used in the start of the application, this is useful because it allows to setup different configurations, for example, for docker or a remote configuration. This provides benefits since this is done on <code>runtime</code>, so theres no need to recompile the whole application to switch from configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_what-is-app_initializer">18.7.2. What is APP_INITIALIZER</h4>
<div class="paragraph">
<p>APP_INITIALIZER allows to provide a service in the initialization of the application in a <code>@NgModule</code>. It also allows to use a factory, allowing to create a singleton in the same service. An example can be found in MyThaiStar <code>/core/config/config.module.ts</code>:</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The provider expects the return of a <code>Promise</code>, if it is using Observables, a change with the method <code>toPromise()</code> will allow a switch from <code>Observable</code> to <code>Promise</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { NgModule, APP_INITIALIZER } from &apos;@angular/core&apos;;
import { HttpClientModule } from &apos;@angular/common/http&apos;;

import { ConfigService } from &apos;./config.service&apos;;

@NgModule({
  imports: [HttpClientModule],
  providers: [
    ConfigService,
    {
      provide: APP_INITIALIZER,
      useFactory: ConfigService.factory,
      deps: [ConfigService],
      multi: true,
    },
  ],
})
export class ConfigModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is going to allow the creation of a <code>ConfigService</code> where, using a singleton, the service is going to load an external config depending on a route. This dependence with a route, allows to setup diferent configuration for docker etc. This is seen in the <code>ConfigService</code> of MyThaiStar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { Injectable } from &apos;@angular/core&apos;;
import { HttpClient } from &apos;@angular/common/http&apos;;
import { Config, config } from &apos;./config&apos;;

@Injectable()
export class ConfigService {
  constructor(private httpClient: HttpClient) {}

  static factory(appLoadService: ConfigService) {
    return () =&gt; appLoadService.loadExternalConfig();
  }

  // this method gets external configuration calling /config endpoint
  //and merges into config object
  loadExternalConfig(): Promise&lt;any&gt; {
    if (!environment.loadExternalConfig) {
      return Promise.resolve({});
    }

    const promise = this.httpClient
      .get(&apos;/config&apos;)
      .toPromise()
      .then((settings) =&gt; {
        Object.keys(settings || {}).forEach((k) =&gt; {
          config[k] = settings[k];
        });
        return settings;
      })
      .catch((error) =&gt; {
        return &apos;ok, no external configuration&apos;;
      });

    return promise;
  }

  getValues(): Config {
    return config;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As it is mentioned earlier, you can see the use of a factory to create a singleton at the start. After that, <code>loadExternalConfig</code> is going to look for a boolean inside the corresponding environment file inside the path <code>src/environments/</code>, this boolean <code>loadExternalConfig</code> is going to easily allow to switch to a external config. If it is true, it generates a promise that overwrites the parameters of the local config, allowing to load the external config. Finally, the last method <code>getValues()</code> is going to allow to return the file config with the values (overwritten or not). The local <code>config</code> file from MyThaiStar can be seen here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">export enum BackendType {
  IN_MEMORY,
  REST,
  GRAPHQL,
}

interface Role {
  name: string;
  permission: number;
}

interface Lang {
  label: string;
  value: string;
}

export interface Config {
  version: string;
  backendType: BackendType;
  restPathRoot: string;
  restServiceRoot: string;
  pageSizes: number[];
  pageSizesDialog: number[];
  roles: Role[];
  langs: Lang[];
}

export const config: Config = {
  version: &apos;dev&apos;,
  backendType: BackendType.REST,
  restPathRoot: &apos;http://localhost:8081/mythaistar/&apos;,
  restServiceRoot: &apos;http://localhost:8081/mythaistar/services/rest/&apos;,
  pageSizes: [8, 16, 24],
  pageSizesDialog: [4, 8, 12],
  roles: [
    { name: &apos;CUSTOMER&apos;, permission: 0 },
    { name: &apos;WAITER&apos;, permission: 1 },
  ],
  langs: [
    { label: &apos;English&apos;, value: &apos;en&apos; },
    { label: &apos;Deutsch&apos;, value: &apos;de&apos; },
    { label: &apos;Espa&#xF1;ol&apos;, value: &apos;es&apos; },
    { label: &apos;Catal&#xE0;&apos;, value: &apos;ca&apos; },
    { label: &apos;Fran&#xE7;ais&apos;, value: &apos;fr&apos; },
    { label: &apos;Nederlands&apos;, value: &apos;nl&apos; },
    { label: &apos;&#x939;&#x93F;&#x928;&#x94D;&#x926;&#x940;&apos;, value: &apos;hi&apos; },
    { label: &apos;Polski&apos;, value: &apos;pl&apos; },
    { label: &apos;&#x420;&#x443;&#x441;&#x441;&#x43A;&#x438;&#x439;&apos;, value: &apos;ru&apos; },
    { label: &apos;&#x431;&#x44A;&#x43B;&#x433;&#x430;&#x440;&#x441;&#x43A;&#x438;&apos;, value: &apos;bg&apos; },
  ],
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, inside a environment file <code>src/environments/environment.ts</code> the use of the boolean <code>loadExternalConfig</code> is seen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">// The file contents for the current environment will overwrite these during build.
// The build system defaults to the dev environment which uses `environment.ts`, but if you do
// `ng build --env=prod` then `environment.prod.ts` will be used instead.
// The list of which env maps to which file can be found in `.angular-cli.json`.

export const environment: {
  production: boolean;
  loadExternalConfig: boolean;
} = { production: false, loadExternalConfig: false };</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_creating-a-app_initializer-configuration">18.7.3. Creating a APP_INITIALIZER configuration</h4>
<div class="paragraph">
<p>This section is going to be used to create a new <code>APP_INITIALIZER</code> basic example. For this, a basic app with angular is going to be generated using <code>ng new &quot;appname&quot;</code> substituting <code>appname</code> for the name of the app choosed.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_setting-up-the-config-files">18.7.4. Setting up the config files</h4>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_docker-external-configuration-optional">Docker external configuration (Optional)</h5>
<div class="paragraph">
<p>This section is only done if theres a docker configuration in the app you are setting up this type of configuration.</p>
</div>
<div class="paragraph">
<p>1.- Create in the root folder <code>/docker-external-config.json</code>. This external config is going to be used when the application is loaded with docker (if the boolean to load the external configuration is set to true). Here you need to add all the config parameter you want to load with docker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    &quot;version&quot;: &quot;docker-version&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.- In the root, in the file <code>/Dockerfile</code> angular is going to copy the <code>docker-external-config.json</code> that was created before into the nginx html route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>....
COPY docker-external-config.json /usr/share/nginx/html/docker-external-config.json
....</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_external-json-configuration">External json configuration</h5>
<div class="paragraph">
<p>1.- Create a json file in the route <code>/src/external-config.json</code>. This external config is going to be used when the application is loaded with the start script (if the boolean to load the external configuration is set to true). Here you need to add all the config parameter you want to load:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    &quot;version&quot;: &quot;external-config&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.- The file named <code>/angular.json</code> located at the root is going to be modified to add the file <code>external-config.json</code> that was just created to both <code>&quot;assets&quot;</code> inside <code>Build</code> and <code>Test</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">	....
	&quot;build&quot;: {
          ....
            &quot;assets&quot;: [
              &quot;src/assets&quot;,
              &quot;src/data&quot;,
              &quot;src/favicon.ico&quot;,
              &quot;src/manifest.json&quot;,
              &quot;src/external-config.json&quot;
            ]
	        ....
        &quot;test&quot;: {
	  ....
	   &quot;assets&quot;: [
              &quot;src/assets&quot;,
              &quot;src/data&quot;,
              &quot;src/favicon.ico&quot;,
              &quot;src/manifest.json&quot;,
              &quot;src/external-config.json&quot;
            ]
	  ....</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_setting-up-the-proxies">18.7.5. Setting up the proxies</h4>
<div class="paragraph">
<p>This step is going to setup two proxies. This is going to allow to load the config desired by the context, in case that it is using docker to load the app or in case it loads the app with angular. Loading diferent files is made posible by the fact that the <code>ConfigService</code> method <code>loadExternalConfig()</code> looks for the path <code>/config</code>.</p>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_docker-optional">Docker (Optional)</h5>
<div class="paragraph">
<p>1.- This step is going to be for docker. Add <code>docker-external-config.json</code> to nginx configuration (<code>/nginx.conf</code>) that is in the root of the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>....
  location  ~ ^/config {
        alias /usr/share/nginx/html/docker-external-config.json;
  }
....</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_external-configuration">External Configuration</h5>
<div class="paragraph">
<p>1.- Now the file <code>/proxy.conf.json</code>, needs to be created/modified this file can be found in the root of the application. In this file you can add the route of the external configuration in <code>target</code> and the name of the file in <code>^/config:</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">....
  &quot;/config&quot;: {
    &quot;target&quot;: &quot;http://localhost:4200&quot;,
    &quot;secure&quot;: false,
    &quot;pathRewrite&quot;: {
      &quot;^/config&quot;: &quot;/external-config.json&quot;
    }
  }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.- The file <code>package.json</code> found in the root of the application is gonna use the start script to load the proxy config that was just created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">  &quot;scripts&quot;: {
....
    &quot;start&quot;: &quot;ng serve --proxy-config proxy.conf.json -o&quot;,
....</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_adding-the-loadexternalconfig-boolean-to-the-environments">18.7.6. Adding the loadExternalConfig boolean to the environments</h4>
<div class="paragraph">
<p>In order to load an external config we need to add the loadExternalConfig boolean to the environments. To do so, inside the folder <code>environments/</code> the files are going to get modified adding this boolean to each environment that is going to be used. In this case, only two environments are going to be modified (<code>environment.ts</code> and <code>environment.prod.ts</code>). Down below theres an example of the modification being done in the <code>environment.prod.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">export const environment: {
  production: boolean;
  loadExternalConfig: boolean;
} = { production: false, loadExternalConfig: false };</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the file in first instance theres the declaration of the types of the variables. After that, theres the definition of those variables. This variable <code>loadExternalConfig</code> is going to be used by the service, allowing to setup a external config just by switching the <code>loadExternalConfig</code> to true.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_creating-core-configuration-service">18.7.7. Creating core configuration service</h4>
<div class="paragraph">
<p>In order to create the whole configuration module three are going to be created:</p>
</div>
<div class="paragraph">
<p>1.- Create in the core <code>app/core/config/</code> a <code>config.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">  export interface Config {
    version: string;
  }

  export const config: Config = {
    version: &apos;dev&apos;
  };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Taking a look to this file, it creates a interface (<code>Config</code>) that is going to be used by the variable that exports (<code>export const config: Config</code>). This variable <code>config</code> is going to be used by the service that is going to be created.</p>
</div>
<div class="paragraph">
<p>2.- Create in the core <code>app/core/config/</code> a <code>config.service.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { Injectable } from &apos;@angular/core&apos;;
import { HttpClient } from &apos;@angular/common/http&apos;;
import { Config, config } from &apos;./config&apos;;

@Injectable()
export class ConfigService {
  constructor(private httpClient: HttpClient) {}

  static factory(appLoadService: ConfigService) {
    return () =&gt; appLoadService.loadExternalConfig();
  }

  // this method gets external configuration calling /config endpoint
  // and merges into config object
  loadExternalConfig(): Promise&lt;any&gt; {
    if (!environment.loadExternalConfig) {
      return Promise.resolve({});
    }

    const promise = this.httpClient
      .get(&apos;/config&apos;)
      .toPromise()
      .then((settings) =&gt; {
        Object.keys(settings || {}).forEach((k) =&gt; {
          config[k] = settings[k];
        });
        return settings;
      })
      .catch((error) =&gt; {
        return &apos;ok, no external configuration&apos;;
      });

    return promise;
  }

  getValues(): Config {
    return config;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As it was explained in previous steps, at first, there is a factory that uses the method <code>loadExternalConfig()</code>, this factory is going to be used in later steps in the module. After that, the <code>loadExternalConfig()</code> method checks if the boolean in the environment is false. If it is false it will return the promise resolved with the normal config. Else, it is going to load the external config in the path (<code>/config</code>), and overwrite the values from the external config to the config thats going to be used by the app, this is all returned in a promise.</p>
</div>
<div class="paragraph">
<p>3.- Create in the core a module for the config <code>app/core/config/</code> a <code>config.module.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { NgModule, APP_INITIALIZER } from &apos;@angular/core&apos;;
import { HttpClientModule } from &apos;@angular/common/http&apos;;

import { ConfigService } from &apos;./config.service&apos;;

@NgModule({
  imports: [HttpClientModule],
  providers: [
    ConfigService,
    {
      provide: APP_INITIALIZER,
      useFactory: ConfigService.factory,
      deps: [ConfigService],
      multi: true,
    },
  ],
})
export class ConfigModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen earlier, the <code>ConfigService</code> is added to the module. In this addition, the app is initialized(<code>provide</code>) and it uses the factory that was created in the <code>ConfigService</code> loading the config with or without the external values depending on the boolean in the <code>config</code>.</p>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_using-the-config-service">Using the Config Service</h5>
<div class="paragraph">
<p>As a first step, in the file <code>/app/app.module.ts</code> the <code>ConfigModule</code> created earlier in the other step is going to be imported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">  imports: [
    ....
    ConfigModule,
    ....
  ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, the <code>ConfigService</code> is going to be injected into the <code>app.component.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">....
import { ConfigService } from &apos;./core/config/config.service&apos;;
....
export class AppComponent {
....
  constructor(public configService: ConfigService) { }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, for this demonstration app, the component <code>app/app.component.html</code> is going to show the version of the config it is using at that moment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div style=&quot;text-align:center&quot;&gt;
  &lt;h1&gt;
    Welcome to {{ title }}!
  &lt;/h1&gt;
&lt;/div&gt;
&lt;h2&gt;Here is the configuration version that is using angular right now: {{configService.getValues().version}}&lt;/h2&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_final-steps">Final steps</h5>
<div class="paragraph">
<p>The script <code>start</code> that was created earlier in the <code>package.json</code> (<code>npm start</code>) is going to be used to start the application. After that, modifying the boolean <code>loadExternalConfig</code> inside the corresponding environment file inside <code>/app/environments/</code> should show the different config versions.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/loadExternalConfigFalse.png"><img src="images/app-initializer/loadExternalConfigFalse.png" alt="loadExternalConfigFalse"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/loadExternalConfigTrue.png"><img src="images/app-initializer/loadExternalConfigTrue.png" alt="loadExternalConfigTrue"></a>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-component-decomposition.asciidoc">18.8. Component Decomposition</h3>
<div class="paragraph">
<p>When implementing a new requirement there are a few design decisions, which need to be considered.
A decomposition in <em>Smart</em> and <em>Dumb Components</em> should be done first.
This includes the definition of state and responsibilities.
Implementing a new dialog will most likely be done by defining a new <em>Smart Component</em> with multiple <em>Dumb Component</em> children.</p>
</div>
<div class="paragraph">
<p>In the component tree this would translate to the definition of a new subtree.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-tree-highlighted-subtree.svg"><img src="images/component-tree-highlighted-subtree.svg" alt="Component Tree With Highlighted Sub Tree" width="450"></a>
</div>
<div class="title">Figure 44. Component Tree with highlighted subtree</div>
</div>
<div class="sect3">
<h4 id="guide-component-decomposition.asciidoc_defining-components">18.8.1. Defining Components</h4>
<div class="paragraph">
<p>The following gives an example for component decomposition.
Shown is a screenshot from a styleguide to be implemented.
It is a widget called <code>Listpicker</code>.</p>
</div>
<div class="paragraph">
<p>The basic function is an <code>input</code> field accepting direct input.
So typing <code>otto</code> puts <code>otto</code> inside the <code>FormControl</code>.
With arrow down key or by clicking the icon displayed in the inputs right edge a dropdown is opened.
Inside possible values can be selected and filtered beforehand.
After pressing arrow down key the focus should move into the filter input field.
Up and down arrow keys can be used to select an element from the list.
Typing into the filter input field filters the list from which the elements can be selected.
The current selected element is highlighted with green background color.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-decomposition-example-1.svg"><img src="images/component-decomposition-example-1.svg" alt="Component Decomposition Example 1v2" width="450"></a>
</div>
<div class="title">Figure 45. Component decomposition example before</div>
</div>
<div class="paragraph">
<p>What should be done, is to define small reusable <em>Dumb Components</em>.
This way the complexity becomes manageable.
In the example every colored box describes a component with the purple box being a <em>Smart Component</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-decomposition-example-2.svg"><img src="images/component-decomposition-example-2.svg" alt="Component Decomposition Example 2v2" width="450"></a>
</div>
<div class="title">Figure 46. Component decomposition example after</div>
</div>
<div class="paragraph">
<p>This leads to the following component tree.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-decomposition-example-component-tree.svg"><img src="images/component-decomposition-example-component-tree.svg" alt="Component Decomposition Example component tree" width="450"></a>
</div>
<div class="title">Figure 47. Component decomposition example component tree</div>
</div>
<div class="paragraph">
<p>Note the uppermost component is a <em>Dumb Component</em>.
It is a wrapper for the label and the component to be displayed inside a form.
The <em>Smart Component</em> is <code>Listpicker</code>.
This way the widget can be reused without a form needed.</p>
</div>
<div class="paragraph">
<p>A widgets is a typical <em>Smart Component</em> to be shared across feature modules.
So the <code>SharedModule</code> is the place for it to be defined.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-component-decomposition.asciidoc_defining-state">18.8.2. Defining state</h4>
<div class="paragraph">
<p>Every UI has state.
There are different kinds of state, for example</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View State: e.g. is a panel open, a css transition pending, etc.</p>
</li>
<li>
<p>Application State: e.g. is a payment pending, current URL, user info, etc.</p>
</li>
<li>
<p>Business Data: e.g. products loaded from backend</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is good practice to base the component decomposition on the state handled by a component and to define a simplified state model beforehand.
Starting with the parent - the <em>Smart Component</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What overall state does the dialog have: e.g. loading, error, valid data loaded, valid input, invalid input, etc.
Every defined value should correspond to an overall appearance of the whole dialog.</p>
</li>
<li>
<p>What events can occur to the dialog: e.g. submitting a form, changing a filter, pressing buttons, pressing keys, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For every <em>Dumb Component</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What data does a component display: e.g. a header text, user information to be displayed, a loading flag, etc.<br>
This will be a slice of the overall state of the parent <em>Smart Component</em>.
In general a <em>Dumb Component</em> presents a slice of its parent <em>Smart Components</em> state to the user.</p>
</li>
<li>
<p>What events can occur: keyboard events, mouse events, etc.<br>
These events are all handled by its parent <em>Smart Component</em> - every event is passed up the tree to be handled by a <em>Smart Component</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These information should be reflected inside the modeled state.
The implementation is a TypeScript type - an interface or a class describing the model.</p>
</div>
<div class="paragraph">
<p>So there should be a type describing all state relevant for a <em>Smart Component</em>.
An instance of that type is send down the component tree at runtime.
Not every <em>Dumb Component</em> will need the whole state.
For instance a single <em>Dumb Component</em> could only need a single string.</p>
</div>
<div class="paragraph">
<p>The state model for the previous <code>Listpicker</code> example is shown in the following listing.</p>
</div>
<div class="listingblock">
<div class="title">Listing 42. Listpicker state model</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">export class ListpickerState {

  items: {}[]|undefined;
  columns = [&apos;key&apos;, &apos;value&apos;];
  keyColumn = &apos;key&apos;;
  displayValueColumn = &apos;value&apos;;
  filteredItems: {}[]|undefined;
  filter = &apos;&apos;;
  placeholder = &apos;&apos;;
  caseSensitive = true;
  isDisabled = false;
  isDropdownOpen = false;
  selectedItem: {}|undefined;
  displayValue = &apos;&apos;;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Listpicker</code> holds an instance of <code>ListpickerState</code> which is passed down the component tree via <code>@Input()</code> bindings in the <em>Dumb Components</em>.
Events emitted by children - <em>Dumb Components</em> - create a new instance of <code>ListpickerState</code> based on the current instance and the event and its data.
So a state transition is just setting a new instance of <code>ListpickerState</code>.
Angular Bindings propagate the value down the tree after exchanging the state.</p>
</div>
<div class="listingblock">
<div class="title">Listing 43. Listpicker State transition</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">export class ListpickerComponent {

  // initial default values are set
  state = new ListpickerState();

  /** User changes filter */
  onFilterChange(filter: string): void {
    // apply filter ...
    const filteredList = this.filterService.filter(...);

    // important: A new instance is created, instead of altering the existing one.
    //            This makes change detection easier and prevents hard to find bugs.
    this.state = Object.assing({}, this.state, {
      filteredItems: filteredList,
      filter: filter
    });
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Note:</div>
<p>It is not always necessary to define the model as independent type.
So there would be no state property and just properties for every state defined directly in the component class.
When complexity grows and state becomes larger this is usually a good idea.
If the state should be shared between <em>Smart Components</em> a store is to be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-component-decomposition.asciidoc_when-are-dumb-components-needed">18.8.3. When are Dumb Components needed</h4>
<div class="paragraph">
<p>Sometimes it is not necessary to perform a full decomposition. The architecture does not enforce it generally. What you should keep in mind is, that there is always a point when it becomes recommendable.</p>
</div>
<div class="paragraph">
<p>For example a template with 800 loc is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>not understandable</p>
</li>
<li>
<p>not maintanable</p>
</li>
<li>
<p>not testable</p>
</li>
<li>
<p>not reusable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So when implementing a template with more than 50 loc you should think about decomposition.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-consuming-rest-services.asciidoc">18.9. Consuming REST services</h3>
<div class="paragraph">
<p>A good introduction to working with Angular HttpClient can be found in <a href="https://angular.io/guide/http">Angular Docs</a></p>
</div>
<div class="paragraph">
<p>This guide will cover, how to embed Angular HttpClient in the application architecture.
For backend request a special service with the suffix <code>Adapter</code> needs to be defined.</p>
</div>
<div class="sect3">
<h4 id="guide-consuming-rest-services.asciidoc_defining-adapters">18.9.1. Defining Adapters</h4>
<div class="paragraph">
<p>It is a good practice to have a Angular service whose single responsibility is to call the backend and parse the received value to a transfer data model (e.g. Swagger generated TOs).
Those services need to have the suffix <code>Adapter</code> to make them easy to recognize.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/rest-adapter.svg"><img src="images/rest-adapter.svg" alt="Adapters handle backend communication" width="450"></a>
</div>
<div class="title">Figure 48. Adapters handle backend communication</div>
</div>
<div class="paragraph">
<p>As illustrated in the figure a Use Case service does not use Angular HttpClient directly but uses an adapter.
A basic adapter could look like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 44. Example adapter</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">import { Injectable } from &apos;@angular/core&apos;;
import { HttpClient } from &apos;@angular/common/http&apos;;
import { Observable } from &apos;rxjs/Observable&apos;;

import { FlightTo } from &apos;./flight-to&apos;;

@Injectable({
 providedIn: &apos;root&apos;,
})
export class FlightsAdapter {

  constructor(
    private httpClient: HttpClient
  ) {}

  getFlights(): Observable&lt;FlightTo&gt; {
    return this.httpClient.get&lt;FlightTo&gt;(&apos;/relative/url/to/flights&apos;);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The adapters should use a well-defined transfer data model.
This could be generated from server endpoints with CobiGen, Swagger, typescript-maven-plugin, etc.
If inside the application there is a business model defined, the adapter has to parse to the transfer model.
This is illustrated in the following listing.</p>
</div>
<div class="listingblock">
<div class="title">Listing 45. Example adapter mapping from business model to transfer model</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">import { Injectable } from &apos;@angular/core&apos;;
import { HttpClient } from &apos;@angular/common/http&apos;;
import { Observable } from &apos;rxjs/Observable&apos;;
import { map } from &apos;rxjs/operators&apos;;

import { FlightTo } from &apos;./flight-to&apos;;
import { Flight } from &apos;../../../model/flight&apos;;

@Injectable({
 providedIn: &apos;root&apos;,
})
export class FlightsAdapter {

  constructor(
    private httpClient: HttpClient
  ) {}

  updateFlight(flight: Flight): Observable&lt;Flight&gt; {
    const to = this.mapFlight(flight);

    return this.httpClient.post&lt;FlightTo&gt;(&apos;/relative/url/to/flights&apos;, to).pipe(
      map(to =&gt; this.mapFlightTo(to))
    );
  }

  private mapFlight(flight: Flight): FlightTo {
    // mapping logic
  }

  private mapFlightTo(flightTo: FlightTo): Flight {
    // mapping logic
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-consuming-rest-services.asciidoc_token-management">18.9.2. Token management</h4>
<div class="paragraph">
<p>In most cases the access to backend API is secured using well konwn mechanisms as <strong>CSRF</strong>, <strong>JWT</strong> or both. In these cases the frontend application must manage the tokens that are generated when the user authenticates. More concretely it must store them to include them in every request automatically. Obviously, when user logs out these tokens must be removed from localStorage, memory, etc.</p>
</div>
<div class="sect4">
<h5 id="guide-consuming-rest-services.asciidoc_store-security-token">Store security token</h5>
<div class="paragraph">
<p>In order to make this guide simple we are going to store the token in memory. Therefore, if we consider that we already have a login mechanism implemented we would like to store the token using a <code>auth.service.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">import { Injectable } from &apos;@angular/core&apos;;
import { Router } from &apos;@angular/router&apos;;

@Injectable({
  providedIn: &apos;root&apos;,
})
export class AuthService {
  private loggedIn = false;
  private token: string;

  constructor(public router: Router) {}

  public isLogged(): boolean {
    return this.loggedIn || false;
  }

  public setLogged(login: boolean): void {
    this.loggedIn = login;
  }

  public getToken(): string {
    return this.token;
  }

  public setToken(token: string): void {
    this.token = token;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the previous service we will be able to store the token obtained in the login request using the method <code>setToken(token)</code>. Please consider that, if you want a more sofisticated approach using localStorage API, you will need to modify this service accordingly.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-consuming-rest-services.asciidoc_include-token-in-every-request">Include token in every request</h5>
<div class="paragraph">
<p>Now that the token is available in the application it is necessary to include it in every request to a protected API endpoint. Instead of modifying all the http requests in our application, Angular provides a class to intercept every request (and every response if we need to) called <code>HttpInterceptor</code>. Let&#x2019;s create a service called <code>http-interceptor.service.ts</code> to implement the <code>intercept</code> method of this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">import {
  HttpEvent,
  HttpHandler,
  HttpInterceptor,
  HttpRequest,
} from &apos;@angular/common/http&apos;;
import { Injectable } from &apos;@angular/core&apos;;
import { Observable } from &apos;rxjs&apos;;
import { environment } from &apos;../../../environments/environment&apos;;
import { AuthService } from &apos;./auth.service&apos;;

@Injectable()
export class HttpRequestInterceptorService implements HttpInterceptor {

  constructor(private auth: AuthService) {}

  intercept(
    req: HttpRequest&lt;any&gt;,
    next: HttpHandler,
  ): Observable&lt;HttpEvent&lt;any&gt;&gt; {
    // Get the auth header from the service.
    const authHeader: string = this.auth.getToken();
    if (authHeader) {
      let authReq: HttpRequest&lt;any&gt;;

      // CSRF
      if (environment.security === &apos;csrf&apos;) {
        authReq = req.clone({
          withCredentials: true,
          setHeaders: { &apos;x-csrf-token&apos;: authHeader },
        });
      }

      // JWT
      if (environment.security === &apos;jwt&apos;) {
        authReq = req.clone({
          setHeaders: { Authorization: authHeader },
        });
      }

      return next.handle(authReq);
    } else {
      return next.handle(req);
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you may notice, this service is making use of an environment field <code>environment.security</code> to determine if we are using JWT or CSRF in order to inject the token accordingly. In your application you can combine both if necessary.</p>
</div>
<div class="paragraph">
<p>Configure environment.ts file to use the CSRF/JWT.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>security: &apos;csrf&apos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>authHeader</code> used is obtained using the injected service <code>AuthService</code> already presented above.</p>
</div>
<div class="paragraph">
<p>In order to activate the interceptor we need to provide it in our <code>app.module.ts</code> or <code>core.module.ts</code> depending on the application structure. Let&#x2019;s assume that we are using the latter and the interceptor file is inside a <code>security</code> folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">...
import { HttpRequestInterceptorService } from &apos;./security/http-request-interceptor.service&apos;;
...

@NgModule({
  imports: [...],
  exports: [...],
  declarations: [],
  providers: [
    ...
    {
      provide: HTTP_INTERCEPTORS,
      useClass: HttpRequestInterceptorService,
      multi: true,
    },
  ],
})
export class CoreModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Angular automatically will now modify every request and include in the header the token if it is convenient.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-error-handler.asciidoc">18.10. Error Handler in angular</h3>
<div class="paragraph">
<p>Angular allows us to set up a custom error handler that can be used to control the different errors and them in a correct way. Using a global error handler will avoid mistakes and provide a use friendly interface allowing us to indicate the user what problem is happening.</p>
</div>
<div class="sect3">
<h4 id="guide-error-handler.asciidoc_what-is-errorhandler">18.10.1. What is ErrorHandler</h4>
<div class="paragraph">
<p><code>ErrorHandler</code> is the class that <code>Angular</code> uses by default to control the errors. This means that, even if the application doesnt have a <code>ErrorHandler</code> it is going to use the one setup by default in <code>Angular</code>. This can be tested by trying to find a page not existing in any app, instantly <code>Angular</code> will print the error in the console.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-error-handler.asciidoc_creating-your-custom-errorhandler-step-by-step">18.10.2. Creating your custom ErrorHandler step by step</h4>
<div class="paragraph">
<p>In order to create a custom <code>ErrorHandler</code> three steps are going to be needed:</p>
</div>
<div class="sect4">
<h5 id="guide-error-handler.asciidoc_creating-the-custom-errorhandler-class">Creating the custom ErrorHandler class</h5>
<div class="paragraph">
<p>In this first step the custom <code>ErrorHandler</code> class is going to be created inside the folder <code>/app/core/errors/errors-handler.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { ErrorHandler, Injectable, Injector } from &apos;@angular/core&apos;;
import { HttpErrorResponse } from &apos;@angular/common/http&apos;;

@Injectable()
export class ErrorsHandler implements ErrorHandler {

    constructor(private injector: Injector) {}

    handleError(error: Error | HttpErrorResponse) {
      //  To do: Use injector to get the necessary services to redirect or
      // show a message to the user
      const classname  = error.constructor.name;
      switch ( classname )  {
        case &apos;HttpErrorResponse&apos;:
          console.error(&apos;HttpError:&apos; + error.message);
          if (!navigator.onLine) {
            console.error(&apos;Theres no internet connection&apos;);
            // To do: control here in internet what you wanna do if user has no internet
          } else {
            console.error(&apos;Server Error:&apos; + error.message);
            // To do: control here if the server gave an error
          }
          break;
        default:
          console.error(&apos;Error:&apos; + error.message);
          // To do: control here if the client/other things gave an error
      }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class can be used to control the different type of errors. If wanted, the <code>classname</code> variable could be used to add more switch cases. This would allow control of more specific situations.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-error-handler.asciidoc_creating-a-errorinterceptor">Creating a ErrorInterceptor</h5>
<div class="paragraph">
<p>Inside the same folder created in the last step we are going to create the <code>ErrorInterceptor</code>(<code>errors-handler-interceptor.ts</code>). This <code>ErrorInterceptor</code> is going to retry any failed calls to the server to make sure it is not being found before showing the error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent } from &apos;@angular/common/http&apos;;
import { Injectable } from &apos;@angular/core&apos;;
import { Observable } from &apos;rxjs&apos;;
import { retry } from &apos;rxjs/operators&apos;;

@Injectable()
export class ErrorsHandlerInterceptor implements HttpInterceptor {

    constructor() {}
    intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {
        return next.handle(req).pipe(
            retryWhen((errors: Observable&lt;any&gt;) =&gt; errors.pipe(
                delay(500),
                take(5),
                concatMap((error: any, retryIndex: number) =&gt; {
                    if (++retryIndex === 5) {
                        throw error;
                    }
                    return of(error);
                })
            ))
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This custom made interceptor is implementing the <code>HttpInterceptor</code> and inside the method <code>intercept</code> using the method <code>pipe</code>,<code>retryWhen</code>,<code>delay</code>,<code>take</code> and <code>concatMap</code> from <a href="https://rxjs-dev.firebaseapp.com/api">RxJs</a> it is going to do the next things if there is errors:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>With <code>delay(500)</code> do a delay to allow some time in between requests</p>
</li>
<li>
<p>With <code>take(5)</code> retry five times.</p>
</li>
<li>
<p>With <code>concatMap</code> if the index that <code>take()</code> gives is not 5 it returns the error, else, it throws the error.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="guide-error-handler.asciidoc_creating-a-error-module">Creating a Error Module</h5>
<div class="paragraph">
<p>Finally, creating a module(<code>errors-handler.module.ts</code>) is necessary to include the <code>interceptor</code> and the custom error handler. In this case, the module is going to be created in the same folder as the last two:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { NgModule, ErrorHandler } from &apos;@angular/core&apos;;
import { CommonModule } from &apos;@angular/common&apos;;
import { ErrorsHandler } from &apos;./errors-handler&apos;;
import { HTTP_INTERCEPTORS } from &apos;@angular/common/http&apos;;
import { ErrorsHandlerInterceptor } from &apos;./errors-handler-interceptor&apos;;

@NgModule({
  declarations: [], // Declare here component if you want to use routing to error component
  imports: [
    CommonModule
  ],
  providers: [
    {
      provide: ErrorHandler,
      useClass: ErrorsHandler,
    },
    {
      provide: HTTP_INTERCEPTORS,
      useClass: ErrorsHandlerInterceptor,
      multi: true,
    }
  ]
})
export class ErrorsHandlerModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This module simply is providing the services that are implemented by our custom classes and then telling angular to use our custom made classes instead of the default ones. After doing this, the module has to be included in the app module <code>app.module.ts</code> in order to be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">....
  imports: [
    ErrorsHandlerModule,
    ....</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-error-handler.asciidoc_handling-errors">18.10.3. Handling Errors</h4>
<div class="paragraph">
<p>As a final step, handling these errors is necessary. Theres different ways that can be used to control the errors, here are a few:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a custom page and using with <code>Router</code> to redirect to a page showing an error.</p>
</li>
<li>
<p>Creating a service in the server side or <code>Backend</code> to create a log with the error and calling it with <code>HttpClient</code>.</p>
</li>
<li>
<p>Showing a custom made <code>SnackBar</code> with the error message.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="guide-error-handler.asciidoc_using-snackbarservice-and-ngzone">Using <code>SnackBarService</code> and <code>NgZone</code></h6>
<div class="paragraph">
<p>If the <a href="https://material.angular.io/components/snack-bar/overview">SnackBar</a> is used directly, some errors can ocurr, this is due to <code>SnackBar</code> being out of the <code>Angular</code> zone. In order to use this service properly, <a href="https://angular.io/api/core/NgZone">NgZone</a> is necessary. The method <code>run()</code> from <code>NgZone</code> will allow the service to be inside the <code>Angular Zone</code>. An example on how to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-TypeScript" data-lang="TypeScript">import { ErrorHandler, Injectable, Injector, NgZone } from &apos;@angular/core&apos;;
import { HttpErrorResponse } from &apos;@angular/common/http&apos;;
import { MatSnackBar } from &apos;@angular/material&apos;;

@Injectable()
export class ErrorsHandler implements ErrorHandler {

    constructor(private injector: Injector, private zone: NgZone) {}

    handleError(error: Error | HttpErrorResponse) {
      // Use injector to get the necessary services to redirect or
      const snackBar: MatSnackBar = this.injector.get(MatSnackBar);
      const classname  = error.constructor.name;
      let message: string;
      switch ( classname )  {
        case &apos;HttpErrorResponse&apos;:
          message = !(navigator.onLine) ? &apos;There is no internet connection&apos; : error.message;
          break;
        default:
          message = error.message;
      }
      this.zone.run(
        () =&gt; snackBar.open(message, &apos;danger&apos;, { duration : 4000})
      );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>Injector</code> the <code>MatSnackBar</code> is obtained, then the correct message is obtained inside the switch. Finally, using <code>NgZone</code> and <code>run()</code>, we open the <code>SnackBar</code> passing the message, and the paremeters wanted.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-file-structure.asciidoc">18.11. File Structure</h3>
<div class="sect3">
<h4 id="guide-file-structure.asciidoc_toplevel">18.11.1. Toplevel</h4>
<div class="paragraph">
<p>The toplevel file structure is defined by Angular CLI. You might put this &quot;toplevel file structure&quot; into a subdirectory to facilitate your build, but this is not relevant for this guide. So the applications file structure relevant to this guide is the folder <code>/src/app</code> inside the part managed by Angular CLI.</p>
</div>
<div class="listingblock">
<div class="title">Listing 46. Toplevel file structure shows feature modules</div>
<div class="content">
<pre class="highlight"><code>    /src
    &#x2514;&#x2500;&#x2500; /app
        &#x251C;&#x2500;&#x2500; /account-management
        &#x251C;&#x2500;&#x2500; /billing
        &#x251C;&#x2500;&#x2500; /booking
        &#x251C;&#x2500;&#x2500; /core
        &#x251C;&#x2500;&#x2500; /shared
        &#x251C;&#x2500;&#x2500; /status
        |
        &#x251C;&#x2500;&#x2500; app.module.ts
        &#x251C;&#x2500;&#x2500; app.component.spec.ts
        &#x251C;&#x2500;&#x2500; app.component.ts
        &#x2514;&#x2500;&#x2500; app.routing-module.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides the definition of app module the <code>app</code> folder has feature modules on toplevel.
The special modules <em>shared</em> and <em>core</em> are present as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-file-structure.asciidoc_feature-modules">18.11.2. Feature Modules</h4>
<div class="paragraph">
<p>A feature module contains the modules definition and two folders representing both layers.</p>
</div>
<div class="listingblock">
<div class="title">Listing 47. Feature module file structure has both layers</div>
<div class="content">
<pre class="highlight"><code>    /src
    &#x2514;&#x2500;&#x2500; /app
        &#x2514;&#x2500;&#x2500; /account-management
            &#x251C;&#x2500;&#x2500; /components
            &#x251C;&#x2500;&#x2500; /services
            |
            &#x251C;&#x2500;&#x2500; account-management.module.ts
            &#x251C;&#x2500;&#x2500; account-management.component.spec.ts
            &#x251C;&#x2500;&#x2500; account-management.component.ts
            &#x2514;&#x2500;&#x2500; account-management.routing-module.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally an entry component is possible. This would be the case in lazy loading scenarios.
So <code>account-management.component.ts</code> would be only present if <code>account-management</code> is lazy loaded.
Otherwise, the module&#x2019;s routes would be defined <em>Component-less</em>
(see <a href="http://vsavkin.tumblr.com/post/146722301646/angular-router-empty-paths-componentless-routes">vsavkin blog post</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-file-structure.asciidoc_components-layer">18.11.3. Components Layer</h4>
<div class="paragraph">
<p>The component layer reflects the distinction between <em>Smart Components</em> and <em>Dumb Components</em>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 48. Components layer file structure shows Smart Components on toplevel</div>
<div class="content">
<pre class="highlight"><code>    /src
    &#x2514;&#x2500;&#x2500; /app
        &#x2514;&#x2500;&#x2500; /account-management
            &#x2514;&#x2500;&#x2500; /components
                &#x251C;&#x2500;&#x2500; /account-overview
                &#x251C;&#x2500;&#x2500; /confirm-modal
                &#x251C;&#x2500;&#x2500; /create-account
                &#x251C;&#x2500;&#x2500; /forgot-password
                &#x2514;&#x2500;&#x2500; /shared</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every folder inside the <code>/components</code> folder represents a smart component. The only exception is <code>/shared</code>.
<code>/shared</code> contains <em>Dumb Components</em> shared across <em>Smart Components</em> inside the components layer.</p>
</div>
<div class="listingblock">
<div class="title">Listing 49. Smart components contain Dumb components</div>
<div class="content">
<pre class="highlight"><code>    /src
    &#x2514;&#x2500;&#x2500; /app
        &#x2514;&#x2500;&#x2500; /account-management
            &#x2514;&#x2500;&#x2500; /components
                &#x2514;&#x2500;&#x2500; /account-overview
                    &#x251C;&#x2500;&#x2500; /user-info-panel
                    |   &#x251C;&#x2500;&#x2500; /address-tab
                    |   &#x251C;&#x2500;&#x2500; /last-activities-tab
                    |   |
                    |   &#x251C;&#x2500;&#x2500; user-info-panel.component.html
                    |   &#x251C;&#x2500;&#x2500; user-info-panel.component.scss
                    |   &#x251C;&#x2500;&#x2500; user-info-panel.component.spec.ts
                    |   &#x2514;&#x2500;&#x2500; user-info-panel.component.ts
                    |
                    &#x251C;&#x2500;&#x2500; /user-header
                    &#x251C;&#x2500;&#x2500; /user-toolbar
                    |
                    &#x251C;&#x2500;&#x2500; account-overview.component.html
                    &#x251C;&#x2500;&#x2500; account-overview.component.scss
                    &#x251C;&#x2500;&#x2500; account-overview.component.spec.ts
                    &#x2514;&#x2500;&#x2500; account-overview.component.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the folder of a <em>Smart Component</em> the component is defined.
Besides that are folders containing the <em>Dumb Components</em> the <em>Smart Component</em> consists of.
This can be recursive - a <em>Dumb Component</em> can consist of other <em>Dumb Components</em>.
This is reflected by the file structure as well. This way the structure of a view becomes very readable.
As mentioned before, if a <em>Dumb Component</em> is used by multiple <em>Smart Components</em> inside the components layer
it is put inside the <code>/shared</code> folder inside the components layer.</p>
</div>
<div class="paragraph">
<p>With this way of thinking the <em>shared</em> module makes a lot of sense. If a <em>Dumb Component</em> is used by multiple <em>Smart Components</em>
from different feature modules, the <em>Dumb Component</em> is placed into the <em>shared</em> module.</p>
</div>
<div class="listingblock">
<div class="title">Listing 50. The shared module contains Dumb Components shared across Smart Components from different feature modules</div>
<div class="content">
<pre class="highlight"><code>    /src
    &#x2514;&#x2500;&#x2500; /app
        &#x2514;&#x2500;&#x2500; /shared
            &#x2514;&#x2500;&#x2500; /user-panel
                |
                &#x251C;&#x2500;&#x2500; user-panel.component.html
                &#x251C;&#x2500;&#x2500; user-panel.component.scss
                &#x251C;&#x2500;&#x2500; user-panel.component.spec.ts
                &#x2514;&#x2500;&#x2500; user-panel.component.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>The layer folder <code>/components</code> is not necessary inside the <em>shared</em> module.
The <em>shared</em> module only contains components!</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-internationalization.asciidoc">18.12. Internationalization</h3>
<div class="paragraph">
<p>Nowadays, a common scenario in front-end applications is to have the ability to translate labels and locate numbers, dates, currency and so on when the user clicks over a language selector or similar. devon4ng and specifically Angular has a default mechanism in order to fill the gap of such features, and besides there are some wide used libraries that make even easier to translate applications.</p>
</div>
<div class="paragraph">
<p>More info at <a href="https://angular.io/guide/i18n">Angular i18n official documentation</a></p>
</div>
<div class="sect3">
<h4 id="guide-internationalization.asciidoc_devon4ng-i18n-approach">18.12.1. devon4ng i18n approach</h4>
<div class="paragraph">
<p>The official approach could be a bit complicated, therefore the recommended one is to use the recommended library <strong>Transloco</strong> from <a href="https://netbasal.gitbook.io/transloco/" class="bare">https://netbasal.gitbook.io/transloco/</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-internationalization.asciidoc_install-and-configure-transloco">Install and configure Transloco</h5>
<div class="paragraph">
<p>In order to include this library in your devon4ng <strong>Angular &gt;= 7.2</strong> project you will need to execute in a terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ng add @ngneat/transloco</code></pre>
</div>
</div>
<div class="paragraph">
<p>As part of the installation process you&#x2019;ll be presented with questions; Once you answer them, everything you need will automatically be created for you.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, Transloco creates boilerplate files for the requested translations.</p>
</li>
<li>
<p>Next, it will create a new file, <code>transloco-root.module.ts</code> which exposes an Angular&#x2019;s <code>module</code> with a default configuration, and inject it into the <code>AppModule</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">import { HttpClient } from &apos;@angular/common/http&apos;;
import {
  TRANSLOCO_LOADER,
  Translation,
  TranslocoLoader,
  TRANSLOCO_CONFIG,
  translocoConfig,
  TranslocoModule
} from &apos;@ngneat/transloco&apos;;
import { Injectable, NgModule } from &apos;@angular/core&apos;;
import { environment } from &apos;../environments/environment&apos;;

@Injectable({ providedIn: &apos;root&apos; })
export class TranslocoHttpLoader implements TranslocoLoader {
  constructor(private http: HttpClient) {}

  getTranslation(lang: string) {
    return this.http.get&lt;Translation&gt;(`/assets/i18n/${lang}.json`);
  }
}

@NgModule({
  exports: [ TranslocoModule ],
  providers: [
    {
      provide: TRANSLOCO_CONFIG,
      useValue: translocoConfig({
        availableLangs: [&apos;en&apos;, &apos;es&apos;],
        defaultLang: &apos;en&apos;,
        // Remove this option if your application doesn&apos;t support changing language in runtime.
        reRenderOnLangChange: true,
        prodMode: environment.production,
      })
    },
    { provide: TRANSLOCO_LOADER, useClass: TranslocoHttpLoader }
  ]
})
export class TranslocoRootModule {}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As you might have noticed it also set an <code>HttpLoader</code> into the module&#x2019;s providers. The <code>HttpLoader</code> is a class that implements the <code>TranslocoLoader</code> interface. It&#x2019;s responsible for instructing Transloco how to load the translation files. It uses Angular HTTP client to fetch the files, based on the given path.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="guide-internationalization.asciidoc_usage">Usage</h5>
<div class="paragraph">
<p>In order to translate any label in any HTML template you will need to use the <code>transloco</code> pipe available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">{{ &apos;HELLO&apos; | transloco }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <strong>optional</strong> parameter from the component TypeScript class could be included as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">{{ &apos;HELLO&apos; | transloco: { value: dynamic } }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to use with <code>inputs</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;span [attr.alt]=&quot;&apos;hello&apos; | transloco&quot;&gt;Attribute&lt;/span&gt;
&lt;span [title]=&quot;&apos;hello&apos; | transloco&quot;&gt;Property&lt;/span&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to change the language used you will need to create a button or selector that calls the <code>this.translocoService.use(language: string)</code> method from <code>TranslocoService</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">export class AppComponent {
  constructor(private translocoService: TranslocoService) {}

  changeLanguage(lang) {
      this.translocoService.setActiveLang(lang);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The translations will be included in the <code>en.json</code>, <code>es.json</code>, <code>de.json</code>, etc. files inside the <code>/assets/i18n</code> folder. For example <code>en.json</code> would be (using the previous param):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    &quot;HELLO&quot;: &quot;hello&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with an <strong>optional param</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    &quot;HELLO&quot;: &quot;hello {{value}}&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Transloco understands nested JSON objects. This means that you can have a translation that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    &quot;HOME&quot;: {
        &quot;HELLO&quot;: &quot;hello {{value}}&quot;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to access access the value, use the dot notation, in this case <code>HOME.HELLO</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-internationalization.asciidoc_using-the-service">Using the service, pipe or directive</h5>
<div class="sect5">
<h6 id="guide-internationalization.asciidoc_structural-directive">Structural Directive</h6>
<div class="paragraph">
<p>Using a structural directive is the <strong>recommended</strong> approach. It&#x2019;s DRY and efficient, as it creates <strong>one</strong> subscription per template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">&lt;ng-container *transloco=&quot;let t&quot;&gt;
  &lt;p&gt;{{ t(&apos;title&apos;) }}&lt;/p&gt;

  &lt;comp [title]=&quot;t(&apos;title&apos;)&quot;&gt;&lt;/comp&gt;
&lt;/ng-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>t</code> function is <strong>memoized</strong>. It means that given the same <code>key</code> it will return the result directly from the cache.</p>
</div>
<div class="paragraph">
<p>We can pass a <code>params</code> object as the second parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">&lt;ng-container *transloco=&quot;let t&quot;&gt;
  &lt;p&gt;{{ t(&apos;name&apos;, { name: &apos;Transloco&apos; }) }}&lt;/p&gt;
&lt;/ng-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can instruct the directive to use a different language in our template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">&lt;ng-container *transloco=&quot;let t; lang: &apos;es&apos;&quot;&gt;
  &lt;p&gt;{{ t(&apos;title&apos;) }}&lt;/p&gt;
&lt;/ng-container&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-internationalization.asciidoc_pipe">Pipe</h6>
<div class="paragraph">
<p>The use of pipes can be possible too:</p>
</div>
<div class="paragraph">
<p>template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">&lt;div&gt;{{ &apos;HELLO&apos; | transloco:param }}&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">param = {value: &apos;world&apos;};</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-internationalization.asciidoc_attribute-directive">Attribute Directive</h6>
<div class="paragraph">
<p>The last option available with <code>transloco</code> is the attribute directive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">&lt;div transloco=&quot;HELLO&quot; [translocoParams]=&quot;{ value: &apos;world&apos; }&quot;&gt;&lt;/div&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-internationalization.asciidoc_service">Service</h6>
<div class="paragraph">
<p>If you need to access translations in any component or service you can do it injecting the <code>TranslocoService</code> into them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">// Sync translation
translocoService.translate(&apos;HELLO&apos;, {value: &apos;world&apos;});

// Async translation
translocoService.selectTranslate(&apos;HELLO&apos;, { value: &apos;world&apos; }).subscribe(res =&gt; {
    console.log(res);
    //=&gt; &apos;hello world&apos;
});</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
You can find a complete example at <a href="https://github.com/devonfw/devon4ng-application-template" class="bare">https://github.com/devonfw/devon4ng-application-template</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Please, visit <a href="https://netbasal.gitbook.io/transloco" class="bare">https://netbasal.gitbook.io/transloco</a> for more info.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-routing.asciidoc">18.13. Routing</h3>
<div class="paragraph">
<p>A basic introduction to the Angular Router can be found in <a href="https://angular.io/guide/router">Angular Docs</a>.</p>
</div>
<div class="paragraph">
<p>This guide will show common tasks and best practices.</p>
</div>
<div class="sect3">
<h4 id="guide-routing.asciidoc_defining-routes">18.13.1. Defining Routes</h4>
<div class="paragraph">
<p>For each feature module and the app module all routes should be defined in a seperate module with the suffix <code>RoutingModule</code>.
This way the routing modules are the only place where routes are defined.
This pattern achieves a clear seperation of concernes.
The following figure illustrates this.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/module-declaration.svg"><img src="images/module-declaration.svg" alt="Routing module declaration" width="450"></a>
</div>
<div class="title">Figure 49. Routing module declaration</div>
</div>
<div class="paragraph">
<p>It is important to define routes inside app routing module with <code>.forRoot()</code> and in feature routing modules with <code>.forChild()</code>.</p>
</div>
<div class="sect4">
<h5 id="guide-routing.asciidoc_example-1---no-lazy-loading">Example 1 - No Lazy Loading</h5>
<div class="paragraph">
<p>In this example two modules need to be configured with routes - AppModule and FlightModule.</p>
</div>
<div class="paragraph">
<p>The following routes will be configured</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/</code> will redirect to <code>/search</code></p>
</li>
<li>
<p><code>/search</code> displays FlightSearchComponent (FlightModule)</p>
</li>
<li>
<p><code>/search/print/:flightId/:date</code> displays FlightPrintComponent (FlightModule)</p>
</li>
<li>
<p><code>/search/details/:flightId/:date</code> displays FlightDetailsComponent (FlightModule)</p>
</li>
<li>
<p>All other routes will display ErrorPage404 (AppModule)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 51. app-routing.module.ts</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">const routes: Routes = [
  { path: &apos;&apos;, redirectTo: &apos;search&apos;, pathMatch: &apos;full&apos; },
  { path: &apos;**&apos;, component: ErrorPage404 }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 52. flight-search-routing.module.ts</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">const routes: Routes = [
  {
    path: &apos;search&apos;, children: [
      { path: &apos;&apos;, component: FlightSearchComponent },
      { path: &apos;print/:flightId/:date&apos;, component: FlightPrintComponent },
      { path: &apos;details/:flightId/:date&apos;, component: FlightDetailsComponent }
    ]
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class FlightSearchRoutingModule { }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The import order inside AppModule is important.
AppRoutingModule needs to be imported <strong>after</strong> FlightModule.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="guide-routing.asciidoc_example-2---lazy-loading">Example 2 - Lazy Loading</h5>
<div class="paragraph">
<p>Lazy Loading is a good practice when the application has multiple feature areas and a user might not visit every dialog.
Or at least he might not need every dialog up front.</p>
</div>
<div class="paragraph">
<p>The following example will configure the same routes as example 1 but will lazy load FlightModule.</p>
</div>
<div class="listingblock">
<div class="title">Listing 53. app-routing.module.ts</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">const routes: Routes = [
  { path: &apos;/search&apos;, loadChildren: &apos;app/flight-search/flight-search.module#FlightSearchModule&apos; },
  { path: &apos;**&apos;, component: ErrorPage404 }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 54. flight-search-routing.module.ts</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">const routes: Routes = [
  {
    path: &apos;&apos;, children: [
      { path: &apos;&apos;, component: FlightSearchComponent },
      { path: &apos;print/:flightId/:date&apos;, component: FlightPrintComponent },
      { path: &apos;details/:flightId/:date&apos;, component: FlightDetailsComponent }
    ]
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class FlightSearchRoutingModule { }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-routing.asciidoc_triggering-route-changes">18.13.2. Triggering Route Changes</h4>
<div class="paragraph">
<p>With Angular you have two ways of triggering route changes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declarative with bindings in component HTML templates</p>
</li>
<li>
<p>Programmatic with Angular <code>Router</code> service inside component classes</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the one hand, architecture-wise it is a much cleaner solution to trigger route changes in <em>Smart Components</em>.
This way you have every UI event that should trigger a navigation handled in one place - in a <em>Smart Component</em>.
It becomes very easy to look inside the code for every navigation, that can occure.
Refactoring is also much easier, as there are no navigation events &quot;hidden&quot; in the HTML templates</p>
</div>
<div class="paragraph">
<p>On the other hand, in terms of accessibility and SEO it is a better solution to rely on bindings in the view - e.g. by using Angulars router-link directive.
This way screen readers and the Google crawler can move through the page easily.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you do not have to support accessibility (screen readers, etc.) and to care about SEO (Google rank, etc.),
then you should aim for triggering navigations only in <em>Smart Components</em>.
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/triggering-navigation.svg"><img src="images/triggering-navigation.svg" alt="Triggering navigation" width="350" height="200"></a>
</div>
<div class="title">Figure 50. Triggering navigation</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-routing.asciidoc_guards">18.13.3. Guards</h4>
<div class="paragraph">
<p>Guards are Angular services implemented on routes which determines whether a user can naviagate to/from the route. There are examples below which will explain things better. We have the following types of Guards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CanActivate</strong>: It is used to determine whether a user can visit a route. The most common scenario for this guard is to check if the user is authenticated. For example, if we want only logged in users to be able to go to a particular route, we will implement the <code>CanActivate</code> guard on this route.</p>
</li>
<li>
<p><strong>CanActivateChild</strong>: Same as above, only implemented on child routes.</p>
</li>
<li>
<p><strong>CanDeactivate</strong>: It is used to determine if a user can naviagate away from a route. Most common example is when a user tries to go to a different page after filling up a form and does not save/submit the changes, we can use this guard to confirm whether the user really wants to leave the page without saving/submiting.</p>
</li>
<li>
<p><strong>Resolve</strong>: For resolving dynamic data.</p>
</li>
<li>
<p><strong>CanLoad</strong>: It is used to determine whether an <em>Angular module</em> can be loaded lazily. Example below will be helpful to understand it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#x2019;s have a look at some examples.</p>
</div>
<div class="sect4">
<h5 id="guide-routing.asciidoc_example-1---canactivate-and-canactivatechild-guards">Example 1 - CanActivate and CanActivateChild guards</h5>
<div class="sect5">
<h6 id="guide-routing.asciidoc_canactivate-guard">CanActivate guard</h6>
<div class="paragraph">
<p>As mentioned earlier, a guard is an Angular service and services are simply TypeScript classes. So we begin by creating a class. This class has to implement the <code>CanActivate</code> interface (imported from <code>angular/router</code>), and therefore, must have a <code>canActivate</code> function. The logic of this function determines whether the requested route can be navigated to or not. It returns either a <code>boolean</code> value or an <code>Observable</code> or a <code>Promise</code> which resolves to a <code>boolean</code> value. If it is true, the route is loaded, else not.</p>
</div>
<div class="listingblock">
<div class="title">Listing 55. CanActivate example</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">...
import {CanActivate} from &quot;@angular/router&quot;;

@Injectable()
class ExampleAuthGuard implements CanActivate {
  constructor(private authService: AuthService) {}

  canActivate(route: ActivatedRouterSnapshot, state: RouterStateSnapshot) {
	if (this.authService.isLoggedIn()) {
      return true;
    } else {
	  window.alert(&apos;Please log in first&apos;);
      return false;
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, let&#x2019;s assume we have a <code>AuthService</code> which has a <code>isLoggedIn()</code> method which returns a boolean value depending on whether the user is logged in. We use it to return <code>true</code> or <code>false</code> from the <code>canActivate</code> function.
The <code>canActivate</code> function accepts two parameters (provided by Angular). The first parameter of type <code>ActivatedRouterSnapshot</code> is the snapshot of the route the user is trying to naviagate to (where the guard is implemented); we can extract the route parameters from this instance. The second parameter of type <code>RouterStateSnapshot</code> is a snapshot of the router state the user is trying to naviagate to; we can fetch the URL from it&#x2019;s <code>url</code> property.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
We can also redirect the user to another page (maybe a login page) if the <code>authService</code> returns false. To do that, inject <code>Router</code> and use it&#x2019;s <code>naviagate</code> function to redirect to the appropriate page.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Since it is a service, it needs to be provided in our module:</p>
</div>
<div class="listingblock">
<div class="title">Listing 56. provide the guard in a module</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">@NgModule({
  ...
  providers: [
    ...
    ExampleAuthGuard
  ]
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now this guard is ready to use on our routes. We implement it where we define our array of routes in the application:</p>
</div>
<div class="listingblock">
<div class="title">Listing 57. Implementing the guard</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">...
const routes: Routes = [
  { path: &apos;&apos;, redirectTo: &apos;home&apos;, pathMatch: &apos;full&apos; },
  { path: &apos;home&apos;, component: HomeComponent },
  { path: &apos;page1&apos;, component: Page1Component, canActivate: [ExampleAuthGuard] }
];</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>canActivate</code> property accepts an array of guards. So we can implement more than one guard on a route.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-routing.asciidoc_canactivatechild-guard">CanActivateChild guard</h6>
<div class="paragraph">
<p>To use the guard on nested (children) routes, we add it to the <code>canActivateChild</code> property like so:</p>
</div>
<div class="listingblock">
<div class="title">Listing 58. Implementing the guard on child routes</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">...
const routes: Routes = [
  { path: &apos;&apos;, redirectTo: &apos;home&apos;, pathMatch: &apos;full&apos; },
  { path: &apos;home&apos;, component: HomeComponent },
  { path: &apos;page1&apos;, component: Page1Component, canActivateChild: [ExampleAuthGuard], children: [
	{path: &apos;sub-page1&apos;, component: SubPageComponent},
    {path: &apos;sub-page2&apos;, component: SubPageComponent}
  ] }
];</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-routing.asciidoc_example-2---canload-guard">Example 2 - CanLoad guard</h5>
<div class="paragraph">
<p>Similar to <code>CanActivate</code>, to use this guard we implement the <code>CanLoad</code> interface and overwrite it&#x2019;s <code>canLoad</code> function. Again, this function returns either a boolean value or an <code>Observable</code> or a <code>Promise</code> which resolves to a boolean value. The fundamental difference between <code>CanActivate</code> and <code>CanLoad</code> is that <code>CanLoad</code> is used to determine whether an entire module can be lazily loaded or not. If the guard returns <code>false</code> for a module protected by <code>CanLoad</code>, the entire module is not loaded.</p>
</div>
<div class="listingblock">
<div class="title">Listing 59. CanLoad example</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">...
import {CanLoad, Route} from &quot;@angular/router&quot;;

@Injectable()
class ExampleCanLoadGuard implements CanLoad {
  constructor(private authService: AuthService) {}

  canLoad(route: Route) {
	if (this.authService.isLoggedIn()) {
      return true;
    } else {
	  window.alert(&apos;Please log in first&apos;);
      return false;
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, let&#x2019;s assume we have a <code>AuthService</code> which has a <code>isLoggedIn()</code> method which returns a boolean value depending on whether the user is logged in. The <code>canLoad</code> function accepts a parameter of type Route which we can use to fetch the path a user is trying to navigate to (using the <code>path</code> property of <code>Route</code>).</p>
</div>
<div class="paragraph">
<p>This guard needs to be provided in our module like any other service.</p>
</div>
<div class="paragraph">
<p>To implement the guard, we use the <code>canLoad</code> property:</p>
</div>
<div class="listingblock">
<div class="title">Listing 60. Implementing the guard</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">...
const routes: Routes = [
  { path: &apos;home&apos;, component: HomeComponent },
  { path: &apos;admin&apos;, loadChildren: &apos;app/admin/admin.module#AdminModule&apos;, canLoad: [ExampleCanLoadGuard] }
];</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-testing.asciidoc">18.14. Testing</h3>
<div class="paragraph">
<p>This guide will cover the basics of testing logic inside your code with UnitTests.
The guide assumes that you are familiar with Angular CLI (<a href="master-devon4ng.asciidoc_angular.html#guide-working-with-angular-cli.asciidoc">see the guide</a>)</p>
</div>
<div class="paragraph">
<p>For testing your Angular application with UnitTests there are two main strategies:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Isolated UnitTests<br>
Isolated unit tests examine an instance of a class all by itself without any dependence on Angular or any injected values.
The amount of code and effort needed to create such tests in minimal.</p>
</li>
<li>
<p>Angular Testing Utilities<br>
Let you test components including their interaction with Angular.
The amount of code and effort needed to create such tests is a little higher.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_testing-concept">18.14.1. Testing Concept</h4>
<div class="paragraph">
<p>The following figure shows you an overview of the application architecture devided in testing areas.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/testing-areas.svg"><img src="images/testing-areas.svg" alt="Testing Areas" width="450"></a>
</div>
<div class="title">Figure 51. Testing Areas</div>
</div>
<div class="paragraph">
<p>There are three areas, which need to be covered by different testing strategies.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Components:<br>
Smart Components need to be tested because they contain view logic.
Also the interaction with 3rd party components needs to be tested.
When a 3rd party component changes with an upgrade a test will be failing and warn you, that there is something wrong with the new version.
Most of the time Dumb Components do not need to be teste because they mainly display data and do not contain any logic.
Smart Components are alway tested with <strong>Angular Testing Utilities</strong>.
For example selectors, which select data from the store and transform it further, need to be tested.</p>
</li>
<li>
<p>Stores:<br>
A store contains methods representing state transitions.
If these methods contain logic, they need to be tested.
Stores are always testet using <strong>Isolated UnitTests</strong>.</p>
</li>
<li>
<p>Services:<br>
Services contain Business Logic, which needs to be tested.
UseCase Services represent a whole business use case.
For instance this could be initializing a store with all the data that is needed for a dialog - loading, transforming, storing.
Often <strong>Angular Testing Utilities</strong> are the optimal solution for testing UseCase Services, because they allow for an easy stubbing of the backend.
All other services should be tested with <strong>Isolated UnitTests</strong> as they are much easier to write and maintain.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_testing-smart-components">18.14.2. Testing Smart Components</h4>
<div class="paragraph">
<p>Testing Smart Components should assure the following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Bindings are correct.</p>
</li>
<li>
<p>Selectors which load data from the store are correct.</p>
</li>
<li>
<p>Asynchronous behavior is correct (loading state, error state, &quot;normal&quot; state).</p>
</li>
<li>
<p>Oftentimes through testing one realizes, that important edge cases are forgotten.</p>
</li>
<li>
<p>Do these test become very complex, it is often an indicator for poor code quality in the component.
Then the implementation is to be adjusted / refactored.</p>
</li>
<li>
<p>When testing values received from the native DOM, you will test also that 3rd party libraries did not change with a version upgrade.
A failing test will show you what part of a 3rd party library has changed.
This is much better than the users doing this for you.
For example a binding might fail because the property name was changed with a newer version of a 3rd party library.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the function <code>beforeEach()</code> the TestBed imported from <strong>Angular Testing Utilities</strong> needs to be initialized.
The goal should be to define a minimal test-module with TestBed.
The following code gives you an example.</p>
</div>
<div class="listingblock">
<div class="title">Listing 61. Example test setup for Smart Components</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">describe(&apos;PrintFlightComponent&apos;, () =&gt; {

  let fixture: ComponentFixture&lt;PrintCPrintFlightComponentomponent&gt;;
  let store: FlightStore;
  let printServiceSpy: jasmine.SpyObj&lt;FlightPrintService&gt;;

  beforeEach(() =&gt; {
    const urlParam = &apos;1337&apos;;
    const activatedRouteStub = { params: of({ id: urlParam }) };
    printServiceSpy = jasmine.createSpyObj(&apos;FlightPrintService&apos;, [&apos;initializePrintDialog&apos;]);
    TestBed.configureTestingModule({
      imports: [
        TranslateModule.forRoot(),
        RouterTestingModule
      ],
      declarations: [
        PrintFlightComponent,
        PrintContentComponent,
        GeneralInformationPrintPanelComponent,
        PassengersPrintPanelComponent
      ],
      providers: [
        FlightStore,
        {provide: FlightPrintService, useValue: printServiceSpy},
        {provide: ActivatedRoute, useValue: activatedRouteStub}
      ]
    });
    fixture = TestBed.createComponent(PrintFlightComponent);
    store = fixture.debugElement.injector.get(FlightStore);
    fixture.detectChanges();
  });

  // ... test cases
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>RouterTestingModule`</code> instead of <code>RouterModule</code></p>
</li>
<li>
<p>Use <code>TranslateModule.forRoot()</code> without translations
This way you can test language-neutral without translation marks.</p>
</li>
<li>
<p>Do not add a whole module from your application - in declarations add the tested Smart Component with all its Dumb Components</p>
</li>
<li>
<p>The store should never be stubbed.
If you need a complex test setup, just use the regular methods defined on the store.</p>
</li>
<li>
<p>Stub all services used by the Smart Component.
These are mostly UseCase services.
They should not be tested by these tests.
Only the correct call to their functions should be assured.
The logic inside the UseCase services is tested with seperate tests.</p>
</li>
<li>
<p><code>detectChanges()</code> performance an Angular Change Detection cycle (Angular refreshes all the bindings present in the view)</p>
</li>
<li>
<p><code>tick()</code> performance a virtual marco task, <code>tick(1000)</code> is equal to the virtual passing of 1s.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following test cases show the testing strategy in action.</p>
</div>
<div class="listingblock">
<div class="title">Listing 62. Example</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">it(&apos;calls initializePrintDialog for url parameter 1337&apos;, fakeAsync(() =&gt; {
  expect(printServiceSpy.initializePrintDialog).toHaveBeenCalledWith(1337);
}));

it(&apos;creates correct loading subtitle&apos;, fakeAsync(() =&gt; {
  store.setPrintStateLoading(123);
  tick();
  fixture.detectChanges();

  const subtitle = fixture.debugElement.query(By.css(&apos;app-header-element .print-header-container span:last-child&apos;));
  expect(subtitle.nativeElement.textContent).toBe(&apos;PRINT_HEADER.FLIGHT STATE.IS_LOADING&apos;);
}));

it(&apos;creates correct subtitle for loaded flight&apos;, fakeAsync(() =&gt; {
  store.setPrintStateLoadedSuccess({
    id: 123,
    description: &apos;Description&apos;,
    iata: &apos;FRA&apos;,
    name: &apos;Frankfurt&apos;,
    // ...
  });
  tick();
  fixture.detectChanges();

  const subtitle = fixture.debugElement.query(By.css(&apos;app-header-element .print-header-container span:last-child&apos;));
  expect(subtitle.nativeElement.textContent).toBe(&apos;PRINT_HEADER.FLIGHT &quot;FRA (Frankfurt)&quot; (ID: 123)&apos;);
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The examples show the basic testing method</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the store to a well-defined state</p>
</li>
<li>
<p>check if the component displays the correct values</p>
</li>
<li>
<p>&#x2026;&#x200B; via checking values inside the native DOM.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_testing-state-transitions-performed-by-stores">18.14.3. Testing state transitions performed by stores</h4>
<div class="paragraph">
<p>Stores are always tested with <strong>Isolated UnitTests</strong>.</p>
</div>
<div class="paragraph">
<p>Actions triggered by <code>dispatchAction()</code> calls are asynchronously performed to alter the state.
A good solution to test such a state transition is to use the done callback from Jasmine.</p>
</div>
<div class="listingblock">
<div class="title">Listing 63. Example for testing a store</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">let sut: FlightStore;

beforeEach(() =&gt; {
  sut = new FlightStore();
});

it(&apos;setPrintStateLoading sets print state to loading&apos;, (done: Function) =&gt; {
  sut.setPrintStateLoading(4711);

  sut.state$.pipe(first()).subscribe(result =&gt; {
    expect(result.print.isLoading).toBe(true);
    expect(result.print.loadingId).toBe(4711);
    done();
  });
});

it(&apos;toggleRowChecked adds flight with given id to selectedValues Property&apos;, (done: Function) =&gt; {
  const flight: FlightTO = {
    id: 12
    // dummy data
  };
  sut.setRegisterabgleichListe([flight]);
  sut.toggleRowChecked(12);

  sut.state$.pipe(first()).subscribe(result =&gt; {
    expect(result.selectedValues).toContain(flight);
    done();
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_testing-services">18.14.4. Testing services</h4>
<div class="paragraph">
<p>When testing services both strategies - <strong>Isolated UnitTests</strong> and <strong>Angular Testing Utilities</strong> - are valid options.</p>
</div>
<div class="paragraph">
<p>The goal of such tests are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>assuring the behavior for valid data.</p>
</li>
<li>
<p>assuring the behavior for invalid data.</p>
</li>
<li>
<p>documenting functionality</p>
</li>
<li>
<p>savely performing refactorings</p>
</li>
<li>
<p>thinking about edge case behavior while testing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For simple services <strong>Isolated UnitTests</strong> can be written.
Writing these tests takes lesser effort and they can be written very fast.</p>
</div>
<div class="paragraph">
<p>The following listing gives an example of such tests.</p>
</div>
<div class="listingblock">
<div class="title">Listing 64. Testing a simple services with <strong>Isolated UnitTests</strong></div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">let sut: IsyDatePipe;

beforeEach(() =&gt; {
  sut = new IsyDatePipe();
});

it(&apos;transform should return empty string if input value is empty&apos;, () =&gt; {
  expect(sut.transform(&apos;&apos;)).toBe(&apos;&apos;);
});

it(&apos;transform should return empty string if input value is null&apos;, () =&gt; {
  expect(sut.transform(undefined)).toBe(&apos;&apos;);
});

// ...more tests</code></pre>
</div>
</div>
<div class="paragraph">
<p>For testing Use Case services the Angular Testing Utilities should be used.
The following listing gives an example.</p>
</div>
<div class="listingblock">
<div class="title">Listing 65. Test setup for testing use case services with Angular Testing Utilities</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">let sut: FlightPrintService;
let store: FlightStore;
let httpController: HttpTestingController;
let flightCalculationServiceStub: jasmine.SpyObj&lt;FlightCalculationService&gt;;
const flight: FlightTo = {
  // ... valid dummy data
};

beforeEach(() =&gt; {
  flightCalculationServiceStub = jasmine.createSpyObj(&apos;FlightCalculationService&apos;, [&apos;getFlightType&apos;]);
  flightCalculationServiceStub.getFlightType.and.callFake((catalog: string, type: string, key: string) =&gt; of(`${key}_long`));
  TestBed.configureTestingModule({
    imports: [
      HttpClientTestingModule,
      RouterTestingModule,
    ],
    providers: [
      FlightPrintService,
      FlightStore,
      FlightAdapter,
      {provide: FlightCalculationService, useValue: flightCalculationServiceStub}
    ]
  });

  sut = TestBed.get(FlightPrintService);
  store = TestBed.get(FlightStore);
  httpController = TestBed.get(HttpTestingController);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using TestBed, it is important</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to import HttpClientTestingModule for stubbing the backend</p>
</li>
<li>
<p>to import RouterTestingModule for stubbing the Angular router</p>
</li>
<li>
<p>not to stub stores, adapters and business services</p>
</li>
<li>
<p>to stub services from libraries like FlightCalculationService - the correct implementation of libraries should not be tested by these tests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Testing backend communication looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 66. Testing backend communication with Angular HttpTestingController</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">it(&apos;loads flight if not present in store&apos;, fakeAsync(() =&gt; {
  sut.initializePrintDialog(1337);
  const processRequest = httpController.expectOne(&apos;/path/to/flight&apos;);
  processRequest.flush(flight);

  httpController.verify();
}));

it(&apos;does not load flight if present in store&apos;, fakeAsync(() =&gt; {
  const flight = {...flight, id: 4711};
  store.setRegisterabgleich(flight);

  sut.initializePrintDialog(4711);
  httpController.expectNone(&apos;/path/to/flight&apos;);

  httpController.verify();
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first test assures a correct XHR request is performed if <code>initializePrintDialog()</code> is called and no data is in the store.
The second test assures no XHR request ist performed if the needed data is already in the store.</p>
</div>
<div class="paragraph">
<p>The next steps are checks for the correct implementation of logic.</p>
</div>
<div class="listingblock">
<div class="title">Listing 67. Example testing a Use Case service</div>
<div class="content">
<pre class="highlight"><code class="language-ts" data-lang="ts">it(&apos;creates flight destination for valid key in svz&apos;, fakeAsync(() =&gt; {
  const flightTo: FlightTo = {
    ...flight,
    id: 4712,
    profile: &apos;77&apos;
  };
  store.setFlight(flightTo);
  let result: FlightPrintContent|undefined;

  sut.initializePrintDialog(4712);
  store.select(s =&gt; s.print.content).subscribe(content =&gt; result = content);
  tick();

  expect(result!.destination).toBe(&apos;77_long (ID: 77)&apos;);
}));</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-update-angular-cli.asciidoc">18.15. Update Angular CLI</h3>
<div class="sect3">
<h4 id="guide-update-angular-cli.asciidoc_angular-cli-common-issues">18.15.1. Angular CLI common issues</h4>
<div class="paragraph">
<p>There are constant updates for the official Angular framework dependencies. These dependencies are directly related with the Angular CLI package. Since this package comes installed by default inside the devonfw distribution folder for Windows OS and the distribution is updated every few months it needs to be updated in order to avoid known issues.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-update-angular-cli.asciidoc_angular-cli-update-guide">18.15.2. Angular CLI update guide</h4>
<div class="paragraph">
<p>For <strong>Linux users</strong> is as easy as updating the global package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ npm unistall -g @angular/cli
$ npm install -g @angular/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <strong>Windows users</strong> the process is only a bit harder. Open the <strong>devonfw bundled console</strong> and do as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd [devonfw_dist_folder]
$ cd software/nodejs
$ npm uninstall @angular/cli --no-save
$ npm install @angular/cli --no-save</code></pre>
</div>
</div>
<div class="paragraph">
<p>After following these steps you should have the latest Angular CLI version installed in your system. In order to check it run in the distribution console:</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
At the time of this writing, the Angular CLI is at 1.7.4 version.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">&#x3BB; ng version

     _                      _                 ____ _     ___
    / \   _ __   __ _ _   _| | __ _ _ __     / ___| |   |_ _|
   / &#x25B3; \ | &apos;_ \ / _` | | | | |/ _` | &apos;__|   | |   | |    | |
  / ___ \| | | | (_| | |_| | | (_| | |      | |___| |___ | |
 /_/   \_\_| |_|\__, |\__,_|_|\__,_|_|       \____|_____|___|
                |___/


Angular CLI: 7.2.3
Node: 10.13.0
OS: win32 x64
Angular:
...</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-upgrade-devon4ng.asciidoc">18.16. Upgrade devon4ng Angular and Ionic/Angular applications</h3>
<div class="paragraph">
<p>Angular CLI provides a powerful tool to upgrade Angular based applications to the current stable release of the core framework.</p>
</div>
<div class="paragraph">
<p>This tool is <code>ng update</code>. It will not only upgrade dependencies and their related ones but also will perform some fixes in your code if available thanks to the provided <em>schematics</em>. It will check even if the update is not possible as there is another library or libraries that are not compatible with the versions of the upgraded dependencies. In this case it will keep your application untouched.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The repository must be in a clean state before executing a <code>ng update</code>. So, remember to commit your changes first.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="guide-upgrade-devon4ng.asciidoc_basic-usage">18.16.1. Basic usage</h4>
<div class="paragraph">
<p>In order to perform a basic upgrade we will execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ng update @angular/cli @angular/core</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="guide-upgrade-devon4ng.asciidoc_upgrade-to-new-angular-version">Upgrade to new Angular version</h5>
<div class="paragraph">
<p>The process will be the same, but first we need to make sure that our devon4ng application is in the lates version of Angular 8, so the <code>ng update</code> command can perform the upgrade not only in the dependencies but also making code changes to reflect the new features and fixes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, upgrade to latest Angular 9 version:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ng update @angular/cli@9 @angular/core@9</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally the flag <code>-C</code> can be added to previous command to make a commit automatically. This is also valid for the next steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Then, upgrade Angular:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ng update @angular/cli @angular/core</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In case you use Angular Material:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ng update @angular/material</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If the application depends on third party libraries, the new tool <code>ngcc</code> can be run to make them compatible with the new <strong>Ivy compiler</strong>. In this case it is recommended to include a <code>postinstall</code> script in the <code>package.json</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  &quot;scripts&quot;: {
    &quot;postinstall&quot;: &quot;ngcc --properties es2015 browser module main --first-only --create-ivy-entry-points&quot;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information at <a href="https://angular.io/guide/updating-to-version-9" class="bare">https://angular.io/guide/updating-to-version-9</a> and <a href="https://angular.io/guide/ivy" class="bare">https://angular.io/guide/ivy</a>.</p>
</div>
<div class="paragraph">
<p><strong>Important use cases:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>To update to the next beta or pre-release version, use the <code>--next=true</code> option.</p>
</li>
<li>
<p>To update from one major version to another, use the format <code>ng update @angular/cli@^&lt;major_version&gt; @angular/core@^&lt;major_version&gt;</code>.</p>
</li>
<li>
<p>In case your Angular application uses <code>@angular/material</code> include it in the first command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ng update @angular/cli @angular/core @angular/material</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-upgrade-devon4ng.asciidoc_ionicangular-applications">Ionic/Angular applications</h5>
<div class="paragraph">
<p>Just following the same procedure we can upgrade Angular applications, but we must take care of important specific Ionic dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ng update @angular/cli @angular/core @ionic/angular @ionic/angular-toolkit [@ionic/...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-upgrade-devon4ng.asciidoc_other-dependencies">Other dependencies</h5>
<div class="paragraph">
<p>Every application will make use of different dependencies. Angular CLI <code>ng upgrade</code> will also take care of these ones. For example, if you need to upgrade <code>@capacitor</code> you will perform:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ng update @capacitor/cli @capacitor/core [@capacitor/...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example could be that you need to upgrade <code>@ngx-translate</code> packages. As always in this case you will execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ng update @ngx-translate/core @ngx-translate/http-loader</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-upgrade-devon4ng.asciidoc_angular-update-guide-online-tool">Angular Update Guide online tool</h5>
<div class="paragraph">
<p>It is recommended to use the Angular Update Guide tool at <a href="https://update.angular.io/" class="bare">https://update.angular.io/</a> that will provide the necessary steps to upgrade any Angular application depending on multiple criteria.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-working-with-angular-cli.asciidoc">18.17. Working with Angular CLI</h3>
<div class="paragraph">
<p>Angular CLI provides a facade for building, testing, linting, debugging and generating code.
Under the hood Angular CLI uses specific tools to achieve these tasks.
The user does no need to maintain them and can rely on Angular to keep them up to date and maybe switch to other tools which come up in the future.</p>
</div>
<div class="paragraph">
<p>The Angular CLI provides a wiki with common tasks you encounter when working on applications with the Angular CLI.
<a href="https://github.com/angular/angular-cli/wiki">The Angular CLI Wiki can be found here.</a></p>
</div>
<div class="paragraph">
<p>In this guide we will go through the most important tasks.
To go into more details, please visit the Angular CLI wiki.</p>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_installing-angular-cli">18.17.1. Installing Angular CLI</h4>
<div class="paragraph">
<p>Angular CLI should be added as global and local dependency.
The following commands add Angular CLI as global Dependency.</p>
</div>
<div class="paragraph">
<p>yarn command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">yarn global add @angular/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>npm command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">npm install -g @angular/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check a successful installtion with <code>ng --version</code>.
This should print out the version installed.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install-cli-success.png"><img src="images/install-cli-success.png" alt="Printing Angular CLI Version" width="450"></a>
</div>
<div class="title">Figure 52. Printing Angular CLI Version</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_running-a-live-development-server">18.17.2. Running a live development server</h4>
<div class="paragraph">
<p>The Angular CLI can be used to start a live development server.
First your application will be compiled and then the server will be started.
If you change the code of a file, the server will reload the displayed page.
Run your application with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ng serve -o</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_running-unit-tests">18.17.3. Running Unit Tests</h4>
<div class="paragraph">
<p>All unit tests can be executed with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ng test</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a single run and create a code coverage file use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ng test -sr -cc</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can configure the output format for code coverage files to match your requirements in the file <code>karma.conf.js</code> which can be found on toplevel of your project folder.
For instance, this can be useful for exporting the results to a SonarQube.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_linting-the-code-quality">18.17.4. Linting the code quality</h4>
<div class="paragraph">
<p>You can lint your files with the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ng lint --type-check</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can adjust the linting rules in the file tslint.json which can be found on toplevel of your project folder.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_generating-code">18.17.5. Generating Code</h4>
<div class="sect4">
<h5 id="guide-working-with-angular-cli.asciidoc_creating-a-new-angular-cli-project">Creating a new Angular CLI project</h5>
<div class="paragraph">
<p>For creating a new Angular CLI project the command <code>ng new</code> is used.</p>
</div>
<div class="paragraph">
<p>The following command creates a new application named my-app.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ng create my-app</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-working-with-angular-cli.asciidoc_creating-a-new-feature-module">Creating a new feature module</h5>
<div class="paragraph">
<p>A new feature module can be created via <code>ng generate module`</code> command.</p>
</div>
<div class="paragraph">
<p>The following command generates a new feature module named todo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ng generate module todo</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/generate-module.png"><img src="images/generate-module.png" alt="Generate a module with Angular CLI" width="450"></a>
</div>
<div class="title">Figure 53. Generate a module with Angular CLI</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The created feature module needs to be added to the AppModule by hand.
Other option would be to define a lazy route in AppRoutingModule to make this a lazy loaded module.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="guide-working-with-angular-cli.asciidoc_creating-a-new-component">Creating a new component</h5>
<div class="paragraph">
<p>To create components the command <code>ng generate component</code> can be used.</p>
</div>
<div class="paragraph">
<p>The following command will generate the component todo-details inside the components layer of todo module.
It will generate a class, a html file, a css file and a test file.
Also, it will register this component as declaration inside the nearest module - this ist TodoModule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ng generate component todo/components/todo-details</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/generate-component.png"><img src="images/generate-component.png" alt="Generate a component with Angular CLI" width="450"></a>
</div>
<div class="title">Figure 54. Generate a component with Angular CLI</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you want to export the component, you have to add the component to exports array of the module.
This would be the case if you generate a component inside shared module.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_configuring-an-angular-cli-project">18.17.6. Configuring an Angular CLI project</h4>
<div class="paragraph">
<p>Inside an Angular CLI project the file <code>.angular-cli.json</code> can be used to configure the Angular CLI.</p>
</div>
<div class="paragraph">
<p>The following options are very important to understand.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The property <code>defaults`</code> can be used to change the default style extension.
The following settings will make the Angular CLI generate <code>.less</code> files, when a new component is generated.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">&quot;defaults&quot;: {
  &quot;styleExt&quot;: &quot;less&quot;,
  &quot;component&quot;: {}
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The property <code>apps</code> contains all applications maintained with Angular CLI.
Most of the time you will have only one.</p>
<div class="ulist">
<ul>
<li>
<p><code>assets</code> configures all the static files, that the application needs - this can be images, fonts, json files, etc.
When you add them to assets the Angular CLI will put these files to the build target and serve them while debugging.
The following will put all files in <code>/i18n</code> to the output folder <code>/i18n</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">&quot;assets&quot;: [
  { &quot;glob&quot;: &quot;**/*.json&quot;, &quot;input&quot;: &quot;./i18n&quot;, &quot;output&quot;: &quot;./i18n&quot; }
]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>styles</code> property contains all style files that will be globally available.
The Angular CLI will create a styles bundle that goes directly into index.html with it.
The following will make all styles in <code>styles.less</code> globally available.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">&quot;styles&quot;: [
  &quot;styles.less&quot;
]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>environmentSource</code> and <code>environments</code> are used to configure configuration with the Angular CLI.
Inside the code always the file specified in <code>environmentSource</code> will be referenced.
You can define different environments - eg. production, staging, etc. - which you list in <code>enviroments</code>.
At compile time the Angular CLI will override all values in <code>environmentSource</code> with the values from the matching environment target.
The following code will build the application for the environment staging.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ng build --environment=staging</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>&#x2190;&#xA0;Previous:&#xA0;<a href="master-devon4ng.asciidoc_guides.html">Guides</a>&#xA0;| &#x2191;&#xA0;Up:&#xA0;<a href="master-devon4ng.asciidoc.html">devon4ng</a>&#xA0;| &#x2302;&#xA0;Home:&#xA0;<a href="master.html">devonfw guide</a>&#xA0;| Next:&#xA0;<a href="master-devon4ng.asciidoc_ionic.html">Ionic</a>&#xA0;&#x2192;</p>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html#introduction-why-should-i-use-devonfw.asciidoc">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_further-information.html">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devon4j.asciidoc_architecture.html">Architecture</a></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">Resources</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-ide-support.asciidoc.html#LICENSE.asciidoc">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script type="module">
      import { UtilsModule } from '/website/shared/utils.js';
      import { HeaderModule } from '/website/components/header/header.js';

      let searchData = { index: null, documents: null };
      UtilsModule.loadIndex(searchData);

      $(window).on('load', function() {
        const queryFun = () => {
          HeaderModule.queryFunction(searchData);
        };

        HeaderModule.searchOnClick(queryFun);
      });
    </script>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<div class="footnote"><sub>

Last updated 2021-05-26 13:02:36 UTC
</sub></div>


<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>

</body></html>