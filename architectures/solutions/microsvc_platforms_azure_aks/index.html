<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Azure Microservice Platforms Solution AKS</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" integrity="sha256-M/Awbb/BYh+Rh0aGjpQid26p1b2OBsrk2k9yAvQxPV0=" crossorigin="anonymous"></script>
<!-- JQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/styles/googlecode.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/lang/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>

<!-- ************** Google analytics ************ -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>

<!-- ******************************************** -->

</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="/website/pages/explore/explore.html">EXPLORE</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">DOCS</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="sect1">
<h2 id="index.asciidoc_azure-microservice-platforms-solution-aks">Azure Microservice Platforms Solution AKS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="index.asciidoc_infrastructure">Infrastructure</h3>
<div class="sect3">
<h4 id="index.asciidoc_overview">Overview</h4>
<div class="paragraph">
<p>The solution is to use Azure Kubernetes Service and the following platform features regarding. The focus of this chapter is to introduce the relevant features. Recommendations for a concrete setup are given in the next chapter.
The platform features that (can) complement Kubernetes are:</p>
</div>
<div class="paragraph">
<p>The services that (can) complement Kubernetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Advisory</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Proactive and actionable recommendations from Azure Advisor based on your configuration and usage telemetry as described here.</p>
</div>
</div>
</div>
</li>
<li>
<p>Provisioning</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use Bridge to Kubernetes to iteratively develop, test, and debug microservices targeted for AKS clusters. It is a <a href="https://azure.microsoft.com/de-de/updates/azure-dev-spaces-is-retiring-on-31-october-2023/">client-only experience</a> offered through extensions in Visual Studio and Visual Studio Code. See Provisioning for general aspects how you can handle provisioning in Azure such as creating pipelines for creating infrastructure.</p>
</div>
</div>
</div>
</li>
<li>
<p>Compliance</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use security measures on networking kevel to avoid public IPs. Combine AKS with additional services to control ingress and outgoing traffic such as Application Gateway or firewalls.</p>
</div>
<div class="paragraph">
<p>Disks used in your AKS cluster can by encrypted by using your own keys through Azure Key Vault.</p>
</div>
<div class="paragraph">
<p>Enforce compliance rules to your cluster and CI/CD pipeline consistently with Azure Policy. Azure Active Directory provides access control with role-based-access-controls (RBAC) and service principals/ managed identities to back RBAC roles. Integration with Azure Security Center can provide security management, intelligent threat detection and actionable recommendations.</p>
</div>
</div>
</div>
</li>
<li>
<p>Desaster recovery</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Higher availability using redundancies across availability zones, protecting applications from datacenter failures. Paired region deployment for disaster recovery.</p>
</div>
</div>
</div>
</li>
<li>
<p>Monitoring</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For infrastructure monitoring see "Monitoring". For infrastructure monitoring specific pages in Azure Monitor exist which will be described here.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The features that (can) complement the resources to be deployed are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provisioning</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Application build pipelines need to build container images and store them in a registry. The native container registry service is Azure Container Registry.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="index.asciidoc_detailed-native-setup">Detailed Native Setup</h4>
<div class="paragraph">
<p>AKS comes with the following additional features regarding the <strong>orchestration platform</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scaling</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Virtual nodes enable network communication between pods that run in Azure Container Instances (ACI) and the AKS cluster. To provide this communication, a virtual network subnet is created and delegated permissions are assigned. Virtual nodes only work with AKS clusters created using advanced networking (Azure CNI). By default, AKS clusters are created with basic networking (kubenet). This implementation allows fast scaling of services for unpredictable traffic.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/virtual_nodes.png" alt="Virtual Nodes" width="1858" height="994">
</div>
</div>
</div>
</div>
</li>
<li>
<p>Compliance</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>Kubernet-dashboard</strong> has been used in the past for attacks. Either disable it or mitigate the attack potential by adding token security.</p>
</div>
<div class="paragraph">
<p>AKS used to rely on <strong>service principals</strong> (SP), which are technical principals in AAD. They came with some challenges like being stored on the nodes and the need to rotate them. SPs allowed an AKS cluster to interact with other Azure resources. Managed service identity (MSI) is a wrapper for SP, it provides auto rotation and if its system assigned then it has the same life cycle as the resource. AKS uses several managed identities for built-in services and add-ons as described <a href="https://docs.microsoft.com/en-us/azure/aks/use-managed-identity">here</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Control plane</p>
</li>
<li>
<p>Agent pool</p>
</li>
<li>
<p>Pod identity (Preview as of 13.10.2021)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Role based access control</strong> (RBAC) can be used for Authentication and Authorization. Predefined roles are: Cluster admin/ Cluster user = developer. Setting it up requires (1) setting up a cluster role and (2) binding the Cluster Role to a user/ cluster identity.</p>
</div>
<div class="paragraph">
<p><strong>Operating system security patches</strong> are automatically pushed to your nodes on a nightly schedule. AKS uses a security hardened operating system image which complies to CIS benchmark.</p>
</div>
<div class="paragraph">
<p><strong>Network security</strong> can be used to reduce attack potential. A private AKS is located inside a VNET and only exposes the ingress controller with a public IP. Interact with the Kubernetes API server as a private endpoint using Azure Private Link. To improve cluster security and minimize attacks, the API server should only be accessible from a limited set of IP address ranges.</p>
</div>
<div class="paragraph">
<p><strong>Azure policies</strong> offer built-in policies to secure pods and built-in initiatives which map to pod security policies. They replace pod security policies and work with gatekeeper/ Open Policy Agent (OPA) under the hood as described here. In Kubernetes, Admission Controllers enforce semantic validation of objects during create, update, and delete operations. With Open Policy Agent (OPA) you can enforce custom policies on Kubernetes objects without recompiling or reconfiguring the Kubernetes API server.</p>
</div>
<div class="paragraph">
<p>The principle of least privilege should be applied to how traffic can flow between pods in an Azure Kubernetes Service (AKS) cluster. Let&#8217;s say you likely want to block traffic directly to back-end applications. The <strong>Network Policy feature</strong> in Kubernetes lets you define rules for ingress and egress traffic between pods in a cluster. <a href="https://docs.microsoft.com/en-us/azure/aks/use-network-policies">Two options</a> for implementation exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Azure&#8217;s own implementation, called Azure Network Policies.</p>
</li>
<li>
<p>Calico Network Policies, an open-source network and network security solution founded by Tigera.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Provisioning</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Environments can be created by logical isolation (namespaces) or phyiscal (multiple clusters). Logical is usually recommended for non dev/test whereas pysical for prod.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>AKS comes with the following additional features regarding the <strong>resources to be deployed</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provisioning</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The following <a href="https://docs.microsoft.com/en-us/azure/aks/operator-best-practices-container-image-management">best practises</a> are recommended:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A container security scan can be included in the <strong>pipelines as quality gate</strong> by using tools like tools such as Twistlock or Aqua.</p>
</li>
<li>
<p>Each time a <strong>base image is updated</strong>, you should also update any downstream container images. Integrate this build process into validation and deployment pipelines such as Azure Pipelines or Jenkins. These pipelines make sure that your applications continue to run on the updated based images. Once your application container images are validated, the AKS deployments can then be updated to run the latest, secure images. Azure Container Registry Tasks can also automatically update container images when the base image is updated. With this feature, you build a few base images and keep them updated with bug and security fixes.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="index.asciidoc_variations">Variations</h4>
<div class="paragraph">
<p>The following additional extra tools can be used in conjunction with Kubernetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Extensions orchestration platform</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>DAPR is a distributed framework that provides application services to applications such as publish subscribe as described here.
Open Service Mesh (OSM) add-on for Azure Kubernetes Service (AKS) is now available in public preview as of 10.09.2021. OSM implements Service Mesh Interface to provide the most common service mesh features as described here.</p>
</div>
</div>
</div>
</li>
<li>
<p>Deployment</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Instead of having to write separate YAML files for each application manually, you can simply create a Helm chart and let Helm deploy the application to the cluster for you. Helm charts contain templates for various Kubernetes resources that combine to form an application. A Helm chart can be customized when deploying it on different Kubernetes clusters. Helm charts can be created in such a way that environment or deployment-specific configurations can be extracted out to a separate file so that these values can be specified when the Helm chart is deployed. For example, you need not have separate charts for deploying an application in development, staging, and production environments.</p>
</div>
</div>
</div>
</li>
<li>
<p>Compliance</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For security reasons and improvement of Helm charts, it is useful to make use of at least one Helm linting tool to ensure your deployments are valid and versioned correctly.</p>
</div>
<div class="paragraph">
<p>Why choosing Polaris as Linting Tool: For helm chart linting, there are several tools like Polaris, kube-score or config-lint available. With Polaris, checks and rules are already given by default, whereby other tools need a lot of custom rules configuration and are therefore more complex to setup. Polaris runs a variety of checks to ensure that Kubernetes pods and controllers are configured using best practices, helping to avoid problems in the future. Polaris can be either installed inside a cluster or as a command-line tool to analyze Kubernetes manifests statically.</p>
</div>
</div>
</div>
</li>
<li>
<p>Configuration</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Tools for accessing sensitive information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>FlexDriver:</strong> Meet rigorous compliance requirements with secrets centrally stored outside of clusters. Access application-specific keys, secrets, and certificates natively within Kubernetes from Azure Key Vault. Mount Azure Key Vault stores via flexvolume driver <a href="https://github.com/Azure/kubernetes-keyvault-flexvol" class="bare">https://github.com/Azure/kubernetes-keyvault-flexvol</a></p>
</li>
<li>
<p><strong>Azure Key Vault to Kubernetes (akv2k8s):</strong> Used for our applications, to make Azure Key Vault secrets, certificates and keys available to use in a secure way. The goals of Azure Key Vault to Kubernetes are to avoid a direct program dependency for getting secrets, secure and low risk to transfer Azure Key Vault secrets and transparently inject secrets into applications. Per default secrets, configurations and certificates can be easily read and accessed by users in Kubernetes and access to them can only be restricted by setting access rights. This will be avoided and is a huge benefit of using akv2k8s with a simple setup of Azure Key Vault and the option to set more detailed restrictions and configurations.</p>
</li>
<li>
<p><a href="https://github.com/Azure/secrets-store-csi-driver-provider-azure/">secrets-store-csi-driver</a> better rated than (akv2k8s). If you want to get from multiple keyvaults secrets using multiple identities you had to have multiple instances of akv2k8s running. And secret store csi driver is more mature in general.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tools for synchronizing configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ArgoCD: Continuous Delivery for Kubernetes: ArgoCD is a leader developed by Intuit and synchronizes changes in the code of applications, photos and cluster definitions, so the Git - repository , to the cluster. The solution is open source software, kept relatively simple and is one of the most important and oldest tools on the market.</p>
</li>
<li>
<p>Flux: Integration of Flux CD into the workflow: Flux basically does the same job as ArgoCD, i.e. synchronizes the repository and cluster in the course of continuous delivery. Flux is also open source and kept simple - the special thing: It comes from the GitOps inventor Weaveworks.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="index.asciidoc_when-to-use">When to use</h3>
<div class="paragraph">
<p>When you need orchestration support due to a higher number of microservices. If you start with a single service then Function App reduces greatly the complexity. You can still later on move to Kubernetes by containerizing your function app code.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html#introduction-why-should-i-use-devonfw.asciidoc">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_further-information.html">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devon4j.asciidoc_architecture.html">Architecture</a></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">Resources</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-ide-support.asciidoc.html#LICENSE.asciidoc">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script type="module">
      import { UtilsModule } from '/website/shared/utils.js';
      import { HeaderModule } from '/website/components/header/header.js';

      let searchData = { index: null, documents: null };
      UtilsModule.loadIndex(searchData);

      $(window).on('load', function() {
        const queryFun = () => {
          HeaderModule.queryFunction(searchData);
        };

        HeaderModule.searchOnClick(queryFun);
      });
    </script>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
<div class="footnote"><sub>

Last updated 2021-10-18 04:29:41 UTC
</sub></div>
</div>
</div>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
</body>
</html>